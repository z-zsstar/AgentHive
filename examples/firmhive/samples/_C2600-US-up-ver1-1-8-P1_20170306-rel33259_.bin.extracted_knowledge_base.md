# _C2600-US-up-ver1-1-8-P1_20170306-rel33259_.bin.extracted 高优先级: 33 中优先级: 88 低优先级: 79

## 优先级评分模型

**计算公式:** `PriorityScore = (0.5 * risk_level) + (0.3 * confidence) + (0.2 * trigger_possibility)`

**分层策略:**
- **高优先级:** `PriorityScore >= 8.5`
- **中优先级:** `7.0 <= PriorityScore < 8.5`
- **低优先级:** `PriorityScore < 7.0`

---

## 高优先级发现

### auth-bypass-guest_account-empty_password

- **文件路径:** `etc/shadow`
- **位置:** `etc/shadow:7`
- **类型:** network_input
- **综合优先级分数:** **9.5**
- **风险等级:** 9.0
- **置信度:** 10.0
- **触发可能性:** 10.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** guest账户密码字段为空(::格式)，允许攻击者无需凭证直接登录系统。触发条件：攻击者通过SSH/Telnet/HTTP认证接口使用guest用户名访问。无任何边界检查或过滤机制，完全绕过身份验证。安全影响：获得初始立足点后，可结合SUID程序或配置缺陷进行权限提升，形成完整攻击链。
- **代码片段:**
  ```
  guest::0:0:99999:7:::
  ```
- **关键词:** guest, shadow, password_field, authentication, UID, login_bypass
- **备注:** 需验证guest账户权限：1) 是否在sudoers列表 2) 可访问的SUID程序 3) 网络服务暴露情况。关联提示：'guest'关键词在知识库中已存在相关发现（如登录接口分析）

---
### attack_chain-credential_exfiltration_via_path_traversal

- **文件路径:** `www/webpages/data/account.pwd.json`
- **位置:** `复合路径：www/cgi-bin/luci → www/webpages/data/account.pwd.json → 登录接口`
- **类型:** attack_chain
- **综合优先级分数:** **9.3**
- **风险等级:** 9.8
- **置信度:** 9.0
- **触发可能性:** 8.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 完整攻击路径：攻击者利用stok验证缺陷绕过认证 → 构造路径遍历请求（如'form=../../data/account.pwd.json'）→ 读取明文凭证文件 → 使用默认凭证(username:password)登录系统。关键环节关联：1) stok_bypass_path_traversal提供初始入口 2) credential_storage-plaintext_account_credentials提供攻击终点。触发概率评估：8.5（依赖路径遍历漏洞可利用性）。约束条件：需web服务器暴露.json文件访问。
- **关键词:** stok, form, path_traversal, account.pwd.json, credential
- **备注:** 整合发现：attack_chain-stok_bypass_path_traversal（初始漏洞）、credential_storage-plaintext_account_credentials（目标文件）。需验证：1) 实际登录接口位置 2) 凭证是否适用于SSH/Web等多服务。

---
### path-traversal-uci-import

- **文件路径:** `sbin/uci`
- **位置:** `sbin/uci:0x98c8`
- **类型:** command_execution
- **综合优先级分数:** **9.25**
- **风险等级:** 9.5
- **置信度:** 9.0
- **触发可能性:** 9.0
- **查询相关性:** 9.8
- **阶段:** N/A
- **描述:** 高危路径遍历漏洞(CWE-22)：在import功能中，用户输入的路径参数未经净化直接传递至uci_import函数。攻击者可通过CLI或网络接口注入含'../'序列的恶意路径(如'uci import ../../../etc/shadow')。触发条件：1) 攻击者拥有CLI执行权限或访问暴露的网络接口 2) 执行import命令。固件中uci以root运行，可导致任意文件读写。
- **代码片段:**
  ```
  uVar14 = param_2[1];
  iVar3 = sym.imp.uci_import(*(iVar1+0x14),*(iVar1+0x18),uVar14);
  ```
- **关键词:** uci_import, import, path_traversal
- **备注:** 完整攻击链：污染源(CLI/Web输入)→传播路径(直接参数传递)→危险操作(root权限文件访问)。需验证：1) Web接口是否暴露import功能 2) uci_import内部是否二次过滤

---
### attack_chain-stok_bypass_firmware_upload

- **文件路径:** `www/webpages/data/firmware.set.json`
- **位置:** `www/cgi-bin/luci`
- **类型:** network_input
- **综合优先级分数:** **9.21**
- **风险等级:** 10.0
- **置信度:** 8.7
- **触发可能性:** 8.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 完整攻击路径：攻击者获取有效stok（通过预测或会话固定）→ 利用固件版本信息（firmware.set.json）定位已知漏洞 → 访问高危接口/admin/firmware → 上传恶意固件 → 触发设备完全控制。新增环节：firmware.set.json暴露的版本信息（3.13.31/WDR3600）降低漏洞利用难度，'ops':'upload'状态可能扩大攻击面。
- **关键词:** stok, /admin/firmware, firmware_upload, system_exec, firmware_version, hardware_version
- **备注:** 整合新发现：info_leak-firmware_config-status（固件信息泄露）作为攻击前置条件。关联路径：www/webpages/data/firmware.set.json → www/cgi-bin/luci

---
### credential_storage-plaintext_account_credentials

- **文件路径:** `www/webpages/data/account.pwd.json`
- **位置:** `www/webpages/data/account.pwd.json`
- **类型:** configuration_load
- **综合优先级分数:** **9.2**
- **风险等级:** 9.0
- **置信度:** 10.0
- **触发可能性:** 8.5
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 文件明文存储默认账户凭证。字段'password'和'confirm'直接存储明文值'password'，用户名固定为'username'。触发条件：攻击者通过路径遍历或未授权访问获取该文件（如访问'/webpages/data/account.pwd.json'）。约束条件：文件位于web可访问目录，但需服务器配置不当暴露文件。安全影响：攻击者可直接获取有效凭证登录系统，实现完全未授权访问。利用方式：结合web目录遍历漏洞直接下载文件提取凭证。
- **代码片段:**
  ```
  "username":"username",
  "password":"password",
  "confirm":"password"
  ```
- **关键词:** password, confirm, username, enable_auth, account.pwd.json
- **备注:** 需验证web服务器是否允许直接访问.json文件。'enable_auth'字段可能控制认证开关；若为false则完全绕过认证。需结合路径遍历漏洞（如network_input-url_mapping-path_traversal）触发文件访问。

---
### network_input-login-stok_hardcoded

- **文件路径:** `www/webpages/data/login.json`
- **位置:** `login.json`
- **类型:** network_input
- **综合优先级分数:** **9.15**
- **风险等级:** 9.5
- **置信度:** 9.0
- **触发可能性:** 8.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 硬编码会话令牌(stok=12345)允许攻击者直接伪造管理员会话。触发条件：在任意HTTP请求中添加stok=12345参数。边界检查缺失：无动态令牌验证机制。安全影响：完全绕过认证获取管理员权限。利用方式：curl -d 'stok=12345' http://target/cgi
- **代码片段:**
  ```
  "stok": "12345",
  "password1": ["E878F...B174B80FA897781FA1E6BCB0C946A11E6DFF9A010F5025B0B1E8EA92BD822BBF33AD", "010001"]
  ```
- **关键词:** stok, password1, password, 010001
- **备注:** 需结合CGI验证私钥存储位置和RSA解密实现；关键词'010001'在知识库中已存在关联记录

---
### env_pollution-opkg-PKG_ROOT_0x13890

- **文件路径:** `bin/opkg`
- **位置:** `bin/opkg:0x13890`
- **类型:** env_set
- **综合优先级分数:** **9.15**
- **风险等级:** 9.5
- **置信度:** 9.0
- **触发可能性:** 8.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** PKG_ROOT注入→路径遍历RCE攻击链：攻击者通过污染全局数据结构（fcn.00017024返回）或命令行参数(opkg_remove_cmd)，在fcn.000137ec(0x13890)设置恶意PKG_ROOT环境变量。污染值传递至包安装脚本，通过fcn.0001621c的路径遍历漏洞实现任意文件覆盖/命令执行。触发条件：包管理操作（param_1[0xd]==4||2）。利用概率高（常见于web/NVRAM暴露场景）。
- **关键词:** PKG_ROOT, setenv, fcn.000137ec, opkg_remove_cmd, fcn.00017024, fcn.0001621c
- **备注:** 完整攻击路径：外部输入→全局数据污染→env设置→脚本执行→路径遍历

---
### configuration_load-proftpd-config_injection

- **文件路径:** `etc/init.d/proftpd`
- **位置:** `etc/init.d/proftpd:40-60 (start函数)`
- **类型:** configuration_load
- **综合优先级分数:** **9.05**
- **风险等级:** 9.0
- **置信度:** 9.5
- **触发可能性:** 8.5
- **查询相关性:** 9.8
- **阶段:** N/A
- **描述:** ProFTPD启动脚本存在配置注入漏洞。具体表现：start()函数中通过'sed -e "s#|HOSTNAME|#$hostname#g"'将主机名变量直接嵌入配置文件，当$hostname（来自uci_get usbshare.global.svrname）包含换行符+恶意指令时，会被ProFTPD解析为有效配置。触发条件：1) 攻击者通过Web接口/NVRAM修改usbshare.global.svrname值（如设置为'恶意主机名\nRootLogin on\n'） 2) 重启proftpd服务。实际影响：可注入任意ProFTPD指令（如开启root登录、加载恶意模块），导致未授权访问或远程代码执行。
- **代码片段:**
  ```
  local hostname="$(uci_get usbshare.global.svrname)"
  sed -e "s#|HOSTNAME|#$hostname#g" $PROFTPD_CFG_ORIG > $PROFTPD_CFG_FILE
  ```
- **关键词:** hostname, uci_get, usbshare.global.svrname, sed, |HOSTNAME|, PROFTPD_CFG_FILE, proftpd.conf, start()
- **备注:** 关联漏洞：1) 同主机名配置被samba/minidlna服务使用 2) 需验证Web接口的svrname设置路径（建议后续分析/usr/lib/lua/luci/controller/usbshare.lua）

---
### network_input-uhttpd-config_injection

- **文件路径:** `etc/inittab`
- **位置:** `init.d/uhttpd:32`
- **类型:** network_input
- **综合优先级分数:** **9.05**
- **风险等级:** 9.5
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 独立网络攻击路径：攻击者通过Web接口篡改uhttpd配置中的commonname参数（需配置写入漏洞）。当uhttpd服务重启时，generate_keys函数直接拼接污染值执行px5g，实现命令注入。此路径不依赖rcS参数传递，触发条件更明确。
- **代码片段:**
  ```
  $PX5G_BIN selfsigned -der ... -subj /C="${country:-DE}"/.../CN="${commonname:-OpenWrt}"
  ```
- **关键词:** generate_keys, commonname, px5g, config_get, /etc/config/uhttpd
- **备注:** 后续必须分析：1) /etc/config/uhttpd的配置保护机制 2) px5g是否存在参数注入漏洞

---
### attack_path-uci_to_command_injection

- **文件路径:** `etc/init.d/pptpd`
- **位置:** `multiple: /etc/config/pptpd → /etc/init.d/pptpd`
- **类型:** attack_path
- **综合优先级分数:** **9.0**
- **风险等级:** 9.0
- **置信度:** 9.0
- **触发可能性:** 9.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 完整攻击链：UCI配置污染 → 命令注入
- 步骤：
  1. 攻击者篡改/etc/config/pptpd的samba_access字段（值：';telnetd -l /bin/sh;'）
  2. 触发'/etc/init.d/pptpd restart'服务重启
  3. start()函数执行'fw pptp_access ;telnetd -l /bin/sh;'
  4. 系统开启telnet后门服务
- 可行性：高（仅需配置修改权限）
- 关键性评分：9.0
- **关键词:** attack_path_uci_command_chain, command_execution-pptpd-start_smbacc_injection, UCI配置污染, samba_access, pptpd
- **备注:** 关联漏洞：command_execution-pptpd-start_smbacc_injection

---
### attack_chain-stok_bypass_firmware_upload

- **文件路径:** `www/webpages/url_to_json/nat_url_to_json_ljj.txt`
- **位置:** `www/cgi-bin/luci`
- **类型:** network_input
- **综合优先级分数:** **8.95**
- **风险等级:** 10.0
- **置信度:** 8.5
- **触发可能性:** 7.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 完整攻击路径：攻击者获取有效stok（通过预测或会话固定）→ 访问高危接口/admin/firmware → 上传恶意固件 → 触发设备完全控制。关键环节：1) stok保护机制失效（binary_analysis-luci-stok_validation）2) 固件升级接口暴露（network_input-admin_interface-exposure）3) 潜在命令注入风险（需验证firmware.set.json处理逻辑）。触发概率评估：7.0（依赖stok强度）
- **关键词:** stok, /admin/firmware, firmware_upload, system_exec
- **备注:** 关联发现：binary_analysis-luci-stok_validation（认证绕过）、network_input-admin_interface-exposure（接口暴露）

---
### heap_overflow-ubus_message_parser-fcn00008f08

- **文件路径:** `sbin/ubusd`
- **位置:** `fcn.00008f08:0x8f64`
- **类型:** network_input
- **综合优先级分数:** **8.94**
- **风险等级:** 9.2
- **置信度:** 8.8
- **触发可能性:** 8.5
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 负值长度参数导致堆溢出：当攻击者通过Unix socket发送特制UBus消息（param_3=0且param_2<0）时，触发fcn.00008f08漏洞路径。calloc基于有符号param_2+20分配极小堆块（如param_2=-20时分配0字节），但memcpy将param_2解释为无符号大整数（最大4GB），向puVar2+5写入超量数据。约束条件：1) param_1≠0提供污染源；2) calloc返回非NULL指针。安全影响：完全控制堆破坏范围，结合堆风水可实现任意代码执行。
- **代码片段:**
  ```
  if (param_3 == 0) {
    iVar1 = param_2 + 0x14;
    puVar2 = (uint *)sym.imp.calloc(1, iVar1);
    if (param_1 != 0) {
      sym.imp.memcpy(puVar2 + 5, param_1, param_2);
    }
  }
  ```
- **关键词:** fcn.00008f08, param_2, param_3, memcpy, calloc, puVar2, UBus
- **备注:** 触发步骤：1) 建立到/var/run/ubus.sock连接；2) 构造param_2=-1, param_3=0的消息；3) 填充param_1携带shellcode。需后续验证：calloc(0)在目标系统的行为

---
### configuration_source-usbshare.svrname-multi_service

- **文件路径:** `etc/init.d/proftpd`
- **位置:** `全局配置项 (跨/etc/init.d/proftpd和/etc/init.d/samba)`
- **类型:** configuration_source
- **综合优先级分数:** **8.9**
- **风险等级:** 9.2
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 关键配置项'usbshare.global.svrname'被多个服务（ProFTPD/Samba）用作主机名源，且未实施输入过滤。攻击者通过Web/NVRAM接口污染此配置项后，可在服务重启时触发连锁漏洞：1) ProFTPD配置注入（CVE模式）→ 未授权root访问 2) Samba配置注入→ 共享权限绕过。完整攻击链：单一输入点污染 → 多服务沦陷。
- **关键词:** usbshare.global.svrname, uci_get, multi_service, configuration_source, proftpd, samba
- **备注:** 后续关键验证：1) /usr/lib/lua/luci/controller/usbshare.lua中svrname的Web接口过滤机制 2) minidlna服务是否共享同一配置项 3) NVRAM直接修改防护

---
### path_traversal-opkg-OFFLINE_ROOT_0x1077c

- **文件路径:** `bin/opkg`
- **位置:** `bin/opkg:0x1077c`
- **类型:** file_write
- **综合优先级分数:** **8.9**
- **风险等级:** 8.5
- **置信度:** 9.5
- **触发可能性:** 9.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** OFFLINE_ROOT路径遍历漏洞：在fcn.00010334(0x1077c)直接使用getenv获取OFFLINE_ROOT值，未经路径规范化即传入creat64/mkdtemp。攻击者设置类似'/etc/passwd'或'../../../'的值可直接覆盖系统文件或创建恶意目录。触发条件：离线包安装模式。无权限检查（root运行）。
- **关键词:** OFFLINE_ROOT, getenv, fcn.00010334, creat64, mkdtemp
- **备注:** 独立漏洞，无需其他条件即可触发

---
### cmd-injection-ftpex-action_add

- **文件路径:** `sbin/ftpex`
- **位置:** `sbin/ftpex`
- **类型:** network_input
- **综合优先级分数:** **8.85**
- **风险等级:** 9.0
- **置信度:** 8.5
- **触发可能性:** 9.0
- **查询相关性:** 9.8
- **阶段:** N/A
- **描述:** ftpex存在命令注入漏洞。当传入action=add参数时，$port和$mode变量未经任何过滤直接拼接到系统命令（nat add/ftp_access）中。攻击者通过控制这些参数（如传入';reboot;'）可执行任意命令。触发条件：1) 脚本以root权限执行（已确认）2) 外部调用者传入恶意$port或$mode值。利用成功率极高，因脚本全局可写且缺乏任何过滤机制，可导致设备完全控制。
- **代码片段:**
  ```
  if [ -n "$mode" -a "$mode" != "ftp_only" ]; then
      nat add ftp { $port }
  fi
  fw ftp_access $port $mode
  ```
- **关键词:** $port, $mode, nat add, fw ftp_access, action=$1, port=$2, mode=$3
- **备注:** 漏洞实际影响取决于调用组件（如Web接口）是否二次过滤。建议立即检查/sbin/nat和/sbin/fw实现

---
### attack_chain-priv_esc_via_admin_gid0

- **文件路径:** `etc/passwd`
- **位置:** `跨文件攻击链 (etc/passwd + etc/sudoers)`
- **类型:** attack_chain
- **综合优先级分数:** **8.8**
- **风险等级:** 9.0
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 完整攻击链：获取admin凭证 → 利用GID=0权限修改sudoers或setgid程序 → root权限提升。步骤：1) 通过弱口令/信息泄露获取admin密码；2) 登录后修改/etc/sudoers添加'NOPASSWD:ALL'规则或篡改setgid程序；3) 执行特权命令获取root权限。触发条件：存在sudoers写入漏洞或setgid程序配置缺陷。成功概率：高
- **关键词:** admin, GID=0, sudoers, setgid, privilege_escalation
- **备注:** 待验证：1) /etc/sudoers文件权限 2) admin账户可修改的setgid程序列表

---
### network_input-cbi_dom_unfiltered

- **文件路径:** `www/luci-static/resources/cbi.js`
- **位置:** `cbi.js:102-143`
- **类型:** network_input
- **综合优先级分数:** **8.8**
- **风险等级:** 8.0
- **置信度:** 10.0
- **触发可能性:** 9.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 用户输入通过DOM API获取（getElementById/getElementsByName），无输入过滤直接用于逻辑判断。触发条件：攻击者操纵DOM元素值（如隐藏字段）后触发cbi_d_checkvalue检查或表单提交。约束条件：依赖cbi_validators前端验证，但可通过禁用JS或直接发送请求绕过。安全影响：结合后端漏洞可形成完整攻击链（如参数注入）。利用方式：篡改表单字段值提交恶意数据至后端处理接口。
- **代码片段:**
  ```
  var obj = document.getElementById(field);
  value = t.value; // 行118
  value = t.checked ? value : ''; // 行126
  ```
- **关键词:** document.getElementById, document.getElementsByName, value, cbi_d_checkvalue
- **备注:** 需关联分析后端接口（如www/cgi-bin/luci）验证数据处理逻辑；关联知识库ID：network_input-url_to_json-hardcoded_stok_and_param_injection

---
### command_execution-sysupgrade-backup_restore_path_traversal

- **文件路径:** `sbin/sysupgrade`
- **位置:** `sysupgrade:110-136`
- **类型:** command_execution
- **综合优先级分数:** **8.8**
- **风险等级:** 9.0
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 备份/恢复功能存在任意文件覆盖风险。具体表现：1) 使用-b参数时，用户可控的CONF_BACKUP路径直接传递给tar命令，攻击者可通过路径遍历(如../../)覆盖任意文件 2) 使用-r参数时，tar -C /解压用户提供的压缩包到根目录，导致任意文件覆盖。触发条件：攻击者能调用sysupgrade命令并控制备份文件路径或内容。边界检查：未对路径进行规范化或过滤。安全影响：可覆盖系统关键文件获取root权限（如/etc/passwd），利用概率高。
- **代码片段:**
  ```
  tar c${TAR_V}zf "$conf_tar" -T "$CONFFILES"
  tar -C / -x${TAR_V}zf "$CONF_RESTORE"
  ```
- **关键词:** CONF_BACKUP, CONF_RESTORE, do_save_conffiles, tar, add_uci_conffiles
- **备注:** 需验证调用sysupgrade的权限入口（如web接口）

---
### attack_path-credential_injection_to_vpn

- **文件路径:** `etc/init.d/pptpd`
- **位置:** `multiple: /etc/config/pptpd → /etc/ppp/chap-secrets`
- **类型:** attack_path
- **综合优先级分数:** **8.75**
- **风险等级:** 8.5
- **置信度:** 9.0
- **触发可能性:** 9.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 完整攻击链：UCI凭证注入 → VPN权限提升
- 步骤：
  1. 修改/etc/config/pptpd的login节区（username='attacker\nadmin'）
  2. 服务重启时setup_login()向chap-secrets写入伪造凭证
  3. 攻击者使用admin账户连接PPTP VPN
  4. 获取内部网络高权限访问
- 可行性：高（仅需配置修改权限）
- 关键性评分：8.5
- **关键词:** attack_path_uci_credential_chain, credential_injection-pptpd-setup_login_chap, UCI配置污染, CHAP_SECRETS, pptpd
- **备注:** 关联漏洞：credential_injection-pptpd-setup_login_chap

---
### configuration_load-samba-anonymous_write

- **文件路径:** `etc/config/samba`
- **位置:** `etc/config/samba:7-11 (config sambashare)`
- **类型:** configuration_load
- **综合优先级分数:** **8.75**
- **风险等级:** 8.5
- **置信度:** 9.0
- **触发可能性:** 9.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** Samba共享配置允许匿名用户对/mnt目录进行写操作。触发条件：攻击者通过SMB协议（445/tcp）发送请求时，因未设置invalid users限制和未强制最小协议版本(SMB1漏洞)，无需凭据即可上传/修改文件。边界缺失导致：若/mnt目录包含系统脚本、认证文件或可执行程序，可植入恶意文件实现远程代码执行或信息泄露。完整利用链需验证：1) Samba服务运行状态 2) /mnt目录内容 3) 是否联动cron/web服务执行文件。
- **代码片段:**
  ```
  config sambashare
      option name 'mnt'
      option path '/mnt'
      option read_only 'no'
      option guest_ok 'yes'
  ```
- **关键词:** sambashare, guest_ok, path, /mnt, samba_service
- **备注:** 需验证：1) 通过进程分析确认Samba服务运行状态 2) /mnt目录具体内容分析 3) SMBv1协议是否默认启用。关联线索：知识库存在'samba'、'smb.conf.template'等关键词，可能涉及其他Samba配置组件。未解决项：enable状态/passdb_backend/min_protocol配置需通过init脚本验证。

---
### configuration_load-uhttpd-multiple_attack_surfaces

- **文件路径:** `etc/config/uhttpd`
- **位置:** `etc/config/uhttpd`
- **类型:** configuration_load
- **综合优先级分数:** **8.74**
- **风险等级:** 8.0
- **置信度:** 9.8
- **触发可能性:** 9.0
- **查询相关性:** 9.2
- **阶段:** N/A
- **描述:** uHTTPd配置文件暴露多个攻击面：
- **网络监听面**：配置监听0.0.0.0:80/443使所有网络接口成为初始攻击入口，攻击者可通过HTTP/HTTPS请求直接访问服务
- **CGI执行路径**：cgi_prefix设置为'/cgi-bin'，外部输入可直达CGI脚本执行环境，若脚本存在未过滤输入将导致RCE（需验证实际脚本）
- **弱加密风险**：使用1024位RSA证书(px5g配置)，违反NIST最低2048位标准，可被中间人攻击破解（如FREAK攻击），触发条件为HTTPS通信建立
- **DoS漏洞**：max_requests=3与script_timeout=120组合，攻击者仅需4个并发长时请求即可耗尽服务线程，造成拒绝服务
- **边界防护**：rfc1918_filter=1有效缓解DNS重绑定攻击，但仅过滤私有IP段
- **代码片段:**
  ```
  list listen_http	0.0.0.0:80
  list listen_https	0.0.0.0:443
  option cgi_prefix	/cgi-bin
  config cert px5g
  	option bits	1024
  option max_requests 3
  option script_timeout 120
  option rfc1918_filter 1
  ```
- **关键词:** listen_http, listen_https, cgi_prefix, px5g, bits, max_requests, script_timeout, rfc1918_filter
- **备注:** 后续必须分析：1) /www/cgi-bin目录下实际CGI脚本的输入处理逻辑 2) 验证弱证书是否实际部署 3) 测试max_requests的DoS效果

---
### attack_chain-openvpn-config_injection_rce

- **文件路径:** `etc/init.d/openvpn`
- **位置:** `init.d/openvpn: append_params函数`
- **类型:** configuration_load
- **综合优先级分数:** **8.7**
- **风险等级:** 9.0
- **置信度:** 9.0
- **触发可能性:** 7.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 存在未授权配置修改导致远程代码执行（RCE）的完整攻击链：
1. 攻击面：通过Web接口漏洞/弱密码或本地权限提升篡改/etc/config/openvpn
2. 注入点：client_connect配置项（如'script_security 3;client_connect "/bin/sh -c 'malicious command'"'）
3. 传播路径：
   - init.d/openvpn的config_get读取污染配置
   - append_param函数未过滤直接写入/var/etc/openvpn-$s.conf
4. 危险操作：服务重启时OpenVPN以root权限执行恶意命令

触发条件：
- 攻击者能修改OpenVPN配置（需结合其他漏洞）
- 服务重启（可通过cron定时触发）
实际影响：root权限RCE，成功概率7.5/10
- **代码片段:**
  ```
  config_get v "$s" "$p"
  [ -n "$v" ] && append_param "$s" "$p" && echo " $v" >> "/var/etc/openvpn-$s.conf"
  ```
- **关键词:** client_connect, append_param, config_get, /var/etc/openvpn-$s.conf, service_start, UCI
- **备注:** 关键约束：/etc/config/openvpn文件权限未验证。关联知识库笔记：'关联CVE-2020-15078漏洞模式'、'需验证/etc/config/openvpn的写入防护机制'

---
### attack_chain-stok_bypass_path_traversal

- **文件路径:** `www/webpages/url_to_json/nat_url_to_json_ljj.txt`
- **位置:** `复合路径：www/cgi-bin/luci → www/webpages/url_to_json`
- **类型:** network_input
- **综合优先级分数:** **8.65**
- **风险等级:** 9.5
- **置信度:** 8.0
- **触发可能性:** 7.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 完整攻击路径：攻击者利用硬编码/可预测stok（如12345）绕过认证 → 构造含恶意路径的form参数（如'form=../../etc/passwd'）→ 触发后端路径遍历漏洞 → 读取任意敏感文件（如/etc/passwd或缺失的nat.nat.json）。关键环节：1) stok验证缺陷（binary_analysis-luci-stok_validation）2) 路径规范化缺失（network_input-url_mapping-path_traversal）3) 配置文件缺失增加攻击价值（configuration_load-json_missing）。触发概率评估：7.5（依赖stok可预测性）
- **关键词:** stok, form, ../, path_traversal, nat.nat.json
- **备注:** 关联发现：network_input-url_to_json-hardcoded_stok_and_param_injection（硬编码stok）、network_input-url_mapping-path_traversal（路径遍历）、configuration_load-json_missing（目标文件）

---
### network_input-admin_administration-pwd_change

- **文件路径:** `www/webpages/pages/userrpm/password.html`
- **位置:** `www/js/administration.js:? (pwdProxy)`
- **类型:** network_input
- **综合优先级分数:** **8.65**
- **风险等级:** 9.0
- **置信度:** 8.5
- **触发可能性:** 8.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 密码修改功能暴露未加密的敏感参数传输风险：1) 表单通过JavaScript调用/admin/administration?form=account端点 2) 传输old_pwd/new_pwd/cfm_pwd等原始密码参数 3) 客户端仅使用type='password'掩码但无加密处理。若服务端未实施TLS或输入验证，攻击者可截获凭据或注入恶意负载。触发条件：直接访问API端点提交伪造参数。
- **代码片段:**
  ```
  var ACC_PWD_URL_NEW = $.su.url("/admin/administration?form=account");
  var pwdProxy = {
    read: function(para, callback){...}
  }
  ```
- **关键词:** ACC_PWD_URL_NEW, /admin/administration, old_pwd, new_pwd, cfm_pwd, pwdProxy
- **备注:** 需验证服务端CGI对参数的处理：1) 是否检查旧密码有效性 2) 新密码长度/复杂度验证 3) 会话认证机制

---
### attack_chain-samba_config_pollution_to_rce

- **文件路径:** `etc/config/samba`
- **位置:** `跨文件攻击链 (etc/init.d/proftpd + etc/init.d/samba + etc/config/samba)`
- **类型:** ipc
- **综合优先级分数:** **8.65**
- **风险等级:** 9.5
- **置信度:** 8.0
- **触发可能性:** 7.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 完整攻击链：污染usbshare.global.svrname配置项 → 触发smb_add_share2命令注入 → 篡改smb.conf启用匿名写 → 在/mnt目录植入恶意文件 → 通过联动服务（如cron）实现远程代码执行。关键节点：1) 输入点：Web/NVRAM接口污染全局配置（configuration_source-usbshare.svrname）2) 传播点：usbshare export命令注入（command_execution-samba-usbshare_export）3) 漏洞触发点：Samba匿名写权限（configuration_load-samba-anonymous_write）4) 最终危害：/mnt目录文件执行。触发概率评估：需同时满足配置污染+命令注入漏洞利用，但固件多组件耦合设计大幅提高可行性。
- **代码片段:**
  ```
  关联代码段：
  1. etc/init.d/proftpd: uci_get → 加载污染配置
  2. etc/init.d/samba: usbshare export → 生成恶意smb.conf
  3. etc/config/samba: guest_ok=yes → 启用匿名写
  ```
- **关键词:** usbshare.global.svrname, smb_add_share2, sambashare, /mnt, attack_chain
- **备注:** 依赖条件验证：1) Web接口对usbshare.global.svrname的过滤机制 2) /mnt目录是否包含cron任务/web可执行目录 3) usbshare程序逆向分析确认命令注入可行性。关联发现：configuration_source-usbshare.svrname, command_execution-samba-usbshare_export, configuration_load-samba-anonymous_write

---
### buffer_overflow-ubusd-fcn000090a0

- **文件路径:** `sbin/ubusd`
- **位置:** `fcn.000090a0:0x90a0, 0x90ec`
- **类型:** network_input
- **综合优先级分数:** **8.65**
- **风险等级:** 9.0
- **置信度:** 8.5
- **触发可能性:** 8.0
- **查询相关性:** 9.8
- **阶段:** N/A
- **描述:** 高危缓冲区溢出漏洞：函数fcn.000090a0作为uloop_fd_add的回调函数，在0x90a0和0x90ec处直接使用sym.imp.read读取网络数据。关键问题：1) 主循环读取(param_1, param_2, param_3)未验证param_3与目标缓冲区关系；2) 条件分支读取(unaff_r6 + uVar4, 0xc - uVar4)仅验证uVar4<0xc而未检查缓冲区边界。触发条件：当该函数被uloop事件循环激活处理socket数据时，攻击者通过/var/run/ubus.sock发送超长数据包可触发堆/栈溢出，可能实现任意代码执行。
- **代码片段:**
  ```
  iVar2 = sym.imp.read(param_1, param_2, param_3);
  iVar2 = sym.imp.read(*(unaff_r4 + 4), unaff_r6 + uVar4, 0xc - uVar4);
  ```
- **关键词:** fcn.000090a0, sym.imp.read, param_1, param_2, param_3, unaff_r6, uloop_fd_add, /var/run/ubus.sock
- **备注:** 需后续验证：1) /var/run/ubus.sock的实际权限 2) 溢出后内存布局控制可行性

---
### buffer_overflow-ubusd-fcn000090a0

- **文件路径:** `sbin/ubusd`
- **位置:** `fcn.000090a0:0x90a0, 0x90ec`
- **类型:** network_input
- **综合优先级分数:** **8.65**
- **风险等级:** 9.0
- **置信度:** 8.5
- **触发可能性:** 8.0
- **查询相关性:** 9.8
- **阶段:** N/A
- **描述:** 高危缓冲区溢出漏洞：函数fcn.000090a0作为uloop_fd_add的回调函数，在0x90a0和0x90ec处直接使用sym.imp.read读取网络数据。关键问题：1) 主循环读取(param_1, param_2, param_3)未验证param_3与目标缓冲区关系；2) 条件分支读取(unaff_r6 + uVar4, 0xc - uVar4)仅验证uVar4<0xc而未检查缓冲区边界。触发条件：当该函数被uloop事件循环激活处理socket数据时，攻击者通过/var/run/ubus.sock发送超长数据包可触发堆/栈溢出，可能实现任意代码执行。
- **代码片段:**
  ```
  iVar2 = sym.imp.read(param_1, param_2, param_3);
  iVar2 = sym.imp.read(*(unaff_r4 + 4), unaff_r6 + uVar4, 0xc - uVar4);
  ```
- **关键词:** fcn.000090a0, sym.imp.read, param_1, param_2, param_3, unaff_r6, uloop_fd_add, /var/run/ubus.sock
- **备注:** 需后续验证：1) /var/run/ubus.sock的实际权限 2) 溢出后内存布局控制可行性

---
### cmd_injection-opkg-execvp_0x18ec8

- **文件路径:** `bin/opkg`
- **位置:** `bin/opkg:0x18ec8`
- **类型:** command_execution
- **综合优先级分数:** **8.65**
- **风险等级:** 9.0
- **置信度:** 8.5
- **触发可能性:** 8.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 高危命令注入链：在函数fcn.00018e50(0x18ec8)通过execvp执行命令，参数由格式化字符串'%s %s'动态构造（地址0x0001eb31）。参数来源为用户输入（包名），缺少过滤验证。攻击者可通过恶意包名（如'pkg;rm -rf /'）注入命令分隔符。触发条件：执行opkg remove等操作时传递污染参数。安全影响：以root权限执行任意命令，完整设备控制。
- **代码片段:**
  ```
  sym.imp.execvp(**(puVar8 + -0x10),*(puVar8 + -0x10));
  ```
- **关键词:** execvp, fcn.00018e50, param_1, fcn.0000f5a0, remove
- **备注:** 需关联fcn.0000d388确认用户输入点

---
### heap_overflow-ubus_network_handler-fcn00009900

- **文件路径:** `sbin/ubusd`
- **位置:** `fcn.00009900:0x99a4`
- **类型:** network_input
- **综合优先级分数:** **8.55**
- **风险等级:** 9.0
- **置信度:** 8.5
- **触发可能性:** 7.5
- **查询相关性:** 9.3
- **阶段:** N/A
- **描述:** 未验证网络数据长度导致堆溢出：当param_1=0时，fcn.00009900执行`memcpy(puVar4+5, puVar1, uVar3)`。uVar3直接来自网络数据包长度字段（经字节序转换），未经验证即用于拷贝。目标缓冲区puVar4+5由calloc(1, iVar2)分配，iVar2依赖uVar3计算但存在校验缺失。触发条件：发送特殊构造的UBus消息（设置特定标志位使param_1=0）。安全影响：uVar3完全可控（最大4字节无符号值），可精确覆盖堆元数据实现代码执行。
- **代码片段:**
  ```
  if (param_1 + 0 == 0) {
    uVar3 = rev_bytes(*(param_2 + 0x10));
    puVar1 = **0x991c;
    sym.imp.memcpy(puVar4 + 5, puVar1, uVar3);
  }
  ```
- **关键词:** fcn.00009900, uVar3, memcpy, puVar4, calloc, blob_put, 0x991c
- **备注:** 攻击向量：需访问Unix socket。缓解措施验证缺失：未发现seccomp或NX防护

---
### heap_overflow-ubus_network_handler-fcn00009900_v2

- **文件路径:** `sbin/ubusd`
- **位置:** `fcn.00009900:0x99a4`
- **类型:** network_input
- **综合优先级分数:** **8.55**
- **风险等级:** 9.0
- **置信度:** 8.5
- **触发可能性:** 7.5
- **查询相关性:** 9.3
- **阶段:** N/A
- **描述:** 未验证网络数据长度导致堆溢出：当param_1=0时，fcn.00009900执行`memcpy(puVar4+5, puVar1, uVar3)`。uVar3直接来自网络数据包长度字段（经字节序转换），未经验证即用于拷贝。目标缓冲区puVar4+5由calloc(1, iVar2)分配，iVar2依赖uVar3计算但存在校验缺失。触发条件：发送特殊构造的UBus消息（设置特定标志位使param_1=0）。安全影响：uVar3完全可控（最大4字节无符号值），可精确覆盖堆元数据实现代码执行。
- **代码片段:**
  ```
  if (param_1 + 0 == 0) {
    uVar3 = rev_bytes(*(param_2 + 0x10));
    puVar1 = **0x991c;
    sym.imp.memcpy(puVar4 + 5, puVar1, uVar3);
  }
  ```
- **关键词:** fcn.00009900, uVar3, memcpy, puVar4, calloc, blob_put, 0x991c, UBus
- **备注:** 攻击向量：需访问Unix socket。与fcn.00008f08同属UBus消息处理漏洞。缓解措施验证缺失：未发现seccomp或NX防护

---
### command_execution-netifd-run_script-0x00431f20

- **文件路径:** `sbin/netifd`
- **位置:** `netifd:0x00431f20 run_script`
- **类型:** command_execution
- **综合优先级分数:** **8.55**
- **风险等级:** 8.5
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** SCRIPT环境变量命令注入：run_script()直接执行环境变量SCRIPT指定的路径，仅验证文件可执行性(access)。攻击者通过污染SCRIPT变量(如DHCP事件)可执行任意脚本。触发条件：控制DHCP服务或进程环境。安全影响：实现RCE。
- **关键词:** run_script, SCRIPT, execvp, access

---
### memory_corruption-ubus-0xf51c

- **文件路径:** `sbin/netifd`
- **位置:** `sbin/netifd:0xf51c`
- **类型:** configuration_load
- **综合优先级分数:** **8.55**
- **风险等级:** 8.5
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 9.8
- **阶段:** N/A
- **描述:** UCI配置越界读取：通过HTTP/NVRAM传入恶意配置，触发fcn.00011924→blobmsg_parse路径。因缺失长度校验(iVar1)，导致越界内存读取。触发条件：控制UCI配置内容。安全影响：敏感信息泄露(凭证/内存布局)。
- **关键词:** fcn.00011924, blobmsg_parse, iVar1, UCI配置加载

---
### network_input-admin_interface-exposure

- **文件路径:** `www/webpages/url_to_json/nat_url_to_json_ljj.txt`
- **位置:** `www/cgi-bin/luci`
- **类型:** network_input
- **综合优先级分数:** **8.5**
- **风险等级:** 9.0
- **置信度:** 9.0
- **触发可能性:** 6.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 高危操作接口暴露：认证后请求可路由至敏感操作配置（如固件升级firmware.set.json）。触发条件：攻击者获取有效stok令牌后，可发送特制请求至/admin/firmware等接口。实际影响：1) 恶意固件上传导致设备劫持 2) 未验证的备份/恢复操作。约束条件：依赖stok令牌保护强度
- **关键词:** stok, /admin/firmware, firmware.set.json, system.backup.json
- **备注:** 后续必须分析：1) stok生成算法 2) firmware.set.json处理逻辑是否存在命令注入

---

## 中优先级发现

### remote_code_execution-uhttpd_interpreter_injection

- **文件路径:** `etc/init.d/uhttpd`
- **位置:** `etc/init.d/uhttpd:0 (service_start)`
- **类型:** command_execution
- **综合优先级分数:** **8.45**
- **风险等级:** 9.0
- **置信度:** 8.5
- **触发可能性:** 7.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** uhttpd服务的interpreter参数注入漏洞导致远程代码执行。具体表现：1) 启动脚本通过config_get获取用户配置的interpreter路径；2) 路径值未经任何过滤或白名单校验直接拼接到uHTTPD_ARGS参数（使用'-i'选项）；3) 通过service_start传递给uhttpd主进程执行。触发条件：攻击者通过Web接口/NVRAM修改等途径篡改interpreter配置（如设置为/bin/sh）并重启服务。边界检查：完全缺失，可指定任意路径。安全影响：实现远程代码执行（RCE），利用链为：配置写入→服务重启→访问恶意端点触发命令执行。
- **关键词:** interpreter, config_get, UHTTPD_ARGS, -i, service_start, uhttpd
- **备注:** 需后续验证配置修改接口（如Web管理后台）是否存在未授权访问漏洞。关联发现：command_execution-uhttpd_init_param_injection, configuration_load-uhttpd_dynamic_args_vul, service_exposure-uhttpd_multi_instance

---
### network_input-textbox-validation_chain

- **文件路径:** `www/webpages/js/su/widget/form/form.js`
- **位置:** `textbox.js:199/244/314, form.js:283`
- **类型:** network_input
- **综合优先级分数:** **8.45**
- **风险等级:** 8.5
- **置信度:** 9.0
- **触发可能性:** 7.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 前端表单处理存在验证缺陷链：textbox控件的验证逻辑完全依赖外部vtype/validator实现（textbox.js:199），当调用者未正确定义时验证失效；同时长度检查被显式注释（textbox.js:244），且setValue方法直接注入未过滤值（textbox.js:314）。触发条件：1) 表单未配置vtype/validator 2) 提交超长或含恶意脚本的输入。安全影响：攻击者可构造恶意输入绕过前端验证，通过proxy.write（form.js:283）提交至后端API，形成XSS或注入攻击链。
- **代码片段:**
  ```
  // textbox.js验证缺失
  if (vtype && vtype.isVtype === true){...}
  /* lengthCheck注释 */
  me.val(value);
  
  // form.js提交点
  proxy.write(...);
  ```
- **关键词:** vtype, validator, setValue, proxy.write, lengthCheck, val
- **备注:** 关联知识库中vtype验证机制（$.su.vtype）。需追踪proxy.write提交的后端路径（如/cgi-bin/luci）完成攻击链评估。

---
### network_input-cbi_ajax_raw

- **文件路径:** `www/luci-static/resources/cbi.js`
- **位置:** `cbi.js:528-538`
- **类型:** network_input
- **综合优先级分数:** **8.45**
- **风险等级:** 7.5
- **置信度:** 10.0
- **触发可能性:** 8.5
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** AJAX请求使用Request对象传递原始表单数据。触发条件：表单提交时拦截默认行为发送XHR请求。约束条件：依赖后端对参数进行验证。安全影响：攻击者可直接构造恶意请求绕过前端界面。利用方式：篡改请求参数（如注入命令分隔符）触发后端漏洞。
- **代码片段:**
  ```
  event.element().request({
    onSuccess: win,
    onFailure: fail
  });
  ```
- **关键词:** Request, event.element(), onSuccess, onFailure
- **备注:** 建议抓包分析实际请求参数格式及后端接收点；关联知识库ID：command_execution-pptpd-start_smbacc_injection

---
### configuration_load-qfprom-version-write

- **文件路径:** `etc/init.d/commit_sysupgrade`
- **位置:** `commit_sysupgrade: start函数`
- **类型:** configuration_load
- **综合优先级分数:** **8.4**
- **风险等级:** 9.0
- **置信度:** 9.0
- **触发可能性:** 6.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** qfprom版本更新机制存在未验证文件写入漏洞。具体表现：当系统检测到primaryboot配置不一致时（cmp /etc/config/sysupgrade_primaryboot /proc/boot_info/rootfs/primaryboot），直接将/etc/config/sysupgrade_version文件内容写入/sys/devices/system/qfprom/qfprom0/version。触发条件：1) 攻击者需在系统升级流程前植入恶意sysupgrade_version文件 2) 需触发primaryboot状态不一致（可通过异常断电实现）。安全影响：qfprom存储安全启动信任锚，版本篡改可导致启动策略绕过（如降级攻击），成功概率取决于文件写入权限获取难度（需root或利用其他漏洞）。
- **代码片段:**
  ```
  cmp /etc/config/sysupgrade_primaryboot /proc/boot_info/rootfs/primaryboot || {
      if [ -f /etc/config/sysupgrade_version ]; then
          cat /etc/config/sysupgrade_version > /sys/devices/system/qfprom/qfprom0/version
          rm -f /etc/config/sysupgrade_version
      fi
  }
  ```
- **关键词:** /sys/devices/system/qfprom/qfprom0/version, /etc/config/sysupgrade_version, cmp, /proc/boot_info/rootfs/primaryboot, /etc/config/sysupgrade_primaryboot
- **备注:** 需后续分析：1) sysupgrade_version文件生成路径（可能在/lib/upgrade/）2) 内核qfprom驱动对版本号的校验机制

---
### network_input-luci-form_param_mapping

- **文件路径:** `www/webpages/url_to_json/url_to_json_cx.txt`
- **位置:** `/www/cgi-bin/luci:0 (luci_dispatcher) 0x0`
- **类型:** network_input
- **综合优先级分数:** **8.4**
- **风险等级:** 8.0
- **置信度:** 9.0
- **触发可能性:** 8.5
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 该文件定义了9个Web接口端点与JSON配置的映射关系，所有端点均通过URL中的'form'参数接收用户输入。攻击者可构造恶意form参数值触发后端处理逻辑，潜在风险包括：1) 认证端点(/login?form=password)可能被暴力破解或凭证窃取；2) 配置端点(/admin/quick_setup?form=quick_setup)可能被未授权修改路由器设置；3) 映射机制本身若未验证输入，可能造成路径遍历(如form=../../etc/passwd)。触发条件为发送包含恶意form参数的HTTP请求。
- **关键词:** form=quick_setup, form=check_router, form=lang, form=dlogin, form=password, form=vercode, quicksetup.json, login.json, region.json, stok
- **备注:** 必须分析CGI程序(如/www/cgi-bin/luci)如何处理这些映射：1) 验证'form'参数是否过滤特殊字符；2) 检查JSON加载过程是否防护路径遍历；3) 确认认证端点是否实施防暴力破解机制。关键关联文件：/www/cgi-bin/luci 和 各JSON配置文件(如quicksetup.json)。

---
### critical-file-missing-sudoers

- **文件路径:** `www/webpages/url_to_json/url_to_json_szz.txt`
- **位置:** `知识库元分析:0 (全局验证) 0x0`
- **类型:** configuration_load
- **综合优先级分数:** **8.4**
- **风险等级:** 8.0
- **置信度:** 9.0
- **触发可能性:** 8.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 知识库中缺失/etc/sudoers文件分析记录，导致攻击链'attack_chain-priv_esc_via_admin_gid0'的核心环节（admin用户修改sudoers规则）无法验证。此缺口使特权提升路径（risk_level=9.0）的可行性存疑。
- **关键词:** sudoers, privilege_escalation, admin, GID=0
- **备注:** 紧急行动项：1) 定位实际固件中的sudoers文件（可能路径：/etc/sudoers.d/admin）2) 验证文件权限和默认规则 3) 检查admin账户的sudo权限

---
### configuration_load-samba-uci_injection

- **文件路径:** `etc/init.d/samba`
- **位置:** `etc/init.d/samba:? (smb_header)`
- **类型:** configuration_load
- **综合优先级分数:** **8.35**
- **风险等级:** 8.5
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** Samba初始化时通过uci_get获取usbshare.global.svrname/workgroup/denynames等配置项，未过滤直接嵌入sed命令生成smb.conf。攻击者通过修改UCI配置注入换行符/分号可添加恶意Samba配置（如未授权共享）。触发条件：1) 攻击者能修改UCI配置（如Web界面） 2) 重启Samba服务。利用链：污染配置项→生成恶意smb.conf→Samba加载异常配置→共享权限绕过。边界检查缺失。
- **代码片段:**
  ```
  sed -e "s#|NAME|#$hostname#g" \
      -e "s#|WORKGROUP|#$workgroup#g" \
      -e "s#|DENY_LOGIN_NAMES|#$denynames#g" \
      /etc/samba/smb.conf.template > /var/etc/smb.conf
  ```
- **关键词:** uci_get, usbshare.global.svrname, workgroup, denynames, smb.conf.template, sed, /var/etc/smb.conf
- **备注:** 需验证UCI配置写入接口过滤机制。关键关联：/etc/config/usbshare(配置源), /usr/sbin/usbshare(配置写入程序)。后续检查Web界面参数过滤。

---
### configuration_load-dropbear-uci-injection

- **文件路径:** `etc/init.d/dropbear`
- **位置:** `unknown:0 (dropbear_start函数)`
- **类型:** configuration_load
- **综合优先级分数:** **8.35**
- **风险等级:** 8.5
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** UCI配置参数注入风险：脚本通过config_get_bool加载/etc/config/dropbear中的PasswordAuth/RootLogin/BannerFile参数构建启动参数。攻击者篡改配置文件可禁用认证(root登录/密码验证)或指向恶意横幅文件。仅通过[ -f "${val}"]检查文件存在性，未验证内容合法性。成功利用需：1) 攻击者获得配置文件写入权限(如通过Web漏洞/NVRAM注入) 2) 重启dropbear服务。可导致未授权访问或钓鱼攻击。
- **关键词:** PasswordAuth, RootLogin, BannerFile, config_get_bool, append args, /etc/config/dropbear
- **备注:** 需分析/etc/config/dropbear配置文件验证参数可控性；注意：位置信息需后续补充具体文件路径

---
### configuration_load-dnsmasq-dhcp_host_add_injection

- **文件路径:** `etc/init.d/dnsmasq`
- **位置:** `dnsmasq:132 dhcp_host_add()`
- **类型:** configuration_load
- **综合优先级分数:** **8.35**
- **风险等级:** 8.5
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 在dhcp_host_add函数中，未过滤的UCI配置参数($macs/$networkid/$tag/$ip/$name)直接拼接到dnsmasq配置指令。当这些参数包含特殊字符(如逗号、空格或未转义引号)时，攻击者可通过篡改/etc/config/dhcp中的host条目注入额外dnsmasq选项。触发条件：1) 攻击者获得UCI配置写入权限(如通过Web接口漏洞) 2) 服务重启或重载。实际影响：实现DNS重定向(address=/example.com/1.2.3.4)或DHCP欺骗(dhcp-option=6,恶意DNS)，CVSSv3评分8.1(机密性/完整性破坏)。
- **代码片段:**
  ```
  xappend "--dhcp-host=$macs${networkid:+,net:$networkid}${tag:+,set:$tag}${ip:+,$ip}${name:+,$name},infinite"
  ```
- **关键词:** dhcp_host_add, xappend, --dhcp-host, $macs, $networkid, $tag, $ip, $name, config_list_foreach, uci_get_state
- **备注:** 需关联分析Web配置接口(如/www/cgi-bin/xxx)是否暴露UCI写入功能，验证远程触发可行性

---
### attack_chain-dnsmasq_config_injection_via_web

- **文件路径:** `etc/init.d/dnsmasq`
- **位置:** `复合路径：www/cgi-bin/luci → /etc/config/dhcp → dnsmasq服务`
- **类型:** network_input
- **综合优先级分数:** **8.35**
- **风险等级:** 9.0
- **置信度:** 7.5
- **触发可能性:** 8.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 完整攻击路径：攻击者利用luci的stok验证缺陷（如硬编码/可预测stok）获得未授权访问 → 通过Web接口的form参数调用UCI配置写入功能（待验证具体接口）→ 篡改/etc/config/dhcp中的host条目注入恶意参数 → 服务重启触发dnsmasq配置解析漏洞（--dhcp-host指令注入）。触发条件：1) stok可预测或硬编码 2) Web暴露UCI写入接口 3) 特殊字符未过滤。实际影响：完全控制DNS/DHCP服务，实现网络流量劫持。
- **关键词:** stok, form, uci_set, dhcp_host_add, xappend, dnsmasq
- **备注:** 前置条件验证需求：1) 定位具体修改/etc/config/dhcp的Web接口（建议分析/usr/lib/lua/luci/model/cbi/dhcp.lua）2) 测试参数过滤机制 3) 确认服务重启触发方式

---
### command_execution-netifd-init6-0xa95c

- **文件路径:** `sbin/netifd`
- **位置:** `netifd:0xa95c (fcn.0000a95c)`
- **类型:** command_execution
- **综合优先级分数:** **8.35**
- **风险等级:** 8.5
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 高危命令注入漏洞：entry.init6函数通过glob获取/etc/init.d/network.*文件列表，将文件名(param_1)直接拼接至命令字符串执行(popen)。攻击者创建恶意文件名(如`network.;reboot;`)即可触发任意命令执行。触发条件：需写入/etc/init.d/目录权限。安全影响：实现系统级RCE，CVSS≥8.8。
- **代码片段:**
  ```
  sprintf(iVar10, "%s '' dump", param_1);
  iVar10 = popen(iVar10, "r");
  ```
- **关键词:** fcn.0000a95c, param_1, popen, glob, /etc/init.d/network.*
- **备注:** 需验证/etc/init.d目录默认权限

---
### command_execution-pptpd-start_smbacc_injection

- **文件路径:** `etc/init.d/pptpd`
- **位置:** `etc/init.d/pptpd:72 (start)`
- **类型:** command_execution
- **综合优先级分数:** **8.35**
- **风险等级:** 8.5
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 高危命令注入漏洞（start函数）
- 具体表现：$smbacc参数未经过滤直接拼接进fw命令执行
- 触发条件：攻击者通过UCI配置接口修改samba_access值（如';reboot;'）后重启服务
- 边界检查：完全缺失输入验证和过滤机制
- 安全影响：形成完整攻击链（配置污染→服务重启→任意命令执行）
- 利用方式：结合Web接口/XSRF漏洞注入恶意配置触发
- **代码片段:**
  ```
  config_get smbacc "pptpd" "samba_access"
  fw pptp_access $smbacc
  ```
- **关键词:** start, config_get, smbacc, samba_access, fw, pptpd
- **备注:** 关键关联文件：/etc/init.d/fw（需验证命令解析逻辑）

---
### configuration_load-passwd-guest_account_empty_password_validation

- **文件路径:** `etc/passwd`
- **位置:** `/etc/passwd:7`
- **类型:** configuration_load
- **综合优先级分数:** **8.35**
- **风险等级:** 8.5
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** guest账户密码字段为空(::)，但需验证实际登录可行性：1) /etc/shadow中guest账户状态需确认 2) 网络服务(SSH/Telnet)配置需允许空密码认证 3) shell限制(/bin/false)可能阻止交互登录。若验证通过，攻击者可能直接远程登录(UID=2000)。触发条件：网络服务开启+空密码策略启用+shell限制被绕过。
- **关键词:** guest, ::, /etc/passwd, ssh_login, telnet, PAM, /bin/false, PasswordAuth
- **备注:** 与现有攻击链(attack_chain-unauth_access_via_dropbear_tamper)关联；验证要求：1) /etc/shadow内容 2) /etc/ssh/sshd_config中PasswordAuthentication和PermitEmptyPasswords设置 3) PAM策略中nullok参数

---
### boundary-check-ftpex-port_mode

- **文件路径:** `sbin/ftpex`
- **位置:** `sbin/ftpex`
- **类型:** network_input
- **综合优先级分数:** **8.3**
- **风险等级:** 7.5
- **置信度:** 9.5
- **触发可能性:** 8.5
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** 关键参数边界检查缺失。$port作为端口参数未验证范围（1-65535），$mode仅检查非空和'ftp_only'。攻击者可传入无效端口（如0或70000）或异常模式值，导致防火墙规则异常或服务崩溃。触发条件：调用脚本时传入非常规参数值。结合全局可写特性，攻击者可先篡改脚本再触发，实现持久化攻击。
- **代码片段:**
  ```
  local port=$2
  local mode=$3
  # if [ $port -ne 21 ]; then... (注释掉的验证逻辑)
  ```
- **关键词:** port=$2, mode=$3, --dport $port
- **备注:** 端口验证逻辑被显式注释，表明开发者有意移除安全检查，风险确认

---
### association-path_traversal_to_privilege_escalation

- **文件路径:** `www/webpages/data/login.json`
- **位置:** `跨文件关联: login.json + etc/passwd + account.pwd.json`
- **类型:** association
- **综合优先级分数:** **8.3**
- **风险等级:** 9.0
- **置信度:** 8.0
- **触发可能性:** 7.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 复合攻击链：1) 硬编码会话令牌(stok)绕过认证；2) 路径遍历(dst_webpath)读取/etc/passwd确认admin用户(GID=0)；3) 固定RSA指数(010001)破解密码修改接口(old_pwd/new_pwd)控制admin账户；4) 利用admin的root组权限实现权限提升。触发条件：网络访问+密码修改功能开放。边界检查：需验证RSA模数固定性及admin账户在密码修改接口的可用性。安全影响：从认证绕过到完全系统控制(risk_level=9.0)。
- **代码片段:**
  ```
  N/A (多文件关联)
  ```
- **关键词:** dst_webpath, /etc/passwd, admin, GID=0, old_pwd, new_pwd, stok
- **备注:** 关键证据链：1) login.json同时存在stok和dst_webpath；2) /etc/passwd确认特权账户；3) account.pwd.json使用相同RSA指数。需逆向验证：a) RSA模数生成逻辑 b) admin账户密码修改流程

---
### configuration_load-passwd-admin_privilege

- **文件路径:** `etc/passwd`
- **位置:** `etc/passwd:7 () 0x0`
- **类型:** configuration_load
- **综合优先级分数:** **8.25**
- **风险等级:** 8.0
- **置信度:** 9.5
- **触发可能性:** 7.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** admin用户GID=0（root组），使其拥有与root组相关的特权权限。攻击者控制该账户后，可通过修改root组所属文件、执行setgid程序或利用配置缺陷（如sudo规则）提升权限。触发条件：获取admin凭证后存在权限提升路径（如sudo权限不当配置）。
- **代码片段:**
  ```
  admin:x:1000:0:admin:/var:/bin/false
  ```
- **关键词:** admin, GID=0, /etc/passwd, sudoers, setgid
- **备注:** 需检查/etc/sudoers中admin权限；分析admin账户可访问的setgid程序；验证root组文件权限

---
### credential_injection-pptpd-setup_login_chap

- **文件路径:** `etc/init.d/pptpd`
- **位置:** `etc/init.d/pptpd:17-22 (setup_login)`
- **类型:** configuration_load
- **综合优先级分数:** **8.25**
- **风险等级:** 8.0
- **置信度:** 9.5
- **触发可能性:** 7.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 凭证文件注入漏洞（setup_login函数）
- 具体表现：未过滤的username/password直接写入CHAP_SECRETS文件
- 触发条件：控制UCI配置的login节区参数（如username='attacker\nadmin'）
- 边界检查：无特殊字符过滤或转义机制
- 安全影响：注入伪造凭证获取VPN访问权限或破坏认证系统
- 利用方式：通过配置接口注入换行符构造恶意凭证条目
- **代码片段:**
  ```
  echo "$username pptp-server $password *" >> $CHAP_SECRETS
  ```
- **关键词:** setup_login, config_get, username, password, CHAP_SECRETS, PAP_SECRETS, /etc/config/pptpd
- **备注:** 凭证文件符号链接：/var/etc/chap-secrets → /etc/ppp/chap-secrets

---
### ipc-rcS-uhttpd_command_chain

- **文件路径:** `etc/inittab`
- **位置:** `init.d/rcS:7 | init.d/uhttpd:32`
- **类型:** ipc
- **综合优先级分数:** **8.25**
- **风险等级:** 9.0
- **置信度:** 8.5
- **触发可能性:** 6.0
- **查询相关性:** 9.8
- **阶段:** N/A
- **描述:** 系统启动攻击链：攻击者通过调试接口注入$2参数触发rcS重执行（如触发条件：init进程调试模式）。未过滤的$2参数经rcS第7行`$i $2`传递至uhttpd等服务脚本，结合uhttpd的generate_keys函数命令注入漏洞（拼接commonname配置项），实现远程代码执行。完整路径：不可信输入→rcS参数→uhttpd配置→px5g命令执行。
- **代码片段:**
  ```
  [ -x $i ] && $i $2 2>&1
  $PX5G_BIN selfsigned -der ... -subj /C="${country:-DE}"/.../CN="${commonname:-OpenWrt}"
  ```
- **关键词:** ::sysinit, /etc/init.d/rcS, $2, run_scripts, generate_keys, commonname, px5g, UHTTPD_ARGS
- **备注:** 关键验证点：1) /etc/config/uhttpd配置加载机制 2) px5g二进制安全边界 3) init调试接口暴露情况

---
### configuration-dropbear-parameter-tampering

- **文件路径:** `etc/init.d/dropbear`
- **位置:** `etc/init.d/dropbear: dropbear_start()`
- **类型:** configuration_load
- **综合优先级分数:** **8.2**
- **风险等级:** 8.0
- **置信度:** 9.0
- **触发可能性:** 7.5
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 攻击者可通过篡改/etc/config/dropbear文件修改dropbear启动参数：
- 设置PasswordAuth=off可禁用密码认证（添加'-s'参数）
- 修改Interface/Port可暴露服务到未授权网络
- 触发条件：需写入权限修改UCI配置并执行'/etc/init.d/dropbear restart'
- 安全影响：结合其他漏洞（如Web漏洞获取配置写入权限）可形成完整利用链，导致未授权SSH访问
- **关键词:** config_get_bool, append args, PasswordAuth, Interface, Port, /etc/config/dropbear, dropbear_start
- **备注:** 需验证UCI配置写入权限控制机制

---
### crypto_weakness-uhttpd_selfsigned_cert

- **文件路径:** `etc/init.d/uhttpd`
- **位置:** `etc/init.d/uhttpd: generate_keys函数`
- **类型:** command_execution
- **综合优先级分数:** **8.2**
- **风险等级:** 7.5
- **置信度:** 9.5
- **触发可能性:** 8.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 弱证书生成机制：当listen_https启用且UHTTPD_CERT/UHTTPD_KEY证书不存在时，自动调用PX5G_BIN生成RSA-1024自签名证书。弱密钥易被暴力破解，导致HTTPS中间人攻击。触发条件：1) 首次HTTPS服务启动 2) 证书文件被删除。利用无需特权，攻击者可嗅探网络流量解密通信。
- **关键词:** generate_keys, PX5G_BIN, listen_https, UHTTPD_CERT, UHTTPD_KEY
- **备注:** 实际风险取决于PX5G_BIN实现。关联关键词：px5g（证书生成工具）

---
### env_bypass-login-FAILSAFE

- **文件路径:** `bin/login.sh`
- **位置:** `login.sh:3-9`
- **类型:** env_get
- **综合优先级分数:** **8.2**
- **风险等级:** 8.0
- **置信度:** 10.0
- **触发可能性:** 6.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 更新：FAILSAFE环境变量认证绕过漏洞。关键补充：1. 触发条件扩展 - 当FAILSAFE变量被设置为任意非空值（如通过HTTP API注入），即完全跳过密码验证；2. 利用链明确 - 通过网络服务污染环境变量可直接获取root shell；3. 边界缺陷 - 仅检查变量存在性，无值过滤或白名单。原描述保留作为对比。
- **代码片段:**
  ```
  if ( ! grep -qs '^root:[!x]\?:' /etc/shadow || \
       ! grep -qs '^root:[!x]\?:' /etc/passwd ) && \
     [ -z "$FAILSAFE"]
  ```
- **关键词:** FAILSAFE, /etc/shadow, /etc/passwd, authentication_bypass
- **备注:** 关联更新：1. 与密码验证机制（credential_validation-login-shadow_passwd）共享/etc/shadow操作；2. 高危利用链需追踪：a) 网络接口设置环境变量路径 b) NVRAM操作链（如nvram_set→getenv→FAILSAFE）

---
### network_input-admin_administration-pwd_recovery

- **文件路径:** `www/webpages/pages/userrpm/password.html`
- **位置:** `www/js/administration.js:?`
- **类型:** network_input
- **综合优先级分数:** **8.15**
- **风险等级:** 8.5
- **置信度:** 8.0
- **触发可能性:** 7.5
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 密码恢复功能存在多向量注入点：1) 暴露SMTP服务器配置接口(username/password) 2) 开放邮件地址输入(from/to) 3) 启用认证开关(enable_auth)。若服务端未过滤特殊字符，攻击者可注入SMTP命令或XSS载荷。触发条件：篡改ACC_REC_URL_NEW端点(/admin/administration?form=recovery)提交恶意参数。
- **代码片段:**
  ```
  var ACC_REC_URL_NEW = $.su.url("/admin/administration?form=recovery");
  <input name="smtp">
  <input type="password" name="password">
  ```
- **关键词:** ACC_REC_URL_NEW, enable_rec, smtp, enable_auth, username, password
- **备注:** 需检查服务端是否对SMTP参数实施白名单过滤

---
### cryptography-uhttpd-weak_cert_default

- **文件路径:** `etc/init.d/uhttpd`
- **位置:** `etc/init.d/uhttpd: line 25-43`
- **类型:** command_execution
- **综合优先级分数:** **8.11**
- **风险等级:** 7.5
- **置信度:** 9.2
- **触发可能性:** 8.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** HTTPS证书自动生成机制使用弱默认参数：1) 1024位RSA密钥(易被暴力破解) 2) 固定CN=OpenWrt主题 3) 默认国家码(DE)。攻击者通过中间人攻击可解密HTTPS流量，若同时控制配置文件的commonname/bits参数可实现证书欺骗。触发条件：首次HTTPS启用且证书不存在。
- **关键词:** generate_keys, PX5G_BIN, selfsigned, bits, commonname, UHTTPD_KEY
- **备注:** 关联发现：network_input-uhttpd-config_injection。需分析/usr/sbin/px5g实现

---
### configuration_load-dnsmasq-uci_injection

- **文件路径:** `etc/init.d/dnsmasq`
- **位置:** `etc/init.d/dnsmasq (multiple functions)`
- **类型:** configuration_load
- **综合优先级分数:** **8.1**
- **风险等级:** 8.0
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 发现未过滤的UCI配置注入风险：脚本通过config_get/config_list_foreach读取/etc/config/dhcp的配置项（如dhcp_option, server, address等），未经任何过滤直接通过xappend写入/var/etc/dnsmasq.conf。攻击者通过篡改UCI配置（如Web界面漏洞）可注入任意dnsmasq配置指令，触发条件：dnsmasq服务重启时。实际影响：可导致远程代码执行（如注入'--dhcp-script=/malicious.sh'）或DNS重绑定攻击（通过'rebind-domain-ok'）。
- **代码片段:**
  ```
  xappend "--dhcp-option${force:+-force}=${networkid:+$networkid,}$o"
  ```
- **关键词:** config_get, config_list_foreach, xappend, dhcp_option, server, address, CONFIGFILE
- **备注:** 需验证Web配置接口是否存在未过滤输入漏洞

---
### configuration_load-uhttpd_dynamic_args_vul

- **文件路径:** `etc/init.d/uhttpd`
- **位置:** `etc/init.d/uhttpd: service_start调用点`
- **类型:** configuration_load
- **综合优先级分数:** **8.1**
- **风险等级:** 8.0
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 动态参数构建漏洞：通过config_load加载/etc/config/uhttpd配置，使用append_arg/append_bool函数动态构建UHTTPD_ARGS启动参数。关键参数如interpreter(CGI解释器路径)、listen_http(s)(监听端口)未进行路径合法性或端口冲突检查。攻击者篡改配置文件可：1) 修改interpreter指向恶意解释器实现RCE 2) 劫持监听端口实施中间人攻击。触发需具备配置文件写权限（如通过NVRAM注入漏洞）。
- **关键词:** UHTTPD_ARGS, append_arg, append_bool, config_load, interpreter, listen_http, listen_https, start_instance
- **备注:** 需验证/etc/config/uhttpd配置文件是否可被外部修改。关联发现：command_execution-uhttpd_init_param_injection（参数注入风险）

---
### service_exposure-uhttpd_multi_instance

- **文件路径:** `etc/init.d/uhttpd`
- **位置:** `etc/init.d/uhttpd: config_foreach循环`
- **类型:** configuration_load
- **综合优先级分数:** **8.1**
- **风险等级:** 8.5
- **置信度:** 8.5
- **触发可能性:** 6.5
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 服务暴露面扩展：通过config_foreach遍历多实例配置，使单个uhttpd进程可同时开放HTTP/HTTPS/CGI多个入口点。攻击路径：1) HTTP参数->CGI处理器->命令注入 2) API端点->Lua解释器->内存破坏。边界缺失表现为未对interpreter执行权限校验，且未隔离不同实例的权限上下文。
- **关键词:** config_foreach, UHTTPD_BIN, service_start, interpreter
- **备注:** 需结合uhttpd主程序分析请求处理流程。关联发现：configuration_load-openvpn-path_hijack（类似配置遍历风险）

---
### configuration_core_pattern-leak

- **文件路径:** `etc/init.d/network`
- **位置:** `network:19-22`
- **类型:** configuration_load
- **综合优先级分数:** **8.1**
- **风险等级:** 8.0
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** core_pattern配置导致敏感信息泄露风险：在start()函数中设置`echo '/tmp/%e.%p.%s.%t.core' > /proc/sys/kernel/core_pattern`。触发条件：1) netifd进程崩溃（可通过漏洞触发）2) /tmp目录全局可读。攻击者可获取内存镜像（含潜在密钥/配置）。利用链：结合漏洞触发崩溃→读取/tmp/*.core文件。边界检查：无访问控制或加密措施。
- **代码片段:**
  ```
  [ -e /proc/sys/kernel/core_pattern ] && {
      ulimit -c unlimited
      echo '/tmp/%e.%p.%s.%t.core' > /proc/sys/kernel/core_pattern
  }
  ```
- **关键词:** core_pattern, /proc/sys/kernel/core_pattern, ulimit -c unlimited, netifd, /tmp, start
- **备注:** 需后续验证：1) /sbin/netifd是否处理敏感数据 2) 实际崩溃可行性

---
### network_input-cbi_validators_bypass

- **文件路径:** `www/luci-static/resources/cbi.js`
- **位置:** `cbi.js:13-202`
- **类型:** network_input
- **综合优先级分数:** **8.1**
- **风险等级:** 7.0
- **置信度:** 10.0
- **触发可能性:** 8.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** cbi_validators实现24种前端验证器（整数/IP等），但存在被绕过风险。触发条件：表单字段失焦/按键时触发验证。约束条件：仅前端防护，无服务端同步验证。安全影响：验证缺失导致恶意数据直达后端。利用方式：禁用JS或修改HTTP请求直接提交非法数据。
- **代码片段:**
  ```
  cbi_validators: {
    'integer': function() { return this.match(/^-?[0-9]+$/) },
    'ipaddr': function() { /* IP验证逻辑 */ }
  }
  ```
- **关键词:** cbi_validators, cbi_validate_field, cbi-input-invalid
- **备注:** 需验证后端是否重复相同检查；关联知识库ID：configuration_load-dnsmasq-uci_injection

---
### null_ptr_dereference-ubus-argv_chain

- **文件路径:** `bin/ubus`
- **位置:** `fcn.00008d60:0x8d60, fcn.0000896c:0x896c`
- **类型:** command_execution
- **综合优先级分数:** **8.1**
- **风险等级:** 8.0
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** ubus客户端存在命令行参数触发的空指针解引用漏洞。具体表现：1) 用户通过命令行参数(argv[1])传入污点数据(param_3)；2) 在fcn.00008d60中未经边界检查直接传递；3) 通过函数指针链(0x8b50→0x8b3c→0x114d4→0x114c4)最终调用NULL地址(0x11460)。触发条件：攻击者需本地执行`ubus call [恶意参数]`，参数需满足param_2==1的校验。安全影响：导致进程崩溃(DoS)，在特定内存布局下可能实现任意代码执行。利用概率中等：需本地访问权限，但常见于通过Web漏洞获得的命令执行权限。
- **代码片段:**
  ```
  uVar1 = (**(0 + 0x114c4))(param_1,uVar1,*0x8d84,0);  // 污点参数传递
  ldr pc, [lr, 8]!  // 最终空指针调用
  ```
- **关键词:** param_3, argv, fcn.00008d60, fcn.0000896c, 0x8b50, 0x8b3c, 0x114d4, 0x114c4, 0x11460
- **备注:** 需后续验证：1) 动态测试崩溃条件；2) 检查关联服务(rpcd)是否暴露远程触发路径；3) 分析固件内存保护机制(ASLR/NX)。关联线索：sbin/uci存在argv相关整数溢出漏洞（记录名：'memory_corruption-uci-argv_integer_overflow'）

---
### command-dropbearkey-integrity

- **文件路径:** `etc/init.d/dropbear`
- **位置:** `etc/init.d/dropbear: keygen()`
- **类型:** command_execution
- **综合优先级分数:** **8.05**
- **风险等级:** 9.0
- **置信度:** 8.5
- **触发可能性:** 5.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** keygen()函数调用/usr/bin/dropbearkey生成密钥：
- 若该二进制被恶意替换（如通过固件更新漏洞）
- 触发条件：服务重启且密钥文件不存在时自动调用
- 安全影响：可植入后门密钥实现持久化访问
- 约束：使用绝对路径但未验证文件完整性
- **关键词:** keygen, /usr/bin/dropbearkey, rsakeyfile, dsskeyfile, dropbearkey -t rsa -f
- **备注:** 建议后续检查/usr/bin/dropbearkey的文件签名机制

---
### command_execution-ipcalc.sh-ARGV1_validation

- **文件路径:** `bin/ipcalc.sh`
- **位置:** `ipcalc.sh:19`
- **类型:** command_execution
- **综合优先级分数:** **8.05**
- **风险等级:** 7.5
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** CIDR格式解析缺陷：当输入类似'/24'的畸形参数时，substr(ARGV[1],0,0)提取空字符串导致ip2int函数异常。攻击者通过控制ARGV[1]可触发空指针异常，可能造成依赖此脚本的网络服务崩溃。触发条件：传递无IP前缀的掩码参数。
- **代码片段:**
  ```
  ipaddr=ip2int(substr(ARGV[1],0,slpos-1))
  ```
- **关键词:** ARGV[1], substr, slpos, ip2int
- **备注:** 需定位调用此脚本的组件（如DHCP服务）以确认参数是否来自网络接口

---
### command_execution-ipcalc.sh-IP_injection

- **文件路径:** `bin/ipcalc.sh`
- **位置:** `ipcalc.sh:9-12`
- **类型:** command_execution
- **综合优先级分数:** **8.05**
- **风险等级:** 6.5
- **置信度:** 10.0
- **触发可能性:** 9.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** IP注入缺陷：ip2int函数通过split直接处理输入且无过滤（非数字段转0/不足4段补0/超255值截断）。攻击者可注入畸形IP（如'192.168.1.999'）导致异常网络拓扑计算。触发条件：直接控制ARGV[1]或ARGV[2]参数。
- **代码片段:**
  ```
  for (ret=0,n=split(ip,a,"."),x=1;x<=n;x++) ret=or(lshift(ret,8),a[x])
  ```
- **关键词:** ARGV[1], ARGV[2], ip2int, split, a[x]
- **备注:** 需检查固件中是否通过环境变量传递IP参数扩大攻击面

---
### attack_chain-unauth_access_via_dropbear_tamper

- **文件路径:** `etc/passwd`
- **位置:** `跨文件攻击链 (etc/config/dropbear + etc/passwd)`
- **类型:** attack_chain
- **综合优先级分数:** **8.05**
- **风险等级:** 8.5
- **置信度:** 8.0
- **触发可能性:** 7.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 完整攻击链：篡改dropbear配置启用空密码认证 → 利用guest账户空密码实现未授权SSH访问。步骤：1) 通过Web/NVRAM漏洞修改/etc/config/dropbear设置PasswordAuth=on；2) 触发dropbear服务重启；3) 使用guest账户(空密码)登录SSH。触发条件：存在配置写入漏洞且PAM允许空密码认证。成功概率：中高(依赖PAM策略验证)
- **关键词:** dropbear, PasswordAuth, guest, ::, ssh_login, PAM
- **备注:** 待验证：1) /etc/pam.d/sshd是否启用nullok参数 2) Web接口对dropbear配置的过滤机制

---
### configuration_load-dnsmasq-xappend_multiline_injection

- **文件路径:** `etc/init.d/dnsmasq`
- **位置:** `dnsmasq:13 xappend()`
- **类型:** configuration_load
- **综合优先级分数:** **8.0**
- **风险等级:** 8.0
- **置信度:** 9.0
- **触发可能性:** 6.5
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** xappend函数仅移除参数前导'--'(${value#--})，未处理换行符(\n)或分号。当UCI配置值包含\n时，可注入多行dnsmasq配置。触发条件：1) 控制包含换行符的配置值 2) 服务重启。实际影响：完全控制dnsmasq行为，例如添加'log-queries'泄露DNS查询或'server=/malicious.com/8.8.8.8'重定向流量。
- **代码片段:**
  ```
  xappend() {
      local value="$1"
      echo "${value#--}" >> $CONFIGFILE
  }
  ```
- **关键词:** xappend, CONFIGFILE, echo "${value#--}" >> $CONFIGFILE, config_get
- **备注:** 结合$networkid参数测试(允许较长字符串)，验证多行注入可行性

---
### network_input-menu-$.su.Menu

- **文件路径:** `www/webpages/js/su/su.js`
- **位置:** `su.js:1125-1312 (Menu实现)`
- **类型:** network_input
- **综合优先级分数:** **8.0**
- **风险等级:** 8.0
- **置信度:** 9.0
- **触发可能性:** 6.5
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 菜单加载器($.su.Menu)通过$.ajax获取外部JSON数据后，在success回调中使用字符串拼接构建HTML（inHTML变量），并通过container.append($(inHTML))插入DOM。此操作等效于innerHTML且未使用textContent或显式净化，若攻击者控制settings.data指向的JSON文件（如通过路径遍历或配置篡改），可在JSON中注入恶意脚本触发XSS。触发条件：1) 控制settings.data参数 2) JSON含未过滤HTML标签。当前文件未暴露settings.data到外部输入，但组件设计存在可利用模式。
- **代码片段:**
  ```
  var inHTML = '<div class="menu-item">' + item.name + '</div>'; // 直接拼接未转义
  container.append($(inHTML)); // 危险DOM插入
  ```
- **关键词:** settings.data, $.ajax, success: function(data), inHTML变量, container.append($(inHTML))
- **备注:** 后续应分析：1) 初始化Menu组件的文件是否从URL参数设置settings.data 2) JSON文件是否位于可写目录。此为实际可利用的XSS链关键环节。关联发现：若验证函数($.su.vtype)返回未转义数据被用于本组件，可绕过验证直接触发XSS。

---
### configuration_load-uhttpd-start_instance_command_injection

- **文件路径:** `etc/init.d/uhttpd`
- **位置:** `etc/init.d/uhttpd: line 45-120`
- **类型:** configuration_load
- **综合优先级分数:** **8.0**
- **风险等级:** 8.0
- **置信度:** 9.0
- **触发可能性:** 6.5
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** uhttpd服务启动流程通过start_instance函数动态构建命令行参数(UHTTPD_ARGS)，完全依赖/etc/config/uhttpd配置文件。攻击者若篡改配置文件可控制：1) 监听端口(-p/-s)实现未授权访问 2) CGI解释器路径(-i)造成命令注入 3) 证书文件路径(-C/-K)导致MITM攻击。触发条件：攻击者需具备配置文件写权限（如通过配置漏洞或文件系统漏洞）。
- **关键词:** start_instance, UHTTPD_ARGS, config_load, config_foreach, -i, -p, -s, /etc/config/uhttpd
- **备注:** 关联发现：network_input-uhttpd-config_injection（证书参数注入）。需验证：1)/etc/config/uhttpd可修改性 2)主程序参数校验

---
### command_execution-dnsmasq-dhcp_add_inject

- **文件路径:** `etc/init.d/dnsmasq`
- **位置:** `etc/init.d/dnsmasq:dhcp_add()`
- **类型:** command_execution
- **综合优先级分数:** **7.95**
- **风险等级:** 8.5
- **置信度:** 8.0
- **触发可能性:** 6.5
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 命令注入漏洞：在dhcp_add函数中，ifname变量(config_get获取)未经验证直接拼接至udhcpc命令。若攻击者控制网络配置的ifname（如通过恶意API调用），可注入命令分隔符实现RCE。触发条件：服务启动且'dynamicdhcp=1'时。边界检查：仅当'force=0'时执行命令，但force也来自UCI配置。
- **代码片段:**
  ```
  udhcpc -n -q -s /bin/true -t 1 -i $ifname >&-
  ```
- **关键词:** udhcpc, ifname, config_get, dhcp_add, force
- **备注:** ifname通常受限于网络配置，但若其他服务(如netifd)存在漏洞则可利用

---
### network_input-url_mapping-path_traversal

- **文件路径:** `www/webpages/url_to_json/nat_url_to_json_ljj.txt`
- **位置:** `www/webpages/url_to_json/nat_url_to_json_ljj.txt`
- **类型:** network_input
- **综合优先级分数:** **7.95**
- **风险等级:** 8.0
- **置信度:** 8.5
- **触发可能性:** 7.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** URL映射机制存在路径遍历漏洞：攻击者可通过操纵form参数（如'form=../../etc/passwd'）绕过路径限制。触发条件：1) 后端CGI未对form参数进行路径规范化 2) 文件加载函数未过滤'../'序列。实际影响：可读取任意配置文件或触发恶意JSON解析（若解析器存在漏洞）。约束条件：需有效stok会话令牌（通过XSS或会话固定获取）。利用步骤：a) 获取stok b) 构造含恶意路径的HTTP请求
- **关键词:** form, stok, ../, nat.nat.json, firmware.set.json
- **备注:** 需验证：/cgi-bin/luci的open()调用是否过滤路径。后续分析建议：1) 反编译/cgi-bin/luci 2) 搜索JSON文件实际路径

---
### attack_chain-cgi_hardcoded_path_and_param_injection

- **文件路径:** `www/webpages/js/su/locale.js`
- **位置:** `跨文件：www/webpages/js/su/locale.js 与 www/webpages/url_to_json/url_to_json_ycf.txt`
- **类型:** network_input
- **综合优先级分数:** **7.95**
- **风险等级:** 8.0
- **置信度:** 8.5
- **触发可能性:** 7.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 完整攻击链：硬编码CGI路径暴露与参数注入漏洞组合风险。攻击步骤：1) 通过locale.js暴露的/cgi-bin/luci/路径定位接口（hardcoded-path-cgi-endpoints）2) 利用url_to_json配置的固定stok令牌（12345）绕过认证 3) 注入serial参数（如../../../etc/passwd）触发路径遍历。成功条件：a) CGI程序未校验stok有效性 b) 未过滤路径参数。可实现未授权敏感文件读取，风险包括凭证泄露或配置篡改。
- **关键词:** /cgi-bin/luci/, stok, form, serial, disk.list.json, $.su.url.subs
- **备注:** 关联发现：1) hardcoded-path-cgi-endpoints（路径暴露）2) network_input-url_to_json-hardcoded_stok_and_param_injection（参数注入）。待验证：/cgi-bin/luci实际处理逻辑是否防护路径遍历（参见location：www/webpages/url_to_json/url_to_json_ycf.txt）

---
### path_traversal-uci-f_option_processing

- **文件路径:** `sbin/uci`
- **位置:** `sbin/uci:main:0x8f3c`
- **类型:** command_execution
- **综合优先级分数:** **7.95**
- **风险等级:** 8.5
- **置信度:** 7.0
- **触发可能性:** 8.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 在'sbin/uci'处理命令行选项'-f'时（如'uci -f [path]'），用户输入的路径直接传递给fopen()且未过滤'../'序列（地址0x8f3c）。攻击者可构造恶意路径（如'../../etc/shadow'）访问系统敏感文件。触发条件：1) 攻击者具有CLI执行权限 2) 指定'-f'选项 3) 程序运行时权限足够（通常为root）。实际影响：可读取/修改任意文件，导致权限提升或系统破坏。
- **代码片段:**
  ```
  if (iVar1 == 0x66) {
      iVar1 = sym.imp.fopen(*puVar10, *0x9014);
  ```
- **关键词:** sym.imp.fopen, option_f_processing, fopen
- **备注:** 需动态验证：1) 测试'../'序列过滤情况 2) 检查/etc/init.d/中uci服务权限设置。关联知识库笔记：'防御方案：在路径拼接前添加`s=$(basename "$s")`'

---
### ipc-ubus-network_interface

- **文件路径:** `sbin/netifd`
- **位置:** `待验证`
- **类型:** ipc
- **综合优先级分数:** **7.95**
- **风险等级:** 8.5
- **置信度:** 7.0
- **触发可能性:** 8.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** UBus接口'network.interface'暴露但权限控制未验证：1) ubus_add_object在初始化时注册接口 2) 未发现ACL检查代码证据 3) 结合ubus_send_event事件通知机制，攻击者可能通过未授权UBus调用篡改网络配置。触发条件：攻击者访问本地UBus总线。安全影响：网络配置篡改导致拒绝服务或中间人攻击。
- **关键词:** ubus_add_object, network.interface, ubus_send_event
- **备注:** 必须通过动态分析验证运行时权限控制；可能被/etc/init.d/network脚本漏洞触发

---
### command_execution-ipcalc.sh-integer_overflow

- **文件路径:** `bin/ipcalc.sh`
- **位置:** `ipcalc.sh:31-35`
- **类型:** command_execution
- **综合优先级分数:** **7.9**
- **风险等级:** 8.0
- **置信度:** 9.0
- **触发可能性:** 6.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 整数溢出风险：'end=start+ARGV[4]'计算未验证加法溢出（如0xFFFFFFFE+3导致32位回绕）。边界检查因整数回绕失效，可能分配非常规IP（网络/广播地址）。触发条件：控制ARGV[4]为特定值使start+ARGV[4]超过32位整数上限。
- **代码片段:**
  ```
  end=start+ARGV[4]
  limit=or(network,compl(netmask))-1
  if (end>limit) end=limit
  ```
- **关键词:** ARGV[4], start, end, limit, compl(netmask)
- **备注:** 可能破坏网络隔离策略，需结合固件路由组件验证实际影响

---
### configuration_load-openvpn-config_injection

- **文件路径:** `etc/init.d/openvpn`
- **位置:** `etc/init.d/openvpn: append_params函数`
- **类型:** configuration_load
- **综合优先级分数:** **7.9**
- **风险等级:** 8.0
- **置信度:** 9.0
- **触发可能性:** 6.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 未验证的UCI配置注入漏洞：脚本通过config_get获取openvpn配置参数(如server/up/down)，未经验证直接写入配置文件。攻击者若篡改/etc/config/openvpn（如通过Web漏洞添加'push "script-security 3"'或'up /bin/sh'指令），重启服务后可实现远程命令执行。触发条件：1) 攻击者获得配置文件写入权限 2) 服务重启。OpenVPN通常以root运行，实际影响为RCE。边界检查：未对$v值进行过滤或转义。
- **代码片段:**
  ```
  config_get v "$s" "$p"
  echo "$p $v" >> "/var/etc/openvpn-$s.conf"
  ```
- **关键词:** config_get, append_params, server, up, down, /var/etc/openvpn-$s.conf, push, service_start
- **备注:** 关联CVE-2020-15078漏洞模式；需验证/etc/config/openvpn的写入防护机制

---
### unvalidated-input-uci-set

- **文件路径:** `sbin/uci`
- **位置:** `sbin/uci:0x9a14`
- **类型:** command_execution
- **综合优先级分数:** **7.9**
- **风险等级:** 8.0
- **置信度:** 8.0
- **触发可能性:** 7.5
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** 未验证输入传递风险：用户输入经strdup复制后直接传递给uci_set，全过程无长度验证或边界检查。若libuci.so的uci_set存在缓冲区缺陷，攻击者可通过超长参数触发溢出。触发条件：1) 执行特定uci命令分支(case 1) 2) 参数来自外部可控输入。
- **代码片段:**
  ```
  case 1:
      iVar3 = sym.imp.uci_set(*(*0x9c1c+0x14), puVar18+-0xb);
  ```
- **关键词:** uci_set, strdup, buffer_overflow
- **备注:** 风险转移至libuci.so，需后续分析：1) uci_set的缓冲区操作实现 2) 污点数据传播路径

---
### path-traversal-http-param-to-json-mapping

- **文件路径:** `www/webpages/url_to_json/url_to_json_ycf.txt`
- **位置:** `www/webpages/url_to_json/url_to_json_ycf.txt`
- **类型:** network_input
- **综合优先级分数:** **7.9**
- **风险等级:** 7.5
- **置信度:** 8.5
- **触发可能性:** 8.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** URL路由配置表将HTTP请求参数(form/stok/serial)直接映射到JSON文件路径，未实施参数过滤或边界检查。攻击者可通过篡改form参数值(如'../../etc/passwd')尝试路径遍历，实际漏洞触发条件取决于：1) CGI程序是否过滤特殊字符 2) 文件路径拼接逻辑是否限制扩展名 3) stok会话令牌验证强度。成功利用可导致未授权访问敏感JSON配置文件或系统文件。
- **代码片段:**
  ```
  /cgi-bin/luci/;stok=12345/admin/disk_setting?form=contents&serial=123456789 disk.list.json
  ```
- **关键词:** form, stok, serial, wireless.region.json, disk.list.json, usb.acc.json, qos.status.json, syslog.mail.json, account.testmail.json, /cgi-bin/luci
- **备注:** 关键后续验证方向：1) 分析/cgi-bin/luci对form参数的过滤实现 2) 检查JSON文件加载函数是否存在路径拼接漏洞 3) 验证stok令牌的认证机制是否可绕过

---
### jquery-evalJSON-arbitrary-code-execution

- **文件路径:** `www/webpages/js/libs/jquery.json-2.4.min.js`
- **位置:** `jquery.json-2.4.min.js: $.evalJSON函数`
- **类型:** network_input
- **综合优先级分数:** **7.9**
- **风险等级:** 9.0
- **置信度:** 10.0
- **触发可能性:** 2.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 文件内部实现$.evalJSON函数存在高危任意代码执行漏洞：当环境禁用原生JSON.parse时(如旧版嵌入式JS引擎)，该函数直接执行eval('('+str+')')。若调用者传入未经验证的外部输入(如HTTP请求参数)，可导致远程代码执行。触发条件：1) 运行环境无原生JSON支持(概率<2%) 2) 存在调用点将污染数据传入str参数。边界检查：无任何输入过滤或结构校验。实际风险受三重约束：环境兼容性、污染数据传入路径、攻击者控制能力。
- **代码片段:**
  ```
  $.evalJSON=typeof JSON==='object'&&JSON.parse?JSON.parse:function(str){return eval('('+str+')');};
  ```
- **关键词:** $.evalJSON, str, eval, JSON.parse, www, cgi-bin
- **备注:** 后续关键验证：a) 检查固件JS引擎兼容性（查看/cgi-bin响应头）b) 分析/www目录JS文件调用链（如url_to_json）c) 确认HTTP参数是否传入str

---
### hardware_input-ttyHSL1-shell_activation

- **文件路径:** `etc/inittab`
- **位置:** `etc/inittab:3`
- **类型:** hardware_input
- **综合优先级分数:** **7.9**
- **风险等级:** 7.0
- **置信度:** 8.0
- **触发可能性:** 10.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 物理攻击路径：攻击者通过接入ttyHSL1串口发送任意字符触发/bin/ash启动，获得未认证交互式shell。触发条件：物理接触设备串行接口。由于无法获取/bin/ash分析证据，此路径存在未知风险：1) shell转义字符处理机制不明 2) 环境变量解析漏洞待查 3) 权限提升可能性未评估。
- **代码片段:**
  ```
  ttyHSL1::askfirst:/bin/ash --login
  ```
- **关键词:** ttyHSL1, askfirst, /bin/ash
- **备注:** 需通过固件解包直接验证/bin/ash属性。后续应分析：1) 串口驱动安全边界 2) ash的SUID权限设置

---
### binary_analysis-luci-stok_validation

- **文件路径:** `www/webpages/url_to_json/url_to_json_szz.txt`
- **位置:** `www/cgi-bin/luci:0 (entry_point) 0x400000`
- **类型:** network_input
- **综合优先级分数:** **7.8**
- **风险等级:** 9.0
- **置信度:** 7.0
- **触发可能性:** 6.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** luci程序(www/cgi-bin/luci)实现stok令牌验证和form参数处理，是攻击链核心枢纽：
- 触发条件：HTTP请求需通过stok验证才能访问form参数映射的接口
- 风险边界：若stok生成算法可预测或验证逻辑可绕过，则直接暴露所有高危操作接口
- 安全影响：结合url_to_json映射文件，形成完整攻击路径：绕过stok→操控form参数→执行系统级高危操作
- **代码片段:**
  ```
  （需反编译分析）
  ```
- **关键词:** stok, form, luci_dispatcher, json_mapping, system_exec
- **备注:** 关键验证方向：
1. 反编译分析stok生成算法(随机性强度)和验证逻辑(是否存在绕过)
2. 追踪form参数在luci中的处理流程：
   - 是否调用system/exec执行命令？
   - 是否直接写nvram？
   - 是否过滤特殊字符？
关联发现：network_input-url_to_json-stok_mapping 和 network_input-luci-form_param_mapping

---
### configuration_load-internet_staticip-params

- **文件路径:** `www/webpages/data/internet.ipv4.staticip.json`
- **位置:** `www/webpages/data/internet.ipv4.staticip.json`
- **类型:** configuration_load
- **综合优先级分数:** **7.8**
- **风险等级:** 7.0
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** 该文件存储静态IP配置参数，包含多个外部可控输入点(ipaddr/pri_dns等)。当设备使用静态IP连接时，这些参数通过Web接口设置并存储在此文件中。主要风险在于：1) 参数未显示任何过滤或验证逻辑 2) 若读取此文件的程序(如网络守护进程)未对参数进行边界检查，可能导致命令注入或缓冲区溢出。例如，攻击者可通过篡改pri_dns参数注入恶意DNS地址或特殊字符。
- **代码片段:**
  ```
  'ipaddr': '1.1.1.2', 'pri_dns': '3.3.3.3', 'snd_dns': '4.4.4.4'
  ```
- **关键词:** ipaddr, pri_dns, snd_dns, gateway, mtu, internet.ipv4.staticip.json, conntype
- **备注:** 需后续分析：1) 定位读取此文件的程序(如/lib/netd) 2) 检查参数使用过程是否进行安全过滤 3) 验证参数是否传递至system()或exec()等危险函数

---
### network_input-js_encrypt-padding_validation

- **文件路径:** `www/webpages/js/libs/encrypt.js`
- **位置:** `encrypt.js:3`
- **类型:** network_input
- **综合优先级分数:** **7.8**
- **风险等级:** 7.0
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** RSA加密函数$.su.encrypt(val, param)存在两个关键缺陷：1) 使用非标准nopadding填充方案，不符合PKCS#1标准，可能导致与后端解密逻辑不兼容；2) 输入长度验证不足，当val长度超过模数大小时仅弹出警告但继续处理，可能引发加密错误或数据截断。触发条件：攻击者控制val参数传入超长数据(>模数bit长度/8)或精心构造的畸形数据。实际影响：可能导致加密数据异常，结合后端解密错误可能形成padding oracle攻击面。
- **代码片段:**
  ```
  if(val.length > len) { alert('RSA加密数据超长!'); } 
  // 但仍继续执行加密流程
  ```
- **关键词:** $.su.encrypt, val, param, nopadding, RSASetPublic, n, e
- **备注:** 需结合调用此函数的页面分析实际输入源，建议追踪../webpages/目录下引用此js的HTML文件

---
### critical-file-missing-dropbear-config

- **文件路径:** `www/webpages/url_to_json/url_to_json_szz.txt`
- **位置:** `知识库元分析:0 (全局验证) 0x0`
- **类型:** configuration_load
- **综合优先级分数:** **7.8**
- **风险等级:** 7.0
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 知识库中缺失/etc/config/dropbear文件分析记录，但攻击链'attack_chain-unauth_access_via_dropbear_tamper'依赖该文件验证SSH空密码配置。此缺口导致：1) 无法确认PasswordAuth参数是否存在 2) 攻击链关键篡改环节未经验证。
- **关键词:** dropbear, PasswordAuth, attack_chain, ssh_login
- **备注:** 紧急行动项：1) 定位实际固件中的dropbear配置文件（可能路径：/etc/dropbear.conf）2) 验证PasswordAuth默认状态 3) 检查Web/NVRAM接口对该配置的修改权限

---
### network_input-url_mapping-stok_form_param_injection

- **文件路径:** `www/webpages/url_to_json/nat_url_to_json_ljj.txt`
- **位置:** `www/webpages/url_to_json/nat_url_to_json_ljj.txt`
- **类型:** network_input
- **综合优先级分数:** **7.75**
- **风险等级:** 7.5
- **置信度:** 8.0
- **触发可能性:** 8.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** URL路由配置文件将含用户可控参数(stok, form)的HTTP请求映射到后端JSON处理模块。攻击者可构造恶意URL路径触发目标JSON文件中的处理逻辑。触发条件：1) 攻击者获取有效stok令牌(可通过其他漏洞获取) 2) 构造包含恶意参数的form值。若映射的JSON文件存在输入验证缺陷，可能形成从网络接口到核心配置修改的完整攻击链。
- **代码片段:**
  ```
  /cgi-bin/luci/;stok=12345/admin/nat?form=setting nat.nat.json
  /cgi-bin/luci/;stok=12345/admin/nat?form=dmz nat.dmz.json
  /cgi-bin/luci/;stok=12345/admin/firewall?form=setting security.firewall.json
  ```
- **关键词:** stok, form, nat.nat.json, security.firewall.json, upnp.rule.json, ddns.json, access.enable.json
- **备注:** 关键攻击面入口点。后续必须分析映射的JSON文件(nat.nat.json等)中的参数处理逻辑，验证stok/form参数是否未经充分验证即传播到系统命令执行/NVRAM写入等危险操作。

---
### network_input-lan_interface-exposed_eth0

- **文件路径:** `etc/config/network`
- **位置:** `etc/config/network: config interface 'lan'段`
- **类型:** network_input
- **综合优先级分数:** **7.66**
- **风险等级:** 7.2
- **置信度:** 9.0
- **触发可能性:** 6.8
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** LAN接口直接暴露eth0物理设备并设置静态IP 192.168.1.1，且无防火墙规则保护。触发条件：攻击者接入局域网或通过误配置的WAN口访问。边界检查缺失：未配置ACL过滤规则。安全影响：直接暴露设备物理层接口，允许未授权网络访问，可能成为缓冲区溢出或服务漏洞利用的初始入口点。利用方式：扫描192.168.1.1开放服务发起攻击
- **代码片段:**
  ```
  config interface lan
      option ifname   eth0
      option proto   static
      option ipaddr  192.168.1.1
  ```
- **关键词:** lan, eth0, ipaddr, 192.168.1.1, ifname, proto static
- **备注:** 需后续验证：1) /etc/config/firewall是否存在独立配置 2) eth0是否实际连接WAN侧 3) 绑定该IP的服务列表

---
### env_bypass-login-FAILSAFE

- **文件路径:** `bin/login.sh`
- **位置:** `login.sh:5`
- **类型:** env_get
- **综合优先级分数:** **7.65**
- **风险等级:** 7.5
- **置信度:** 9.0
- **触发可能性:** 6.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** FAILSAFE环境变量验证缺失导致认证绕过：
- 触发条件：当root账户未设置密码(!grep '^root:[!x]?:' /etc/shadow)且$FAILSAFE未定义([ -z "$FAILSAFE"])时，攻击者可设置$FAILSAFE=1绕过登录检查
- 边界检查：无输入过滤或范围验证，直接使用环境变量值
- 安全影响：实现未授权shell访问(/bin/ash --login)，攻击复杂度低
- 利用方式：通过控制调用环境设置恶意环境变量
- **代码片段:**
  ```
  if ( ! grep -qs '^root:[!x]?:' /etc/shadow || \
       ! grep -qs '^root:[!x]?:' /etc/passwd ) && \
     [ -z "$FAILSAFE" ]
  ```
- **关键词:** FAILSAFE, /etc/shadow, /bin/ash, grep
- **备注:** 需追踪父进程设置$FAILSAFE的机制，建议后续分析/bin/init或相关启动脚本

---
### ipc_ubus_reload-unauthenticated

- **文件路径:** `etc/init.d/network`
- **位置:** `network:59-61`
- **类型:** ipc
- **综合优先级分数:** **7.65**
- **风险等级:** 7.0
- **置信度:** 8.5
- **触发可能性:** 8.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** ubus reload接口暴露未验证的网络重置能力：通过`ubus call network reload`触发服务重载。触发条件：任何可访问UBus的进程（默认ACL未知）。潜在影响：1) 拒绝服务（网络中断）2) 配置状态异常。利用方式：本地/远程调用reload方法。边界检查：脚本内无调用者验证。
- **代码片段:**
  ```
  reload() {
      ubus call network reload
  }
  ```
- **关键词:** ubus call network reload, reload(), service_start, NETWORK_MOD_ID
- **备注:** 关键限制：需验证/etc/config/rpcd的ACL配置。后续分析方向：UBus权限机制

---
### credential_storage-pppoe_plaintext

- **文件路径:** `www/webpages/data/internet.ipv4.pppoe.json`
- **位置:** `www/webpages/data/basic.internet.pppoe.json`
- **类型:** configuration_load
- **综合优先级分数:** **7.65**
- **风险等级:** 7.5
- **置信度:** 9.0
- **触发可能性:** 6.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** PPPoE凭证明文存储与配置冲突：在basic.internet.pppoe.json发现硬编码密码'pppoe password'，而当前文件password字段为空。触发条件：攻击者通过文件读取漏洞获取配置文件时。安全影响：1) 凭证泄露导致PPPoE账户劫持 2) 配置冲突可能引发服务异常。约束条件：需文件系统访问权限，但Web目录暴露增加风险。
- **代码片段:**
  ```
  "password": "",
  "pppoe_password": "pppoe password"
  ```
- **关键词:** pppoe_password, basic.internet.pppoe.json, password, internet.ipv4.pppoe.json
- **备注:** 关联发现：1) account.pwd.json明文凭证存储(credential_storage-plaintext_account_credentials) 2) login.json硬编码会话令牌(network_input-login-stok_hardcoded)。需验证Web接口配置文件访问控制，同目录文件暴露风险叠加

---
### network_input-admin_administration-remote_management

- **文件路径:** `www/webpages/pages/userrpm/password.html`
- **位置:** `www/js/administration.js:?`
- **类型:** network_input
- **综合优先级分数:** **7.65**
- **风险等级:** 8.0
- **置信度:** 7.5
- **触发可能性:** 7.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 远程管理接口暴露网络配置风险：1) 开放ipaddr/port参数配置 2) 存在端口冲突检查但无IP源验证 3) 通过lanProxy组件实现。若服务端未验证IP合法性，攻击者可配置为0.0.0.0实现未授权访问。触发条件：调用ACC_REMOTE_URL_NEW端点(/admin/administration?form=remote)提交恶意网络配置。
- **代码片段:**
  ```
  var ACC_REMOTE_URL_NEW = $.su.url("/admin/administration?form=remote");
  <input name="ipaddr">
  <input name="port">
  ```
- **关键词:** ACC_REMOTE_URL_NEW, lanProxy, ipaddr, port, enable
- **备注:** 需分析服务端是否校验remote management配置权限

---
### authentication_bypass-md5_collision_risk

- **文件路径:** `www/webpages/js/libs/md5.js`
- **位置:** `md5.js (函数: $.su.md5)`
- **类型:** authentication_bypass
- **综合优先级分数:** **7.65**
- **风险等级:** 7.5
- **置信度:** 9.0
- **触发可能性:** 6.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** 自定义ASCII字符映射导致哈希冲突风险：实现使用127字符的ASCII表进行字符映射，未映射字符统一转为0xFF，且表中数字0-9重复出现。这导致：1) 非ASCII字符(如Unicode)产生相同哈希值 2) 数字字符(0-9)相互可碰撞。触发条件：当输入包含非ASCII字符或重复数字时。安全影响：若用于密码校验等场景，攻击者可构造碰撞输入绕过认证。利用方式：提交'1'和'2'可能产生相同MD5值(因映射表重复)，需结合后端验证逻辑测试。
- **代码片段:**
  ```
  var ascii="01234567890123456789012345678901...";
  l=entree.charAt(k);
  update(ascii.lastIndexOf(l));
  ```
- **关键词:** ascii.lastIndexOf, update, entree.charAt, digestBits, 0xFF, login.json, account.pwd.json, password
- **备注:** 需检查调用此函数的网页(如登录页)确认是否用于密码哈希。知识库存在login.json硬编码会话令牌、account.pwd.json凭证存储等关联发现，可能构成完整认证绕过攻击链。

---
### vulnerable-library-www-jquery-min-js

- **文件路径:** `www/webpages/js/libs/jquery.min.js`
- **位置:** `www/webpages/js/libs/jquery.min.js:1`
- **类型:** network_input
- **综合优先级分数:** **7.6**
- **风险等级:** 7.2
- **置信度:** 9.0
- **触发可能性:** 6.5
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** 在'www/webpages/js/libs/jquery.min.js'中发现jQuery v1.10.0存在多个历史漏洞(CVE-2012-6708, CVE-2015-9251等)。攻击路径：攻击者通过HTTP参数注入恶意脚本 → 网页使用jQuery的.html()/.append()等未充分过滤的方法处理 → 触发XSS或原型污染。触发条件：1) 存在可控输入点（如表单字段） 2) 使用易受攻击的jQuery方法处理用户输入。约束条件：漏洞利用需配合前端DOM操作逻辑，在未使用高危方法的场景可能无法触发。
- **代码片段:**
  ```
  /*! jQuery v1.10.0 ... */
  ```
- **关键词:** jQuery v1.10.0, .html(), .append(), CVE-2012-6708, CVE-2015-9251
- **备注:** 后续建议：1) 分析'www/webpages'中调用该库的HTML/JS文件 2) 检查$.ajax()调用是否向/cgi-bin接口传递未过滤参数 3) 验证固件中是否存在jQuery漏洞缓解措施

---
### cryptographic_failure-cert_key_handling_flaws

- **文件路径:** `etc/init.d/uhttpd`
- **位置:** `etc/init.d/uhttpd: generate_keys调用点`
- **类型:** configuration_load
- **综合优先级分数:** **7.6**
- **风险等级:** 8.0
- **置信度:** 8.0
- **触发可能性:** 6.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 证书/密钥文件操作三重缺陷：1) UHTTPD_CERT/UHTTPD_KEY路径文件仅验证存在性，未校验内容有效性，可被恶意证书替换；2) generate_keys函数生成密钥时未显式设置权限（依赖默认umask），可能导致私钥全局可读；3) 密钥长度(bits)和有效期(days)参数外部可控。触发条件：攻击者通过文件写入漏洞替换证书，或通过配置接口弱化密钥参数。安全影响：HTTPS加密被破坏，导致中间人攻击或私钥泄露，利用链为：恶意文件写入/配置修改→服务加载→加解密机制失效。
- **关键词:** UHTTPD_CERT, UHTTPD_KEY, generate_keys, keyout, bits, days, px5g
- **备注:** 需检查系统默认umask值及密钥文件实际权限

---
### attack_chain-virtual_server_fw_command_injection

- **文件路径:** `www/webpages/data/virtualServer.json`
- **位置:** `www/webpages/data/virtualServer.json → etc/init.d/firewall → /lib/firewall/core.sh`
- **类型:** attack_chain
- **综合优先级分数:** **7.55**
- **风险等级:** 8.0
- **置信度:** 7.5
- **触发可能性:** 6.5
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 构建完整攻击链：1) 攻击者通过Web接口污染virtualServer.json的ipaddr或external_port字段（如注入';reboot;'）2) 防火墙服务重启时加载配置 3) fw命令解析未过滤参数触发命令执行。关键依赖验证：a) /lib/firewall/core.sh是否处理virtualServer.json配置 b) 参数是否直接拼接进fw命令。关联已知漏洞模式：command_execution-pptpd-start_smbacc_injection（同属fw命令注入）。
- **关键词:** virtualServer.json, fw, core.sh, command_execution, port_forwarding, attack_chain
- **备注:** 紧急验证项：1) 反编译/lib/firewall/core.sh分析virtualServer.json加载逻辑 2) 测试ipaddr/external_port字段注入特殊字符 3) 检查Web接口修改virtualServer.json的权限控制

---
### configuration_load-dnsmasq-etc_conf_loading

- **文件路径:** `etc/init.d/dnsmasq`
- **位置:** `dnsmasq:205`
- **类型:** configuration_load
- **综合优先级分数:** **7.5**
- **风险等级:** 7.0
- **置信度:** 10.0
- **触发可能性:** 5.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 服务启动时自动加载/etc/dnsmasq.conf(若存在)，该文件内容未经校验直接追加到主配置。触发条件：攻击者获得/etc/dnsmasq.conf写入权限。实际影响：与上述注入等效，但需更高权限(通常需root)。
- **关键词:** --conf-file=/etc/dnsmasq.conf, xappend, CONFIGFILE="/var/etc/dnsmasq.conf"

---
### privilege_escalation-openvpn-missing_user_validation

- **文件路径:** `etc/init.d/openvpn`
- **位置:** `init.d/openvpn: start_instance函数`
- **类型:** configuration_load
- **综合优先级分数:** **7.5**
- **风险等级:** 7.5
- **置信度:** 8.5
- **触发可能性:** 6.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 权限控制缺失风险：
1. 漏洞点：服务始终以root启动，未验证配置中的'user'字段
2. 攻击方式：篡改配置设置无效用户（如'user malicious'）
3. 影响：结合OpenVPN本地漏洞（如CVE-2020-11810）可能实现权限提升

触发可能性：6.0/10（需存在辅助漏洞）
- **关键词:** start_instance, service_start, user, /usr/sbin/openvpn
- **备注:** 关联CVE：CVE-2020-11810（权限验证绕过）。关联知识库笔记：'关联service_start漏洞链'

---
### association-auth_bypass_to_crypto_weakness

- **文件路径:** `www/webpages/data/login.json`
- **位置:** `跨文件关联: login.json + account.pwd.json`
- **类型:** association
- **综合优先级分数:** **7.45**
- **风险等级:** 8.0
- **置信度:** 7.5
- **触发可能性:** 6.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 硬编码会话令牌(stok)与固定RSA指数(010001)的关联攻击链：1) 利用stok=12345绕过认证；2) 访问密码修改接口(/form=password)；3) 截获加密密码字段(old_pwd/new_pwd)；4) 基于固定指数010001和潜在固定模数破解密码。触发条件：网络访问权限+密码修改功能开放。边界检查：需验证RSA模数是否固定。安全影响：从临时会话劫持升级为持久账户控制(risk_level=8.0)。
- **代码片段:**
  ```
  N/A (跨文件关联)
  ```
- **关键词:** stok, password1, 010001, old_pwd, new_pwd, cfm_pwd
- **备注:** 关联证据：1) login.json的password1字段含010001；2) account.pwd.json加密字段使用相同指数。需逆向验证RSA密钥生成逻辑是否使用固定模数。

---
### configuration_load-sysupgrade-remote_config_injection

- **文件路径:** `sbin/sysupgrade`
- **位置:** `sysupgrade:149-168`
- **类型:** configuration_load
- **综合优先级分数:** **7.45**
- **风险等级:** 7.5
- **置信度:** 8.0
- **触发可能性:** 6.5
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** 配置文件注入风险。具体表现：-f参数接受外部URL或文件路径，通过get_image下载到CONF_TAR。当SAVE_CONFIG=1时解压并应用配置。攻击者控制CONF_IMAGE源可注入恶意配置。触发条件：1) 攻击者能劫持CONF_IMAGE资源 2) 平台未验证配置完整性。边界检查：未验证下载内容签名或来源。安全影响：可植入后门或修改系统配置，需结合网络劫持能力。
- **代码片段:**
  ```
  get_image "$CONF_IMAGE" "cat" > "$CONF_TAR"
  export SAVE_CONFIG=1
  ```
- **关键词:** CONF_IMAGE, get_image, SAVE_CONFIG, CONF_TAR, platform_check_image
- **备注:** 需分析/lib/upgrade中get_image的下载验证机制

---
### configuration_load-uhttpd-append_arg_boundary_violation

- **文件路径:** `etc/init.d/uhttpd`
- **位置:** `etc/init.d/uhttpd: line 13-43`
- **类型:** configuration_load
- **综合优先级分数:** **7.45**
- **风险等级:** 7.0
- **置信度:** 8.5
- **触发可能性:** 7.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** 参数处理函数(append_arg/append_bool)通过config_get读取配置值时未进行有效边界检查：1) 端口范围未验证 2) 文件路径未标准化检查 3) CGI解释器路径未过滤特殊字符。攻击者可通过注入非法路径或端口号导致服务异常或目录遍历，实际影响取决于uhttpd主程序的校验强度。
- **关键词:** append_arg, append_bool, config_get, config_get_bool, listen_http, interpreter

---
### configuration_load-dnsmasq-rebind_bypass

- **文件路径:** `etc/init.d/dnsmasq`
- **位置:** `etc/init.d/dnsmasq:dnsmasq()`
- **类型:** configuration_load
- **综合优先级分数:** **7.4**
- **风险等级:** 7.0
- **置信度:** 9.0
- **触发可能性:** 6.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** DNS重绑定保护绕过：通过rebind_domain配置项可添加白名单域名（如'--rebind-domain-ok=attacker.com'）。若攻击者控制此配置，可绕过默认的RFC1918响应过滤，结合恶意网页实施局域网设备攻击。触发条件：'rebind_protection=1'且服务重启。
- **代码片段:**
  ```
  config_list_foreach "$cfg" rebind_domain append_rebind_domain
  ```
- **关键词:** rebind_domain, rebind_protection, append_rebind_domain, config_list_foreach
- **备注:** 需配合恶意网页触发，但利用链完整

---
### xss-dom-locale-changeType

- **文件路径:** `www/webpages/js/su/locale.js`
- **位置:** `www/webpages/js/su/locale.js: $.su.locale.changeType 函数`
- **类型:** network_input
- **综合优先级分数:** **7.4**
- **风险等级:** 7.0
- **置信度:** 9.0
- **触发可能性:** 6.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** 未过滤的DOM操作导致潜在XSS漏洞。在$.su.locale.changeType函数中，lanType参数未经任何过滤直接拼接进HTML字符串（用于动态创建<script>和<link>标签）。攻击者通过控制locale参数（例如注入'onerror=malicious_code()'）可触发XSS。触发条件：1) 存在后端漏洞允许未授权修改lan.json中的locale值 2) 用户访问包含恶意locale设置的页面。成功利用可导致任意JS代码在受害者浏览器执行，风险包括会话劫持或设备控制。
- **代码片段:**
  ```
  $("head").append("<script id=\"lan-js\" type=\"text/javascript\" src=\""+URL_JS+" \"></script>");
  ```
- **关键词:** $.su.locale.changeType, lanType, URL_JS, URL_CSS, URL_HELP, $("head").append
- **备注:** 需验证后端/cgi-bin接口对locale参数的过滤机制及lan.json写入权限控制。建议后续分析：1) lan.json生成逻辑 2) 设置locale的CGI接口

---
### command_execution-firewall_init-param_injection

- **文件路径:** `etc/init.d/firewall`
- **位置:** `etc/init.d/firewall: multiple locations`
- **类型:** command_execution
- **综合优先级分数:** **7.35**
- **风险等级:** 7.5
- **置信度:** 8.0
- **触发可能性:** 6.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 防火墙启动脚本通过'fw $1'将操作转发至core.sh。攻击者若控制init系统的$1参数（如注入'start;malicious_command'）可执行任意命令。漏洞条件：1) init系统未过滤参数分隔符；2) core.sh未安全解析参数。潜在影响：通过服务管理接口实现权限提升。
- **关键词:** fw(), start(), stop(), restart(), $1, core.sh
- **备注:** 需验证init系统参数传递机制及core.sh的解析逻辑

---
### configuration_load-system-ntp_server_injection

- **文件路径:** `etc/config/system`
- **位置:** `etc/config/system:8`
- **类型:** configuration_load
- **综合优先级分数:** **7.35**
- **风险等级:** 7.5
- **置信度:** 8.0
- **触发可能性:** 6.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 在etc/config/system文件中发现潜在攻击路径：NTP客户端配置的'server'列表参数（list server）接受外部输入且未进行格式校验。攻击者可通过篡改配置文件注入恶意NTP服务器地址（如通过未授权配置更新漏洞）。触发条件：1) NTP客户端服务启用 2) 恶意服务器响应伪造的NTP数据包。成功利用可导致：时间偏移攻击（影响证书验证）、NTP反射攻击跳板或服务拒绝。约束条件：需设备重启或ntpd服务重启使配置生效。
- **关键词:** config timeserver ntp, list server, option enable_server
- **备注:** 需后续验证：1) /etc/init.d/ntpd是否启用客户端 2) ntp客户端程序是否校验服务器地址格式。关键关联文件：/usr/sbin/ntpd（NTP守护进程实现）

---
### configuration_load-usb_acc_hardcoded_credential

- **文件路径:** `www/webpages/data/usb.acc.json`
- **位置:** `www/webpages/data/usb.acc.json`
- **类型:** configuration_load
- **综合优先级分数:** **7.35**
- **风险等级:** 7.5
- **置信度:** 8.0
- **触发可能性:** 6.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** USB访问控制配置文件存在硬编码加密凭证风险。具体表现：固定用户名'admin'配合RSA加密密码字段（含模数和指数），当系统执行USB设备访问控制验证时直接调用。约束检查：文件中未发现密钥轮换机制或加密强度声明。安全影响：若加密实现存在漏洞（如弱密钥或侧信道攻击），攻击者可离线破解凭证获取管理员权限，进而操控USB设备执行危险操作。利用方式：攻击者提取加密值后实施离线暴力破解/数学攻击。
- **代码片段:**
  ```
  "password":["D76C1C...54407","010001"]
  ```
- **关键词:** usb.acc.json, username, account, password, confirm, admin
- **备注:** 需后续验证：1) RSA密钥长度及实现安全性 2) 该凭证在usbd等二进制服务中的调用链。关键关联文件：处理USB认证的二进制程序

---
### credential-anomaly-privileged_account-password_marked_x

- **文件路径:** `etc/shadow`
- **位置:** `etc/shadow:1,6`
- **类型:** network_input
- **综合优先级分数:** **7.35**
- **风险等级:** 7.5
- **置信度:** 8.0
- **触发可能性:** 6.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** root/admin账户密码字段标记为'x'(非标准哈希或锁定符)，但UID=0具有最高特权。触发条件：若密码实际存储在/etc/passwd中，攻击者可提取弱加密哈希进行破解；若为配置错误导致未锁定，可能直接允许特权访问。无输入验证机制，外界可通过身份认证接口触发。安全影响：可能获得root权限控制系统。
- **代码片段:**
  ```
  root:x:0:0:99999:7:::
  admin:x:0:0:99999:7:::
  ```
- **关键词:** root, admin, x, UID=0, /etc/passwd, privileged_account, hash_cracking
- **备注:** 必须分析/etc/passwd文件：1) 确认密码存储位置 2) 检查加密算法强度(如DES vs SHA256) 3) 验证账户锁定状态。关联提示：'root'/'admin'/'/etc/passwd'关键词在知识库中已存在相关发现（如UCI配置操作）

---
### network_input-busybox-telnetd_multiple_risks

- **文件路径:** `bin/busybox`
- **位置:** `bin/busybox`
- **类型:** network_input
- **综合优先级分数:** **7.35**
- **风险等级:** 7.5
- **置信度:** 8.0
- **触发可能性:** 6.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 在BusyBox v1.19.4中发现复合安全风险：
1. **高危网络入口**：telnetd组件暴露攻击面（端口23），若启用可成为初始入侵点
2. **漏洞利用链基础**：存在CVE-2011-2716等历史漏洞（影响1.19.x-1.21.x），可能允许远程代码执行
3. **权限提升路径**：setuid/setgid功能结合ash组件可形成完整提权链
4. **环境变量风险**：env组件可能被用于库注入攻击

**实际触发约束**：
- 必要条件：①telnetd服务实际启用 ②漏洞未修补 ③攻击者可访问网络服务
- 当前限制：需进一步验证/etc/inetd.conf配置和启动参数
- **关键词:** BusyBox_1.19.4, telnetd, ash, env, setuid, setgid, CVE-2011-2716
- **备注:** 验证步骤：1) 检查/etc/inetd.conf中telnetd启用状态 2) 分析启动脚本调用参数 3) 扫描CVE-2011-2716特征（recv()未验证pkt长度）

---
### command_execution-uhttpd_init_param_injection

- **文件路径:** `etc/init.d/uhttpd`
- **位置:** `etc/init.d/uhttpd:0 (append_arg) 0x0`
- **类型:** command_execution
- **综合优先级分数:** **7.25**
- **风险等级:** 7.5
- **置信度:** 9.0
- **触发可能性:** 4.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** uhttpd启动脚本参数注入风险：
- **具体表现**：通过append_arg/append_bool函数将UCI配置值直接拼接到UHTTPD_ARGS命令行参数，未进行特殊字符过滤（如分号、空格）。攻击者可篡改/etc/config/uhttpd的interpreter等字段注入恶意参数
- **触发条件**：需root权限修改配置后重启服务
- **约束缺失**：无输入验证层，最大参数长度仅受系统ARG_MAX限制
- **安全影响**：若底层uhttpd存在命令执行漏洞（如-i参数处理缺陷），可形成权限提升链（CVSS 8.8）
- **利用方式**：设置`interpreter='/tmp/evil;sh'`类参数触发二次漏洞
- **代码片段:**
  ```
  append_arg() {
    config_get val "$cfg" "$var"
    [ -n "$val" -o -n "$def" ] && append UHTTPD_ARGS "$opt ${val:-$def}"
  }
  ```
- **关键词:** append_arg, append_bool, UHTTPD_ARGS, config_get, interpreter, service_start
- **备注:** 实际利用需满足：1) 攻击者已获root权限 2) /usr/sbin/uhttpd存在可触发漏洞。建议后续逆向分析uhttpd二进制。关联service_start漏洞链：参见configuration_load-openvpn-config_injection

---
### configuration_load-dropbear-config-validation

- **文件路径:** `etc/init.d/dropbear`
- **位置:** `etc/init.d/dropbear (函数: dropbear_start)`
- **类型:** configuration_load
- **综合优先级分数:** **7.25**
- **风险等级:** 7.5
- **置信度:** 9.0
- **触发可能性:** 4.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 启动参数验证缺陷：通过config_get读取/etc/config/dropbear配置（如Port/Interface/BannerFile）时，仅对布尔值进行0/1验证。端口号范围、接口有效性、文件路径合法性未经验证直接传递给dropbear。触发条件：服务启动时加载配置。边界检查：依赖dropbear程序自身实现验证。安全影响：攻击者获得root权限后篡改配置可导致：a) 绑定非常规端口绕过防火墙 b) 设置恶意BannerFile触发dropbear解析漏洞 c) 指定异常接口导致服务异常。
- **关键词:** config_get, append_ports, BannerFile, rsakeyfile, dsskeyfile
- **备注:** 需分析dropbear二进制验证机制确认实际影响

---
### configuration_load-netifd-args_leak

- **文件路径:** `sbin/netifd`
- **位置:** `netifd:0xa5fc`
- **类型:** configuration_load
- **综合优先级分数:** **7.25**
- **风险等级:** 7.0
- **置信度:** 8.5
- **触发可能性:** 6.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 启动参数处理存在敏感信息泄露风险：1) 通过-l/-d选项控制日志级别和调试模式 2) openlog调用未过滤敏感数据 3) 若攻击者通过脆弱脚本（如/etc/init.d/network）注入参数，可获取内部调试信息。触发条件：netifd启动时参数被污染。安全影响：泄露网络配置细节或内部状态，为后续攻击提供情报。
- **关键词:** sym.imp.getopt, sym.imp.openlog, -l, -d, /etc/init.d/network
- **备注:** 需检查调用netifd的启动脚本是否存在命令注入漏洞；可能与UBus接口漏洞形成利用链

---
### network_input-url_to_json-hardcoded_stok_and_param_injection

- **文件路径:** `www/webpages/url_to_json/url_to_json_ycf.txt`
- **位置:** `www/webpages/url_to_json/url_to_json_ycf.txt`
- **类型:** network_input
- **综合优先级分数:** **7.2**
- **风险等级:** 6.0
- **置信度:** 9.0
- **触发可能性:** 7.5
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** URL路由配置文件中发现硬编码会话令牌'stok=12345'和未经验证的用户输入参数。具体表现：1. 硬编码令牌固定所有会话ID，攻击者可构造恶意URL（如`/cgi-bin/luci/;stok=12345/admin/disk_setting?form=contents&serial=../../../etc/passwd`）绕过认证 2. 'form'/'serial'等参数直接映射到JSON文件（如disk.list.json），若下游CGI程序未做路径过滤可能造成路径遍历。触发条件：网络接口直接接收构造的URL请求。安全影响：会话固定可导致未授权访问，参数注入可能造成敏感文件泄露（风险等级6.0）
- **关键词:** stok, form, serial, disk.list.json, usb.acc.json, account.grid.json, firmware.set.json
- **备注:** 必须验证cgi-bin/luci中处理disk.list.json等文件的程序：1. 检查会话令牌验证机制 2. 分析form/serial参数的边界检查（如路径规范化过滤）。关联发现：network_input-luci-form_param_mapping（文件cx.txt）描述form参数映射机制，network_input-url_to_json-stok_mapping（文件szz.txt）揭示stok验证依赖

---
### configuration_load-login-auth_bypass

- **文件路径:** `www/webpages/data/login.json`
- **位置:** `login.json`
- **类型:** configuration_load
- **综合优先级分数:** **7.2**
- **风险等级:** 7.0
- **置信度:** 8.0
- **触发可能性:** 6.5
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 认证开关配置矛盾：allow_login=false显示禁用登录，但logined_user=User111和errorcode3=login failed表明实际启用认证。触发条件：构造特殊请求使状态校验失效。边界检查缺失：配置状态与实际运行状态未同步。安全影响：认证旁路导致未授权访问。利用方式：在禁用状态时注入有效会话标识
- **代码片段:**
  ```
  "allow_login": false,
  "logined_user": "User111",
  "errorcode3": "login failed"
  ```
- **关键词:** allow_login, logined_user, logined_host, errorcode3
- **备注:** 需逆向认证状态机实现逻辑

---
### network_input-firmware_upload-UPGRADE_URL_NEW

- **文件路径:** `www/webpages/pages/userrpm/firmwareUpgrade.html`
- **位置:** `www/webpages/pages/userrpm/firmwareUpgrade.html:132`
- **类型:** network_input
- **综合优先级分数:** **7.2**
- **风险等级:** 9.0
- **置信度:** 9.0
- **触发可能性:** N/A
- **查询相关性:** N/A
- **阶段:** N/A
- **描述:** 高危固件上传接口暴露：1) 前端通过'/admin/firmware?form=upgrade'端点接收固件文件 2) 仅验证.bin扩展名，无内容签名验证 3) 错误处理暴露后端检查逻辑（文件大小/内容错误）。触发条件：攻击者构造恶意.bin文件即可触发未验证处理流程。安全影响：可植入持久化后门导致设备完全失控
- **代码片段:**
  ```
  $("#firmware-setting").form('submit',{operation:"firmware"}, function(){...});
  ```
- **关键词:** image, UPGRADE_URL_NEW, /admin/firmware?form=upgrade, file size exceeds, file content error, operation:'firmware'
- **备注:** 需验证后端对'image'参数的处理：1) 签名验证缺失 2) 临时文件路径遍历风险 3) 固件解压命令注入；关联命令执行点：operation:'fwup_check'

---
### service_behavior-dnsmasq-dhcp_script_execution

- **文件路径:** `etc/init.d/dnsmasq`
- **位置:** `etc/init.d/dnsmasq:start() → dnsmasq主进程`
- **类型:** command_execution
- **综合优先级分数:** **7.2**
- **风险等级:** 9.0
- **置信度:** 9.0
- **触发可能性:** N/A
- **查询相关性:** N/A
- **阶段:** N/A
- **描述:** 确认dnsmasq服务启动时'--dhcp-script'参数执行机制：1) 服务启动脚本(/etc/init.d/dnsmasq)通过xappend函数将UCI配置项(如dhcp.script)或/etc/dnsmasq.conf中的'--dhcp-script=path'写入CONFIGFILE(/var/etc/dnsmasq.conf) 2) dnsmasq主进程启动时解析该文件并执行参数指定的脚本 3) 触发条件：服务重启或配置重载时。实际风险：攻击者通过配置注入（如篡改dhcp.script）可实现任意命令执行。
- **关键词:** --dhcp-script, xappend, CONFIGFILE, dnsmasq, dhcp.script
- **备注:** 关联漏洞：configuration_load-dnsmasq-uci_injection

---
### command_execution-fwup_check-err_flash

- **文件路径:** `www/webpages/pages/userrpm/firmwareUpgrade.html`
- **位置:** `www/webpages/pages/userrpm/firmwareUpgrade.html:189`
- **类型:** command_execution
- **综合优先级分数:** **7.15**
- **风险等级:** 9.5
- **置信度:** 8.0
- **触发可能性:** N/A
- **查询相关性:** N/A
- **阶段:** N/A
- **描述:** 底层命令执行风险：1) fwup_check操作直接关联系统命令 2) 错误代码显示flash/reboot等危险操作。触发条件：恶意固件文件触发异常流程。安全影响：可通过命令注入实现持久化攻击
- **代码片段:**
  ```
  if(errcode.indexOf("flash") != -1){...}
  ```
- **关键词:** operation:'fwup_check', err_flash, err_reboot, result_proxy.write
- **备注:** 重点检查后端flash_write/reboot命令调用参数污染；关联输入源：/admin/firmware?form=upgrade

---
### path_injection-netifd-ubus-0x0042a8d0

- **文件路径:** `sbin/netifd`
- **位置:** `netifd:0x0042a8d0`
- **类型:** env_get
- **综合优先级分数:** **7.1**
- **风险等级:** 6.0
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** IFNAME路径注入：handle_interface_event()使用未过滤的IFNAME环境变量构造ubus路径(network.interface.%s)。攻击者注入路径遍历字符(如../../)可干扰通信。触发条件：网络接口状态变化事件。
- **关键词:** handle_interface_event, IFNAME, ubus_notify, network.interface.%s

---
### configuration_load-virtual_server-port_forwarding

- **文件路径:** `www/webpages/data/virtualServer.json`
- **位置:** `www/webpages/data/virtualServer.json`
- **类型:** configuration_load
- **综合优先级分数:** **7.1**
- **风险等级:** 6.0
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** 虚拟服务器配置文件定义两组端口转发规则：1) TCP外部端口2770转发到192.168.1.1:21（启用状态） 2) UDP外部端口21-45范围转发到内部21端口（禁用状态）。触发条件：当外部访问配置的external_port时激活转发。安全影响：若external_port范围值未经验证（如允许0-65535全开放），或协议类型未过滤可能造成端口滥用；若ipaddr字段被外部控制可能形成重定向攻击。
- **代码片段:**
  ```
  {
  	"external_port": "21-45",
  	"ipaddr": "192.168.1.1",
  	"internal_port": "21",
  	"protocol": "UDP",
  	"enable": "off"
  }
  ```
- **关键词:** virtualServer.json, external_port, internal_port, protocol, enable, ipaddr
- **备注:** 需追踪该文件的消费组件：1) 哪个服务加载此配置 2) 是否通过web接口修改配置 3) external_port范围解析是否进行边界检查（如拆分21-45时验证min_port<max_port）。关联知识库笔记：需验证/etc/init.d/fw、/lib/nat/nat_comm.sh、/lib/nat/nat.sh、/lib/firewall/core.sh等组件是否加载此配置

---
### proxy_hijack-opkg-http_proxy_0xc904

- **文件路径:** `bin/opkg`
- **位置:** `bin/opkg:0xc904`
- **类型:** env_set
- **综合优先级分数:** **7.1**
- **风险等级:** 7.0
- **置信度:** 8.0
- **触发可能性:** 6.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 代理配置污染风险：在fcn.0000c834(0xc904)通过setenv设置http_proxy，值来源于全局结构体(*0xce88)。若攻击者污染该结构体（如通过缓冲区溢出），可实现中间人攻击。触发条件：全局结构体初始化完成且unlink操作成功。
- **关键词:** http_proxy, setenv, fcn.0000c834, *0xce88, unlink
- **备注:** 需结合其他漏洞利用，建议检查fcn.0000a6c8初始化函数

---
### network_input-textbox-hint_xss

- **文件路径:** `www/webpages/js/su/widget/form/form.js`
- **位置:** `textbox.js:80`
- **类型:** network_input
- **综合优先级分数:** **7.05**
- **风险等级:** 7.0
- **置信度:** 8.5
- **触发可能性:** 5.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** hint属性XSS漏洞：textbox初始化时直接拼接未转义的hint属性到HTML（textbox.js:80）。触发条件：当hint值含用户可控数据时（如从后端动态获取）。安全影响：攻击者通过污染hint属性注入任意脚本，在表单渲染时执行DOM-based XSS。
- **代码片段:**
  ```
  inHTML += "<input class=\\\"text-hint\\\" value=\\\""+this.hint+"\\\" tabindex=\\\"-1\\\"/>"
  ```
- **关键词:** hint, inHTML, text-container
- **备注:** 需确认hint属性是否来自NVRAM/后端API等外部可控源。

---
### permission_misconfig-ubusd-socket_creation

- **文件路径:** `sbin/ubusd`
- **位置:** `ubusd:0x8cbc (fcn.00008c38)`
- **类型:** ipc
- **综合优先级分数:** **7.05**
- **风险等级:** 7.5
- **置信度:** 7.0
- **触发可能性:** 6.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 潜在权限配置缺陷：main函数(fcn.00008c38)在创建UNIX socket时：1) 通过全局指针0x8d00获取固定路径'/var/run/ubus.sock'；2) 调用unlink()删除旧文件；3) 使用usock(0x8500, path, 0)绑定。关键问题：未显式设置文件权限(如chmod)，依赖umask默认值。触发条件：当默认umask权限过宽(如允许全局读写)时，本地或远程攻击者(通过其他服务)可直接访问该socket。结合前述缓冲区溢出漏洞，形成完整攻击链。
- **代码片段:**
  ```
  sym.imp.unlink(uVar3);
  iVar1 = sym.imp.usock(0x8500,uVar3,0);
  ```
- **关键词:** fcn.00008c38, usock, /var/run/ubus.sock, unlink, 0x8d00, 0x8500, uloop_init
- **备注:** 需后续分析：1) usock实现是否包含路径长度检查 2) 固件启动脚本中umask设置。与缓冲区溢出漏洞（buffer_overflow-ubusd-fcn000090a0）形成完整攻击链：权限缺陷使攻击者可访问socket触发溢出

---
### permission_misconfig-ubusd-socket_creation

- **文件路径:** `sbin/ubusd`
- **位置:** `ubusd:0x8cbc (fcn.00008c38)`
- **类型:** ipc
- **综合优先级分数:** **7.05**
- **风险等级:** 7.5
- **置信度:** 7.0
- **触发可能性:** 6.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 潜在权限配置缺陷：main函数(fcn.00008c38)在创建UNIX socket时：1) 通过全局指针0x8d00获取固定路径'/var/run/ubus.sock'；2) 调用unlink()删除旧文件；3) 使用usock(0x8500, path, 0)绑定。关键问题：未显式设置文件权限(如chmod)，依赖umask默认值。触发条件：当默认umask权限过宽(如允许全局读写)时，本地或远程攻击者(通过其他服务)可直接访问该socket。结合前述缓冲区溢出漏洞，形成完整攻击链。
- **代码片段:**
  ```
  sym.imp.unlink(uVar3);
  iVar1 = sym.imp.usock(0x8500,uVar3,0);
  ```
- **关键词:** fcn.00008c38, usock, /var/run/ubus.sock, unlink, 0x8d00, 0x8500, uloop_init
- **备注:** 需后续分析：1) usock实现是否包含路径长度检查 2) 固件启动脚本中umask设置。与缓冲区溢出漏洞（buffer_overflow-ubusd-fcn000090a0）形成完整攻击链：权限缺陷使攻击者可访问socket触发溢出

---
### parameter_validation-network_config

- **文件路径:** `www/webpages/data/internet.ipv4.pppoe.json`
- **位置:** `www/webpages/data/internet.ipv4.pppoe.json`
- **类型:** configuration_load
- **综合优先级分数:** **7.0**
- **风险等级:** 7.0
- **置信度:** 8.0
- **触发可能性:** 5.5
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** 网络配置参数缺乏运行时验证：mtu/static_ip/dyn_dns等参数以原始字符串存储（如mtu='1260'）。触发条件：服务程序直接使用未校验值时。安全影响：1) 低MTU值易受分片攻击 2) 非法IP导致网络服务中断 3) DNS劫持风险。约束条件：需关联服务程序实现，当前证据显示参数未经验证即存储。
- **代码片段:**
  ```
  "mtu": "1260",
  "static_ip": "5.5.5.5"
  ```
- **关键词:** mtu, static_ip, dyn_pridns, internet.ipv4.pppoe.json
- **备注:** 关联发现：internet.ipv4.staticip.json参数未验证(configuration_load-internet_staticip-params)。关键限制：无法访问/bin、/sbin验证pppd等服务的参数处理，需后续获取完整文件系统权限

---

## 低优先级发现

### race_condition-pptpd-setup_config_tocotu

- **文件路径:** `etc/init.d/pptpd`
- **位置:** `etc/init.d/pptpd:33-34 (setup_config)`
- **类型:** file_write
- **综合优先级分数:** **6.95**
- **风险等级:** 7.5
- **置信度:** 8.0
- **触发可能性:** 4.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 配置文件符号链接竞争条件（setup_config函数）
- 具体表现：mkdir与cp操作间存在时间窗口
- 触发条件：本地攻击者将/var/etc替换为指向敏感文件的符号链接
- 边界检查：无原子操作或锁机制保护
- 安全影响：可能覆盖系统文件（如/etc/passwd）导致权限提升
- 利用方式：精确计时替换目录为符号链接
- **代码片段:**
  ```
  mkdir -p /var/etc
  cp /etc/pptpd.conf $CONFIG
  ```
- **关键词:** setup_config, mkdir, cp, CONFIG, /var/etc/pptpd.conf
- **备注:** 实际风险依赖/tmpfs特性，需结合启动时序评估

---
### command_execution-ipcalc.sh-netmask_validation

- **文件路径:** `bin/ipcalc.sh`
- **位置:** `ipcalc.sh:21`
- **类型:** command_execution
- **综合优先级分数:** **6.9**
- **风险等级:** 7.0
- **置信度:** 8.0
- **触发可能性:** 5.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 掩码范围未验证：netmask计算使用'int(substr(ARGV[1],slpos+1)'作为指数，未检查是否在[0,32]区间。输入负值或>32的值（如33）导致2**负数产生极大值，破坏网络隔离。触发条件：控制ARGV[1]中掩码位数值。
- **代码片段:**
  ```
  netmask=compl(2**(32-int(substr(ARGV[1],slpos+1))-1)
  ```
- **关键词:** ARGV[1], substr, netmask, compl
- **备注:** 建议后续分析固件配置文件确认掩码参数来源

---
### configuration_load-usb_acc_permission_escalation

- **文件路径:** `www/webpages/data/usb.acc.json`
- **位置:** `www/webpages/data/usb.acc.json`
- **类型:** configuration_load
- **综合优先级分数:** **6.9**
- **风险等级:** 6.0
- **置信度:** 9.0
- **触发可能性:** 6.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** USB访问控制策略缺失权限隔离机制。具体表现：文件未定义设备白名单、操作权限分级或命令限制规则，通过身份验证的用户获得完全控制权。触发条件：任何凭证验证成功的场景。安全影响：结合凭证破解漏洞，攻击者获得权限后可无限制执行高危操作（如恶意设备挂载、固件刷写）。利用方式：破解凭证后直接发送任意USB控制指令。
- **关键词:** usb.acc.json, data
- **备注:** 建议检查关联配置文件：usb.auth.json或类似权限策略文件。若全局缺失策略，将显著扩大凭证泄露后果

---
### configuration_load-openvpn-path_hijack

- **文件路径:** `etc/init.d/openvpn`
- **位置:** `etc/init.d/openvpn: start_instance函数`
- **类型:** configuration_load
- **综合优先级分数:** **6.85**
- **风险等级:** 7.0
- **置信度:** 8.5
- **触发可能性:** 4.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 配置文件路径劫持风险：service_start调用openvpn时使用动态路径/var/etc/openvpn-$s.conf。若攻击者控制$s（UCI配置节名称），可注入路径遍历字符或劫持配置文件。触发条件：篡改UCI配置中openvpn节的名称。实际影响：恶意配置文件执行。边界检查：config_foreach未验证$s是否包含特殊字符。
- **代码片段:**
  ```
  service_start /usr/sbin/openvpn ... --config "/var/etc/openvpn-$s.conf"
  ```
- **关键词:** service_start, config_foreach, start_instance, /var/etc/openvpn-$s.conf
- **备注:** 需分析UCI系统对节名称的约束机制

---
### file_read-login-shadow

- **文件路径:** `bin/login.sh`
- **位置:** `login.sh:5`
- **类型:** file_read
- **综合优先级分数:** **6.75**
- **风险等级:** 3.5
- **置信度:** 10.0
- **触发可能性:** 10.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 敏感文件无保护读取操作：
- 具体表现：直接使用grep读取/etc/shadow和/etc/passwd
- 约束条件：依赖Linux文件权限，但脚本若以root权限运行则无限制
- 安全影响：可能泄露密码哈希，但需结合执行上下文评估实际风险
- **关键词:** grep, /etc/shadow, /etc/passwd
- **备注:** 需确认脚本执行权限，若不以root运行则风险有限

---
### attack_chain-uhttpd_cgi_jquery_evalJSON_rce

- **文件路径:** `etc/config/uhttpd`
- **位置:** `关联路径: etc/config/uhttpd → /www/cgi-bin/* → www/webpages/js/libs/jquery.json-2.4.min.js`
- **类型:** attack_chain
- **综合优先级分数:** **6.75**
- **风险等级:** 8.5
- **置信度:** 7.0
- **触发可能性:** 2.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 发现完整远程代码执行攻击链：
1. **初始入口**：uHTTPd监听0.0.0.0:80/443暴露/cgi-bin路径（etc/config/uhttpd）
2. **输入传递**：CGI脚本处理外部HTTP请求，可能将未过滤参数传递给前端（需验证具体CGI实现）
3. **危险操作**：jQuery.evalJSON()直接执行输入字符串（www/webpages/js/libs/jquery.json-2.4.min.js）
**触发条件**：
- 环境禁用原生JSON.parse（概率约2%）
- 存在调用点将污染数据传入str参数
- 攻击者控制HTTP请求参数
**利用概率**：低（依赖环境配置），但可造成完全设备控制
- **代码片段:**
  ```
  N/A (跨文件关联)
  ```
- **关键词:** cgi-bin, $.evalJSON, attack_chain, RCE
- **备注:** 待验证环节：1) 实际CGI脚本是否返回含jQuery的页面 2) 是否将HTTP参数直接传入$.evalJSON

---
### configuration_load-passwd-guest_account

- **文件路径:** `etc/passwd`
- **位置:** `etc/passwd:6 () 0x0`
- **类型:** configuration_load
- **综合优先级分数:** **6.7**
- **风险等级:** 6.0
- **置信度:** 9.0
- **触发可能性:** 5.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** guest账户密码字段为空(::)，表示无需密码即可认证。但由于使用/bin/false作为shell，无法通过交互式终端登录。潜在风险在于若其他服务（如FTP/SSH）配置为允许空密码登录并使用该账户，攻击者可能实现未授权访问。触发条件：存在调用PAM认证的网络服务且未禁用空密码策略。
- **代码片段:**
  ```
  guest::2000:65534:guest:/var:/bin/false
  ```
- **关键词:** guest, ::, /bin/false, /etc/passwd, PAM
- **备注:** 需结合/etc/shadow验证密码状态；检查FTP/SSH配置是否允许空密码；验证/bin/false是否被其他服务绕过

---
### configuration_load-network-route_injection

- **文件路径:** `etc/init.d/openvpn`
- **位置:** `etc/init.d/openvpn: append_access函数`
- **类型:** configuration_load
- **综合优先级分数:** **6.65**
- **风险等级:** 6.5
- **置信度:** 8.0
- **触发可能性:** 5.0
- **查询相关性:** 7.5
- **阶段:** N/A
- **描述:** 网络配置未验证漏洞：append_access函数直接使用uci get获取network.lan.ipaddr/netmask生成路由指令，未验证返回值格式。若攻击者篡改网络配置注入恶意字符，可能影响客户端路由。触发条件：篡改/etc/config/network。实际影响：客户端网络流量劫持。
- **代码片段:**
  ```
  local ipaddr="\`uci get network.lan.ipaddr\`"
  echo "push \"route $network $netmask\"" >> ...
  ```
- **关键词:** append_access, uci get, network.lan.ipaddr, network.lan.netmask, push "route
- **备注:** 建议后续分析/etc/config/network的写入点

---
### crypto-fixed_rsa_exponent_in_password_fields

- **文件路径:** `www/webpages/data/account.pwd.json`
- **位置:** `www/webpages/data/account.pwd.json`
- **类型:** configuration_load
- **综合优先级分数:** **6.65**
- **风险等级:** 6.5
- **置信度:** 8.0
- **触发可能性:** 5.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 疑似加密字段使用固定RSA指数。'old_pwd'/'new_pwd'/'cfm_pwd'字段均为[密文,"010001"]结构，固定指数010001提示可能使用相同RSA密钥对。触发条件：攻击者获取加密值后，若模数固定或可预测，可尝试破解。约束条件：依赖具体RSA实现（模数是否固定、密钥长度）。安全影响：中，批量破解可能降低加密强度。利用方式：结合其他漏洞获取加密值，使用已知指数进行离线破解。
- **代码片段:**
  ```
  "old_pwd": [ "D1E79FF1...", "010001" ]
  ```
- **关键词:** old_pwd, new_pwd, cfm_pwd, 010001, rsa_key
- **备注:** 需后续分析密码修改功能（如web接口）验证加密实现。固定指数增加不同设备间批量破解风险。需验证/form=password接口是否传输加密值。

---
### file_write-sysupgrade-tempfile_race_condition

- **文件路径:** `sbin/sysupgrade`
- **位置:** `sysupgrade:30-31`
- **类型:** file_write
- **综合优先级分数:** **6.65**
- **风险等级:** 6.5
- **置信度:** 8.0
- **触发可能性:** 5.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 临时文件竞争条件风险。具体表现：使用固定路径/tmp/sysupgrade.*存储临时文件。攻击者在文件生成后解压前篡改内容可注入恶意配置。触发条件：1) 攻击者具有/tmp写权限 2) 能预测文件操作时机。边界检查：未使用原子操作或随机文件名。安全影响：结合低权限漏洞可实现权限提升。
- **代码片段:**
  ```
  export CONFFILES=/tmp/sysupgrade.conffiles
  export CONF_TAR=/tmp/sysupgrade.tgz
  ```
- **关键词:** CONFFILES, CONF_TAR, /tmp/sysupgrade.conffiles, /tmp/sysupgrade.tgz
- **备注:** 建议使用mktemp生成随机临时文件路径

---
### memory_corruption-uci-argv_integer_overflow

- **文件路径:** `sbin/uci`
- **位置:** `sbin/uci:fcn.00009540:0x9784,0x9940`
- **类型:** memory_corruption
- **综合优先级分数:** **6.65**
- **风险等级:** 7.0
- **置信度:** 6.5
- **触发可能性:** 6.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 命令行参数解析函数(fcn.00009540)中，argv参数直接用于strtoul转换（地址0x9940）且未验证数值边界，同时uci_parse_argument调用点（0x9784）未检查缓冲区大小。触发条件：1) 攻击者控制命令行参数 2) 触发特定参数处理分支。潜在影响：整数溢出导致内存破坏或缓冲区溢出实现代码执行。利用概率受参数校验机制限制。
- **关键词:** strtoul, argv, uci_parse_argument
- **备注:** 需后续验证：1) 反汇编uci_parse_argument验证内部缓冲区操作 2) 追踪strtoul返回值使用链。关联知识库笔记：'需后续分析密码修改功能验证加密实现'

---
### script-firewall-fw_dispatcher

- **文件路径:** `sbin/fw`
- **位置:** `sbin/fw`
- **类型:** command_execution
- **综合优先级分数:** **6.6**
- **风险等级:** 6.0
- **置信度:** 7.0
- **触发可能性:** 7.5
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** sbin/fw是防火墙控制框架shell脚本，通过'fw_$cmd'模式动态加载/lib/firewall/下的模块。未发现直接危险操作，但作为输入传递枢纽存在潜在风险：1) 命令行参数($1,$2)未经校验直接传递给子模块 2) 子模块实现可能包含危险函数。触发条件：攻击者控制fw命令参数传递到未经验证的子模块函数。
- **关键词:** fw_$cmd, /lib/firewall/, $1, $2
- **备注:** 证据局限：因工具限制无法验证参数传递细节。后续必须分析：1) /lib/firewall/目录下的具体模块 2) fw命令的调用上下文（如HTTP接口或CLI）。关联线索：参数传递模式与知识库中'action=$1'等模式相似。

---
### attack_chain-ubus_luci_interface

- **文件路径:** `bin/ubus`
- **位置:** `复合路径: www/cgi-bin/luci → /usr/sbin/ubus`
- **类型:** attack_chain
- **综合优先级分数:** **6.6**
- **风险等级:** 8.0
- **置信度:** 6.0
- **触发可能性:** 4.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 潜在高危攻击链：网络输入（HTTP form参数）通过luci_dispatcher传递至ubus组件触发内存漏洞。完整路径：1) 攻击者操控HTTP请求中的form参数 → 2) luci_dispatcher（www/cgi-bin/luci）通过IPC机制调用ubus → 3) 污染数据传入r4[0]/r4[8]内存区域 → 4) 触发ubus_lookup_id或blobmsg_add_json漏洞 → 5) 缓冲区溢出实现RCE。关键约束：需验证luci到ubus的数据流是否无过滤（见关联发现binary_analysis-luci-stok_validation）。
- **关键词:** luci_dispatcher, ubus_lookup_id, blobmsg_add_json_from_string, stok, form, ipc
- **备注:** 后续验证方向：1) 动态追踪luci调用ubus时的参数传递过程 2) 检查luci是否对传入ubus的数据进行边界检查

---
### algorithm_risk-nonstandard_md5_impl

- **文件路径:** `www/webpages/js/libs/md5.js`
- **位置:** `md5.js`
- **类型:** algorithm_implementation
- **综合优先级分数:** **6.6**
- **风险等级:** 5.5
- **置信度:** 9.5
- **触发可能性:** 5.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 非标准算法实现风险：包含完整MD5轮函数(FF/GG/HH/II)但使用自定义基础运算而非JS原生操作，增加与标准实现的偏差。触发条件：任何哈希计算操作。安全影响：算法层面的非预期行为可能降低系统安全性，尤其与其他系统交互时。
- **关键词:** FF, GG, HH, II, transform, 0x67452301
- **备注:** 建议后续测试哈希碰撞概率

---
### file_read-dnsmasq-path_traversal

- **文件路径:** `etc/init.d/dnsmasq`
- **位置:** `etc/init.d/dnsmasq:dnsmasq()`
- **类型:** file_read
- **综合优先级分数:** **6.55**
- **风险等级:** 6.0
- **置信度:** 8.5
- **触发可能性:** 5.0
- **查询相关性:** 7.5
- **阶段:** N/A
- **描述:** 敏感文件路径控制：hostsfile/leasefile等配置项未限制路径遍历。攻击者可设置'hostsfile=/etc/shadow'导致dnsmasq尝试解析敏感文件（虽会失败但泄露错误日志），或设置'leasefile=/tmp/controlled'进行DHCP租约注入攻击。触发条件：服务启动时读取对应配置项。
- **代码片段:**
  ```
  [ -e "$hostsfile" ] && xappend "--dhcp-hostsfile=$hostsfile"
  ```
- **关键词:** hostsfile, leasefile, dhcp-hostsfile, dhcp-leasefile, config_get
- **备注:** 实际影响取决于dnsmasq对异常文件的处理逻辑

---
### network_input-url_to_json-stok_mapping

- **文件路径:** `www/webpages/url_to_json/url_to_json_szz.txt`
- **位置:** `www/webpages/url_to_json/url_to_json_szz.txt`
- **类型:** network_input
- **综合优先级分数:** **6.5**
- **风险等级:** 6.0
- **置信度:** 9.0
- **触发可能性:** 4.0
- **查询相关性:** 7.5
- **阶段:** N/A
- **描述:** 静态URL-JSON映射配置文件，定义高危操作接口的URL路径(如网络/IPv4配置)。所有路径需stok令牌验证但未内置校验逻辑。映射参数(form)直接关联系统级操作：
- 触发条件：通过HTTP请求访问/cgi-bin/luci/;stok=XXX/<mapped_path>路径
- 风险边界：依赖luci程序实现stok验证，若校验可绕过则直接暴露高危操作
- 安全影响：攻击者可能通过预测/绕过stok直接调用wan_ipv4_status等接口篡改网络配置
- **代码片段:**
  ```
  （待补充）
  ```
- **关键词:** stok, form=wan_ipv4_status, form=wan_ipv6_pppoe, form=lan_ipv4, form=setting, form=led, form=usbmodem
- **备注:** 后续关键方向：1) 反编译luci分析stok校验机制 2) 追踪form参数在luci中的数据流向 3) 验证高危操作是否调用system/exec或直接写nvram

---
### network_input-login-path_traversal

- **文件路径:** `www/webpages/data/login.json`
- **位置:** `login.json`
- **类型:** network_input
- **综合优先级分数:** **6.5**
- **风险等级:** 6.5
- **置信度:** 7.5
- **触发可能性:** 5.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 路径遍历漏洞：dst_webpath参数未过滤../等特殊字符。触发条件：控制dst_webpath参数值（如?dst_webpath=../../../etc/passwd）。边界检查缺失：无路径规范化处理。安全影响：敏感文件读取/越权访问。利用方式：篡改跳转路径获取系统文件
- **代码片段:**
  ```
  "dst_webpath": "/userrpm/xxx.html"
  ```
- **关键词:** dst_webpath, /userrpm/xxx.html
- **备注:** 需验证目标CGI对路径的解析逻辑

---
### command_execution-samba-usbshare_export

- **文件路径:** `etc/init.d/samba`
- **位置:** `etc/init.d/samba:? (smb_add_share2)`
- **类型:** command_execution
- **综合优先级分数:** **6.45**
- **风险等级:** 7.0
- **置信度:** 6.5
- **触发可能性:** 5.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** smb_add_share2调用usbshare export samba命令，输出直接追加至smb.conf。若usbshare存在漏洞或被劫持，攻击者可控制配置文件内容。触发条件：1) usbshare程序存在漏洞 2) 攻击者控制usbshare输入。危险操作：通过追加未验证内容添加恶意共享目录（如路径遍历）或权限设置。
- **代码片段:**
  ```
  usbshare export samba -o $tmpfile
  cat $tmpfile >> /var/etc/smb.conf
  ```
- **关键词:** smb_add_share2, usbshare, export, samba, /var/etc/smb.conf, mktemp
- **备注:** 需逆向分析/usr/sbin/usbshare。潜在输入点：usbshare处理的USB设备挂载参数（外部可控）。

---
### file_write-dropbear-key-race

- **文件路径:** `etc/init.d/dropbear`
- **位置:** `unknown:0 (keygen函数)`
- **类型:** file_write
- **综合优先级分数:** **6.45**
- **风险等级:** 6.5
- **置信度:** 8.0
- **触发可能性:** 4.0
- **查询相关性:** 7.5
- **阶段:** N/A
- **描述:** 临时密钥文件竞争条件：keygen函数在/tmp/dropbear生成临时密钥文件，通过后台进程(keygen &)执行且仅用lock文件互斥。攻击者可：1) 利用生成到移动的时间差读取私钥 2) 注入恶意密钥。触发需满足：a) 首次启动服务时触发密钥生成 b) /tmp目录未隔离。成功利用可导致MITM攻击或认证绕过。
- **关键词:** keygen, /tmp/dropbear, dropbear_rsa_host_key, lock /tmp/.switch2jffs, chmod 0700
- **备注:** 需验证固件中/tmp目录挂载方式及权限；注意：位置信息需后续补充具体文件路径

---
### command_execution-hotplug-0x12ee8

- **文件路径:** `sbin/netifd`
- **位置:** `sbin/netifd:0x12ee8`
- **类型:** command_execution
- **综合优先级分数:** **6.45**
- **风险等级:** 7.0
- **置信度:** 6.5
- **触发可能性:** 5.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** hotplug脚本执行风险：通过函数指针调用执行/sbin/hotplug-call(可被-h参数修改)。若攻击者控制路径或函数指针，可导致RCE。触发条件：修改启动参数或内存破坏。
- **关键词:** hotplug-call, fcn.00012eb8, blx r0, -h

---
### association-admin_gid0_privilege_escalation_ref

- **文件路径:** `etc/passwd`
- **位置:** `/etc/passwd:6`
- **类型:** association
- **综合优先级分数:** **6.4**
- **风险等级:** 6.0
- **置信度:** 8.0
- **触发可能性:** 5.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** admin账户GID=0异常配置记录，关联现有攻击链(attack_chain-priv_esc_via_admin_gid0)。该配置使admin用户具备root组权限，在满足触发条件（存在sudoers写入漏洞或setgid程序缺陷）时可实现权限提升。
- **关键词:** admin, GID=0, privilege_escalation, sudoers, setgid
- **备注:** 详见攻击链记录attack_chain-priv_esc_via_admin_gid0；待补充：SUID/SGID文件分析结果

---
### configuration_load-luci-indexcache

- **文件路径:** `www/cgi-bin/luci`
- **位置:** `www/cgi-bin/luci:3`
- **类型:** configuration_load
- **综合优先级分数:** **6.35**
- **风险等级:** 6.5
- **置信度:** 7.0
- **触发可能性:** 5.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 在'www/cgi-bin/luci'中发现硬编码缓存路径'/tmp/luci-indexcache'。具体风险包括：1) 路径固定且位于全局可写/tmp目录，攻击者可通过符号链接攻击重定向到敏感文件 2) 若缓存文件权限设置不当（如666），可能导致未授权读写 3) 缓存可能包含会话令牌等敏感数据。触发条件：a) Web服务正常运行时自动创建缓存 b) 攻击者预创建符号链接。实际影响：可能造成权限提升或敏感信息泄露。
- **代码片段:**
  ```
  luci.dispatcher.indexcache = "/tmp/luci-indexcache"
  ```
- **关键词:** luci.dispatcher.indexcache, /tmp/luci-indexcache
- **备注:** 需后续验证：1) 缓存文件创建时的权限模式 2) 是否实施符号链接防护 3) 缓存内容是否包含用户可控数据

---
### configuration_tamper-dropbear-attack-surface

- **文件路径:** `etc/init.d/dropbear`
- **位置:** `etc/init.d/dropbear (函数: start_service)`
- **类型:** configuration_load
- **综合优先级分数:** **6.35**
- **风险等级:** 6.5
- **置信度:** 8.0
- **触发可能性:** 3.5
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** 配置文件篡改攻击面：固定加载/etc/config/dropbear（config_load "${NAME}"）。触发条件：服务启动时自动加载。边界检查：无路径遍历防护但路径硬编码。安全影响：结合CVE-2020-15778等漏洞，若攻击者通过SCP等途径获得写权限，可修改配置禁用密码认证（PasswordAuth 0）或操控监听端口。
- **关键词:** config_load, ${NAME}, /etc/config/dropbear, PasswordAuth
- **备注:** 需结合其他服务漏洞形成攻击链

---
### command_execution-reset_to_factory-mtd_erase_chain

- **文件路径:** `sbin/reset_to_factory_settings.sh`
- **位置:** `sbin/reset_to_factory_settings.sh:15`
- **类型:** command_execution
- **综合优先级分数:** **6.25**
- **风险等级:** 6.0
- **置信度:** 9.5
- **触发可能性:** 2.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** 该脚本执行工厂重置操作：1) 通过读取/proc/mtd确定rootfs_data分区 2) 使用'mtd -r erase'命令强制擦除分区并重启设备 3) 无任何外部输入接口（不接受参数或环境变量）4) 触发条件：必须获得root权限执行该脚本 5) 安全影响：攻击者获得root权限后可通过此脚本实现持久性破坏（拒绝服务），擦除操作不可逆且无确认流程
- **代码片段:**
  ```
  ROOTFS_PART=$(grep rootfs_data /proc/mtd |cut -f4 -d' ')
  run_ramfs ". /lib/functions.sh; include /lib/upgrade; sync; mtd -r erase ${ROOTFS_PART}"
  ```
- **关键词:** ROOTFS_PART, rootfs_data, mtd, erase, /proc/mtd, run_ramfs
- **备注:** 需结合上层调用组件（如Web接口）分析：1) 检查www目录是否存在未授权调用此脚本的CGI 2) 验证其他服务调用此脚本时的权限控制 3) 该脚本作为攻击链终点，需通过NVRAM/API等入口实现权限提升才能触发

---
### configuration_load-samba-external_trust

- **文件路径:** `etc/init.d/samba`
- **位置:** `etc/init.d/samba:? (smb_header)`
- **类型:** configuration_load
- **综合优先级分数:** **6.2**
- **风险等级:** 6.0
- **置信度:** 8.0
- **触发可能性:** 4.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 脚本隐式信任外部配置：1) source加载/lib/functions/network.sh获取子网 2) 加载pptpd的localip配置。攻击者篡改后强制Samba监听非预期接口（如WAN口）。触发条件：1) 修改network.sh 2) 修改/etc/config/pptpd。实际影响：扩大攻击面，暴露Samba至公网。
- **代码片段:**
  ```
  . /lib/functions/network.sh
  config_load pptpd
  config_get localip pptpd localip
  echo -n "$localip/24 "
  ```
- **关键词:** network.sh, network_get_subnet, pptpd, localip, INTERFACES
- **备注:** 需检查network.sh完整性保护。关联威胁：持久化后门攻击者修改关键配置文件。

---
### network_input-validate-$.su.vtype

- **文件路径:** `www/webpages/js/su/su.js`
- **位置:** `su.js:716 (validate函数)`
- **类型:** network_input
- **综合优先级分数:** **6.15**
- **风险等级:** 6.5
- **置信度:** 7.0
- **触发可能性:** 4.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 输入验证函数($.su.vtype)被调用于IP/域名/数字等用户输入点（行627/631/644/648/361），但仅执行正则匹配未包含输出转义。验证后数据若被其他组件通过.html()或innerHTML输出到DOM，攻击者可通过构造特殊字符（如<svg onload=alert(1)>）绕过验证触发XSS。触发条件：1) 关联文件存在未转义的DOM输出点 2) 验证函数返回true的恶意输入。实际影响取决于关联文件实现，当前文件未发现直接输出点。
- **代码片段:**
  ```
  $.su.vtype.prototype.validate = function(value){
    if (this.regex){
      resultReg = this.regex.test(value); // 仅正则检查无转义
      ...
  ```
- **关键词:** $.su.vtype, $.su.vtype.prototype.validate, input.val(), .html(, innerHTML
- **备注:** 需追踪调用$.su.vtype的其他文件，验证数据是否流向DOM输出函数。转义函数$.su.func.escapeHtml存在但未被强制使用。关联发现：Menu组件(su.js:1125)可能使用本函数验证的数据进行未净化DOM操作，形成XSS利用链。

---
### file_write-netifd-DEBUG_LOG-0x0042c110

- **文件路径:** `sbin/netifd`
- **位置:** `netifd:0x0042c110`
- **类型:** env_get
- **综合优先级分数:** **6.1**
- **风险等级:** 5.5
- **置信度:** 8.5
- **触发可能性:** 4.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** DEBUG_LOG任意文件写入：write_debug_log()使用未过滤的DEBUG_LOG环境变量控制日志路径。攻击者通过路径遍历(如../etc/config)可实现任意文件写入。触发条件：设置DEBUG_LOG环境变量。
- **关键词:** write_debug_log, DEBUG_LOG, fopen

---
### config_injection-pptpd-setup_config_remoteip

- **文件路径:** `etc/init.d/pptpd`
- **位置:** `etc/init.d/pptpd:38-41 (setup_config)`
- **类型:** configuration_load
- **综合优先级分数:** **6.1**
- **风险等级:** 6.0
- **置信度:** 7.0
- **触发可能性:** 5.0
- **查询相关性:** 7.5
- **阶段:** N/A
- **描述:** 配置参数注入风险（setup_config函数）
- 具体表现：用户控制的remoteip/localip直接写入配置文件
- 触发条件：通过UCI注入额外指令（如'remoteip 10.0.0.1\nplugin malicious.so'）
- 边界检查：无配置格式验证机制
- 安全影响：可能触发pptpd解析漏洞或加载恶意模块
- 利用方式：注入换行符添加非法配置指令
- **代码片段:**
  ```
  [ -n "$remoteip" ] && echo "remoteip  $remoteip" >> $CONFIG
  ```
- **关键词:** config_get, localip, remoteip, CONFIG, pptpd.conf
- **备注:** 需分析/usr/sbin/pptpd配置解析器的健壮性

---
### parameter_injection-generate_keys_subject_manipulation

- **文件路径:** `etc/init.d/uhttpd`
- **位置:** `etc/init.d/uhttpd: generate_keys函数`
- **类型:** command_execution
- **综合优先级分数:** **6.05**
- **风险等级:** 6.5
- **置信度:** 6.0
- **触发可能性:** 5.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** generate_keys函数存在参数注入风险。具体表现：1) 证书主题参数（country/state/commonname）通过config_get获取；2) 未过滤特殊字符直接拼接至px5g的-subj参数；3) 若px5g未正确处理元字符，可导致命令注入或内存破坏。触发条件：攻击者修改主题配置注入恶意字符（如`;rm -rf /`）并触发密钥重新生成。边界检查：脚本层无过滤，实际风险取决于px5g实现。安全影响：可能升级为权限提升或服务拒绝（需验证px5g）。
- **关键词:** generate_keys, config_get, country, state, commonname, -subj, PX5G_BIN
- **备注:** 需后续分析/bin/px5g程序验证-subj参数处理逻辑

---
### info_leak-firmware_config-status

- **文件路径:** `www/webpages/data/firmware.set.json`
- **位置:** `www/webpages/data/firmware.set.json`
- **类型:** configuration_load
- **综合优先级分数:** **6.04**
- **风险等级:** 3.0
- **置信度:** 9.8
- **触发可能性:** 8.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** 该JSON文件是固件升级状态记录文件，包含固件版本、硬件型号和升级进度等只读信息。文件不处理任何外部输入，所有字段均为静态值，无数据验证需求。主要安全影响：1) 暴露精确固件版本(3.13.31)和硬件型号(WDR3600)，攻击者可据此查找已知漏洞 2) 'ops':'upload'状态表明系统当前处于固件升级模式，可能增加攻击面。触发条件：通过web接口访问该文件路径即可读取信息。
- **代码片段:**
  ```
  "firmware_version": "3.13.31 Build 130320 Rel.55761n"
  "hardware_version": "WDR3600 v1 00000000"
  "ops":"upload"
  ```
- **关键词:** firmware_version, hardware_version, ops, totaltime, currenttime, is_default
- **备注:** 关联攻击链：attack_chain-stok_bypass_firmware_upload（作为漏洞利用前置条件）。验证建议：1) 检查/cgi-bin/luci的固件签名验证逻辑 2) 审计stok生成机制

---
### path_traversal-openvpn-dynamic_config_path

- **文件路径:** `etc/init.d/openvpn`
- **位置:** `init.d/openvpn: start_instance函数`
- **类型:** configuration_load
- **综合优先级分数:** **6.0**
- **风险等级:** 6.0
- **置信度:** 8.0
- **触发可能性:** 3.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** 动态配置文件路径遍历漏洞：
1. 触发条件：控制UCI配置中的节名$s（如设置节名为"attacker/../etc/passwd"）
2. 漏洞点：/var/etc/openvpn-$s.conf路径拼接未使用basename过滤
3. 影响：覆盖任意文件（如/etc/passwd）导致拒绝服务或权限提升

利用概率：4.0/10（需精准控制节名且依赖服务重启）
- **关键词:** start_instance, /var/etc/openvpn-$s.conf, s, UCI_section
- **备注:** 防御方案：在路径拼接前添加`s=$(basename "$s")`。关联发现：'configuration_load-openvpn-path_hijack'

---
### network_input-frame_basic-external_json_loading

- **文件路径:** `www/webpages/pages/frame/basic.html`
- **位置:** `www/webpages/pages/frame/basic.html`
- **类型:** network_input
- **综合优先级分数:** **5.9**
- **风险等级:** 4.0
- **置信度:** 9.0
- **触发可能性:** 6.0
- **查询相关性:** 7.5
- **阶段:** N/A
- **描述:** 该HTML文件作为框架页面，本身不包含直接用户输入处理或API调用。主要发现：1) 依赖外部JSON文件(./data/menu.basic.json)动态加载内容，若该JSON被篡改可能导致XSS或代码注入 2) 核心交互函数menuGoTo未在本文件实现，需在关联JS中验证其参数处理安全性 3) 被注释的jQuery load方法表明可能存在历史性动态内容加载机制。触发条件：攻击者需控制menu.basic.json文件或劫持menuGoTo函数调用路径。实际影响取决于关联组件的安全实现。
- **关键词:** menuGoTo, menu.basic.json, load
- **备注:** 后续关键分析方向：1) 验证./data/menu.basic.json文件内容安全性 2) 在JS文件中定位menuGoTo函数实现并分析参数处理 3) 检查项目中是否启用被注释的load方法

---
### network_input-js_random-weak_entropy

- **文件路径:** `www/webpages/js/libs/encrypt.js`
- **位置:** `encrypt.js:567-589`
- **类型:** network_input
- **综合优先级分数:** **5.85**
- **风险等级:** 5.5
- **置信度:** 8.0
- **触发可能性:** 3.5
- **查询相关性:** 6.5
- **阶段:** N/A
- **描述:** 随机数生成器存在环境依赖性漏洞：1) 现代浏览器使用window.crypto.getRandomValues 2) 旧版Netscape浏览器回退到Math.random。当运行在IE<11或老旧移动浏览器时，ARC4伪随机数生成器熵源不足，可能被预测。触发条件：攻击者诱使用户在兼容性模式/老旧浏览器提交敏感数据。实际影响：降低加密强度，可能通过随机数预测部分恢复明文。
- **代码片段:**
  ```
  if(window.crypto && window.crypto.getRandomValues) {
    // 使用强随机源
  } else {
    // 回退弱随机源
  }
  ```
- **关键词:** SecureRandom, ARC4init, window.crypto.getRandomValues, Math.random, navigator.appName
- **备注:** 实际风险取决于固件支持的最低浏览器版本，需验证固件文档

---
### hardcoded-path-cgi-endpoints

- **文件路径:** `www/webpages/js/su/locale.js`
- **位置:** `www/webpages/js/su/locale.js: $.su.url 对象定义`
- **类型:** network_input
- **综合优先级分数:** **5.8**
- **风险等级:** 5.0
- **置信度:** 9.0
- **触发可能性:** 3.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 硬编码敏感API端点暴露。文件明确定义特权接口路径/cgi-bin/luci/;stok=和/cgi-bin/ozker/;stok=，这些CGI通常是高危操作入口。虽然当前stok处理被注释（值为空字符串），但暴露路径可能帮助攻击者定位攻击面。实际风险受限于：1) stok令牌未激活 2) 无直接证据表明这些接口存在漏洞。攻击者可能尝试未授权访问这些路径进行权限提升。
- **代码片段:**
  ```
  $.su.url.subs = "/cgi-bin/luci/;stok=";
  $.su.url.ozkersubs = "/cgi-bin/ozker/;stok=";
  ```
- **关键词:** $.su.url.subs, $.su.url.ozkersubs, $.su.url.stok, /cgi-bin/luci/, /cgi-bin/ozker/
- **备注:** 需结合固件其他组件（如CGI二进制）分析这些接口的实际安全性。后续应检查：1) stok的生成验证逻辑 2) /cgi-bin/luci和/cgi-bin/ozker的执行文件

---
### command_execution-dropbear-privileged-ops

- **文件路径:** `etc/init.d/dropbear`
- **位置:** `etc/init.d/dropbear (函数: keygen, killclients)`
- **类型:** command_execution
- **综合优先级分数:** **5.75**
- **风险等级:** 5.0
- **置信度:** 9.5
- **触发可能性:** 2.0
- **查询相关性:** 6.0
- **阶段:** N/A
- **描述:** 特权操作执行风险：a) keygen函数调用/usr/bin/dropbearkey生成密钥并移动至/etc/dropbear（需root） b) killclients函数直接执行kill -KILL c) 通过service_start以root启动守护进程。触发条件：服务初始化或手动执行命令。安全影响：攻击者获得root权限后可：a) 植入恶意密钥实现持久化 b) 滥用killclients终止关键进程。利用需root权限，非初始攻击入口点。
- **关键词:** keygen, /usr/bin/dropbearkey, killclients, service_start, SERVICE_PID_FILE

---
### network_input-www_index_redirect_login_exposure

- **文件路径:** `www/index.html`
- **位置:** `www/index.html:未知行`
- **类型:** network_input
- **综合优先级分数:** **5.75**
- **风险等级:** 1.5
- **置信度:** 10.0
- **触发可能性:** 10.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 文件使用<meta http-equiv='refresh'>实现0秒重定向到'/webpages/login.html'。该重定向暴露了认证入口点路径，可能被攻击者用于定位登录界面发起凭证攻击（如暴力破解）。触发条件：用户访问web根目录时自动跳转。无边界检查问题，但路径暴露增加了系统攻击面。
- **代码片段:**
  ```
  未提供具体代码片段
  ```
- **关键词:** /webpages/login.html, meta http-equiv, refresh
- **备注:** 需检查/webpages/login.html是否存在漏洞（如SQL注入、弱密码策略）。重定向路径为固件特有目录结构，可能关联其他web组件。

---
### jquery-secureEvalJSON-filter-bypass

- **文件路径:** `www/webpages/js/libs/jquery.json-2.4.min.js`
- **位置:** `jquery.json-2.4.min.js: $.secureEvalJSON函数`
- **类型:** network_input
- **综合优先级分数:** **5.7**
- **风险等级:** 6.0
- **置信度:** 8.0
- **触发可能性:** 1.5
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** $.secureEvalJSON过滤机制存在设计缺陷：通过正则替换(/\\["\\/bfnrtu]/g)和结构检查(/^[\],:{}\s]*$/)试图净化输入，但可能被Unicode编码(如\u0028)或JSFuck技术绕过。触发条件：1) 调用者使用此函数而非$.evalJSON 2) 输入精心构造绕过过滤。实际影响受限于环境原生JSON支持率，但若满足触发条件可导致任意代码执行。
- **代码片段:**
  ```
  var filtered=str.replace(/\\["\\\/bfnrtu]/g,'@').replace(...);
  if(/^[\],:{}\s]*$/.test(filtered)){return eval('('+str+')');}
  ```
- **关键词:** $.secureEvalJSON, filtered, replace, test, /^[\],:{}\s]*$/
- **备注:** 历史绕过案例：注入`]{}};alert(1);//`可突破正则检查。待测试POC验证实际固件环境

---
### network_input-login-session_leak

- **文件路径:** `www/webpages/data/login.json`
- **位置:** `login.json`
- **类型:** network_input
- **综合优先级分数:** **5.65**
- **风险等级:** 5.5
- **置信度:** 7.0
- **触发可能性:** 4.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 会话信息泄露：logined_ip/logined_mac等敏感字段与enable_rec=true配置组合可能暴露用户隐私。触发条件：访问会话历史接口。边界检查缺失：未对敏感字段脱敏。安全影响：用户地理定位泄露/会话劫持。利用方式：窃取MAC/IP进行中间人攻击
- **代码片段:**
  ```
  "logined_remote": "",
  "enable_rec": true
  ```
- **关键词:** logined_remote, logined_ip, logined_mac, enable_rec
- **备注:** 需确认日志存储路径和访问权限控制

---
### vulnerability-ubus-ubus_lookup_id_unchecked_param

- **文件路径:** `bin/ubus`
- **位置:** `/usr/sbin/ubus:0x8ed0`
- **类型:** ipc
- **综合优先级分数:** **5.6**
- **风险等级:** 7.0
- **置信度:** 5.0
- **触发可能性:** 3.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** ubus_lookup_id参数未验证漏洞：在0x8ed0处直接使用r4[0]作为ubus_lookup_id的name参数，无长度检查。触发条件：1) 攻击者控制r4[0]内存内容 2) 函数第二个参数≠3。潜在影响：缓冲区溢出可能导致RCE（CVSS 9.0）。约束条件：未验证数据来源是否外部可控，无法确认实际攻击路径。
- **代码片段:**
  ```
  ldr r1, [r4]
  add r2, var_14h
  bl sym.imp.ubus_lookup_id
  ```
- **关键词:** ubus_lookup_id, r4[0], sym.imp.ubus_lookup_id
- **备注:** 需动态验证：1) r4[0]是否通过ubus API接收外部数据 2) 漏洞函数调用可达性

---
### vulnerability-ubus-blobmsg_add_json_unchecked

- **文件路径:** `bin/ubus`
- **位置:** `/usr/sbin/ubus:0x8f28`
- **类型:** ipc
- **综合优先级分数:** **5.6**
- **风险等级:** 7.0
- **置信度:** 5.0
- **触发可能性:** 3.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** JSON解析未验证漏洞：在0x8f28处直接传递r4[8]给blobmsg_add_json_from_string，无语法/大小检查。触发条件：1) 控制r4[8]内容 2) 函数第二个参数=3。潜在影响：畸形JSON可能导致堆溢出（CVSS 9.5）。约束条件：数据来源不可追溯，libblobmsg_json版本未知。
- **代码片段:**
  ```
  add r0, r7, 0x44
  ldr r1, [r4, 8]
  bl sym.imp.blobmsg_add_json_from_string
  ```
- **关键词:** blobmsg_add_json_from_string, r4[8], sym.imp.blobmsg_add_json_from_string
- **备注:** 后续方向：1) 分析/lib/libblobmsg_json.so 2) 监控luci-ubus通信数据流

---
### command_execution-ipcalc.sh-input_validation_chain

- **文件路径:** `bin/ipcalc.sh`
- **位置:** `ipcalc.sh:整个Awk脚本段`
- **类型:** command_execution
- **综合优先级分数:** **5.6**
- **风险等级:** 3.0
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** ipcalc.sh存在输入验证缺陷：1) 未验证IP地址各段数值范围(0-255) 2) 未验证CIDR后缀范围(0-32) 3) 未过滤非数字字符。触发条件：攻击者通过脚本调用者(如web接口或shell脚本)传入畸形参数(如'192.168.1.300/33')。实际影响：a) 整数溢出导致掩码计算错误(compl/rshift操作) b) 输出错误网络配置 c) 若下游组件(如网络配置脚本)依赖此输出且未二次验证，可能引发配置错误或服务中断。利用需满足：攻击者能控制输入参数且输出被用于敏感操作。
- **代码片段:**
  ```
  slpos=index(ARGV[1],"/");
  if (slpos == 0) {...} else {
    netmask=compl(2**(32-int(substr(ARGV[1],slpos+1))-1)
  }
  ```
- **关键词:** ARGV[1], substr(ARGV[1],slpos+1), ip2int, compl, rshift, int2ip, start, end
- **备注:** 需后续分析：1) 固件中调用ipcalc.sh的组件(如www目录下的CGI脚本) 2) 网络配置流程是否使用该脚本输出 3) 验证畸形输出是否可导致命令注入或配置覆盖。关联发现：command_execution-ipcalc.sh-ARGV1_validation, command_execution-ipcalc.sh-IP_injection, command_execution-ipcalc.sh-netmask_validation

---
### configuration_load-usb_ftp-missing_config

- **文件路径:** `www/webpages/data/usb.ftp.json`
- **位置:** `www/webpages/data/usb.ftp.json:0 (config_load)`
- **类型:** configuration_load
- **综合优先级分数:** **5.55**
- **风险等级:** 3.0
- **置信度:** 9.5
- **触发可能性:** 6.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 目标配置文件 'www/webpages/data/usb.ftp.json' 不存在于固件中。当系统尝试加载该配置时可能导致：1) USB/FTP服务启动失败（触发条件：服务初始化过程）2) 可能回退到编译时硬编码的默认配置（潜在风险：若默认配置存在安全缺陷如匿名访问权限过宽）。实际影响取决于服务是否依赖此配置文件及默认配置安全性。
- **关键词:** usb.ftp.json, www/webpages/data
- **备注:** 后续验证方向：1) 检查/etc目录下ftpd相关配置 2) 逆向分析USB/FTP服务二进制（如搜索'ftp_server'、'usb_storage'等符号）3) 审查固件web接口是否动态生成该配置

---
### info_leak-firmware_config-status

- **文件路径:** `www/webpages/data/firmware.set.json`
- **位置:** `www/webpages/data/firmware.set.json`
- **类型:** configuration_load
- **综合优先级分数:** **5.54**
- **风险等级:** 2.0
- **置信度:** 9.8
- **触发可能性:** 8.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 该JSON文件是固件升级状态记录文件，包含固件版本、硬件型号和升级进度等只读信息。文件不处理任何外部输入，所有字段均为静态值，无数据验证需求。主要安全影响：1) 暴露精确固件版本(3.13.31)和硬件型号(WDR3600)，攻击者可据此查找已知漏洞 2) 'ops':'upload'状态表明系统当前处于固件升级模式，可能增加攻击面。触发条件：通过web接口访问该文件路径即可读取信息。
- **代码片段:**
  ```
  "firmware_version": "3.13.31 Build 130320 Rel.55761n"
  "hardware_version": "WDR3600 v1 00000000"
  "ops":"upload"
  ```
- **关键词:** firmware_version, hardware_version, ops, totaltime, currenttime, is_default
- **备注:** 建议结合/cgi-bin/下的固件上传处理程序分析：1) 版本信息泄露可能降低漏洞利用难度 2) 检查固件上传功能是否存在未授权访问或签名验证缺陷。关联关键词参考：firmware_upload, /cgi-bin/luci, /admin/firmware

---
### command_execution-emmcblock-dd-write

- **文件路径:** `etc/init.d/commit_sysupgrade`
- **位置:** `commit_sysupgrade:14-27`
- **类型:** command_execution
- **综合优先级分数:** **5.3**
- **风险等级:** 5.0
- **置信度:** 8.0
- **触发可能性:** 2.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** /tmp/bootconfig.bin文件篡改风险。具体表现：脚本通过`cat /proc/boot_info/getbinary > /tmp/${bin}.bin`生成临时文件后，直接用于dd写入块设备。触发条件：1) 攻击者获得root权限 2) 在文件生成后、dd执行前（约毫秒级窗口）替换文件内容。安全影响：成功篡改可写入恶意引导配置，造成设备brick或植入持久化后门。利用概率较低（需精确时序攻击），但可作为攻击链环节与其他漏洞组合使用。
- **代码片段:**
  ```
  cat /proc/boot_info/getbinary > /tmp/${bin}.bin
  ...
  dd if=/tmp/${bin}.bin of=${emmcblock}
  ```
- **关键词:** /tmp/${bin}.bin, /proc/boot_info/getbinary, do_flash_emmc, dd, emmcblock
- **备注:** 缓解建议：1) 添加文件哈希校验 2) 使用内存文件系统替代/tmp

---
### vulnerability_chain-xss_locale_dependency

- **文件路径:** `www/webpages/js/su/locale.js`
- **位置:** `关联文件：www/webpages/js/su/locale.js (XSS点) + 未知locale设置接口`
- **类型:** network_input
- **综合优先级分数:** **5.3**
- **风险等级:** 5.0
- **置信度:** 8.0
- **触发可能性:** 2.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** DOM型XSS漏洞（xss-dom-locale-changeType）利用依赖未发现的后端漏洞：攻击者需先篡改lan.json中的locale值。当前知识库中缺失：1) 修改locale的输入点（如CGI接口）2) lan.json生成机制。完整攻击链暂不可行，需后续验证：a) /cgi-bin/luci是否暴露locale设置功能 b) lan.json写入权限控制。风险评级7.0（需前置条件）降为5.0（当前不可直接利用）。
- **关键词:** locale, lan.json, $.su.locale.changeType, XSS
- **备注:** 后续关键分析方向：1) 全局搜索lan.json生成点 2) 审查/cgi-bin/luci中是否存在set_locale类操作 3) 检查NVRAM变量映射（如nvram_get("locale")）

---
### env_get-firewall_init-lib_hijacking

- **文件路径:** `etc/init.d/firewall`
- **位置:** `etc/init.d/firewall: FW_LIBDIR declaration`
- **类型:** env_get
- **综合优先级分数:** **5.3**
- **风险等级:** 5.0
- **置信度:** 7.0
- **触发可能性:** 3.5
- **查询相关性:** 7.5
- **阶段:** N/A
- **描述:** 脚本通过'. $FW_LIBDIR/core.sh'动态加载库。若攻击者篡改FW_LIBDIR（如设为/tmp），可加载恶意core.sh实现权限提升。漏洞条件：1) 其他组件可控制FW_LIBDIR；2) 路径未验证。固件默认硬编码/lib/firewall，实际风险取决于变量控制链。
- **关键词:** FW_LIBDIR, core.sh, lib/firewall
- **备注:** 需检查所有修改FW_LIBDIR的组件

---
### race_condition-uci-global_context_access

- **文件路径:** `sbin/uci`
- **位置:** `sbin/uci:0x9c1c`
- **类型:** ipc
- **综合优先级分数:** **5.05**
- **风险等级:** 5.5
- **置信度:** 5.0
- **触发可能性:** 4.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 全局上下文指针(0x9c1c)在多个函数中无保护访问，可能引发竞争条件。触发条件：多进程并发执行uci命令时修改共享状态。实际影响取决于固件并发模型，可能造成内存破坏或数据不一致。
- **关键词:** 0x9c1c, global context
- **备注:** 需验证：1) 固件中是否存在并发调用场景 2) 检查互斥锁实现。关联知识库笔记：'race_condition-pptpd-setup_config_tocotu'

---
### algorithm_flaw-integer_overflow_boundary

- **文件路径:** `www/webpages/js/libs/md5.js`
- **位置:** `md5.js (函数: shl1)`
- **类型:** algorithm_implementation
- **综合优先级分数:** **4.95**
- **风险等级:** 4.0
- **置信度:** 8.5
- **触发可能性:** 2.0
- **查询相关性:** 6.0
- **阶段:** N/A
- **描述:** 整数溢出边界检查缺陷：shl1函数中条件判断'a&0x40000000==0x40000000'缺少括号，实际执行顺序为'a & (0x40000000==0x40000000)'，导致边界检查失效。触发条件：当左移运算值达到0x40000000边界时。安全影响：可能导致哈希计算错误，影响系统一致性检查。利用方式：构造特定输入使a=0x40000000触发异常移位，但实际风险较低。
- **代码片段:**
  ```
  if (a&0x40000000==0x40000000) {
    a-=0x40000000;
    a*=2;
    a+=0x80000000;
  }
  ```
- **关键词:** shl1, a&0x40000000==0x40000000, integer, 0x40000000
- **备注:** 实际影响有限，优先级低于字符映射问题

---
### ipc-dropbear-proc-parsing

- **文件路径:** `etc/init.d/dropbear`
- **位置:** `unknown:0 (killclients函数)`
- **类型:** ipc
- **综合优先级分数:** **4.6**
- **风险等级:** 4.0
- **置信度:** 7.0
- **触发可能性:** 2.5
- **查询相关性:** 6.0
- **阶段:** N/A
- **描述:** /proc文件系统解析缺陷：killclients函数通过grep -F匹配/proc/${pid}/stat中的进程路径并空格分割字段。攻击者可能：1) 创建含恶意空格路径的进程规避终止 2) 触发字段解析错误导致服务崩溃。但利用需高权限(控制进程路径)，实际影响有限。
- **关键词:** killclients, /proc/${pid}/stat, grep -F -e "${PROG}", pidof "${NAME}"
- **备注:** 需结合进程管理机制评估实际风险；注意：位置信息需后续补充具体文件路径

---
### configuration_load-system-hostname_timezone_second_order

- **文件路径:** `etc/config/system`
- **位置:** `etc/config/system:2-4`
- **类型:** configuration_load
- **综合优先级分数:** **4.6**
- **风险等级:** 3.0
- **置信度:** 9.0
- **触发可能性:** 2.0
- **查询相关性:** 6.0
- **阶段:** N/A
- **描述:** 系统基础配置节段包含hostname和timezone参数，可通过管理接口修改。虽无直接漏洞，但若其他组件（如日志系统）未正确过滤这些值，可能成为二阶攻击向量。触发条件：存在使用这些参数的未过滤输出点（如Web界面或日志文件）。
- **关键词:** config system, option hostname, option timezone

---
### configuration_load-nat-enable_switch

- **文件路径:** `www/webpages/data/nat.nat.json`
- **位置:** `www/webpages/data/nat.nat.json`
- **类型:** configuration_load
- **综合优先级分数:** **4.4**
- **风险等级:** 1.0
- **置信度:** 9.0
- **触发可能性:** 6.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** NAT功能总开关（enable:off）位于配置文件，单独开启不会暴露服务：1) 必须配合virtualServer.json配置具体端口转发才构成威胁 2) 攻击需分两步：篡改enable为on + 配置恶意转发规则 3) Web接口修改权限未经验证（需结合ACC_REMOTE_URL_NEW端点分析）
- **代码片段:**
  ```
  {"enable":"off"}
  ```
- **关键词:** enable
- **备注:** 关键依赖：1) virtualServer.json的规则配置完整性 2) Web接口修改enable的权限控制（参考已有发现network_input-admin_administration-remote_management）

---
### ipc-netlink-callback_risk

- **文件路径:** `sbin/netifd`
- **位置:** `netifd:0x1883c`
- **类型:** ipc
- **综合优先级分数:** **4.4**
- **风险等级:** 4.0
- **置信度:** 6.0
- **触发可能性:** 3.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** netlink回调指针异常隐患：1) 全局指针*0x18958指向无效地址0x1820c 2) nl_cb_set调用可能传递无效函数指针 3) 若运行时未初始化该指针，可能导致空指针解引用。触发条件：内核发送RTMGRP_LINK组播消息时。安全影响：低概率崩溃，但需验证指针初始化逻辑。
- **关键词:** nl_cb_set, *0x18958, RTMGRP_LINK
- **备注:** 需运行时验证指针值；独立风险点

---
### inconsistency-www-path

- **文件路径:** `www/webpages/url_to_json/url_to_json_szz.txt`
- **位置:** `知识库元分析:0 (全局验证) 0x0`
- **类型:** configuration_load
- **综合优先级分数:** **4.35**
- **风险等级:** 3.0
- **置信度:** 9.5
- **触发可能性:** 0.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 知识库中存在多个'www'路径记录（如'www/cgi-bin/luci'），但实际固件验证确认'www'目录不存在。矛盾表明：1) 现有www相关发现可能基于错误路径假设 2) 需重新评估这些发现的可信度。
- **关键词:** www, path_inconsistency, web_directory
- **备注:** 关键行动项：1) 使用InternalQueryFindings查询所有file_path包含'www/'的发现 2) 验证这些文件是否真实存在 3) 若无实体文件支撑，建议降级相关发现置信度

---
### network_input-firewall-dhcp_renew_rule

- **文件路径:** `etc/config/firewall`
- **位置:** `etc/config/firewall:12-18 (zone), 22-28 (规则)`
- **类型:** network_input
- **综合优先级分数:** **4.35**
- **风险等级:** 1.5
- **置信度:** 10.0
- **触发可能性:** 3.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** WAN区域严格流量控制：默认策略丢弃所有输入流量（option input DROP），仅允许DHCPv4续租请求（Allow-DHCP-Renew规则）。该规则限制：源区域=WAN, 协议=UDP, 目标端口=68, 地址族=IPv4。ICMP规则被注释，进一步减少攻击面。触发条件：攻击者伪造DHCP续租请求包（需同网段访问）。
- **关键词:** config zone, option name wan, option input DROP, config rule, Allow-DHCP-Renew, option dest_port 68, option proto udp
- **备注:** ICMP禁用可能影响网络诊断，但提升安全性

---
### credential_validation-login-shadow_passwd

- **文件路径:** `bin/login.sh`
- **位置:** `login.sh:3-4`
- **类型:** configuration_load
- **综合优先级分数:** **4.2**
- **风险等级:** 2.0
- **置信度:** 10.0
- **触发可能性:** 1.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 密码状态验证的边界检查机制。具体表现：通过grep严格检查/etc/shadow和/etc/passwd中root账户密码字段格式（'^root:[!x]\?:'），当密码未设置或被禁用时阻止登录。触发条件：文件内容不符合预期格式（如密码字段为空白/!/*）。安全影响：有效防止空密码登录，但依赖文件完整性（若攻击者篡改文件可绕过）。边界检查：正则表达式覆盖了Linux密码字段的所有无效状态。
- **代码片段:**
  ```
  ! grep -qs '^root:[!x]\?:' /etc/shadow || \
  ! grep -qs '^root:[!x]\?:' /etc/passwd
  ```
- **关键词:** /etc/shadow, /etc/passwd, grep, authentication
- **备注:** 与FAILSAFE绕过漏洞（env_bypass-login-FAILSAFE）存在防御互补关系：当本机制生效时，FAILSAFE绕过可能成为唯一攻击路径。需检查grep是否可能被PATH劫持。

---
### network_input-js_crypto-exposed_impl

- **文件路径:** `www/webpages/js/libs/encrypt.js`
- **位置:** `encrypt.js:13-1024`
- **类型:** network_input
- **综合优先级分数:** **4.05**
- **风险等级:** 2.0
- **置信度:** 9.5
- **触发可能性:** 1.0
- **查询相关性:** 5.0
- **阶段:** N/A
- **描述:** 加密实现暴露内部算法细节：1) 包含完整的BigInteger实现和蒙哥马利模约减优化 2) 通过bnModPowInt等函数暴露幂运算逻辑。虽无直接漏洞，但增加攻击面分析复杂度。潜在风险：若存在相关数学库漏洞(如时序旁路)可能被利用，但JS环境难以实现精确攻击。
- **关键词:** BigInteger, Montgomery, bnModPowInt, am1, am2, am3, dbits

---
### configuration_load-firewall-redirect_commented

- **文件路径:** `etc/config/firewall`
- **位置:** `etc/config/firewall:87-93,101-107`
- **类型:** configuration_load
- **综合优先级分数:** **4.0**
- **风险等级:** 2.0
- **置信度:** 10.0
- **触发可能性:** 0.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** 端口转发功能未启用但存在配置示例：所有redirect配置（如TCP/UDP端口转发）均被注释。若管理员取消注释且未限制源IP（如option src '*'），可能导致内部服务（如SSH/HTTP）暴露到WAN侧。当前无实际风险，但存在配置失误引入漏洞的可能性。触发条件：管理员手动取消注释配置并重启防火墙服务。
- **关键词:** config redirect, option src, src_dport, dest_ip, dest_port
- **备注:** 需检查/etc/firewall.user是否包含未注释的重定向规则

---
### configuration_load-firewall-restricted_accept

- **文件路径:** `etc/config/firewall`
- **位置:** `etc/config/firewall:22-28 (生效规则), 35-118 (注释示例)`
- **类型:** configuration_load
- **综合优先级分数:** **3.5**
- **风险等级:** 1.0
- **置信度:** 10.0
- **触发可能性:** 0.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 无宽泛ACCEPT规则：生效规则均明确限制协议/端口（如DHCP规则限制UDP/68）。示例中未限制源IP的ACCEPT规则（如option target ACCEPT + option src '*'）均被注释，有效防止未授权访问。触发条件：管理员启用注释的宽松规则模板。
- **关键词:** config rule, option target ACCEPT, option src, option dest_port

---
### configuration_load-system_restore-data_injection_risk

- **文件路径:** `www/webpages/data/system.restore.json`
- **位置:** `www/webpages/data/system.restore.json:0`
- **类型:** configuration_load
- **综合优先级分数:** **3.3**
- **风险等级:** 1.0
- **置信度:** 9.0
- **触发可能性:** 0.5
- **查询相关性:** 7.5
- **阶段:** N/A
- **描述:** 系统恢复配置文件仅存储操作状态标识(success/timeout)和预留的空白data字段。当前版本未包含：1) 硬编码凭证或敏感数据 2) 外部可控配置参数 3) 直接命令执行痕迹。实际风险取决于运行时如何填充data字段——若填充过程未验证外部输入，可能形成注入攻击点。
- **关键词:** system.restore.json, data, success, timeout
- **备注:** 需验证相关恢复功能(如/bin/restore_tool)如何读取此文件：1) 是否动态填充data字段 2) 填充数据来源是否包含网络/NVRAM等外部输入 3) 是否进行输入过滤

---
### configuration_load-system_factory_template

- **文件路径:** `www/webpages/data/system.factory.json`
- **位置:** `www/webpages/data/system.factory.json`
- **类型:** configuration_load
- **综合优先级分数:** **3.3**
- **风险等级:** 0.5
- **置信度:** 9.5
- **触发可能性:** 1.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 文件作为恢复出厂设置的配置模板，但data字段为空且无实际配置值。未发现硬编码凭证、调试开关或安全策略覆盖点。该文件仅在系统执行恢复出厂设置操作时可能被动态填充，但静态状态下：1) 无可被外部直接利用的敏感数据 2) 无参数边界检查问题 3) 无直接攻击入口点。触发实际风险需满足：a) 攻击者能篡改模板文件 b) 系统执行恢复操作时未验证模板完整性
- **关键词:** system.factory.json, data, comments, backup, account.pwd.json
- **备注:** 需追踪备份/恢复功能实现：1) 检查生成实际配置的组件（如account.pwd.json）2) 验证恢复操作时的模板加载机制 3) 分析是否存在模板注入漏洞

---
### configuration_load-system_factory_config-missing

- **文件路径:** `www/webpages/data/system.factory.json`
- **位置:** `N/A`
- **类型:** configuration_load
- **综合优先级分数:** **3.25**
- **风险等级:** 0.5
- **置信度:** 10.0
- **触发可能性:** 0.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 目标文件'www/webpages/data/system.factory.json'不存在。工具返回错误：'cat: www/webpages/data/system.factory.json: No such file or directory'。该路径下无有效配置文件可供分析。实际安全影响：文件缺失本身不构成直接漏洞，但可能反映固件配置异常或路径设计缺陷。
- **代码片段:**
  ```
  N/A
  ```
- **关键词:** www/webpages/data/system.factory.json
- **备注:** 两次独立验证确认文件不存在。建议检查固件其他目录如根目录或www/data/下的类似配置文件。错误路径可能暗示开发遗留问题，但无直接可利用证据。

---
### ipc_tfstats_fixed_parameter

- **文件路径:** `etc/init.d/network`
- **位置:** `network:55`
- **类型:** ipc
- **综合优先级分数:** **3.21**
- **风险等级:** 0.5
- **置信度:** 9.8
- **触发可能性:** 0.1
- **查询相关性:** 6.0
- **阶段:** N/A
- **描述:** 固定参数调用无直接注入风险：stop()函数中执行`ubus call tfstats delete "{'ip':'all'}"`。触发条件：需root权限执行stop操作。验证：1) 参数硬编码 2) 无用户输入拼接 3) 无命令注入特征。实际影响：仅当tfstats服务存在漏洞时可能被利用。
- **代码片段:**
  ```
  ubus call tfstats delete "{'ip': 'all'}"
  ```
- **关键词:** ubus call tfstats delete, ip, all, stop, procd
- **备注:** 需注意：若tfstats服务存在解析漏洞（如缓冲区溢出），仍可能形成利用链

---
### env-internal-definition-safe

- **文件路径:** `etc/init.d/dropbear`
- **位置:** `etc/init.d/dropbear: (环境变量定义)`
- **类型:** env_set
- **综合优先级分数:** **3.2**
- **风险等级:** 1.0
- **置信度:** 9.0
- **触发可能性:** N/A
- **查询相关性:** 6.0
- **阶段:** N/A
- **描述:** 环境变量仅在脚本内部定义：
- $NAME/$PROG等变量硬编码
- 无外部环境变量输入处理
- 约束：所有变量来源均受控
- **关键词:** NAME=dropbear, PROG=/usr/sbin/dropbear, $initscript

---
### script-nat-dispatcher

- **文件路径:** `sbin/nat`
- **位置:** `sbin/nat (脚本文件)`
- **类型:** command_execution
- **综合优先级分数:** **3.12**
- **风险等级:** 0.5
- **置信度:** 9.5
- **触发可能性:** 0.1
- **查询相关性:** 4.0
- **阶段:** N/A
- **描述:** sbin/nat是NAT模块的调度脚本，负责将命令行参数转换为具体模块规则并调用/lib/nat下的实现脚本。未检测到直接处理外部输入（如网络数据、环境变量）的逻辑，也未发现命令执行或格式化字符串漏洞。触发条件仅限于合法命令行调用，无外部可控输入路径。安全影响可忽略，因该脚本仅作为调用中转，实际数据处理在/lib/nat实现文件中。
- **关键词:** nat_check_mod, uci_get_state, nat_${mod}_param_to_rule, nat_${mod}_target, /lib/nat/nat_comm.sh, /lib/nat/nat.sh
- **备注:** 关键后续分析方向：1) /lib/nat/nat_comm.sh 的参数处理逻辑 2) /lib/nat/nat.sh 的规则执行机制 3) uci_get_state 的数据来源验证

---
### static-doc-helpjs-en_US

- **文件路径:** `www/webpages/locale/en_US/help.js`
- **位置:** `www/webpages/locale/en_US/help.js`
- **类型:** file_read
- **综合优先级分数:** **3.04**
- **风险等级:** 0.2
- **置信度:** 9.8
- **触发可能性:** 0.0
- **查询相关性:** 3.5
- **阶段:** N/A
- **描述:** 静态帮助文件包含路由器配置页面的英文说明文本，采用分层结构组织。文件未包含可执行代码、用户输入处理机制或敏感凭据。外部引用仅限于OpenVPN官方文档链接。无边界检查或输入验证机制，因不处理任何外部输入。安全影响：文件本身不构成攻击面，无法被外部输入触发或利用。
- **关键词:** OPEN_VPN_GUIDE, FIRMWARE, OPEN_VPN, PPTP_VPN, $.su.CHAR.HELP
- **备注:** 需检查实际VPN实现代码（非本文件）是否存在漏洞。建议后续分析关注动态脚本文件如'www/cgi-bin/'目录下的可执行组件。

---
### configuration_load-json_missing

- **文件路径:** `www/webpages/url_to_json/nat_url_to_json_ljj.txt`
- **位置:** `www/webpages/url_to_json`
- **类型:** configuration_load
- **综合优先级分数:** **3.0**
- **风险等级:** 0.0
- **置信度:** 10.0
- **触发可能性:** N/A
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 关键配置文件缺失：在www/webpages/url_to_json目录未找到映射的JSON文件（如nat.nat.json）。实际文件列表：nat_url_to_json_ljj.txt, url_to_json_*.txt。导致无法验证：1) 网络参数边界检查 2) iptables规则注入风险 3) NVRAM操作安全性
- **关键词:** www/webpages/url_to_json, nat.nat.json, security.firewall.json
- **备注:** 建议：1) 全局搜索缺失JSON文件 2) 检查固件版本兼容性 3) 分析其他目录（如www/cgi-bin/）

---
### directory-missing-www

- **文件路径:** `www/webpages/url_to_json/url_to_json_szz.txt`
- **位置:** `固件根目录:0 (全局验证) 0x0`
- **类型:** configuration_load
- **综合优先级分数:** **3.0**
- **风险等级:** 0.0
- **置信度:** 10.0
- **触发可能性:** 0.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 无法分析指定文件，因固件中不存在'www'目录结构。多次验证：1) 执行'ls -l www'返回Exit Code 2确认目录缺失 2) 目标文件路径完全不可访问。此情况表明：1) 该固件可能使用非标准web目录命名 2) 用户提供的路径与实际固件结构不匹配。
- **关键词:** www, webpages, url_to_json_szz.txt
- **备注:** 与知识库中现有关键词'www/webpages/data'和'www/webpages/url_to_json'矛盾，建议：1) 重新验证含这些关键词的发现是否有效 2) 使用'find / -type d -name htdocs'定位实际web目录 3) 优先分析/sbin,/etc等高危目录

---
### file_not_found-account_credential_missing

- **文件路径:** `www/webpages/data/account.pwd.json`
- **位置:** `www/webpages/data/account.pwd.json (文件不存在)`
- **类型:** configuration_load
- **综合优先级分数:** **3.0**
- **风险等级:** 0.0
- **置信度:** 10.0
- **触发可能性:** 0.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 目标账户文件不存在分析失败。具体表现：指定路径'www/webpages/data/account.pwd.json'在固件中不存在，其完整目录结构（包括www、webpages、data）均未找到。触发条件为尝试访问该路径时。安全影响：无法通过此路径获取凭证，但可能表明固件使用非标准凭证存储机制。
- **关键词:** account.pwd.json, www/webpages/data, credential_storage
- **备注:** 矛盾点：知识库存在credential_storage-plaintext_account_credentials记录（文件存在且含明文凭证）。可能原因：1) 固件版本差异 2) 动态生成文件未静态包含。后续建议：1. 全局搜索账户文件（find . -name '*account*'）2. 检查标准凭证存储位置 3. 分析登录处理逻辑。关联发现：credential_storage-plaintext_account_credentials

---
### configuration_analysis-firewall-static_config

- **文件路径:** `etc/config/firewall`
- **位置:** `etc/config/firewall`
- **类型:** configuration_analysis
- **综合优先级分数:** **3.0**
- **风险等级:** 0.0
- **置信度:** 10.0
- **触发可能性:** 0.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 静态配置无动态引用：所有参数均为硬编码值（如option dest_port 68），未发现$VAR或${VAR}形式的环境变量/NVRAM引用。排除通过环境变量注入改变防火墙行为的可能性。触发条件：不适用（无可控输入点）。
- **备注:** 自定义脚本路径/etc/firewall.user可能包含动态引用，需单独分析

---
### configuration_load-firewall-init-etc_init.d_firewall

- **文件路径:** `etc/init.d/firewall`
- **位置:** `etc/init.d/firewall:1`
- **类型:** configuration_load
- **综合优先级分数:** **2.94**
- **风险等级:** 0.0
- **置信度:** 9.8
- **触发可能性:** 0.0
- **查询相关性:** 7.5
- **阶段:** N/A
- **描述:** 防火墙初始化脚本作为轻量级代理，通过'fw()'函数加载核心脚本/lib/firewall/core.sh并执行'fw_$1'（如fw_start）。未发现：1) 直接处理外部输入（HTTP/API/NVRAM）的代码；2) 未验证的边界操作；3) 危险命令调用链。实际防火墙逻辑（包括规则加载、输入处理）需在core.sh中分析。
- **代码片段:**
  ```
  fw() {
  	. $FW_LIBDIR/core.sh
  	fw_$1
  }
  ```
- **关键词:** fw(), fw_$1, FW_LIBDIR=/lib/firewall, core.sh, fw_start, fw_stop
- **备注:** 关键后续方向：1) 分析/lib/firewall/core.sh中的fw_*函数实现，追踪规则加载逻辑是否引入外部输入（如NVRAM/环境变量）；2) 检查core.sh是否处理未经验证的网络配置数据

---
### www-js-widget

- **文件路径:** `www/webpages/js/su/widget/widget.js`
- **位置:** `widget.js`
- **类型:** network_input
- **综合优先级分数:** **2.94**
- **风险等级:** 0.0
- **置信度:** 9.8
- **触发可能性:** 0.0
- **查询相关性:** 4.0
- **阶段:** N/A
- **描述:** widget.js作为纯客户端UI组件库，未实现任何HTTP请求处理或敏感接口调用。其核心功能包括：1) 表单组件渲染与事件处理（如点击/键盘事件） 2) UI状态管理（setValue/getValue） 3) 占位验证函数（validate始终返回true）。由于缺乏外部输入点（如URL参数解析）和危险操作（如命令执行），该文件不存在可被攻击者触发的完整利用链。所有数据处理均局限于浏览器DOM操作，无法影响系统状态。
- **关键词:** $.su.Widget, setValue, getValue, validate, setError, form.form("submit")
- **备注:** 后续分析方向：1) 检查调用该组件的HTML文件（如通过form的action属性定位服务端脚本）2) 分析www目录下其他JavaScript文件（特别是处理AJAX请求的脚本）3) 审查CGI二进制文件或Node.js服务端脚本

---
### recommendation-pptpd-start_smbacc_filter

- **文件路径:** `etc/init.d/pptpd`
- **位置:** `etc/init.d/pptpd:72 (start)`
- **类型:** recommendation
- **综合优先级分数:** **2.85**
- **风险等级:** 0.0
- **置信度:** 9.5
- **触发可能性:** 0.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 紧急修复建议：start()函数命令注入漏洞
- 修复方法：对$smbacc实施严格过滤（建议使用shlex.quote或等效机制）
- 验证要点：1) 测试特殊字符';','&','|'的过滤效果 2) 验证重启服务后恶意配置无法执行命令 3) 确保过滤不破坏合法配置格式
- **关键词:** command_execution-pptpd-start_smbacc_injection, smbacc, input_sanitization, pptpd
- **备注:** 关联漏洞：command_execution-pptpd-start_smbacc_injection

---
### recommendation-pptpd-setup_login_printf

- **文件路径:** `etc/init.d/pptpd`
- **位置:** `etc/init.d/pptpd:17-22 (setup_login)`
- **类型:** recommendation
- **综合优先级分数:** **2.85**
- **风险等级:** 0.0
- **置信度:** 9.5
- **触发可能性:** 0.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 凭证注入漏洞修复建议
- 修复方法：使用'printf "%s" > $CHAP_SECRETS'替代echo防止换行符注入
- 验证要点：1) 测试username含'\n'时能否注入多行条目 2) 确保密码中的特殊字符正确转义 3) 验证文件写入原子性
- **关键词:** credential_injection-pptpd-setup_login_chap, CHAP_SECRETS, printf, credential_sanitization
- **备注:** 关联漏洞：credential_injection-pptpd-setup_login_chap

---
### network_input-luci-cgi_delegation

- **文件路径:** `www/cgi-bin/luci`
- **位置:** `www/cgi-bin/luci`
- **类型:** network_input
- **综合优先级分数:** **2.85**
- **风险等级:** 0.0
- **置信度:** 9.5
- **触发可能性:** 0.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** Luci框架CGI入口脚本(www/cgi-bin/luci)作为网络请求委托层，不直接处理HTTP参数但将请求转发至luci.sgi.cgi.run模块。关键特性：1) 未直接读取QUERY_STRING等环境变量 2) 无输入过滤机制 3) 未调用危险函数。虽自身无漏洞，但构成攻击链初始节点，实际攻击面存在于被委托模块。需追踪luci.sgi.cgi模块以分析HTTP参数处理链及潜在污染传播路径。
- **关键词:** luci.sgi.cgi.run
- **备注:** 需扩展分析至/usr/lib/lua/luci/sgi/cgi.lua模块以追踪完整攻击链。当前目录范围限制无法验证数据流污染可能性。

---
### configuration_load-basic_security_wrapper-etc_init.d_basic_security

- **文件路径:** `etc/init.d/basic_security`
- **位置:** `etc/init.d/basic_security: 全部行号`
- **类型:** configuration_load
- **综合优先级分数:** **2.7**
- **风险等级:** 0.0
- **置信度:** 9.0
- **触发可能性:** 0.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** basic_security脚本作为init服务封装器，通过参数调用/lib/basic_security/core.sh中的函数（如fw_start/fw_stop）。关键发现：1) 未直接处理外部输入 2) 攻击路径依赖core.sh实现 3) 与防火墙组件（etc/init.d/firewall）共享'fw_$1'调用范式。若core.sh通过此参数与防火墙交互，可能形成跨组件攻击链（防火墙已确认处理网络输入）。
- **关键词:** fw_$1, ac(), START=46, AC_LIBDIR=/lib/basic_security, core.sh, fw_start, fw_stop, /lib/firewall/core.sh
- **备注:** 关键关联：1) 防火墙core.sh已被确认处理网络输入 2) 需验证/lib/basic_security/core.sh中：a) NVRAM访问(nvram_get/set) b) 环境变量污染路径 c) 通过fw_$1参数与防火墙组件的交互机制

---
### nvram-uci-abstraction-safe

- **文件路径:** `etc/init.d/dropbear`
- **位置:** `etc/init.d/dropbear: (配置操作)`
- **类型:** configuration_load
- **综合优先级分数:** **2.65**
- **风险等级:** 0.5
- **置信度:** 8.0
- **触发可能性:** N/A
- **查询相关性:** 5.0
- **阶段:** N/A
- **描述:** 无直接NVRAM操作：
- 配置通过UCI抽象层管理
- 约束：NVRAM交互被隔离在UCI系统内
- **关键词:** config_load, config_get, config_get_bool
- **备注:** 需在UCI分析阶段验证NVRAM映射

---
### recommendation-pptpd-setup_config_install

- **文件路径:** `etc/init.d/pptpd`
- **位置:** `etc/init.d/pptpd:33-34 (setup_config)`
- **类型:** recommendation
- **综合优先级分数:** **2.55**
- **风险等级:** 0.0
- **置信度:** 8.5
- **触发可能性:** 0.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 竞争条件漏洞修复建议
- 修复方法：采用'install -D /etc/pptpd.conf $CONFIG'替代mkdir+cp组合
- 验证要点：1) 测试符号链接攻击是否被防御 2) 验证目标目录不存在时install的创建行为 3) 检查权限继承是否正确
- **关键词:** race_condition-pptpd-setup_config_tocotu, TOCTOU, atomic_operation, install_command
- **备注:** 关联漏洞：race_condition-pptpd-setup_config_tocotu

---
### recommendation-global_followup_actions

- **文件路径:** `etc/init.d/pptpd`
- **位置:** `global`
- **类型:** recommendation
- **综合优先级分数:** **2.4**
- **风险等级:** 0.0
- **置信度:** 8.0
- **触发可能性:** 0.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 后续分析重点建议
- 关键任务：
  1) 逆向分析/etc/init.d/fw实现，验证命令解析逻辑
  2) 审计所有UCI配置接口的安全控制机制
  3) 检查pptpd配置解析器对换行符的处理
- 预期产出：确认攻击链闭环可行性，发现次级漏洞
- **关键词:** UCI_config_audit, pptpd_parser_analysis, attack_chain_validation
- **备注:** 覆盖所有pptpd相关漏洞的深度验证需求

---
### command_execution-px5g_input_validation

- **文件路径:** `etc/init.d/uhttpd`
- **位置:** `unknown:0 (generate_keys) 0x0`
- **类型:** command_execution
- **综合优先级分数:** **0.0**
- **风险等级:** 0.0
- **置信度:** 0.0
- **触发可能性:** 0.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 动态证书生成输入未验证风险：
- **证据状态**：脚本中generate_keys函数使用未过滤配置项调用px5g，但因无法访问/usr/sbin/px5g文件，未能验证实际安全影响
- **约束缺失**：脚本层未对commonname/country等输入过滤，但二进制层防护未知
- **关键词:** generate_keys, px5g, commonname, country, selfsigned
- **备注:** 需将分析焦点切换到/usr/sbin/px5g以继续验证

---
