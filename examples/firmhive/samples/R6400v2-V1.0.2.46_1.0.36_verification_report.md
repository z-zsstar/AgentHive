# R6400v2-V1.0.2.46_1.0.36 - 综合验证报告

总共验证了 14 条发现。

---

## 高优先级发现 (6 条)

### 待验证的发现: network_input-pppd_PAP_auth-stack_overflow

#### 原始信息
- **文件/目录路径:** `sbin/pppd`
- **位置:** `sbin/pppd: sym.upap_authwithpeer (偏移待定)`
- **描述:** PAP认证栈缓冲区溢出漏洞（CVE待分配）：攻击者通过PPP连接发送超长PAP密码时触发。漏洞位于sym.upap_authwithpeer函数：1) 密码长度(param_3)未经验证 2) 通过memcpy复制到24字节固定栈缓冲区 3) 用户名+密码+分隔符总长超过15字节时覆盖返回地址。pppd以root权限运行，成功利用可导致设备完全控制。
- **代码片段:**\n  ```\n  memcpy(puVar9 + iVar3 + 1, puVar5[3], puVar5[4]); // puVar5[3]=密码指针, puVar5[4]=密码长度\n  ```
- **备注:** 需后续验证：1) 精确溢出偏移 2) ASLR/PIE绕过可行性 3) 关联配置文件/etc/ppp/pap-secrets的输入过滤机制\n
#### 验证结论
- **描述准确性:** `partially`
- **是否为真实漏洞:** `True`
- **是否可直接触发:** `True`
- **详细原因:** 验证发现以下关键点：
1. **漏洞存在性确认**：memcpy操作确实使用未经验证的外部输入长度(param_3)，存在边界检查缺失（证据：ldr r2, [r4, 0x10]直接加载长度参数）
2. **描述不准确处**：
   - 目标缓冲区为全局变量outpacket_buf（地址0x4c36c，大小1504字节）而非24字节栈缓冲区
   - 触发条件应为用户名+密码+分隔符总长>1495字节（1504-9偏移）而非15字节
   - 溢出对象为相邻全局变量而非返回地址（函数无栈缓冲区）
3. **可利用性评估**：
   - 风险仍存在：pppd以root运行，溢出可能破坏关键数据结构（如childwait_done等相邻变量）
   - 直接触发：网络输入可控制密码长度参数直接触发溢出
4. **修正后漏洞**：全局缓冲区溢出风险等级降为7.0（原9.5），因需更大输入且非控制流劫持

#### 验证指标
- **验证耗时:** 1040.02 秒
- **Token用量:** 2145990

---

### 待验证的发现: command_injection-rc-0x0000efd0

#### 原始信息
- **文件/目录路径:** `sbin/rc`
- **位置:** `rc:0x0000efd0`
- **描述:** 高危命令注入漏洞：rc中函数fcn.0000ed80(0x0000efd0)通过system执行全局指针*0xfd88/*0xfd8c指向的命令。触发条件：当nvram_get(*0xfd80)返回空或strcmp(*0xfd84)不匹配时。关键缺陷：命令字符串完全由NVRAM值控制且未经验证，攻击者可通过HTTP接口/NVRAM设置污染输入，实现任意命令执行。
- **代码片段:**\n  ```\n  if ((iVar2 == 0) || (iVar2 = sym.imp.strcmp(iVar2,*0xfd84), iVar2 != 0)) {\n      sym.imp.system(*0xfd88);\n      sym.imp.system(*0xfd8c);\n  }\n  ```
- **备注:** 完整攻击路径：HTTP参数→NVRAM设置接口→rc启动时触发\n
#### 验证结论
- **描述准确性:** `inaccurate`
- **是否为真实漏洞:** `False`
- **是否可直接触发:** `False`
- **详细原因:** 证据显示：1) *0xfd88/*0xfd8c指向硬编码字符串'gpio 10 0'/'gpio 19 1'(.rodata段)，编译时固定不可修改；2) 实际NVRAM检查对象为'emf_enable'等，非描述中的*0xfd80；3) 0xefd0地址未找到描述代码，最近system调用执行的是硬编码命令。攻击者最多能触发预定义GPIO操作，但无法控制命令内容，需NVRAM写入权限且依赖特定服务触发，不构成任意命令执行漏洞。

#### 验证指标
- **验证耗时:** 2029.94 秒
- **Token用量:** 5474770

---

### 待验证的发现: nvram_pollution-rc-0x0000ed80

#### 原始信息
- **文件/目录路径:** `sbin/rc`
- **位置:** `rc:0x0000ed80`
- **描述:** NVRAM污染传播路径：fcn.0000ed80包含21处nvram_get调用（如*0xfd54, *0xfd80等），直接影响：1) 分支条件判断(strcmp) 2) 文件写入内容(*0xff08) 3) 命令执行参数(*0xfd88)。关键约束缺失：所有NVRAM值使用点均无长度检查或内容过滤，形成系统级污染入口。

#### 验证结论
- **描述准确性:** `partially`
- **是否为真实漏洞:** `True`
- **是否可直接触发:** `True`
- **详细原因:** 1) 准确性：实际检测到39处nvram_get调用（报告21处），但三种污染传播类型（分支/文件/命令）验证正确；2) 漏洞真实：存在完整污染链（如nvram_get→system），且18处命令执行点无过滤；3) 直接触发：路径无中断（如地址0x0000f0b0直接执行system命令），攻击者通过污染NVRAM即可触发。实际风险高于报告（含缓冲区溢出）

#### 验证指标
- **验证耗时:** 485.08 秒
- **Token用量:** 910270

---

### 待验证的发现: network_input-ubdcmd-recvmsg

#### 原始信息
- **文件/目录路径:** `sbin/ubdcmd`
- **位置:** `调用点: 0x8e10,0x8ebc,0x8f40,0x9168,0x9a60`
- **描述:** recvmsg缓冲区缺陷：接收网络数据时硬编码长度0x420且未验证实际长度。触发条件：发送≠1056字节的特制UDP包。具体表现：1) 5处调用点固定param_2=0x420 2) 实际接收长度未验证 → 短包控制*0x8e70+0x26等内存 3) 长包触发fcn.00008f04栈溢出。安全影响：内存破坏导致RCE（结合auto命令可形成完整链）。边界检查：仅fcn.00008b98有param_2≤0x420检查，未验证recvmsg实际返回值。
- **代码片段:**\n  ```\n  mov r2, #0x420  ; 硬编码长度\n  bl recvmsg\n  ldr r3, [sp, #0x400] ; 未验证长度直接偏移访问\n  ```
- **备注:** 需验证UDP端口暴露情况；关联fcn.00008b98（manualset整数溢出）\n
#### 验证结论
- **描述准确性:** `accurate`
- **是否为真实漏洞:** `True`
- **是否可直接触发:** `True`
- **详细原因:** 基于二进制分析证据：1) 5处调用点（0x8e10等）均存在'mov r2,0x420'硬编码和recvmsg后无长度验证 2) 存在未验证偏移内存访问（如[sp+0x400]）3) fcn.00008f04栈缓冲区(0x400)小于复制长度(0x420)导致溢出 4) fcn.00008b98边界检查不完整。漏洞触发仅需发送特制UDP包，无需前置条件，构成可直接利用的RCE链。

#### 验证指标
- **验证耗时:** 2649.92 秒
- **Token用量:** 6259246

---

### 待验证的发现: attack_chain-http_to_command

#### 原始信息
- **文件/目录路径:** `sbin/acos_service`
- **位置:** `unknown`
- **描述:** 攻击链可行性验证：确认从HTTP接口到命令注入的完整路径：1) 攻击者设置污染NVRAM(lan_ipaddr) 2) acos_service启动读取污染值 3) 值直接拼接到system()命令 4) 注入命令以root执行。关键触发点位于main()网络初始化段，利用成功率高。
- **备注:** 与发现1形成完整利用链。建议后续分析/cgi-bin/下的Web组件验证NVRAM写入接口\n
#### 验证结论
- **描述准确性:** `partially`
- **是否为真实漏洞:** `True`
- **是否可直接触发:** `False`
- **详细原因:** 1) 准确性评估：发现中lan_ipaddr的引用不存在（Radare2显示0交叉引用），但存在同等危险的pppoe/pptp_gateway注入点（证据：sprintf+system调用链）；2) 漏洞真实性：未过滤的NVRAM值直接拼接到system()命令，且/etc/init.d/S80acos证明以root执行；3) 非直接触发：需通过Web接口污染特定NVRAM变量（非lan_ipaddr），符合攻击链特征。实际风险8.5（需特定污染点），建议修正漏洞描述。

#### 验证指标
- **验证耗时:** 2999.35 秒
- **Token用量:** 6498825

---

### 待验证的发现: cmd_injection-env_nvram_system-fcn1728c

#### 原始信息
- **文件/目录路径:** `sbin/system`
- **位置:** `fcn.0001728c (0x16024, 0x15d5c)`
- **描述:** 高危命令注入链：攻击者通过污染环境变量（如HTTP_USER_AGENT）触发NVRAM污染（fcn.0001728c+0x16024）。污染后的NVRAM值在fcn.0001728c+0x15d5c处未经过滤直接拼接到sprintf格式字符串，最终通过system执行。触发条件：1) 网络配置操作时 2) 污染数据包含命令分隔符。边界检查：无输入过滤机制，仅简单修剪空格。可利用性：高（可注入任意命令）
- **代码片段:**\n  ```\n  iVar7 = sym.imp.getenv(*0x16e84);\n  sym.imp.acosNvramConfig_set(*0x16f00,iVar7);\n  uVar13 = sym.imp.acosNvramConfig_get(...);\n  sym.imp.sprintf(iVar18,*0x15e9c,pcVar10,uVar13);\n  sym.imp.system(iVar18);\n  ```
- **备注:** 完整攻击路径：环境变量污染→NVRAM存储→命令拼接→系统命令执行。建议验证web接口中环境变量设置点。\n
#### 验证结论
- **描述准确性:** `partially`
- **是否为真实漏洞:** `True`
- **是否可直接触发:** `False`
- **详细原因:** 验证确认核心漏洞存在：pppoe_localgateway值在0x15d5c处未经过滤即拼接到system命令（证据：反汇编显示sprintf+system调用）。但原始描述存在三处不准确：1) 污染源实际为subnet环境变量（0x1606c处getenv）而非HTTP_USER_AGENT；2) 偏移地址0x16024对应固定命令（killall zeroconf）而非污染点；3) 污染键(wan_netmask)与注入键(pppoe_localgateway)在sbin/system中无数据流关联。漏洞需满足：a) 控制pppoe_localgateway值（来源未验证） b) 触发网络配置操作。故构成真实漏洞但非直接触发链。

#### 验证指标
- **验证耗时:** 4092.47 秒
- **Token用量:** 7051893

---

## 中优先级发现 (5 条)

### 待验证的发现: network_input-remote-web_exposure

#### 原始信息
- **文件/目录路径:** `etc/init.d/remote.sh`
- **位置:** `etc/init.d/remote.sh:12-19`
- **描述:** 脚本创建符号链接将/opt/remote/plugin/remote/下的文件暴露为Web端点（如/tmp/www/cgi-bin/RMT_invite.cgi）。触发条件：Web服务器配置包含/tmp/www路径时自动启用。外部HTTP请求可直接访问这些端点，未发现输入过滤机制，可能形成从网络输入到CGI执行的完整攻击链。
- **代码片段:**\n  ```\n  ln -s /opt/remote/plugin/remote/RMT_invite.cgi /tmp/www/cgi-bin/RMT_invite.cgi\n  ln -s /opt/remote/plugin/remote/func.sh /tmp/www/cgi-bin/func.sh\n  ```
- **备注:** 实际风险取决于：1) Web服务器是否加载/tmp/www 2) RMT_invite.cgi/func.sh是否存在漏洞\n
#### 验证结论
- **描述准确性:** `partially`
- **是否为真实漏洞:** `False`
- **是否可直接触发:** `False`
- **详细原因:** 1) 准确性评估：符号链接创建命令确实存在（描述部分准确），但源文件/opt/remote/plugin/remote/RMT_invite.cgi在固件中缺失（关键不准确点）
2) 漏洞判断：无法构成真实漏洞，因为：
   - 暴露的CGI文件根本不存在，无法被访问
   - Web服务器使用/tmp/www作为根目录的证据未找到
   - 即使文件存在，其漏洞性也未验证
3) 触发机制：非直接触发，需要同时满足：
   a) 缺失的CGI文件在运行时存在（无证据）
   b) Web服务器配置加载/tmp/www（无证据）
   c) CGI文件存在可利用漏洞（未验证）

#### 验证指标
- **验证耗时:** 780.83 秒
- **Token用量:** 2831687

---

### 待验证的发现: configuration_load-readydropd-external_usb_admin_chain

#### 原始信息
- **文件/目录路径:** `www/cgi-bin/readydropd.conf`
- **位置:** `www/cgi-bin/readydropd.conf`
- **描述:** 配置指定外部USB挂载路径作为home_dir(/tmp/mnt/usb0/part1)，当恶意USB设备接入时，攻击者可通过文件植入或路径遍历影响服务行为。结合httpd_user=admin的高权限，可能形成'外部介质输入→路径遍历→权限提升'攻击链。触发条件：插入恶意USB设备并诱导服务访问特定路径
- **代码片段:**\n  ```\n  home_dir = /tmp/mnt/usb0/part1\n  httpd_user = admin\n  ```
- **备注:** 需验证readydropd主程序对home_dir的处理逻辑（建议分析www/cgi-bin/readydropd二进制文件）\n
#### 验证结论
- **描述准确性:** `partially`
- **是否为真实漏洞:** `False`
- **是否可直接触发:** `False`
- **详细原因:** 验证确认：1) 配置风险存在 - www/cgi-bin/readydropd.conf中确实设置了高风险路径(home_dir=/tmp/mnt/usb0/part1)和高权限用户(httpd_user=admin)；2) 漏洞无法验证 - 未找到处理该配置的readydropd主程序(www/cgi-bin目录不存在该二进制)，且相邻文件genie.cgi未引用此配置；3) 攻击链断裂 - 缺乏程序加载配置和使用路径的证据，无法验证路径遍历和权限提升是否实际发生；4) 触发条件复杂 - 需要物理接入恶意USB设备且依赖未验证的服务行为

#### 验证指标
- **验证耗时:** 1893.53 秒
- **Token用量:** 5189459

---

### 待验证的发现: configuration_load-readydropd-httpd_admin_privilege

#### 原始信息
- **文件/目录路径:** `www/cgi-bin/readydropd.conf`
- **位置:** `www/cgi-bin/readydropd.conf`
- **描述:** httpd_user配置为admin高权限账户但未定义权限边界，若服务存在漏洞（如缓冲区溢出），攻击者可能直接获取admin权限。触发条件：通过网络接口或IPC发送恶意数据触发漏洞
- **代码片段:**\n  ```\n  httpd_user = admin\n  httpd_group = admin\n  ```
- **备注:** 建议检查进程实际权限（通过系统启动脚本验证）\n
#### 验证结论
- **描述准确性:** `partially`
- **是否为真实漏洞:** `False`
- **是否可直接触发:** `False`
- **详细原因:** 配置项存在但未被实际使用：1) httpd二进制未引用readydropd.conf或httpd_user字符串；2) 未检测到权限设置函数(setuid/getpwnam)；3) 启动脚本缺失导致运行时权限无法验证。攻击者无法通过此配置直接获取admin权限，风险仅停留在静态配置层面。

#### 验证指标
- **验证耗时:** 2093.62 秒
- **Token用量:** 5642047

---

### 待验证的发现: command_execution-afpd-send_wol_background

#### 原始信息
- **文件/目录路径:** `etc/init.d/afpd`
- **位置:** `etc/init.d/afpd:14`
- **描述:** 脚本启动send_wol服务（/usr/sbin/send_wol）在后台运行，发送WOL包。触发条件：系统启动或手动执行'/etc/init.d/afpd start'。该服务暴露网络攻击面，攻击者可能发送伪造WOL包或利用其漏洞进行拒绝服务攻击。MAXCONS=7参数直接使用无边界检查，但未实际用于afpd服务。
- **代码片段:**\n  ```\n  /usr/sbin/send_wol 300 &\n  ```
- **备注:** 需单独分析send_wol二进制验证实际风险；关联发现：cmd_injection-nvram_leafp2p_sys_prefix（etc/init.d/leafp2p.sh）。若攻击者通过NVRAM污染实现任意命令执行，可能操控本服务。\n
#### 验证结论
- **描述准确性:** `partially`
- **是否为真实漏洞:** `False`
- **是否可直接触发:** `False`
- **详细原因:** 验证结果：1) afpd脚本确实存在启动send_wol的命令（实际在25行，发现中行号14错误）2) 参数300固定不可控，无直接注入风险 3) MAXCONS定义但未使用，描述准确 4) send_wol程序存在但无法分析其安全特性，导致无法验证关键风险点（网络攻击面/漏洞）5) 关联攻击链依赖外部条件（NVRAM污染），非直接触发。综合认为：启动命令存在但无直接漏洞，send_wol风险无法证实。

#### 验证指标
- **验证耗时:** 278.92 秒
- **Token用量:** 442914

---

### 待验证的发现: nvram_get-ubdcmd-wan_config

#### 原始信息
- **文件/目录路径:** `sbin/ubdcmd`
- **位置:** `ubdcmd:0x91b4`
- **描述:** NVRAM变量处理缺陷：通过acosNvramConfig_get获取的变量(wan_proto/wan_mtu)未经验证直接使用。触发条件：污染NVRAM变量后执行网络配置相关功能。具体表现：1) 字符串直接atoi转换 → 非数字输入导致逻辑错误 2) 转换后整数参与运算 → 超大值引发整数溢出。安全影响：配置篡改/服务崩溃。约束检查：无输入过滤或边界校验。
- **代码片段:**\n  ```\n  bl acosNvramConfig_get(wan_mtu)\n  bl atoi  ; 无长度检查\n  sub r0, r0, #10 ; 直接参与运算\n  ```
- **备注:** 需全局追踪NVRAM污染向量；关联atoi（多链共用转换函数）\n
#### 验证结论
- **描述准确性:** `accurate`
- **是否为真实漏洞:** `True`
- **是否可直接触发:** `True`
- **详细原因:** 验证确认：1) 代码模式存在：偏移0x91b8获取wan_mtu→0x91c0无校验atoi→0x9200直接运算（sub r3, r4, 0x268）；2) 输入源外部可控：通过NVRAM污染可设置wan_mtu；3) 可触发漏洞：执行'ubdcmd set'使污染值进入处理流程；4) 实际影响：非数字输入导致负值逻辑错误（如atoi('abc')=0→0-616=-616），超大值触发条件分支但造成服务异常。虽然条件分支阻止了崩溃，但配置篡改和服务异常仍构成可利用漏洞（CWE-190）。

#### 验证指标
- **验证耗时:** 2427.96 秒
- **Token用量:** 1842477

---

## 低优先级发现 (3 条)

### 待验证的发现: configuration_load-readydropd-log_level_info_leak

#### 原始信息
- **文件/目录路径:** `www/cgi-bin/readydropd.conf`
- **位置:** `www/cgi-bin/readydropd.conf`
- **描述:** 日志级别设置为最高(level=2)，在调试模式下可能记录敏感数据（如用户凭证）。若日志文件权限配置不当（如全局可读），可导致信息泄露。触发条件：攻击者访问日志存储路径
- **代码片段:**\n  ```\n  log_level = 2\n  ```
- **备注:** 需确认日志存储路径（建议检查log_path配置项）\n
#### 验证结论
- **描述准确性:** `partially`
- **是否为真实漏洞:** `False`
- **是否可直接触发:** `False`
- **详细原因:** 1. 配置存在性准确但未实际加载：log_level=2在readydropd.conf中真实存在，但全系统无进程加载该文件（grep验证无引用）。2. 漏洞逻辑断裂：未找到readydropd执行文件和服务脚本，配置无法生效。3. 关联程序行为不符：唯一关联文件genie.cgi使用独立日志路径且不解析该配置。4. 无实际风险：配置未加载时最高日志级别设置不会触发敏感信息记录，攻击链完全中断。

#### 验证指标
- **验证耗时:** 1401.40 秒
- **Token用量:** 3355547

---

### 待验证的发现: tz_env-rc-0x00011094

#### 原始信息
- **文件/目录路径:** `sbin/rc`
- **位置:** `rc:0x00011094`
- **描述:** TZ环境变量分析结论：在rc文件中未发现有效数据流。此前报告的getenv('TZ')调用(fcn.00011094)中：1) 获取的值仅存入栈变量auStack_424 2) 未用于后续危险操作(如execve环境) 3) 无缓冲区溢出风险。排除当前文件利用可能。

#### 验证结论
- **描述准确性:** `accurate`
- **是否为真实漏洞:** `False`
- **是否可直接触发:** `False`
- **详细原因:** 代码证据证实：1) getenv('TZ')返回值仅用于snprintf('TZ=%s')，目标缓冲区1000字节小于栈帧(1044字节)，无溢出风险 2) execve调用使用固定环境数组(var_3ech)，未传递TZ值 3) 无格式化字符串等危险操作。外部控制TZ无法触发代码执行或内存破坏，与发现描述完全一致。

#### 验证指标
- **验证耗时:** 515.45 秒
- **Token用量:** 1880496

---

### 待验证的发现: file_write-afpd-applevolumes_config

#### 原始信息
- **文件/目录路径:** `etc/init.d/afpd`
- **位置:** `etc/init.d/afpd:4-6`
- **描述:** 启动时创建AFP_CONF_DIR=/tmp/netatalk目录并复制AppleVolumes.default配置文件。触发条件：服务启动时自动执行。若攻击者能篡改源文件(/usr/config/netatalk/AppleVolumes.default)或目标路径，可能植入恶意配置。目录创建未验证路径安全性，存在路径遍历风险。
- **备注:** 需验证配置文件内容是否包含用户可控参数\n
#### 验证结论
- **描述准确性:** `partially`
- **是否为真实漏洞:** `True`
- **是否可直接触发:** `True`
- **详细原因:** 验证确认：1) 脚本确实在start()函数（行11-13）创建/tmp/netatalk并复制文件；2) mkdir -p未验证符号链接，cp未用--no-dereference，存在符号链接攻击风险；3) /tmp特性使攻击者可预置指向敏感目录的符号链接（如/etc），导致root权限任意文件覆盖。但需修正：a) 风险类型应为符号链接攻击而非路径遍历；b) 实际漏洞位置在11-13行（非报告中的4-6行）；c) 配置文件篡改需root权限，非主要风险。漏洞可直接触发（服务启动自动执行），利用门槛低。

#### 验证指标
- **验证耗时:** 803.24 秒
- **Token用量:** 1096374

---

