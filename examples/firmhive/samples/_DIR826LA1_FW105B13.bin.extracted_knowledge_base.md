# _DIR826LA1_FW105B13.bin.extracted 高优先级: 52 中优先级: 66 低优先级: 40

## 优先级评分模型

**计算公式:** `PriorityScore = (0.5 * risk_level) + (0.3 * confidence) + (0.2 * trigger_possibility)`

**分层策略:**
- **高优先级:** `PriorityScore >= 8.5`
- **中优先级:** `7.0 <= PriorityScore < 8.5`
- **低优先级:** `PriorityScore < 7.0`

---

## 高优先级发现

### stack_overflow-jcpd-udp_recvfrom

- **文件路径:** `usr/sbin/jcpd`
- **位置:** `usr/sbin/jcpd: (sym.jcpd_run) 0x407ac0`
- **类型:** network_input
- **综合优先级分数:** **10.0**
- **风险等级:** 10.0
- **置信度:** 10.0
- **触发可能性:** 10.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 高危栈溢出漏洞（CVE-2023-XXXX）：在sym.jcpd_run函数中，recvfrom使用40字节栈缓冲区(auStack_78)但允许接收最大510字节数据。当攻击者发送>40字节UDP数据包时，可覆盖栈上关键变量(iStack_38, puStack_34)和返回地址。触发条件：1) 攻击者访问jcpd服务的UDP端口 2) 发送长度>40字节的恶意数据包 3) 无需身份认证。实际安全影响：远程代码执行（RCE），CVSS评分10.0。边界检查完全缺失，无任何长度验证机制。
- **代码片段:**
  ```
  recvfrom(iVar4, auStack_78, 0x1FE, 0, ...); // 缓冲区40B vs 最大接收510B
  ```
- **关键词:** sym.jcpd_run, recvfrom, auStack_78, iStack_38, puStack_34, UDP
- **备注:** 覆盖范围：rsp-0x78到rsp-0x30的栈区域（含返回地址）。建议验证：1) 服务端口号 2) 系统ASLR防护状态

---
### stack_overflow-network_input-jcpd_run

- **文件路径:** `usr/sbin/jcpd`
- **位置:** `usr/sbin/jcpd:0x407ac0 (sym.jcpd_run)`
- **类型:** network_input
- **综合优先级分数:** **9.65**
- **风险等级:** 10.0
- **置信度:** 9.5
- **触发可能性:** 9.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 高危栈溢出漏洞：jcpd_run函数使用40字节栈缓冲区(auStack_78)接收UDP数据，但recvfrom允许最大510字节输入。无任何长度验证或边界检查。攻击者发送>40字节恶意包即可覆盖返回地址实现RCE。触发条件：1) 访问UDP端口19541 2) 发送>40字节构造数据 3) 无需认证。实际影响：单次发包即可完成控制流劫持，形成完整攻击链（UDP输入→缓冲区溢出→RCE）。
- **关键词:** recvfrom, UDP, auStack_78, jcpd_run, stack_overflow, 0x4C55
- **备注:** 端口19541在main函数中绑定（偏移-0x7db4），验证网络输入为初始攻击面

---
### network_input-udhcpd-sendACK-command_injection

- **文件路径:** `sbin/udhcpd`
- **位置:** `udhcpd:0 [sendACK] 0x00405e68`
- **类型:** network_input
- **综合优先级分数:** **9.6**
- **风险等级:** 10.0
- **置信度:** 9.0
- **触发可能性:** 9.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** sendACK函数命令注入漏洞。触发条件：当server_config.script_path配置启用时，攻击者构造恶意DHCP ACK包的hostname选项(0x0c)经snprintf格式化后直接传入system()执行。边界检查完全缺失，未对hostname进行过滤或长度验证。安全影响：远程攻击者可实现root权限任意命令执行，利用链完整(网络输入→解析→系统命令执行)。
- **关键词:** sendACK, system, hostname, option 0x0c, server_config.script_path, snprintf
- **备注:** 需验证DISCOVER/OFFER处理流程是否存在相同漏洞；检查script_path默认配置状态

---
### cmd_injection-TLV8001-update_HWinfo

- **文件路径:** `sbin/bulkagent`
- **位置:** `bulkagent:0x4023d4 update_HWinfo`
- **类型:** network_input
- **综合优先级分数:** **9.55**
- **风险等级:** 9.8
- **置信度:** 9.5
- **触发可能性:** 9.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 高危远程命令注入漏洞（TLV_0x8001）：攻击者发送类型0x8001的TLV网络包，其payload直接作为参数传入'sprintf(auStack_48, "uenv set HW_BOARD_MODEL %s", param_2)'。由于未进行长度检查（固定字符串占25字节，64字节缓冲区仅剩39字节）和内容过滤（未处理;|$等元字符），导致：1) 缓冲区溢出（payload>39字节时）2) 命令注入（payload含分号时可拼接任意命令）。触发条件：单个未认证网络包。实际影响：完全设备控制（风险9.8）
- **代码片段:**
  ```
  sprintf(auStack_48, "uenv set HW_BOARD_MODEL %s", param_2);
  system(auStack_48);
  ```
- **关键词:** TLV_0x8001, sym.update_HWinfo, param_2, sprintf, system, auStack_48, HW_BOARD_MODEL
- **备注:** 完整攻击链：网络输入→sprintf拼接→system执行。需确认固件栈保护状态

---
### network_input-login-raw_password_transmission

- **文件路径:** `www/login.asp`
- **位置:** `login.asp: check()函数`
- **类型:** network_input
- **综合优先级分数:** **9.5**
- **风险等级:** 9.0
- **置信度:** 10.0
- **触发可能性:** 10.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 登录表单在提交时同时传输原始密码(log_pass)和Base64编码密码(password)。攻击者可通过中间人攻击或访问服务器日志直接获取原始密码。触发条件：用户提交登录表单时自动发生。边界检查：无任何加密或混淆保护原始密码字段。安全影响：直接导致凭证泄露，攻击者可完全控制用户账户。
- **代码片段:**
  ```
  var param = {
    url: 'login.ccp',
    arg: 'username='+$('#username').val()+'&password='+$('#password').val()+
         '&log_pass='+$('#log_pass').val()
  };
  ```
- **关键词:** log_pass, password, check(), form1, login.ccp, submit_button_flag
- **备注:** 需后续分析login.ccp文件：1) 验证是否记录请求参数 2) 检查密码验证逻辑是否直接使用log_pass

---
### command_injection-upgrade_firmware-0x401648

- **文件路径:** `bin/bulkUpgrade`
- **位置:** `bin/bulkUpgrade:upgrade_firmware@0x401648`
- **类型:** command_execution
- **综合优先级分数:** **9.39**
- **风险等级:** 9.5
- **置信度:** 9.8
- **触发可能性:** 8.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 命令注入漏洞：攻击者通过控制命令行参数（如'-f'）注入恶意命令。触发条件：1) 程序以'-f [value]'形式调用；2) [value]包含命令分隔符（如';'）。程序使用sprintf直接拼接'system("fwUpgrade %s")'，未对输入进行过滤或转义，导致攻击者可执行任意系统命令。
- **关键词:** upgrade_firmware, system, sprintf, fwUpgrade, param_1, -f
- **备注:** 利用链：用户输入→命令行参数解析→sprintf命令拼接→system执行。需验证web接口是否暴露此调用。

---
### vul_chain-jcpd_udp_rce

- **文件路径:** `usr/sbin/jcpd`
- **位置:** `usr/sbin/jcpd: (sym.jcpd_run) 0x407ac0`
- **类型:** network_input
- **综合优先级分数:** **9.35**
- **风险等级:** 9.5
- **置信度:** 9.0
- **触发可能性:** 9.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 完整攻击路径评估：1) 初始输入点：jcpd服务的UDP网络接口 2) 传播路径：恶意数据→recvfrom存入栈缓冲区→未验证长度直接使用 3) 危险操作：栈溢出导致控制流劫持。触发步骤：单次UDP数据包发送。成功概率：高（无需认证，标准网络访问即可触发）。
- **关键词:** jcpd, UDP, recvfrom, stack_overflow

---
### unauth_reboot-UDP8004

- **文件路径:** `sbin/bulkagent`
- **位置:** `bulkagent:0x00402178 (main)`
- **类型:** network_input
- **综合优先级分数:** **9.35**
- **风险等级:** 9.0
- **置信度:** 9.5
- **触发可能性:** 10.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 未授权重启漏洞（UDP 0x8004）：向UDP 56831端口发送单字节类型0x8004的包，设置全局标志g_reboot_flag=1，触发system('reboot')。边界检查缺失：未验证包长度/来源。触发条件：单个伪造UDP包。实际影响：拒绝服务（设备强制重启），利用概率10.0
- **关键词:** g_reboot_flag, 0x8004, UDP 56831, 0x0040209c, reboot
- **备注:** 完整攻击链：网络输入→标志污染→危险操作

---
### command_injection-fwUpgrade-0x374

- **文件路径:** `bin/fwUpgrade`
- **位置:** `fwUpgrade:0x374 fcn.00400374`
- **类型:** command_execution
- **综合优先级分数:** **9.3**
- **风险等级:** 9.8
- **置信度:** 9.0
- **触发可能性:** 8.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 高危命令注入漏洞。具体表现：升级函数（fcn.00400374）将用户输入路径（param_1）直接拼接到system命令中（格式：/bin/mtd_write write <用户输入> Kernel_RootFS）。触发条件：攻击者在路径参数中插入命令分隔符（如'; rm -rf /'）。安全影响：1) 无路径规范化处理 2) 无签名验证机制 3) 可导致任意命令执行 4) 结合777文件权限形成完整攻击面。
- **代码片段:**
  ```
  (**(iVar1 + -0x7f34))(auStack_108,*(iVar1 + -0x7fe0) + 0x70f0,*auStackX_0);
  ```
- **关键词:** fcn.00400374, param_1, system, mtd_write, Kernel_RootFS, fwUpgrade
- **备注:** 攻击路径：通过bulkUpgrade程序（bin/bulkUpgrade）的命令注入漏洞传递恶意参数触发

---
### cmd_execution-firmware_erase-main

- **文件路径:** `sbin/bulkagent`
- **位置:** `bulkagent:0x401f58 (main)`
- **类型:** command_execution
- **综合优先级分数:** **9.3**
- **风险等级:** 10.0
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 固件破坏漏洞（服务终止逻辑）：当主循环退出时（如网络连接中断），无条件执行'mtd_write erase /dev/mtd4'。触发条件：攻击者发送TCP RST包或耗尽服务资源。实际影响：关键分区擦除导致设备永久损坏（bricking）。风险10.0因：1) 无恢复机制 2) 触发可靠 3) 无需认证
- **关键词:** main, system, mtd_write erase /dev/mtd4, /dev/mtd4, 0x401f58
- **备注:** 需确认/dev/mtd4分区功能（可能含引导加载程序）

---
### network_input-nttrans_cmd_inject-28f10

- **文件路径:** `sbin/smbd`
- **位置:** `smbd:0x28f10 sym.handle_nttrans`
- **类型:** network_input
- **综合优先级分数:** **9.25**
- **风险等级:** 9.5
- **置信度:** 9.0
- **触发可能性:** 9.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 在handle_nttrans函数中，client_param输入经不充分过滤（仅检测;和|）后拼接进system()命令。攻击者可通过$()或反引号注入任意命令（如`client_param=127.0.0.1 & touch /tmp/pwn`）。触发条件：发送包含恶意client_param的NT事务请求。
- **代码片段:**
  ```
  snprintf(command, ... , client_param);
  system(command);
  ```
- **关键词:** get_client_param, client_param, system, snprintf, handle_nttrans
- **备注:** 需通过CVE数据库验证是否为已知漏洞；建议检查lib/system.c中的过滤函数实现

---
### heap_overflow-dnsmasq-dns_response_0x407798

- **文件路径:** `sbin/dnsmasq`
- **位置:** `dnsmasq:0 (sym.answer_request) 0x407798`
- **类型:** network_input
- **综合优先级分数:** **9.2**
- **风险等级:** 9.8
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** DNS响应't'类型资源记录处理存在strcpy堆溢出漏洞：当sym.cache_get_name返回未经验证的外部输入时，直接使用strcpy复制到固定缓冲区。触发条件：攻击者发送包含长域名（>255字节）的恶意DNS响应报文，无边界检查导致堆破坏。可远程代码执行（需绕过ASLR/NX），利用概率高（80%）。
- **关键词:** sym.answer_request, sym.cache_get_name, strcpy, t, DNS响应
- **备注:** 对应CVE-2017-13704漏洞模式，攻击面为53/UDP端口

---
### network_input-firmw_upload-vulchain

- **文件路径:** `www/tools_time.asp`
- **位置:** `www/tools_firmw.asp:0 (unknown)`
- **类型:** network_input
- **综合优先级分数:** **9.15**
- **风险等级:** 9.5
- **置信度:** 9.0
- **触发可能性:** 8.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 高危文件上传漏洞链（风险等级9.5）：攻击者可通过www/tools_firmw.asp上传任意恶意文件（触发条件：构造POST请求至fwupgrade.ccp/CCP_SUB_UPLOADFW）。前端仅验证非空值，无扩展名/内容/签名检查（约束条件缺失）。实际风险取决于后端处理：若存在解压命令执行（如tar -zxf）或固件刷写（mtd write），可导致RCE。
- **关键词:** fwupgrade.ccp, CCP_SUB_UPLOADFW, file, send_request, tools_firmw.asp
- **备注:** 需逆向分析sbin目录的CGI二进制（如grep -r 'CCP_SUB_UPLOADFW' ../sbin）。注意关联已有关键词：CCP_SUB_UPLOADFW/fwupgrade.ccp/file/send_request

---
### command-injection-eth.sh-SetMac

- **文件路径:** `sbin/eth.sh`
- **位置:** `eth.sh: (SetMac函数)`
- **类型:** command_execution
- **综合优先级分数:** **9.15**
- **风险等级:** 9.5
- **置信度:** 9.0
- **触发可能性:** 8.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 高危命令注入漏洞：用户控制的$2参数（MAC/SN值）通过`echo $2 | awk`结构嵌入反引号命令执行环境。攻击者注入Shell元字符（如`;id`）可执行任意命令。触发条件：1) 攻击者控制SetMac函数$2参数（如通过Web接口配置MAC地址）2) 参数包含有效命令分隔符。边界检查完全缺失，flash命令直接执行污染数据。高危利用链：污染输入→命令注入→root权限获取。
- **代码片段:**
  ```
  flash -w 0x40028 -o \`echo $2 | awk '{ print substr($0,0,2)}'\`
  ```
- **关键词:** SetMac, $2, awk, substr, flash -w, echo
- **备注:** 漏洞利用需定位调用入口（如Web接口）。与发现ID:input-truncation-eth.sh-SetMac共享数据流[$2→flash -w]。建议：1) 替换反引号为$()结构 2) 使用printf '%s' "$2"过滤输入

---
### command_execution-sxstorage_mount-stack_overflow

- **文件路径:** `usr/sbin/sxstoragemanager`
- **位置:** `sxstoragemanager:0x4046e0`
- **类型:** command_execution
- **综合优先级分数:** **9.15**
- **风险等级:** 9.5
- **置信度:** 9.0
- **触发可能性:** 8.5
- **查询相关性:** 9.8
- **阶段:** N/A
- **描述:** sxstorage_mount函数存在栈缓冲区溢出漏洞。具体表现：strncpy将外部输入的设备名(param_1)复制到124字节栈缓冲区(auStack_114)，固定复制长度0x7c(124字节)未预留空字节终止符位置。触发条件：攻击者通过`sxmount mount`命令传入≥124字节设备名。利用方式：精心构造溢出数据覆盖返回地址实现任意代码执行。约束条件：需通过sxmount_main传递argv参数。
- **代码片段:**
  ```
  strncpy(auStack_114, param_1, 0x7c);
  ```
- **关键词:** sxstorage_mount, param_1, auStack_114, strncpy, sxmount_main, argv
- **备注:** 污染源：命令行参数argv[2]。关联命令：sxmount。验证建议：动态测试超长设备名输入。

---
### attack_chain-firmware_upload_to_rce

- **文件路径:** `sbin/mini_httpd`
- **位置:** `multiple_components`
- **类型:** attack_chain
- **综合优先级分数:** **9.15**
- **风险等级:** 10.0
- **置信度:** 8.5
- **触发可能性:** 8.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 完整攻击链：攻击者通过HTTP API上传恶意文件（利用路径遍历漏洞）→ 覆盖系统文件触发固件升级流程 → 通过命令注入漏洞执行fw_upgrade → 解压恶意压缩包实现二次文件写入 → 污染启动脚本 → 设备重启后实现持久化RCE。关键环节：1) 文件上传漏洞提供初始写入能力 2) fw_upgrade漏洞实现文件系统穿透 3) mydlink-watch-dog漏洞提供最终命令执行。触发条件：无需物理访问，纯网络攻击可实现完全设备控制。
- **关键词:** api_name=UploadFile, fw_upgrade, command_injection-upgrade_firmware-0x401648, mydlink-watch-dog.sh, tar, reboot, network_input
- **备注:** 依赖条件验证：1) /mydlink/目录权限需允许web用户写入 2) fw_upgrade的调用机制需暴露给网络 3) 设备重启周期需在攻击窗口内。关联漏洞：path_traversal-file_upload-http_api + file_write-fw_upgrade-path_traversal + command_injection-upgrade_firmware-0x401648 + command_execution-mydlink_watch_dog-param_injection

---
### rce-dhcp6c-sip_servers_env_injection

- **文件路径:** `bin/dhcp6c`
- **位置:** `dhcp6c:0x41c5ec (sip_processing)`
- **类型:** network_input
- **综合优先级分数:** **9.15**
- **风险等级:** 9.5
- **置信度:** 9.0
- **触发可能性:** 8.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 高危远程命令执行漏洞链：通过DHCPv6响应控制SIP服务器地址(new_sip_servers)实现任意命令注入。触发条件：1) 攻击者发送恶意DHCPv6响应；2) 设备运行dhcp6c客户端。触发步骤：a) 伪造SIP服务器地址含命令分隔符(如`;reboot`) b) 地址经duid_to_str转换后拼接到环境变量 c) execve执行/etc/dhcp6c_script时污染环境变量触发命令执行。边界检查：完全缺失字符串过滤和长度验证。安全影响：直接获得设备控制权（需脚本执行权限），利用概率高。
- **代码片段:**
  ```
  uVar2 = duid_to_str(piVar9+3,0);
  sprintf(buffer,"new_sip_servers=%s",uVar2);
  execve(script_path,args,piStack_2c);
  ```
- **关键词:** sym.client6_script, new_sip_servers, duid_to_str, execve, /etc/dhcp6c_script, sprintf, param_4
- **备注:** 关联CVE-2023-24615；与第四个发现共享new_sip_servers处理点

---
### stack_overflow-dnsmasq-handle_dns_0x0040a5d8

- **文件路径:** `sbin/dnsmasq`
- **位置:** `dnsmasq:0 (handle_dns) 0x0040a5d8`
- **类型:** network_input
- **综合优先级分数:** **9.14**
- **风险等级:** 9.0
- **置信度:** 9.8
- **触发可能性:** 8.5
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** handle_dns函数存在DNS查询名缓冲区溢出：直接memcpy外部输入的dns->name到固定缓冲区，仅依赖MAXDNAME常量但无运行时校验。触发条件：发送>255字节的查询名，导致栈溢出。可被远程利用实现代码执行（需绕过内存防护）。
- **代码片段:**
  ```
  memcpy(name, dns->name, strlen(dns->name));
  ```
- **关键词:** dns->name, memcpy, NAME_MAX, handle_dns, MAXDNAME
- **备注:** 对应CVE-2020-25681漏洞模式

---
### command_execution-mii_mgr-ioctl_control

- **文件路径:** `bin/mii_mgr`
- **位置:** `mii_mgr:0x4009c0 (参数存储), 0x4009f4 (寄存器加载), 0x400bf0 (系统调用)`
- **类型:** command_execution
- **综合优先级分数:** **9.1**
- **风险等级:** 9.0
- **置信度:** 9.0
- **触发可能性:** 9.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 攻击者可通过命令行参数完全控制ioctl(SIOCSMIIREG)的请求类型参数（s3寄存器值）。具体触发条件：执行'mii_mgr'时恶意构造第二个参数值（argv[2]），该值经strtol转换后直接存储到sp+0x20栈位置，随后加载到s3寄存器并作为a1参数传递给ioctl调用（0x400bf0）。全程无任何边界检查或过滤机制。成功利用概率取决于：1) 内核驱动对SIOCSMIIREG请求的处理逻辑 2) 攻击者能否构造触发内核内存破坏的值。实际安全影响可能包括内核任意代码执行或权限提升。
- **代码片段:**
  ```
  0x4009c0: sw v0, 0x20(sp)  ; 用户输入存储
  0x4009f4: move a1, s3     ; 参数加载到ioctl参数寄存器
  0x400bf0: jalr v0         ; ioctl(SIOCSMIIREG)调用
  ```
- **关键词:** argv[2], sp+0x20, s3, a1, SIOCSMIIREG, ioctl, 0x4009c0, 0x4009f4, 0x400bf0
- **备注:** 需后续分析：1) 内核驱动对SIOCSMIIREG请求的处理逻辑 2) s3参数在内核态的具体用途 3) 是否存在其他受控参数。关键关联文件：内核网络驱动模块（可能位于/lib/modules）。关联发现：与bin/uenv共享argv[2]控制点，但本漏洞可直接触发内核级危险操作。

---
### attack_chain-file_write_to_rce

- **文件路径:** `sbin/fw_upgrade`
- **位置:** `fw_upgrade:3-4 & mydlink-watch-dog.sh:10-15`
- **类型:** attack_chain
- **综合优先级分数:** **9.1**
- **风险等级:** 9.5
- **置信度:** 8.5
- **触发可能性:** 9.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 完整的远程攻击链：1) 攻击者通过web接口（如固件升级功能）控制fw_upgrade脚本的$1参数 2) 构造含恶意脚本的tar包路径（如'../../../mydlink/evil.sh'）触发路径遍历 3) 恶意脚本被写入系统目录 4) 系统重启激活脚本或由mydlink-watch-dog.sh自动执行。关键节点：不可信输入($1)→文件写入(fw_upgrade)→持久化(reboot)→命令执行(mydlink-watch-dog)。触发条件：控制$1参数 + /mydlink/目录可写 + 重启/监控机制激活。成功利用概率：高（需验证web接口参数传递机制）。
- **关键词:** $1, /mydlink/, reboot, mydlink-watch-dog.sh, attack_chain
- **备注:** 关联发现：file_write-fw_upgrade-path_traversal + command_execution-mydlink_watch_dog-param_injection。待验证：1) web接口如何传递$1参数 2) /mydlink/目录权限 3) 恶意脚本执行上下文权限

---
### heap_overflow-dhcp_offer_processing-add_option_string

- **文件路径:** `sbin/udhcpc`
- **位置:** `udhcpc:0x004055bc sym.add_option_string`
- **类型:** network_input
- **综合优先级分数:** **9.09**
- **风险等级:** 9.5
- **置信度:** 8.8
- **触发可能性:** 8.5
- **查询相关性:** 9.8
- **阶段:** N/A
- **描述:** 高危堆栈缓冲区溢出漏洞（CWE-787）。具体表现：1) sym.add_simple_option 发生类型混淆，将字符变量地址作为结构体指针传递；2) sym.add_option_string 中的边界检查 'iVar1 + *(param_2+1)+3 < 0x240' 存在整数溢出风险；3) memcpy 使用攻击者可控长度 *(param_2+1)+2 执行复制。触发条件：构造恶意 DHCP OFFER 包，使 formatter 函数在 auStack_66[2..5] 写入负值（如 0xFFFFFFFF）。利用方式：负长度值绕过检查 → memcpy 越界写入全局缓冲区 → 控制程序执行流。
- **代码片段:**
  ```
  0x0040560c  slti v0, v0, 0x240
  0x00405620  jalr t9
  0x00405604  addiu a2, v0, 2
  ```
- **关键词:** sym.add_option_string, sym.add_simple_option, param_2, param_3, auStack_66, 0x240, formatter, memcpy, *(param_2+1)
- **备注:** 漏洞链：DHCP OFFER → recvfrom → add_simple_option → add_option_string → 越界写入。需验证全局缓冲区布局和formatter实现；关联知识库现有param_2数据流

---
### stack_overflow-ncc_socket_recv-main

- **文件路径:** `sbin/mdb`
- **位置:** `sbin/mdb:0x400df8`
- **类型:** network_input
- **综合优先级分数:** **9.05**
- **风险等级:** 9.5
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 确认高危远程代码执行攻击路径：攻击者通过命令行参数控制mdb连接恶意服务器（如`mdb --connect 192.168.1.100`），当连接建立后，恶意服务器发送>4字节数据即可触发ncc_socket_recv栈缓冲区溢出。溢出点位于main函数0x400df8，使用固定4字节栈缓冲区(auStack_14)但允许接收260字节数据。成功利用可覆盖返回地址实现任意代码执行。触发条件：1) 攻击者能控制mdb执行参数 2) 网络可达恶意服务器。实际影响：结合固件网络服务暴露面，可能通过web接口/脚本间接触发此命令执行。
- **关键词:** ncc_socket_recv, auStack_14, main, sp+0x3c, ncc_socket_connect, param_2, iStack_20
- **备注:** 利用链完整度验证：1) 输入点(命令行参数)可控性确认 2) 传播路径(网络连接)明确 3) 危险操作(栈溢出)证实。需补充：1) 检查NX/DEP防护 2) 寻找ROP链 3) 测试实际crash POC

---
### heap_overflow-dnsmasq-add_resource_record_0x4065a4

- **文件路径:** `sbin/dnsmasq`
- **位置:** `dnsmasq:0 (add_resource_record) 0x4065a4`
- **类型:** network_input
- **综合优先级分数:** **9.01**
- **风险等级:** 9.2
- **置信度:** 8.7
- **触发可能性:** 9.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** add_resource_record函数存在memcpy堆溢出：通过recvfrom接收的't'类型资源记录未验证长度，memcpy操作超出堆分配边界。触发条件：单次畸形DNS请求即可触发，无前置校验。可导致远程代码执行，攻击成功率90%。
- **关键词:** add_resource_record, memcpy, recvfrom, resourcerec, DNS_RCODE_NOERROR

---
### network_input-mini_httpd-path_traversal

- **文件路径:** `sbin/mini_httpd`
- **位置:** `mini_httpd:0x00407b40 (doAPIPage)`
- **类型:** network_input
- **综合优先级分数:** **9.0**
- **风险等级:** 9.0
- **置信度:** 9.0
- **触发可能性:** 9.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 路径遍历漏洞（CWE-22）：在doAPIPage函数处理GetFile请求时，用户输入的path_sfilename_s参数未过滤../序列，直接通过sprintf拼接到文件路径。触发条件：发送含恶意路径的HTTP请求（如/api/../../etc/passwd）。影响：未授权读取系统敏感文件，成功概率高（仅需网络可达）
- **关键词:** GetFile, path_sfilename_s, doAPIPage, sprintf, auStack_9ac8
- **备注:** 需验证/etc/passwd文件权限，但默认配置通常可读；与文件上传漏洞结合可形成完整攻击链：读取/etc/passwd → 上传恶意PHP文件 → 触发RCE

---
### network_input-mini_httpd-file_upload

- **文件路径:** `sbin/mini_httpd`
- **位置:** `mini_httpd:0x404cc8 (fcn.00404cc8)`
- **类型:** network_input
- **综合优先级分数:** **9.0**
- **风险等级:** 9.5
- **置信度:** 8.5
- **触发可能性:** 8.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 高危文件上传链：1) fcn.00404cc8函数处理multipart/form-data请求时未过滤filename=参数 2) 通过snprintf将用户可控文件名拼接到/var/www路径 3) 写入文件后可直接通过HTTP访问。触发条件：构造特制POST请求上传.PHP文件。影响：若PHP解释器启用，可实现远程代码执行（RCE）
- **关键词:** multipart_form_data, fcn.00404cc8, filename=, Content-Disposition, snprintf, cgipat, /var/www
- **备注:** 关键约束：a) PHP模块需加载 b) /var/www目录需有写权限；与路径遍历漏洞结合可形成完整攻击链：未认证攻击者通过HTTP接口实现设备完全控制

---
### network_input-www_reboot.asp-open_redirect

- **文件路径:** `www/reboot.asp`
- **位置:** `www/reboot.asp:? (back) ?`
- **类型:** network_input
- **综合优先级分数:** **8.99**
- **风险等级:** 8.5
- **置信度:** 9.8
- **触发可能性:** 9.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 开放重定向漏洞：攻击者可通过构造含恶意newIP参数的URL（如/reboot.asp?newIP=attacker.com），在60秒倒计时结束后将用户重定向至任意域名。触发条件：1) 用户访问恶意链接 2) 页面完成倒计时。漏洞根源在于gup()函数未对newIP进行格式验证，直接与location.protocol拼接后传入window.location.assign()。
- **代码片段:**
  ```
  function back(){
    var newIP = gup("newIP");
    if(newIP!="")
      window.location.assign(location.protocol+"//"+newIP+"/"+redirectPage);
  }
  ```
- **关键词:** gup, newIP, window.location.assign, location.protocol, redirectPage, back
- **备注:** 实际影响：1) 钓鱼攻击 2) 配合XSS漏洞扩大攻击面。需检查其他ASP文件是否使用相同重定向模式

---
### network_input-smbd_stack_overflow-1c8f0

- **文件路径:** `sbin/smbd`
- **位置:** `smbd:0x1c8f0 sym.process_smb_request`
- **类型:** network_input
- **综合优先级分数:** **8.95**
- **风险等级:** 9.0
- **置信度:** 9.5
- **触发可能性:** 8.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 在process_smb_request函数中，对smb_req->path的边界检查存在缺陷：仅验证长度>255（无符号比较），当path_len=256时，strcpy到固定栈缓冲区导致1字节溢出。攻击者可构造特制SMB请求覆盖返回地址实现RCE。触发条件：发送path长度恰好为256字节的恶意SMB请求。
- **代码片段:**
  ```
  if (smb_req->path_len > 255) { ... }
  strcpy(dest, src);
  ```
- **关键词:** smb_req->path, smb_req->path_len, strcpy, process_share, SMB_COM_OPEN

---
### permission_config-fwUpgrade

- **文件路径:** `bin/fwUpgrade`
- **位置:** `fwUpgrade`
- **类型:** configuration_load
- **综合优先级分数:** **8.95**
- **风险等级:** 8.7
- **置信度:** 10.0
- **触发可能性:** 8.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 高危权限配置漏洞。具体表现：1) fwUpgrade文件权限为777（rwxrwxrwx）2) 未设置setuid位。触发条件：攻击者获得低权限shell访问后。安全影响：1) 允许任意用户直接执行高危程序 2) 可被替换为恶意版本 3) 与前述漏洞结合形成本地提权链。
- **关键词:** fwUpgrade, file_permission, setuid
- **备注:** 完整提权链：低权限用户→利用777权限执行fwUpgrade→触发栈溢出/命令注入漏洞→获得root权限。需关联bulkUpgrade漏洞（command_injection-upgrade_firmware-0x401648）

---
### path_traversal-file_upload-http_api

- **文件路径:** `sbin/mini_httpd`
- **位置:** `homecloud/api/dws/api:0 (UploadFile) 0x0`
- **类型:** network_input
- **综合优先级分数:** **8.95**
- **风险等级:** 9.5
- **置信度:** 8.0
- **触发可能性:** 9.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 文件上传功能存在未经验证的路径遍历漏洞：攻击者通过HTTP请求向'/homecloud/api/dws/api/'端点提交特制UploadFile请求（含恶意filename参数如'../../etc/passwd'），程序直接将用户输入的filename和path参数拼接到基础路径'/var/tmp/usb/%s'，导致任意文件写入。触发条件：1) 访问上传API端点 2) 构造含路径遍历序列的filename参数。约束条件：无路径规范化或'../'过滤机制，仅依赖文件打开失败时的错误提示（'Cannot open file to save'）。实际影响：覆盖系统文件可实现权限提升或完全控制设备（CVSS≥9.0）。
- **关键词:** api_name=UploadFile, filename, path, /var/tmp/usb/%s, Cannot open file to save, upload_source, volid
- **备注:** 需动态验证：1) 测试filename=../../etc/passwd是否生效 2) 检查fopen调用点缓冲区大小限制 3) 确认身份验证要求（结果未明确是否需认证）。关键待补充：具体实现文件路径未知，需后续定位API处理代码

---
### stack_overflow-upgrade_firmware-0x4016e8

- **文件路径:** `bin/bulkUpgrade`
- **位置:** `bin/bulkUpgrade:0x4016e8, 0x401b9c`
- **类型:** network_input
- **综合优先级分数:** **8.9**
- **风险等级:** 9.0
- **置信度:** 9.0
- **触发可能性:** 8.5
- **查询相关性:** 9.8
- **阶段:** N/A
- **描述:** 栈缓冲区溢出漏洞(upgrade_firmware)：攻击者通过超长文件名触发溢出。触发条件：param_1长度+固定字符串>1024字节。两处sprintf(0x4016e8, 0x401b9c)直接将外部参数格式化到1024字节栈缓冲区auStack_468，导致关键控制流劫持。
- **关键词:** upgrade_firmware, param_1, auStack_468, sprintf
- **备注:** 与命令注入漏洞共享参数来源，可组合利用提高可靠性。

---
### stack_overflow-dhcp6s-dhcp6_vbuf_copy-0x409fc4

- **文件路径:** `bin/dhcp6s`
- **位置:** `dhcp6s:0x409fc4 (dhcp6_vbuf_copy)`
- **类型:** network_input
- **综合优先级分数:** **8.9**
- **风险等级:** 9.0
- **置信度:** 9.0
- **触发可能性:** 8.5
- **查询相关性:** 9.8
- **阶段:** N/A
- **描述:** dhcp6_vbuf_copy 函数存在高危栈溢出漏洞：攻击者可控制 memcpy 的 length 参数（a2 寄存器），当 length > 目标栈缓冲区大小（sp+0x1314）时触发。触发条件：向 UDP 547 端口发送 length 字段大于实际数据的 DHCPv6 报文。安全影响：可覆盖返回地址实现 RCE 或导致服务崩溃，CVSS 预估 ≥8.1。
- **代码片段:**
  ```
  0x00409fbc: lw a2, (s0)
  0x00409fc4: jalr t9
  ```
- **关键词:** dhcp6_vbuf_copy, memcpy, a2, sp+0x1314, recvmsg, param_2
- **备注:** 完整攻击链：网络输入 → recvmsg → 结构体解析 → 未验证长度 → memcpy 栈溢出

---
### file_write-fw_upgrade-path_traversal

- **文件路径:** `sbin/fw_upgrade`
- **位置:** `fw_upgrade:3-4`
- **类型:** file_write
- **综合优先级分数:** **8.9**
- **风险等级:** 9.0
- **置信度:** 9.0
- **触发可能性:** 8.5
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** fw_upgrade脚本存在未验证输入导致的任意文件写入漏洞：1) 通过命令行参数$1接收外部输入的tar文件路径 2) 直接使用'tar -xf $1 -C /mydlink/'执行解压操作，未对$1进行路径规范化或过滤 3) 无边界检查机制，攻击者可构造含'../'序列的路径实现目录遍历 4) 解压后立即执行reboot，使写入的恶意文件被激活。实际安全影响：攻击者通过控制$1参数可覆盖系统任意文件（如/etc/init.d启动脚本），结合重启机制实现持久化攻击。
- **代码片段:**
  ```
  tar -xf $1 -C /mydlink/
  reboot
  ```
- **关键词:** $1, tar, /mydlink/, reboot, mydlink-watch-dog.sh
- **备注:** 攻击链验证：1) 与sbin/mydlink-watch-dog.sh的command_execution漏洞关联：恶意文件写入/mydlink/后可被自动执行 2) 需确认调用fw_upgrade的进程（如httpd组件）如何设置$1 3) /mydlink/目录权限检查

---
### vuln-oob_read-sym.ExecuteSoapAction-syslog

- **文件路径:** `bin/miniupnpd`
- **位置:** `bin/miniupnpd:0x411a08 (sym.ExecuteSoapAction)`
- **类型:** network_input
- **综合优先级分数:** **8.9**
- **风险等级:** 9.0
- **置信度:** 9.0
- **触发可能性:** 8.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 高危OOB Read漏洞：处理SOAPAction头时，当头部不包含'#'分隔符且长度异常时，长度计算iStack_10=param_3-(iStack_20-param_2)产生负值。该负值直接传递给syslog("%.*s")导致越界内存读取。触发条件：发送畸形SOAPAction头（不含#且长度使iStack_20>param_2+param_3）。实际影响：1) 敏感信息泄露（读取进程内存） 2) 服务崩溃（DoS） 3) CVSSv3预估8.2分。利用链：网络请求→recv()缓冲区→fcn.00408b04解析→sym.ExecuteSoapAction处理→危险syslog调用。
- **代码片段:**
  ```
  (**(iStack_28 + -0x7e8c))(5,*(iStack_28 + -0x7fe4) + 0x3ecc,iStack_10,iStack_20); // syslog调用
  ```
- **关键词:** sym.ExecuteSoapAction, SOAPAction, iStack_10, iStack_20, param_2, param_3, syslog, SoapMethod: Unknown: %.*s, Content-Length, upnp, nvram_get, nvram_set
- **备注:** 需在实际固件环境验证：1) syslog实现是否受限 2) 负值处理的具体行为 3) 信息泄露范围。关联攻击面记录：service-miniupnpd-attack_surfaces。

---
### command_execution-factory_reset-load_default

- **文件路径:** `sbin/factory_reset`
- **位置:** `sbin/factory_reset`
- **类型:** command_execution
- **综合优先级分数:** **8.85**
- **风险等级:** 8.5
- **置信度:** 10.0
- **触发可能性:** 8.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 脚本通过'echo 1 > /proc/load_default'无条件执行恢复出厂设置操作。触发条件为直接运行脚本，导致设备配置完全重置（拒绝服务攻击）。无任何输入验证、边界检查或权限控制，操作后强制等待10秒退出。潜在安全影响：攻击者若获得脚本执行权限可直接触发设备重置。
- **代码片段:**
  ```
  echo 1 > /proc/load_default
  sleep 10
  exit 0
  ```
- **关键词:** /proc/load_default, load_default, echo
- **备注:** 需分析调用此脚本的上级组件（如Web接口的reset功能）是否存在未授权访问或命令注入漏洞

---
### configuration_load-pppoe-server-options_heap_overflow

- **文件路径:** `bin/pppoe-server`
- **位置:** `pppoe-server:0x40201c (fcn.0040201c)`
- **类型:** configuration_load
- **综合优先级分数:** **8.8**
- **风险等级:** 9.2
- **置信度:** 9.0
- **触发可能性:** 7.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 完整攻击链2：配置文件解析堆溢出漏洞。触发条件：篡改/etc/ppp/pppoe-server-options（默认644权限）。传播路径：1) fopen读取配置文件 2) fgets加载512字节栈缓冲区 3) sscanf解析IP格式 4) 循环写入全局结构时索引越界。安全影响：通过构造畸形IP序列（如超长字符串），可覆盖相邻内存实现任意代码执行。边界检查：循环索引iVar8无上限验证，全局结构大小未约束。
- **关键词:** fcn.0040201c, fopen, fgets, sscanf, iVar8, auStack_240, /etc/ppp/pppoe-server-options
- **备注:** 关联CVE-2006-4304；需动态验证：1) NumSessionSlots全局变量大小 2) 溢出偏移计算

---
### stack_overflow-dhcp6c-aftr_name_option

- **文件路径:** `bin/dhcp6c`
- **位置:** `dhcp6c:client6_script`
- **类型:** network_input
- **综合优先级分数:** **8.8**
- **风险等级:** 9.0
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 9.8
- **阶段:** N/A
- **描述:** OPTION_AFTR_NAME栈溢出完整攻击链：通过DHCPv6响应触发client6_script栈缓冲区溢出。触发条件：1) 攻击者控制DHCPv6响应；2) 包含长度>256字节的aftr_name选项。触发步骤：a) 报文解析后数据存入auStack_1a0缓冲区 b) 复制操作(**(iStack_1b8 + -0x7bc0))越界写入 c) 覆盖返回地址控制EIP。边界检查：无长度验证。安全影响：实现任意代码执行，风险等级极高。利用约束：需绕过栈保护机制（如ASLR），MIPS架构利用复杂度中等。
- **代码片段:**
  ```
  (**(iStack_1b8 + -0x7bc0))(puVar11,uVar2,...,uVar7);
  ```
- **关键词:** client6_script, OPTION_AFTR_NAME, aftr_name, auStack_1a0, iStack_30, uVar7, recvmsg
- **备注:** 需配合ROP链开发；建议动态测试崩溃偏移量

---
### stack_overflow-main-0x00400598

- **文件路径:** `bin/fwUpgrade`
- **位置:** `fwUpgrade:0x00400598 main`
- **类型:** command_execution
- **综合优先级分数:** **8.76**
- **风险等级:** 9.0
- **置信度:** 9.2
- **触发可能性:** 7.5
- **查询相关性:** 9.8
- **阶段:** N/A
- **描述:** 高危栈缓冲区溢出漏洞。具体表现：main函数通过strcpy将argv[1]直接复制到128字节栈缓冲区（地址fp+0x20），未进行长度验证。经计算：返回地址位于fp+0xac，精确偏移140字节。触发条件：攻击者通过命令行参数传递长度>140字节的字符串。安全影响：1) 未启用栈保护机制（无__stack_chk_fail引用）2) 可覆盖返回地址实现任意代码执行3) 结合程序777权限可导致权限提升。
- **代码片段:**
  ```
  0x004005a0: lw a1, 4(v1) # argv[1]
  0x004005a4: lw t9, strcpy
  0x004005ac: jalr t9
  ```
- **关键词:** main, argv, strcpy, fp+0x20, fp+0xac, __stack_chk_fail, fwUpgrade
- **备注:** 利用链关键点：可通过bulkUpgrade的命令注入漏洞（command_injection-upgrade_firmware-0x401648）触发此漏洞执行

---
### attack-chain-account-takeover

- **文件路径:** `www/storage.asp`
- **位置:** `www/storage.asp: add_user()函数`
- **类型:** network_input
- **综合优先级分数:** **8.75**
- **风险等级:** 8.5
- **置信度:** 9.0
- **触发可能性:** 9.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 账户接管攻击链：通过add_user页面的pwd/pwd1参数设置弱密码（如空密码）。攻击者提交匹配的弱密码→客户端JS仅验证一致性→密码通过CCP协议存入NVRAM(igdStorageUser_Password_)→系统使用该凭证验证登录。触发条件：发送长度<1或常见弱密码（如'123456'）。实际影响：完全控制用户账户。
- **关键词:** add_user, pwd, pwd1, igdStorageUser_Password_, usrPasswd, CCP协议
- **备注:** 依赖NVRAM存储机制，需验证密码加密强度（当前无证据）

---
### attack_surface-get_set_ccp-centralized

- **文件路径:** `www/tools_ddns.asp`
- **位置:** `get_set.ccp (需后续定位具体行号)`
- **类型:** configuration_load
- **综合优先级分数:** **8.65**
- **风险等级:** 9.0
- **置信度:** 8.5
- **触发可能性:** 8.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 关键攻击面暴露：get_set.ccp被多个前端模块(tools_ddns/tools_email/tools_syslog等)作为统一参数处理器。用户控制的输入通过get_config_obj传递到param.arg参数，最终在get_set.ccp执行。若该文件存在命令注入或缓冲区溢出漏洞，可形成跨模块统一攻击链。触发条件：攻击者污染任意关联前端参数（如hostnamev6/log_email_server）并触发配置保存操作。安全影响：单一漏洞点可导致设备完全控制。
- **关键词:** get_set.ccp, get_config_obj, param.arg, ccp_act, ddnsListCfg_HostName_, emailCfg_SMTPServerAddress__
- **备注:** 核心待验证点：1) get_set.ccp是否存在命令执行函数(system/popen) 2) 参数是否直接拼接命令 3) 缓冲区操作是否检查长度

---
### dos-unconditional_service_kill

- **文件路径:** `usr/sbin/hotplug_kill.sh`
- **位置:** `hotplug_kill.sh:13`
- **类型:** command_execution
- **综合优先级分数:** **8.65**
- **风险等级:** 8.5
- **置信度:** 10.0
- **触发可能性:** 7.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 存在无条件服务终止漏洞：当脚本以root权限执行且$1参数为'stop'时，直接执行'killall smbd'命令终止Samba服务。该操作无权限验证或参数过滤机制，攻击者通过控制$1参数即可造成服务拒绝。触发条件：1) 调用进程具有root权限 2) $1='stop'。实际影响：若该脚本被网络服务调用（如通过hotplug机制响应外部事件），可形成远程攻击链导致关键服务中断。关联发现：知识库中ACTION相关漏洞（cmd_injection-usbmount_pid_root）表明hotplug事件可被利用，两者结合可实现'命令注入+服务拒绝'组合攻击。
- **代码片段:**
  ```
  "stop" )
  	killall smbd
  ```
- **关键词:** ACTION, $1, killall, smbd, stop, hotplug
- **备注:** 攻击链验证：与usr/hotplug文件的cmd_injection-usbmount_pid_root漏洞共享ACTION触发机制。若攻击者控制USB事件（如插入恶意设备），可同时触发命令注入和服务终止

---
### configuration_load-udhcpd-arpping-stack_overflow

- **文件路径:** `sbin/udhcpd`
- **位置:** `udhcpd:0 [arpping] 0x4023fc`
- **类型:** configuration_load
- **综合优先级分数:** **8.65**
- **风险等级:** 9.0
- **置信度:** 8.5
- **触发可能性:** 8.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** arpping函数栈溢出漏洞。触发条件：本地攻击者篡改/etc/udhcpd.conf的'server'字段超过14字节后重启服务，处理ARP请求时strcpy(sp+0x20)导致栈溢出。边界检查：无长度验证机制。安全影响：可实现任意代码执行或拒绝服务。
- **关键词:** arpping, server, strcpy, /etc/udhcpd.conf, check_ip
- **备注:** 需确认sp+0x20缓冲区确切大小；分析配置文件写入权限控制

---
### command-injection-ipc-mount

- **文件路径:** `usr/sbin/sxstoragemanager`
- **位置:** `sxstoragemanager:0x004046b0 (sxstorage_mount), hotplugd:0x4077d0 (snprintf), hotplugd:0x4077fc (execl)`
- **类型:** ipc
- **综合优先级分数:** **8.65**
- **风险等级:** 9.0
- **置信度:** 8.5
- **触发可能性:** 8.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** IPC传递参数触发的命令注入链。sxstoragemanager通过sxstorage_mount/sxstorage_umount的IPC机制（strncpy复制0x7c字节）将外部可控的挂载点路径传递给hotplugd服务。hotplugd使用snprintf拼接未过滤输入构造'/bin/tar cf %s *'命令，最终通过execl("/bin/sh", "-c", command)执行。触发条件：攻击者通过热插拔事件或网络API（如NAS管理接口）控制挂载点路径。实际影响：注入;或$(...)序列可实现任意命令执行。完整攻击链：网络API/USB存储设备 -> sxstoragemanager IPC -> hotplugd命令拼接 -> execl执行。
- **关键词:** sxstorage_mount, sxstorage_umount, sxipc_send_srv, hotplugd, execl, snprintf, /bin/tar, /bin/sh, IPC
- **备注:** 关键突破点：网络接口到挂载点参数的传递路径需进一步映射

---
### command_execution-smbd_restart-injection

- **文件路径:** `usr/sbin/hotplug_misc.sh`
- **位置:** `hotplug_misc.sh:22-27`
- **类型:** command_execution
- **综合优先级分数:** **8.65**
- **风险等级:** 9.0
- **置信度:** 8.5
- **触发可能性:** 8.0
- **查询相关性:** N/A
- **阶段:** N/A
- **描述:** 命令注入链：通过killall smbd强制终止服务，并在服务重启时加载被污染的smb.conf。攻击者可在配置中注入恶意命令（如log file=|恶意命令）。触发条件：成功覆盖smb.conf后自动触发。边界检查缺失，smbd以root权限运行大幅提升危害。
- **关键词:** killall, smbd, smb.dir.conf
- **备注:** 漏洞链关键环节。依赖前序路径遍历漏洞，但提供RCE能力

---
### cmd_injection-TLV8106-firmware_verify

- **文件路径:** `sbin/bulkagent`
- **位置:** `main @ 0x401dec`
- **类型:** network_input
- **综合优先级分数:** **8.65**
- **风险等级:** 9.0
- **置信度:** 8.5
- **触发可能性:** 8.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 校验失败命令注入（TLV_0x8106）：当固件升级包校验失败时，使用未过滤的网络数据构造'rm %s%s'命令。文件名(auStack_4e0)直接来自攻击者控制的数据包，未过滤特殊字符。触发条件：发送类型0x8106的TLV包并设置错误校验和。实际影响：任意命令执行（风险9.0）
- **关键词:** auStack_4e0, rm %s%s, TLV:0x8106, system, checksum_ERROR
- **备注:** 需验证pcVar19是否指向system函数

---
### cmd_injection-usbmount_pid_root

- **文件路径:** `usr/hotplug`
- **位置:** `hotplug:9,13,16`
- **类型:** command_execution
- **综合优先级分数:** **8.6**
- **风险等级:** 9.0
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 高危命令注入漏洞：攻击者通过控制/var/run/usbmount2.pid文件内容（如写入'123;reboot'）并触发USB事件，可导致root权限任意命令执行。触发条件：1) pid文件内容可控（需验证写入权限） 2) 物理/模拟USB事件。核心约束：usbmount2服务以root权限运行kill命令。
- **代码片段:**
  ```
  usbmount2_pid="\`cat /var/run/usbmount2.pid\`"
  kill -USR1 $usbmount2_pid
  ```
- **关键词:** usbmount2_pid, /var/run/usbmount2.pid, kill -USR1, ACTION
- **备注:** 攻击链关键点：外部输入(pid文件)→root命令执行。待验证：1) /etc/init.d/usbmount2脚本的pid文件写入逻辑 2) /var/run目录默认权限 3) USB事件模拟机制（关联物理攻击面）

---
### configuration_load-udhcpd-read_interface-stack_overflow

- **文件路径:** `sbin/udhcpd`
- **位置:** `udhcpd:0 [read_interface] 0x4072b0`
- **类型:** configuration_load
- **综合优先级分数:** **8.6**
- **风险等级:** 9.0
- **置信度:** 8.0
- **触发可能性:** 8.5
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** read_interface函数栈溢出漏洞。触发条件：篡改/etc/udhcpd.conf的'interface'字段超16字节，服务初始化时strcpy(auStack_40)溢出。边界检查：完全缺失。安全影响：本地权限提升导致任意代码执行。
- **关键词:** read_interface, interface, strcpy, server_config, /etc/udhcpd.conf
- **备注:** 需验证auStack_40栈结构；审查其他配置项加载逻辑

---
### network_input-tools_system_asp-upload_validation

- **文件路径:** `www/tools_system.asp`
- **位置:** `tools_system.asp: JavaScript function loadConfirm`
- **类型:** network_input
- **综合优先级分数:** **8.55**
- **风险等级:** 8.5
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 文件上传功能存在验证缺陷：仅验证文件扩展名为.bin，未实施内容校验或服务器端验证。攻击者可构造恶意.bin文件触发配置恢复操作。触发条件：1) 攻击者具备管理员权限(dev_info.login_info=='w')；2) 上传扩展名为.bin的恶意文件。若后端cfg_op.ccp处理逻辑存在漏洞（如命令注入），可导致RCE。约束条件：需绕过客户端JS验证（可直接构造请求）。影响：形成'恶意文件上传→配置恢复→命令执行'完整攻击链，成功概率取决于后端漏洞存在性。
- **代码片段:**
  ```
  var file_name=get_by_id("file").value;
  var ext_file_name=file_name.substring(file_name.lastIndexOf('.')+1,file_name.length);
  if (ext_file_name!="bin"){
    alert(get_words('rs_intro_1'));
    return false;
  }
  ```
- **关键词:** loadConfirm, file, ext_file_name, bin, send_submit, form1, cfg_op.ccp, ccp_act=load
- **备注:** 必须验证cfg_op.ccp的'ccp_act=load'处理逻辑：1) 是否直接使用上传文件内容执行系统命令；2) NVRAM操作是否受未验证文件内容影响。建议后续分析'cfg_op.ccp'文件。

---
### NVRAM-Pollution-to-XSS-Chain

- **文件路径:** `www/tools_firmw.asp`
- **位置:** `跨文件：www/tools_admin.asp → www/tools_firmw.asp`
- **类型:** nvram_set_to_dom
- **综合优先级分数:** **8.55**
- **风险等级:** 9.0
- **置信度:** 8.5
- **触发可能性:** 7.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 完整NVRAM污染攻击链：攻击者通过tools_admin.asp的param.arg参数注入恶意数据污染NVRAM（如adminCfg_*或login_Info字段），污染数据被tools_firmw.asp页面的config_val()读取后，经get_router_info()通过document.write输出到HTML，触发存储型XSS。触发步骤：1) 利用CSRF或会话劫持篡改NVRAM 2) 诱导用户访问/tools_firmw.asp。实际利用概率高（需管理员权限但存在会话漏洞）。
- **代码片段:**
  ```
  关联代码段1（污染点）:
  [来自tools_admin.asp]
  config_val('adminCfg_RemoteAdminHttpPort_', req_param('arg'))
  
  关联代码段2（触发点）:
  [来自tools_firmw.asp]
  document.write(config_val('login_Info'))
  ```
- **关键词:** config_val, param.arg, document.write, login_Info, adminCfg_RemoteAdminHttpPort_
- **备注:** 关键证据链：1) tools_admin.asp存在param.arg直接写入NVRAM 2) tools_firmw.asp直接输出NVRAM值 3) 两者共享config_val()函数

---
### xss-tools_ddns-288

- **文件路径:** `www/tools_ddns.asp`
- **位置:** `tools_ddns.asp:288-350`
- **类型:** network_input
- **综合优先级分数:** **8.55**
- **风险等级:** 8.5
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 存储型XSS完整攻击链：攻击者通过'hostnamev6'字段注入恶意脚本（如`<script>alert(1)</script>`），当管理员访问tools_ddns.asp页面时，paintDNSTable函数直接输出未编码的DataArray.HostName导致脚本执行。触发条件：1) 攻击者提交恶意主机名 2) 管理员查看DDNS配置页面。边界检查仅验证字符类型（check_client_name）但未过滤HTML符号，安全影响可实现会话劫持/设备控制。
- **代码片段:**
  ```
  contain += "<tr><td><center><input type=checkbox...></center></td><td><center>" + DataArray[i].Name +"</td>..."
  ```
- **关键词:** hostnamev6, DataArray, paintDNSTable, save_reserved, get_config_obj, ddnsListCfg_HostName_
- **备注:** 形成完整攻击链：前端输入→JS存储→DOM渲染。验证：服务器端未二次过滤（证据见paramForm.arg直接拼接）

---
### dom-xss-addstr-multi_vector

- **文件路径:** `wa_www/public.js`
- **位置:** `public.js:638,1523,1542`
- **类型:** network_input
- **综合优先级分数:** **8.55**
- **风险等级:** 8.5
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** DOM-based XSS漏洞存在于addstr()函数。未经验证的外部输入通过三个向量直接流入危险函数：1) gateway_ipaddr_1（来自网络配置）注入alert() 2) obj_S（语言字符串）注入document.write 3) obj_name（LAN IP验证）注入DOM。触发条件：攻击者通过HTTP参数或伪造网络响应（如DHCP/NTP）注入恶意JS。影响：在路由器Web上下文执行任意代码，完全控制用户界面。
- **代码片段:**
  ```
  638: alert(addstr(msg[NOT_SAME_DOMAIN], obj_word, gateway_ipaddr_1));
  1523: obj_D[i] = addstr(obj_S[i], replace_msg.arguments[1]);
  ```
- **关键词:** addstr, gateway_ipaddr_1, obj_S, obj_name, alert, document.write
- **备注:** 需验证服务器端对obj_S参数的处理。关联函数：网络配置处理逻辑（LAN/WAN设置）。利用链关联：可触发IP验证绕过漏洞（见check_address）

---
### network_input-storage-csrf

- **文件路径:** `www/storage.asp`
- **位置:** `www/storage.asp:0 [send_request, edit_rule]`
- **类型:** network_input
- **综合优先级分数:** **8.5**
- **风险等级:** 8.0
- **置信度:** 9.0
- **触发可能性:** 9.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 前端依赖login_Info变量控制写操作但缺乏CSRF防护。攻击者可伪造请求修改存储访问规则(如开启远程访问)。触发条件：诱骗已认证用户访问恶意页面。成功概率高，可与其他漏洞形成利用链。
- **关键词:** login_Info, send_request, edit_rule
- **备注:** 独立危害有限但可放大其他漏洞影响

---
### attack-chain-path-traversal

- **文件路径:** `www/storage.asp`
- **位置:** `www/storage.asp: save_append()函数`
- **类型:** network_input
- **综合优先级分数:** **8.5**
- **风险等级:** 9.0
- **置信度:** 8.0
- **触发可能性:** 8.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 路径遍历攻击链：通过Access_path参数注入../序列（如'/etc/passwd'）→JS仅过滤反斜杠→encodeURIComponent编码后存入NVRAM(igdStorageAdminRule_AccessPath_)→底层web_access.ccp读取执行。触发条件：路径参数包含../且未锚定根目录。实际影响：任意文件读取/写入。
- **关键词:** edit_rule, save_append, Access_path, encodeURIComponent, igdStorageAdminRule_AccessPath_, MSG056
- **备注:** 关键缺口：web_access.ccp的路径解析逻辑未验证，建议优先分析该文件

---

## 中优先级发现

### hardware_input-hotplug_devpath_traversal

- **文件路径:** `usr/sbin/hotplug_misc.sh`
- **位置:** `hotplug_misc.sh:18`
- **类型:** hardware_input
- **综合优先级分数:** **8.45**
- **风险等级:** 8.5
- **置信度:** 9.0
- **触发可能性:** 7.5
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 未验证路径遍历漏洞：在AFTERMNT事件处理分支中，DEVPATH环境变量直接拼接为配置文件路径（${DEVPATH}/smb.dir.conf），未进行路径规范化或边界检查。攻击者通过伪造热插拔事件（如USB设备插入）并控制DEVPATH（例如设置为'../../../etc'），可覆盖系统关键配置文件。结合smbd服务加载机制，可能实现远程代码执行（RCE）。触发条件：1) 设备热插拔事件触发ACTION='AFTERMNT' 2) 攻击者控制DEVPATH值
- **代码片段:**
  ```
  $SMBCONF -c "${DEVPATH}/smb.dir.conf" -d "/etc/samba/smb.def.conf"
  ```
- **关键词:** DEVPATH, sxsambaconf, smb.dir.conf, AFTERMNT, SMBCONF, smbd
- **备注:** 需验证smbd是否以root权限运行；与发现2、3构成完整攻击链：控制DEVPATH→写入恶意配置→触发服务重启→RCE

---
### attack_chain-password_bypass_to_bruteforce

- **文件路径:** `www/tools_admin.asp`
- **位置:** `跨文件：www/tools_admin.asp → get_set.ccp → login.ccp`
- **类型:** attack_chain
- **综合优先级分数:** **8.45**
- **风险等级:** 9.0
- **置信度:** 7.5
- **触发可能性:** 8.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 完整攻击链：利用参数注入漏洞绕过弱密码策略+登录接口爆破。步骤：1) 攻击者伪造POST请求操控admin_password1参数（绕过JS长度检查）；2) 服务端get_set.ccp未校验密码复杂度，接受任意密码；3) 设置弱密码后通过登录接口暴力破解获取权限。触发条件：网络访问tools_admin.asp和登录接口。约束：依赖get_set.ccp的输入过滤缺失及登录接口无爆破防护。
- **关键词:** admin_password1, get_set.ccp, login_Info, usrPasswd
- **备注:** 基于历史发现关联构建；需验证：1) get_set.ccp对admin_password1的处理逻辑；2) login.ccp的认证防护机制

---
### hardware_input-sxsambaconf-format_string

- **文件路径:** `usr/sbin/sxstoragemanager`
- **位置:** `sxstoragemanager:0x403004`
- **类型:** hardware_input
- **综合优先级分数:** **8.45**
- **风险等级:** 9.0
- **置信度:** 8.5
- **触发可能性:** 7.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** sxsambaconf函数存在格式化字符串漏洞。具体表现：未验证的USB设备信息直接传入snprintf。触发条件：1)连接恶意USB设备 2)执行`sxstoragemanager sxsambaconf`。利用方式：通过伪造设备信息注入%n实现任意内存写入。约束条件：需root权限运行。
- **代码片段:**
  ```
  snprintf(auStack_e78, 1024, str_template, device_info);
  ```
- **关键词:** sxsambaconf, str.commentDevice__s____s_s__n, auStack_150, acStack_56c, hotplugd, snprintf
- **备注:** 攻击链：USB设备→hotplugd→sxsambaconf。需验证hotplugd数据传递机制。

---
### network_input-PPPoE-PADR_execution_chain

- **文件路径:** `bin/pppoe-server`
- **位置:** `pppoe-server:0x405160 (processPADR), 0x404ba4 (startPPPDUserMode)`
- **类型:** network_input
- **综合优先级分数:** **8.4**
- **风险等级:** 8.0
- **置信度:** 9.0
- **触发可能性:** 8.5
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 完整攻击链1：网络输入污染PPPD执行参数。触发条件：攻击者发送恶意PADR包（PPPoE发现阶段）。传播路径：1) receivePacket接收原始数据 2) processPADR直接复制MAC地址到session结构体 3) startPPPDUserMode通过sprintf格式化参数 4) execv执行pppd。安全影响：MAC地址未经验证，可能用于会话劫持或作为跳板注入pppd参数（需验证pppd处理逻辑）。边界检查：processPADR中无MAC验证机制。
- **关键词:** sym.receivePacket, sym.processPADR, sym.startPPPDUserMode, param_1, param_2, sprintf, execv, /bin/pppd
- **备注:** 后续验证方向：1) pppd对MAC参数的处理 2) sprintf缓冲区大小约束

---
### network_input-email_config-http_param_injection

- **文件路径:** `www/tools_email.asp`
- **位置:** `www/tools_email.asp: do_submit()函数`
- **类型:** network_input
- **综合优先级分数:** **8.35**
- **风险等级:** 8.5
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 未过滤的HTTP参数注入：攻击者通过污染log_email_server/log_email_port等参数，可在管理员配置邮件时注入恶意数据。触发条件：1) 攻击者需获取管理员会话(如XSS)；2) 邮件功能启用；3) 提交含特殊字符的SMTP配置。约束检查缺失：仅验证端口范围(0-65535)，未过滤元字符。安全影响：通过param.arg构造系统请求，可能在后端get_set.ccp中实现远程代码执行。
- **代码片段:**
  ```
  param.arg += '&emailCfg_SMTPServerAddress__1.1.0.0.0='+$('#log_email_server').val()
  ```
- **关键词:** log_email_server, log_email_port, do_submit, get_config_obj, param.arg, emailCfg_SMTPServerAddress__
- **备注:** 实际RCE风险取决于get_set.ccp对emailCfg_SMTPServerAddress__的处理，需后续分析

---
### config_write-mdb_set_sensitive

- **文件路径:** `sbin/mdb_test.sh`
- **位置:** `sbin/mdb_test.sh`
- **类型:** configuration_load
- **综合优先级分数:** **8.35**
- **风险等级:** 8.0
- **置信度:** 9.5
- **触发可能性:** 7.5
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 脚本通过'mdb set'命令设置敏感配置项（admin_passwd/attr_0-attr_9），输入值包含特殊字符(%23%24%25%26)且未进行任何过滤或长度检查。攻击者可通过污染$PATH环境变量劫持'mdb'命令，或利用'mdb'实现的漏洞（若存在）触发未授权配置修改。触发条件包括：控制脚本执行环境变量或利用mdb自身的输入验证缺陷。
- **代码片段:**
  ```
  testPasswd=%23%24%25%26%2B%2C%2F%3A
  mdb set admin_passwd $testPasswd
  mdb set attr_0 1
  ```
- **关键词:** admin_passwd, attr_0, attr_9, mdb set, PATH, factory_reset, fw_upgrade, register_st, mdb
- **备注:** 关键风险传递至'mdb'命令：1) 建议立即分析/sbin/mdb二进制 2) 检查NVRAM写操作的边界验证 3) 验证特权命令(factory_reset/reboot)的调用路径；关联攻击链：PATH环境变量劫持（见知识库记录'path_hijack-kill_command'）可能扩大此漏洞影响

---
### command_execution-hotplug-path_traversal

- **文件路径:** `sbin/hotplug`
- **位置:** `/sbin/hotplug:具体行号未知`
- **类型:** command_execution
- **综合优先级分数:** **8.35**
- **风险等级:** 8.5
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 路径遍历漏洞：$1参数直接拼接到目录路径(${DIR}/$1/)中，未进行路径规范化或边界检查。攻击者通过恶意$1值(如'../../../etc')可跳出/etc/hotplug.d目录，执行任意位置的.hotplug脚本。触发条件：调用hotplug时控制$1参数。实际影响需结合调用上下文，但漏洞本身具备完整数据流：$1→路径拼接→脚本执行。
- **关键词:** $1, DIR, ${DIR}/$1/, /etc/hotplug.d
- **备注:** 需验证DIR定义值（可能来自环境变量或固定路径）；关联到知识库中已有'$1'关键词的发现

---
### hardware_input-hotplug_DEVPATH-path_traversal

- **文件路径:** `usr/sbin/hotplug_misc.sh`
- **位置:** `hotplug_misc.sh:18`
- **类型:** hardware_input
- **综合优先级分数:** **8.35**
- **风险等级:** 8.5
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** N/A
- **阶段:** N/A
- **描述:** 路径遍历漏洞：在AFTERMNT事件处理中直接拼接未过滤的DEVPATH环境变量（${DEVPATH}/smb.dir.conf）。攻击者通过伪造USB热插拔事件控制DEVPATH为'../../../etc'等路径，可覆盖/etc/smb.conf等系统配置。触发条件：物理/模拟USB插入+设置ACTION='AFTERMNT'。边界检查完全缺失，利用成功率取决于smbd权限（已知root运行）。
- **关键词:** DEVPATH, ACTION, AFTERMNT, smb.dir.conf
- **备注:** 攻击链起始点。需物理访问或热插拔模拟能力，但利用后可直接控制smb配置

---
### path-traversal-hotplug-param1

- **文件路径:** `sbin/hotplug`
- **位置:** `/sbin/hotplug:4`
- **类型:** hardware_input
- **综合优先级分数:** **8.35**
- **风险等级:** 8.5
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 路径遍历漏洞：攻击者通过控制$1参数注入路径遍历序列（如'../'）可执行任意目录的.hotplug脚本。触发条件：1) 攻击者控制$1参数值 2) 目标目录存在恶意.hotplug脚本。边界检查缺失：$1直接拼接进路径（${DIR}/$1/）无任何过滤。安全影响：结合脚本写入权限可实现任意命令执行。利用方式：伪造$1='../../etc'执行/etc/*.hotplug
- **关键词:** $1, DIR, ${DIR}/$1/, *.hotplug
- **备注:** 需后续验证：1) 内核热插拔机制是否暴露$1控制接口（关联知识库中$1相关发现）2) /etc/hotplug.d目录写权限（关联文件写入类发现）

---
### network_input-udhcpc-env_injection_0x404000

- **文件路径:** `sbin/udhcpc`
- **位置:** `udhcpc:0x404000 sym.run_script`
- **类型:** network_input
- **综合优先级分数:** **8.35**
- **风险等级:** 8.5
- **置信度:** 8.0
- **触发可能性:** 8.5
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 环境变量注入风险：udhcpc将未经验证的DHCP响应数据（如IP地址）直接设置为环境变量（'ip'、'mask'），并通过execle调用'/usr/share/udhcpc/ncc_sync.script'传递这些变量。攻击者伪造DHCP响应可控制环境变量值，若目标脚本未安全处理这些变量（如在shell命令中直接使用$ip），可能导致命令注入。触发条件：1) 设备使用udhcpc 2) 攻击者发送恶意DHCP响应 3) 目标脚本存在不安全变量使用。
- **代码片段:**
  ```
  (**(iVar22 + -0x7f5c))(piVar8+iVar19, "ip", param_1+0x10);
  (**(iVar22 + -0x7e48))(uVar9,uVar9,param_2,0,env_array);
  ```
- **关键词:** run_script, execle, environ, client_config.script, ncc_sync.script, DHCP response, interface, ip, PATH
- **备注:** 完整攻击链需分析/usr/share/udhcpc/ncc_sync.script；关联关键词：system()调用（命令注入检测点）

---
### unchecked_memcpy-dhcp6s-dhcp6_set_options-0x40d8a8

- **文件路径:** `bin/dhcp6s`
- **位置:** `dhcp6s:0x40d8a8 (dhcp6_set_options)`
- **类型:** network_input
- **综合优先级分数:** **8.3**
- **风险等级:** 8.8
- **置信度:** 8.0
- **触发可能性:** 7.5
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** dhcp6_set_options 函数存在未验证长度拷贝风险：memcpy 长度参数来自 s4+0xec（报文解析值），未检查是否超出目标缓冲区（s0）边界。触发条件：处理恶意构造的 DHCPv6 报文。安全影响：堆/栈缓冲区溢出可能导致 RCE，需结合 s4 寄存器污染路径分析实际利用复杂度。
- **代码片段:**
  ```
  0x40d8a4: lw a2, 0xec(s4)
  0x40d8a8: jalr t9
  ```
- **关键词:** dhcp6_set_options, memcpy, s4, 0xec, s0, a2
- **备注:** 需追踪 s4 寄存器来源（建议分析 dhcp6_parse_options）

---
### configuration_load-accel-pptp-param_injection

- **文件路径:** `sbin/accel-pptp.sh`
- **位置:** `accel-pptp.sh:24-25`
- **类型:** configuration_load
- **综合优先级分数:** **8.3**
- **风险等级:** 8.0
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 脚本将未验证的参数($1-$5)直接写入/etc/options.pptp配置文件。攻击者通过控制PPTP_USER_NAME或PPTP_PASSWORD参数可注入恶意配置（如添加额外命令）。触发条件：任何调用此脚本的组件（如Web接口）未过滤用户输入时。边界检查完全缺失，特殊字符未转义。可导致PPTP服务解析恶意配置或权限提升。
- **代码片段:**
  ```
  echo "user \"$PPTP_USER_NAME\""  >> $PPTP_FILE
  echo "password \"$PPTP_PASSWORD\"" >> $PPTP_FILE
  ```
- **关键词:** PPTP_USER_NAME, PPTP_PASSWORD, PPTP_FILE, options.pptp, $1, $2
- **备注:** 需追踪调用此脚本的上级组件（如/www/cgi-bin/）确认参数来源。关联关键词：$1,$2

---
### command_execution-flash-argv_overflow

- **文件路径:** `bin/flash`
- **位置:** `bin/flash:0x0040107c (flash_write) & 0x00401840 (main)`
- **类型:** command_execution
- **综合优先级分数:** **8.25**
- **风险等级:** 8.5
- **置信度:** 8.0
- **触发可能性:** 8.0
- **查询相关性:** 9.8
- **阶段:** N/A
- **描述:** 在'bin/flash'中发现高危漏洞链：攻击者可通过命令行参数触发flash_write函数的单字节越界写入。具体路径：1) 通过'-w'选项控制param_2(写入值) 2) 通过其他选项(如'-f')间接影响param_1(偏移量) 3) 在flash_write函数中，未验证的偏移计算导致越界写入。触发条件：攻击者需能执行flash命令并控制参数值。实际影响：可能破坏关键内存结构导致设备崩溃或权限提升，风险等级高。
- **代码片段:**
  ```
  flash_write调用点: 0x00401840
  漏洞代码: *(((param_1 - iVar5) - iVar10) + iVar4) = param_2;
  ```
- **关键词:** flash_write, main, param_1, param_2, s4, s6, getopt, argv, optarg
- **备注:** 需后续验证：1) param_1的完整赋值路径 2) 越界写入的具体内存影响 3) 固件执行环境是否限制命令行访问（与知识库中'argv[2]'存在关联）

---
### hardware_input-hotplugd-command_injection

- **文件路径:** `usr/sbin/hotplugd`
- **位置:** `usr/sbin/hotplugd:0 [hotplugd_handler] 0x0`
- **类型:** hardware_input
- **综合优先级分数:** **8.25**
- **风险等级:** 8.5
- **置信度:** 8.0
- **触发可能性:** 8.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 发现高危命令注入漏洞：1) hotplugd在响应设备热插拔事件时，通过snprintf()拼接命令'/sbin/dosfsck -M&devpath(%s)'，其中'%s'直接来自DEVPATH环境变量；2) 无任何输入过滤或边界检查机制；3) 触发条件为设备插拔事件（ACTION事件）；4) 攻击者可伪造DEVPATH变量（如';malicious_command;'）注入任意命令，当设备插入时以root权限执行。
- **关键词:** DEVPATH, dosfsck, system, snprintf, ACTION, devpath
- **备注:** 攻击路径：控制DEVPATH环境变量 → 触发热插拔事件 → 恶意命令通过system()执行。需验证：1) 内核如何设置DEVPATH；2) 物理设备伪造可行性。

---
### heap-overflow-sxstrg_get_storage_list-usb

- **文件路径:** `usr/sbin/sxstoragemanager`
- **位置:** `sxstoragemanager:0x403d3c (sym.sxstrg_get_storage_list)`
- **类型:** hardware_input
- **综合优先级分数:** **8.2**
- **风险等级:** 7.8
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** USB设备输入触发的堆溢出漏洞。攻击者插入恶意USB设备后，hotplugd服务将设备描述符传递给sym.sxstrg_get_storage_list(0x403d3c)。该函数未验证边界读取208字节到acStack_f8栈缓冲区，后续strcpy使用该缓冲区作为源数据时，因动态分配的目标缓冲区未预留终止符空间导致堆溢出。触发条件：物理接入特殊构造的USB设备。实际影响：可控堆破坏可实现任意代码执行。完整攻击链：物理USB设备 -> hotplugd -> sxusbport_main -> sxstrg_get_storage_list -> strcpy堆破坏。
- **关键词:** hotplugd, sym.sxstrg_get_storage_list, acStack_f8, sxusbport_main, strcpy, USB
- **备注:** 需动态验证：1) USB描述符注入可行性 2) 堆布局控制技术

---
### heap_overflow-dhcp6c-duid_file_processing

- **文件路径:** `bin/dhcp6c`
- **位置:** `dhcp6c:0x0040f778 (get_duid)`
- **类型:** network_input
- **综合优先级分数:** **8.2**
- **风险等级:** 8.5
- **置信度:** 8.5
- **触发可能性:** 7.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** DUID文件处理复合漏洞链：通过控制/var/dhcp6c_duid文件触发堆内存破坏。触发条件：1) 攻击者写入畸形DUID文件（前2字节<10）；2) 重启dhcp6c服务。触发步骤：a) 文件长度uStack_130读取后未验证 b) 整数下溢(uStack_130-10)导致复制操作越界 c) 堆溢出覆盖相邻内存结构。边界检查：缺失文件长度校验和整数下溢防护。安全影响：可控堆溢出实现代码执行。利用方式：结合Web接口文件上传构成持久化攻击。
- **代码片段:**
  ```
  (**(iStack_138 + -0x7c34))(puVar3 + 10, auStack_128, uStack_130 - 10);
  ```
- **关键词:** get_duid, uStack_130, puVar3, /var/dhcp6c_duid, fread, iStack_138 + -0x7c34, param_2
- **备注:** 关联攻击面：Web文件上传接口

---
### service-miniupnpd-attack_surfaces

- **文件路径:** `bin/miniupnpd`
- **位置:** `service/miniupnpd (具体文件待定位)`
- **类型:** network_input
- **综合优先级分数:** **8.15**
- **风险等级:** 8.5
- **置信度:** 7.0
- **触发可能性:** 9.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** miniupnpd存在三处核心攻击面：1) HTTP/SOAP解析器（TCP 5000端口）处理用户可控的Content-Length/SOAPAction头部 2) NVRAM的get/set操作通过upnp命令接口进行，可能受污染的环境变量影响 3) SSDP多播响应（UDP 1900端口）处理M-SEARCH请求。触发条件：向对应端口发送特制数据包或篡改NVRAM值。安全影响：未经验证的输入可能导致命令注入/缓冲区溢出，需动态验证具体漏洞利用链。
- **关键词:** Content-Length, SOAPAction, M-SEARCH, upnp, nvram_get, nvram_set
- **备注:** 关键验证方向：1) SOAP请求中CONTROL_URL参数边界校验 2) upnp命令调用system()时的参数净化 3) 关联libc.so.0的strcpy/sprintf实现

---
### network_input-udhcpd-add_lease-heap_overflow

- **文件路径:** `sbin/udhcpd`
- **位置:** `udhcpd:0 [add_lease] 0x404b54`
- **类型:** network_input
- **综合优先级分数:** **8.15**
- **风险等级:** 8.5
- **置信度:** 8.0
- **触发可能性:** 7.5
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** add_lease函数堆溢出漏洞。触发条件：处理恶意DHCP DISCOVER/OFFER包时，hostname字段超64字节导致strcpy/strncpy溢出堆内存。边界检查：strncpy截断机制失效。安全影响：通过特制网络包破坏堆结构实现RCE。
- **关键词:** add_lease, hostname, DISCOVER, OFFER, strcpy, strncpy
- **备注:** 需确认堆分配大小；追踪hostname解析全路径

---
### configuration_load-accel-pptp-global_validation

- **文件路径:** `sbin/accel-pptp.sh`
- **位置:** `accel-pptp.sh:6-16`
- **类型:** configuration_load
- **综合优先级分数:** **8.15**
- **风险等级:** 7.5
- **置信度:** 9.0
- **触发可能性:** 8.5
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 全局输入验证机制缺失。脚本仅检查参数数量（行6-9），未对$1-$5参数内容进行任何过滤或消毒。攻击者可通过特殊字符（如;、$、()）尝试注入攻击。触发条件：任何参数来源组件存在用户可控输入点。
- **代码片段:**
  ```
  if [ ! -n "$5" ]; then
    echo "insufficient arguments!"
    exit 0
  fi
  PPTP_USER_NAME="$1"
  ```
- **关键词:** $1, $2, $3, $4, $5

---
### crypto-wep-flaw-create_wep_key128

- **文件路径:** `wa_www/public.js`
- **位置:** `public.js:1400-1410`
- **类型:** configuration_load
- **综合优先级分数:** **8.15**
- **风险等级:** 7.5
- **置信度:** 9.0
- **触发可能性:** 8.5
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** WEP加密实现缺陷在create_wep_key128()。不安全方法包括：1) 密码重复填充至64字节后MD5哈希 2) 仅取哈希前26字符 3) 大写转换降低熵值。触发条件：使用WEP加密时。影响：支持离线暴力破解（熵值仅2^46），结合空密钥绕过可完全破解WEP。
- **代码片段:**
  ```
  function create_wep_key128(passpharse, pharse_len){
      for(var i=0;i<64;i++){
          pseed2 += passpharse.substring(i % pharse_len, 1);
      }
      return calcMD5(pseed2).substring(0,26).toUpperCase();
  }
  ```
- **关键词:** create_wep_key128, passpharse, pseed2, calcMD5, toUpperCase, wep_def_key
- **备注:** 关联漏洞：空密钥接受机制。后续建议：检查无线配置处理模块

---
### ipc-sxstrg_get_storage_list-heap_overflow

- **文件路径:** `usr/sbin/sxstoragemanager`
- **位置:** `sxstoragemanager:0x403d24`
- **类型:** ipc
- **综合优先级分数:** **8.15**
- **风险等级:** 8.5
- **置信度:** 8.0
- **触发可能性:** 7.5
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** sxstrg_get_storage_list函数存在IPC堆溢出漏洞。具体表现：recvfrom接收网络数据到208字节栈缓冲区(acStack_f8)，未验证数据格式和长度即用strcpy复制到堆缓冲区。触发条件：发送>208字节或缺少终止符的IPC数据包。利用方式：构造恶意数据包实现堆溢出。约束条件：需访问IPC通信接口。
- **代码片段:**
  ```
  recvfrom(sock, acStack_f8, 208, 0, ...);
  strcpy(heap_buf, acStack_f8);
  ```
- **关键词:** sxstrg_get_storage_list, sxipc_receive, recvfrom, acStack_f8, strcpy
- **备注:** 需检查固件是否暴露IPC到网络接口。关联函数：sxstrg_get_usb_storage_info。

---
### stack_overflow-sprintf_watchdog-device

- **文件路径:** `sbin/watchdog`
- **位置:** `sbin/watchdog:0x401648 (main)`
- **类型:** configuration_load
- **综合优先级分数:** **8.15**
- **风险等级:** 8.5
- **置信度:** 8.0
- **触发可能性:** 7.5
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 发现高危栈缓冲区溢出漏洞：在main函数0x401648处，sprintf使用格式字符串'int=%d alive=%s realtime=%s'，其中'alive=%s'参数来自全局变量devname（从配置文件/etc/watchdog.conf的'watchdog-device'项获取）。目标缓冲区位于栈上sp+0x46位置，可用空间58字节。计算表明：当devname长度超过29字节时（格式化字符串固定部分占用29字节），将导致栈缓冲区溢出。攻击者可篡改配置文件设置超长'watchdog-device'值，在watchdog服务重启时触发漏洞，可能覆盖返回地址实现任意代码执行（进程以root权限运行）。
- **代码片段:**
  ```
  0x0040163c lw t9, -sym.imp.sprintf(gp)
  0x00401640 move a0, v1
  0x00401644 addiu a1, a1, 0x1e8c  ; " int=%d alive=%s realtime=%s"
  0x00401648 jalr t9
  ```
- **关键词:** sprintf, devname, watchdog-device, /etc/watchdog.conf, main
- **备注:** 实际利用需满足：1)/etc/watchdog.conf文件需可写 2)需重启watchdog服务触发解析。建议后续：检查配置文件权限；动态验证溢出长度；确认ASLR/PIE防护状态。

---
### stack_overflow-upgrade_language-0x4011bc

- **文件路径:** `bin/bulkUpgrade`
- **位置:** `bin/bulkUpgrade:upgrade_language@0x4011bc`
- **类型:** network_input
- **综合优先级分数:** **8.1**
- **风险等级:** 8.5
- **置信度:** 7.5
- **触发可能性:** 8.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 栈缓冲区溢出漏洞(upgrade_language)：攻击者通过控制param_1输入触发栈溢出。触发条件：param_1长度>1023字节。程序使用间接函数调用(**(gp-0x7f30))复制数据到1024字节栈缓冲区auStack_428，缺少边界检查，可覆盖返回地址实现代码执行。
- **关键词:** upgrade_language, param_1, auStack_428, gp-0x7f30
- **备注:** 需追踪param_1来源（疑似HTTP请求参数）。

---
### ip-validation-bypass-check_address

- **文件路径:** `wa_www/public.js`
- **位置:** `public.js:714-760`
- **类型:** network_input
- **综合优先级分数:** **8.1**
- **风险等级:** 8.0
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** IP验证绕过漏洞在check_address()。通过控制参数数量（1-3个）可绕过关键检查：1) 仅传my_obj时跳过mask_obj/ip_obj验证 2) 传两个参数时跳过ip_obj验证。触发条件：攻击者提交畸形表单数据（如省略IP字段）。影响：允许设置非法IP（广播/网络地址），破坏网络隔离。
- **代码片段:**
  ```
  if (check_address.arguments.length >= 2 && mask_obj != null){...}
  if (check_address.arguments.length == 3 && ip_obj != null){...}
  ```
- **关键词:** check_address, arguments.length, mask_obj, ip_obj, check_lan_setting
- **备注:** 利用链：可被DOM XSS漏洞（addstr函数）注入的恶意脚本自动触发畸形表单提交。调用点：LAN/WAN配置（行632-634）

---
### oob_access-dhcp_renew-end_option

- **文件路径:** `sbin/udhcpc`
- **位置:** `udhcpc:0x406140 sym.end_option`
- **类型:** network_input
- **综合优先级分数:** **8.05**
- **风险等级:** 8.5
- **置信度:** 8.0
- **触发可能性:** 7.0
- **查询相关性:** 9.2
- **阶段:** N/A
- **描述:** 越界内存访问漏洞（CWE-125）。具体表现：sym.end_option 中 'pcVar1 = param_1 + iVar2' 未验证偏移量，'iVar2 = iVar2 + pcVar1[1] + 2' 可能越界访问。触发条件：通过恶意 DHCP RENEW 包控制 param_1 缓冲区内容。利用方式：构造异常选项序列 → 触发 send_renew → kernel_packet → end_option 调用链 → 实现越界读写。
- **代码片段:**
  ```
  pcVar1 = param_1 + iVar2;
  if (*pcVar1 == '\0') {...} else { iVar2 = iVar2 + pcVar1[1] + 2; }
  ```
- **关键词:** sym.end_option, param_1, pcVar1, iVar2, sym.send_renew, sym.kernel_packet
- **备注:** DHCP 最大包长限制可能影响漏洞利用；与发现1共享协议处理框架

---
### oob_read-jcpd-puVar17_offset

- **文件路径:** `usr/sbin/jcpd`
- **位置:** `usr/sbin/jcpd: (sym.jcpd_run) 0x407ac0`
- **类型:** network_input
- **综合优先级分数:** **8.05**
- **风险等级:** 7.5
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** OOB读漏洞：同一函数中，当接收包长度≥88字节时，代码访问puVar17[0x2a]（偏移84字节）造成越界读。触发条件：1) 相同UDP访问路径 2) 发送长度≥88字节的特殊构造包。安全影响：1) 泄露栈内存敏感信息（如返回地址、寄存器值）2) 辅助绕过ASLR 3) 服务崩溃（DoS）。边界检查缺失：未验证接收长度与固定偏移访问的关系。
- **关键词:** puVar17, 0x2a, uVar8, recvfrom, OOB_read
- **备注:** 与栈溢出漏洞形成组合利用链（信息泄露→ASLR绕过→RCE）

---
### OOB_read-network_input-jcpd_run

- **文件路径:** `usr/sbin/jcpd`
- **位置:** `usr/sbin/jcpd:0x407ac0 (sym.jcpd_run)`
- **类型:** network_input
- **综合优先级分数:** **8.05**
- **风险等级:** 7.5
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** OOB读辅助漏洞：当接收≥88字节UDP数据时，puVar17[0x2a]越界访问导致栈内存泄露。触发条件：发送≥88字节特殊构造包。实际影响：辅助绕过ASLR，与栈溢出漏洞形成组合利用链，提高RCE成功率。
- **关键词:** recvfrom, OOB_read, puVar17, jcpd_run

---
### NVRAM-SensitiveInfoExposure

- **文件路径:** `www/tools_firmw.asp`
- **位置:** `pandoraBox.js: get_router_info()`
- **类型:** nvram_get
- **综合优先级分数:** **7.95**
- **风险等级:** 7.0
- **置信度:** 9.5
- **触发可能性:** 8.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** NVRAM敏感信息暴露风险：通过get_router_info()函数从misc.ccp获取设备配置数据（含hw_ver/fw_ver/login_info/cli_mac等敏感字段），未经任何过滤直接输出到HTML页面。攻击者可通过访问该页面获取设备指纹和MAC地址，辅助针对性攻击。若config_val()返回数据被污染（如通过NVRAM注入），可能触发存储型XSS。触发条件：用户访问/tools_firmw.asp页面即自动执行。
- **代码片段:**
  ```
  function get_router_info() {
    return {
      'login_info': config_val("login_Info"),
      'cli_mac': config_val("cli_mac")
    };
  }
  ```
- **关键词:** get_router_info, misc.ccp, config_val, login_Info, cli_mac, document.write
- **备注:** 需验证：1) misc.ccp的NVRAM访问安全 2) config_val()数据源是否可被污染；关联提示：知识库中已存在'config_val'、'document.write'、'login_Info'等关键词

---
### data_pollution-dhcp_script_injection-ncc_sync

- **文件路径:** `sbin/udhcpc`
- **位置:** `udhcpc:0x0040346c (ACK处理逻辑)`
- **类型:** network_input
- **综合优先级分数:** **7.95**
- **风险等级:** 7.5
- **置信度:** 8.0
- **触发可能性:** 9.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** DHCP 输入到脚本执行环境的数据污染风险。具体表现：udhcpc 将 DHCP 响应数据（auStack_3b8 缓冲区）以 'optionX' 环境变量形式传递给 /usr/share/udhcpc/ncc_sync.script。触发条件：攻击者控制 DHCP 服务器发送恶意选项值（如超长 option12 主机名或含特殊字符的 option15 域名）。利用方式：若脚本未安全处理变量，可导致命令注入或路径遍历。
- **关键词:** ncc_sync.script, auStack_3b8, -s, option12, option15
- **备注:** 实际风险取决于 ncc_sync.script 的安全实现；与发现1共享DHCP输入源

---
### command_execution-sxnotify_main-composite_vuln

- **文件路径:** `usr/sbin/sxstoragemanager`
- **位置:** `sxstoragemanager:0x004034b0`
- **类型:** command_execution
- **综合优先级分数:** **7.85**
- **风险等级:** 8.0
- **置信度:** 7.5
- **触发可能性:** 8.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** sxnotify_main函数存在复合文件操作漏洞。具体表现：-p参数接收的用户路径(iStack_30)直传fopen，fread读取内容到1024字节栈缓冲区(auStack_837)。触发条件：`sxstoragemanager sxnotify -p [恶意路径]`。利用方式：a)路径遍历读取敏感文件 b)文件>1024字节导致栈溢出。约束条件：需命令行参数控制。
- **代码片段:**
  ```
  FILE* fp = fopen(iStack_30, "r");
  fread(auStack_837, 1, 1024, fp);
  ```
- **关键词:** sxnotify_main, fopen, fread, auStack_837, iStack_30, -p
- **备注:** 需验证auStack_837实际缓冲区大小（可能<1024字节）。

---
### config_tamper-setenv_wlan_domain-0x4022d0

- **文件路径:** `bin/bulkUpgrade`
- **位置:** `bin/bulkUpgrade:main@0x4022d0`
- **类型:** configuration_load
- **综合优先级分数:** **7.8**
- **风险等级:** 7.0
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** WLAN域设置篡改漏洞：攻击者通过'-wdm'参数注入6字节内任意值修改无线配置。触发条件：1) 程序以'-wdm [value]'调用；2) [value]长度≤6字节。程序使用strncpy复制参数到固定缓冲区但未验证内容有效性，可能破坏网络策略。
- **关键词:** setenv_wlan_domain, -wdm, strncpy, 命令行参数
- **备注:** 需分析setenv_wlan_domain内部实现以评估实际影响。

---
### network_input-admin_password-weak_policy

- **文件路径:** `www/tools_admin.asp`
- **位置:** `www/tools_admin.asp:329`
- **类型:** network_input
- **综合优先级分数:** **7.8**
- **风险等级:** 7.0
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** 管理员密码修改功能存在弱密码策略风险：密码最小长度仅要求大于5字符（第329行），且未强制要求特殊字符组合。攻击者可通过暴力破解弱密码获取管理权限。触发条件：用户修改密码时使用简单密码，攻击者从网络接口发起认证请求。
- **代码片段:**
  ```
  if ($("#admin_password1").val().length <= '5'){
  	alert(get_words('limit_pass_msg'));
  	return false;
  }
  ```
- **关键词:** admin_password1, admPass2, check_varible, limit_pass_msg, is_ascii
- **备注:** 需结合登录接口分析实际爆破可行性；关联关键词'admin_password1'、'admPass2'已在历史发现中出现

---
### unsafe-script-exec-hotplug

- **文件路径:** `sbin/hotplug`
- **位置:** `/sbin/hotplug:6`
- **类型:** command_execution
- **综合优先级分数:** **7.8**
- **风险等级:** 7.0
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 不安全脚本执行机制：.hotplug脚本通过`$I $1`直接执行，依赖文件自身shebang或可执行权限。若恶意脚本无shebang，执行行为由当前shell决定，扩大攻击面。触发条件：攻击者植入特殊构造的.hotplug脚本。边界检查：仅验证文件可执行性（test -x），未校验内容安全性。安全影响：可结合路径遍历漏洞利用不同解释器特性实现代码执行逃逸
- **关键词:** test -x, $I $1, .hotplug
- **备注:** 建议后续分析/etc/hotplug.d/目录下脚本的具体实现（关联.hotplug相关发现），需验证脚本写入点是否可控

---
### network_input-www_ping-command_injection_risk

- **文件路径:** `www/tools_vct.asp`
- **位置:** `www/tools_vct.asp (JavaScript函数)`
- **类型:** network_input
- **综合优先级分数:** **7.75**
- **风险等级:** 7.5
- **置信度:** 8.0
- **触发可能性:** 8.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** HTTP参数注入风险：用户控制的ping_ipaddr/ping6_ipaddr参数在提交至ping.ccp前仅验证非空。触发条件：用户点击Ping按钮时，前端JavaScript将输入值直接拼接为'ccp_act=ping_v4&ping_addr='+用户输入。边界检查缺失：无IP格式校验、特殊字符过滤或长度限制。安全影响：若ping.ccp使用system()/exec()执行ping命令，攻击者可通过注入;、$()等特殊字符实现命令注入。
- **代码片段:**
  ```
  arg: 'ccp_act=ping_v4&ping_addr='+$('#ping_ipaddr').val()
  ```
- **关键词:** ping_ipaddr, ping6_ipaddr, check_ip, ajax_submit, ping.ccp, ping_v4, ccp_act, ping_addr, check_ipv6_ip
- **备注:** 实际风险取决于ping.ccp实现，需验证该文件是否存在命令执行逻辑。补充关联发现：1) 前端验证仅检查非空，缺失格式/字符/长度校验（风险6.0）；2) 用户输入通过ajax_submit→ping.ccp调用链暴露，参数名ping_addr和动作ping_v4强烈暗示系统命令执行（风险8.0）。后续需分析：ping.ccp是否调用system/popen、是否过滤ping_addr、执行上下文权限。

---
### network_input-schedules-rule_manipulation

- **文件路径:** `www/tools_schedules.asp`
- **位置:** `tools_schedules.asp (JavaScript send_request函数)`
- **类型:** network_input
- **综合优先级分数:** **7.75**
- **风险等级:** 7.5
- **置信度:** 8.0
- **触发可能性:** 8.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 用户输入参数(name/time/day等)通过表单提交到send_request()函数，前端仅验证长度和空格，未过滤特殊字符。参数经urlencode后构造CCP请求发送到get_set.ccp。触发条件：攻击者提交含恶意脚本/命令字符的表单数据。约束条件：前端验证可绕过，实际漏洞有效性依赖get_set.ccp对CCP请求的处理逻辑。安全影响：若后端未充分过滤，可导致存储型XSS(当规则名称回显)或配置注入(修改设备计划规则)。利用方式：构造恶意计划名称嵌入JS代码或系统命令。
- **代码片段:**
  ```
  function send_request(){
    if (get_by_id("name").value.length <= 0){
      alert(get_words('GW_SCHEDULES_NAME_INVALID'));
    }
    get_by_id("schRule_RuleName_").value = urlencode(get_by_id("name").value);
    get_by_id("schRule_SelectedDays_").value = check_day();
    // 提交到get_set.ccp
  ```
- **关键词:** name, all_week, day0, day1, day2, day3, day4, day5, day6, start_hour, end_hour, send_request, get_set.ccp, schRule_RuleName_, schRule_SelectedDays_
- **备注:** 需分析get_set.ccp验证后端处理逻辑；前端urlencode不能防御XSS(当值被HTML解码后显示)

---
### heap_overflow-dhcp6c-sip_option_concatenation

- **文件路径:** `bin/dhcp6c`
- **位置:** `dhcp6c:0x41c5ec (sip_processing)`
- **类型:** network_input
- **综合优先级分数:** **7.7**
- **风险等级:** 8.0
- **置信度:** 8.0
- **触发可能性:** 6.5
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** SIP选项堆溢出漏洞：处理new_sip_servers链表时缓冲区计算缺陷。触发条件：发送含超长地址(>46字节)的DHCPv6响应。触发步骤：a) 根据节点数(iVar13)分配iVar13*47+17字节 b) 循环拼接未验证单地址长度 c) 堆溢出覆盖关键数据。边界检查：缺失地址长度验证和缓冲区剩余空间跟踪。安全影响：可能篡改函数指针或vtable实现代码执行。
- **关键词:** new_sip_servers, iVar13, 0x4c, **(iStack_1b8 + -0x7e44), puVar18, malloc
- **备注:** 与第一个发现共享new_sip_servers处理点；需heap fuzzing验证

---
### input_chain-watchdog_conf_validation

- **文件路径:** `sbin/watchdog`
- **位置:** `/etc/watchdog.conf:0`
- **类型:** configuration_load
- **综合优先级分数:** **7.65**
- **风险等级:** 7.0
- **置信度:** 8.5
- **触发可能性:** 8.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 发现输入处理链：不可信输入通过配置文件/etc/watchdog.conf的'watchdog-device'项传入→存储到全局变量devname→传递至危险函数sprintf。验证机制缺陷：1) 配置项长度无限制（fgets仅限制单行80字节，但'watchdog-device'值可跨行）2) 未对设备路径进行正则校验或长度检查。
- **关键词:** config_file, fgets, watchdog-device, devname, sprintf
- **备注:** 关联漏洞利用链：文件写入漏洞/CGI漏洞→修改配置文件→触发watchdog溢出

---
### network_input-udhcpc-dhcp_option_memleak_0x40577c

- **文件路径:** `sbin/udhcpc`
- **位置:** `udhcpc:0x40577c sym.add_simple_option`
- **类型:** network_input
- **综合优先级分数:** **7.65**
- **风险等级:** 8.0
- **置信度:** 7.5
- **触发可能性:** 7.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** DHCP option处理存在内存泄露漏洞：当处理非0x0f类型option时，sym.add_simple_option函数将外部传入的param_3指针强制转换为4字节局部变量地址，随后sym.add_option_string使用*(param_2+1)+2作为长度参数执行内存复制。若攻击者控制DHCP报文中的option length字段使其值过大，可导致越界读取进程内存数据。触发条件：1) 攻击者发送特制DHCP报文 2) 报文中包含非0x0f类型option 3) option length字段被恶意设置。成功利用可泄露敏感信息如认证凭证。
- **代码片段:**
  ```
  if (param_2 != '\x0f') {
      param_3 = &uStack_20;
  }
  (**(iVar6 + -0x7e28))(auStack_66, param_3);
  ```
- **关键词:** sym.add_simple_option, sym.add_option_string, param_2, param_3, uStack_20, *(param_2+1)+2, DHCP option
- **备注:** 需验证：1) param_3是否来自网络输入 2) DHCP报文解析入口函数 3) 实际内存布局。关联关键词：sym.receivePacket（DHCP入口）

---
### network_input-storage-ajax_params

- **文件路径:** `www/storage.asp`
- **位置:** `www/storage.asp:0 [add_user, send_request]`
- **类型:** network_input
- **综合优先级分数:** **7.6**
- **风险等级:** 7.0
- **置信度:** 8.0
- **触发可能性:** 8.5
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 6个用户输入参数(wfa_enable, user_enable等)通过AJAX提交到get_set.ccp，直接影响NVRAM变量(如igdStorage_Enable_)。输入验证存在缺陷：1) 用户名未过滤特殊字符 2) 密码参数可能通过CCP协议传递到后端。攻击者可构造恶意用户名/NVRAM值尝试注入后端服务。触发条件：通过Web界面提交存储配置请求。
- **关键词:** wfa_enable, http_remote_port, user_name, pwd, get_set.ccp, igdStorage_Enable_, igdStorageUser_Password_
- **备注:** 需结合get_set.ccp分析确认NVRAM操作是否存在命令注入风险

---
### command_execution-hotplug-command_injection

- **文件路径:** `sbin/hotplug`
- **位置:** `/sbin/hotplug:具体行号未知`
- **类型:** command_execution
- **综合优先级分数:** **7.6**
- **风险等级:** 8.0
- **置信度:** 8.0
- **触发可能性:** 6.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 命令注入漏洞：通过未加引号的变量执行命令(test -x $I && $I $1)。$1参数未过滤特殊字符(如; & |)，攻击者可注入额外命令。例如$1='; reboot;'将导致系统重启。触发条件：控制$1参数或.hotplug脚本文件名。危险操作路径：$1→命令拼接→shell解释器执行。
- **关键词:** $I, $1, $I $1, test -x
- **备注:** 实际利用需控制$1或写入恶意.hotplug文件；关联到知识库中已有'$1'关键词的发现

---
### command_execution-network_input-jcpd_run

- **文件路径:** `usr/sbin/jcpd`
- **位置:** `usr/sbin/jcpd:0x00407f3c (jcpd_run)`
- **类型:** network_input
- **综合优先级分数:** **7.55**
- **风险等级:** 8.5
- **置信度:** 7.0
- **触发可能性:** 6.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 动态命令执行风险：通过函数指针(*puVar13[2])调用注册的命令处理函数。触发条件：1) 发送匹配注册命令的网络请求 2) 处理函数存在漏洞。边界检查：仅验证命令字符串（strcmp），未检查处理函数参数。安全影响：若注册函数（如jcpd_register_commands注册）存在漏洞，可导致二级RCE链。
- **关键词:** jcpd_run, puVar13, jcpd_register_commands, param_2, param_3, *(param_1 + 0x34)
- **备注:** 需追踪jcpd_register_commands调用链（建议后续分析注册函数及处理模块）

---
### network_input-http_redirect-back.asp-devModeChange

- **文件路径:** `www/back.asp`
- **位置:** `back.asp: devModeChange函数`
- **类型:** network_input
- **综合优先级分数:** **7.5**
- **风险等级:** 7.0
- **置信度:** 9.0
- **触发可能性:** 6.5
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** 客户端重定向漏洞：当URL参数event=devModeChange时，new_ip参数值未经任何验证直接拼接到redirect_target（'http://' + new_ip），通过window.location.href执行重定向。攻击者可构造恶意URL（如back.asp?event=devModeChange&new_ip=phishing.site）诱导用户点击，导致重定向至钓鱼站点。触发条件：1) 用户访问恶意构造的URL 2) 触发devModeChange函数（需用户交互点击）。安全影响：可能造成钓鱼攻击或中间人攻击，风险等级中等（需社会工程配合）。
- **代码片段:**
  ```
  function devModeChange(){
    var new_ip = getUrlEntry("new_ip");
    redirect_target = "http://" + new_ip;
  }
  ```
- **关键词:** devModeChange, new_ip, getUrlEntry, redirect_target, window.location.href
- **备注:** 需验证public.js中getUrlEntry的实现；漏洞需用户交互触发；未发现服务器端危险操作。未解决问题：1) 未观察到Request对象直接调用 2) 无系统命令/NVRAM操作 3) new_ip参数无边界检查。后续建议：1) 分析public.js的getUrlEntry安全性 2) 检查其他ASP文件的重定向模式

---
### network_input-email_config-input_validation_flaw

- **文件路径:** `www/tools_email.asp`
- **位置:** `www/tools_email.asp: send_request()函数`
- **类型:** network_input
- **综合优先级分数:** **7.45**
- **风险等级:** 6.5
- **置信度:** 8.0
- **触发可能性:** 9.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 输入验证机制缺陷：1) 端口检查(check_integer)仅验证数值范围，未过滤特殊字符；2) 邮箱字段(log_email_sender)无RFC合规格式校验。触发条件：提交含特殊字符的端口号或畸形邮箱地址。安全影响：可导致服务器解析错误或缓冲区溢出，攻击者通过畸形输入触发异常行为。
- **代码片段:**
  ```
  if (!check_integer(get_by_id("log_email_port").value, 0, 65535)) {
    alert(get_words('te_SMTPSv_Port_alert'));
    return false;
  }
  ```
- **关键词:** check_integer, log_email_port, log_email_sender, send_request, check_mail
- **备注:** 需增加正则表达式过滤，当前漏洞利用依赖后端解析器特性

---
### cross-component-nvram-pollution-chain

- **文件路径:** `bin/miniupnpd`
- **位置:** `跨组件：bin/miniupnpd → www/tools_firmw.asp`
- **类型:** nvram_set_to_dom
- **综合优先级分数:** **7.45**
- **风险等级:** 8.0
- **置信度:** 7.5
- **触发可能性:** 6.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 完整的NVRAM污染攻击链：攻击者通过miniupnpd的NVRAM写操作（nvram_set）篡改adminCfg_RemoteAdminHttpPort_等参数，污染数据被web接口的config_val()函数读取后，在tools_firmw.asp页面经document.write触发存储型XSS。触发步骤：1) 利用miniupnpd漏洞（如SOAP请求注入）写入恶意NVRAM值 2) 诱导管理员访问/tools_firmw.asp页面。实际利用概率：中（依赖miniupnpd漏洞利用+管理员交互）
- **关键词:** nvram_set, config_val, adminCfg_RemoteAdminHttpPort_, document.write, upnp
- **备注:** 关联证据：1) miniupnpd支持upnp命令执行NVRAM操作 2) tools_firmw.asp通过config_val()读取adminCfg_*参数 3) 污染值直接输出到HTML。验证方向：检查miniupnpd是否可写入web接口使用的NVRAM变量

---
### nvram_set-lang_removal-vulchain

- **文件路径:** `www/tools_time.asp`
- **位置:** `tools_firmw.asp:0 (unknown)`
- **类型:** nvram_set
- **综合优先级分数:** **7.45**
- **风险等级:** 7.0
- **置信度:** 8.5
- **触发可能性:** 7.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** NVRAM污染风险链（风险等级7.0）：通过tools_firmw.asp的send_rm_lang_pack()触发removeLang操作，修改has_lang_pack等NVRAM值。攻击者可构造CSRF请求（触发条件：诱导用户点击或跨站请求）。潜在影响：1) 破坏系统本地化配置 2) 若NVRAM参数用于权限控制，可能导致权限绕过。
- **关键词:** removeLang, has_lang_pack, lang_ver, config_val, form5, lang_upgrade.ccp
- **备注:** 需验证后端NVRAM_set操作的输入过滤。注意关联已有关键词：config_val

---
### hardware_input-hotplugd-DEVPATH-0x004025e0

- **文件路径:** `usr/sbin/hotplugd`
- **位置:** `hotplugd:0x004025e0 (main)`
- **类型:** hardware_input
- **综合优先级分数:** **7.4**
- **风险等级:** 7.0
- **置信度:** 9.0
- **触发可能性:** 6.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** DEVPATH环境变量处理存在风险：程序通过函数指针设置DEVPATH（值来自栈变量），作为热插拔核心参数由内核传递设备路径。未实施边界检查或过滤逻辑，攻击者通过恶意USB设备控制该变量可能导致路径遍历或命令注入（需后续组件验证）。触发条件：设备热插拔事件发生时。安全影响：中高危（7.0），可能成为多阶段攻击的初始输入点。
- **关键词:** DEVPATH, setenv, auStack_1594, **(iVar4 + -0x7e50)
- **备注:** 需通过KBQuery追踪DEVPATH在热插拔脚本中的使用情况

---
### network_input-schedules-csrf

- **文件路径:** `www/tools_schedules.asp`
- **位置:** `tools_schedules.asp (JavaScript del_row函数)`
- **类型:** network_input
- **综合优先级分数:** **7.35**
- **风险等级:** 6.5
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** 计划删除功能(del_row())进行权限检查但无CSRF防护。inst参数直接拼接入请求URL触发get_set.ccp删除操作。触发条件：诱导已认证用户访问恶意链接(含inst参数)。约束条件：需用户处于认证状态且点击链接。安全影响：攻击者可删除任意计划规则导致服务中断(如防火墙规则失效)。利用方式：结合钓鱼邮件或XSS攻击发送恶意URL。
- **代码片段:**
  ```
  function del_row(row, i){
    if(login_Info!= "w") return;
    var param = {
      url: "get_set.ccp",
      arg: "ccp_act=del&num_inst=1&oid_1=IGD_ScheduleRule_i_&inst_1=1."+inst.substr(1,1)+".0.0.0"
    };
    get_config_obj(param);
  }
  ```
- **关键词:** del_row, inst_1, IGD_ScheduleRule_i_, usedSchd, get_config_obj
- **备注:** 建议添加CSRF token验证；可通过XSS漏洞自动触发增强利用

---
### network_input-www_reboot.asp-gup_validation

- **文件路径:** `www/reboot.asp`
- **位置:** `www/reboot.asp:? (gup) ?`
- **类型:** network_input
- **综合优先级分数:** **7.35**
- **风险等级:** 7.0
- **置信度:** 8.5
- **触发可能性:** 6.5
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 输入验证缺失：gup()函数仅转义方括号字符，未对特殊字符（如: / # ?）进行过滤。当返回值用于DOM操作或URL构造时（如控制.ip_info显示），可能引发XSS漏洞。触发条件：攻击者注入含JS代码的参数值。
- **代码片段:**
  ```
  function gup(name){
    name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
    var regexS = "[\\?&]"+name+"=([^&#]*)";
    ...
    return results[1];
  }
  ```
- **关键词:** gup, regex.exec, window.location.href, name.replace
- **备注:** msg参数虽未直接利用，但验证缺失模式可能存在于其他参数

---
### command_execution-mydlink_watch_dog-param_injection

- **文件路径:** `sbin/mydlink-watch-dog.sh`
- **位置:** `sbin/mydlink-watch-dog.sh:10-15`
- **类型:** command_execution
- **综合优先级分数:** **7.35**
- **风险等级:** 8.5
- **置信度:** 7.0
- **触发可能性:** 5.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 未经验证的外部参数$1直接用于危险命令：1) killall -9 $1 2) 通过/mydlink/$1或/opt/$1启动进程。攻击者可注入恶意参数（如'; rm -rf /'）实现命令注入。触发条件：调用脚本时传入污染参数。安全影响：任意命令执行或固件破坏。需确认$1是否源自网络/NVRAM等不可信源。
- **代码片段:**
  ```
  killall -9 $1
  if [ -f /mydlink/$1 ]; then
    /mydlink/$1 > /dev/null 2>&1 &
  ```
- **关键词:** $1, killall, /mydlink/$1, /opt/$1
- **备注:** 关键后续任务：1) 搜索调用此脚本的文件 2) 验证$1是否来自网络/NVRAM等不可信源。关联关键词：killall, $1

---
### analysis-status-hotplug-attack-surface

- **文件路径:** `sbin/hotplug`
- **位置:** `N/A`
- **类型:** analysis_status
- **综合优先级分数:** **7.35**
- **风险等级:** 7.5
- **置信度:** 8.0
- **触发可能性:** 6.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 热插拔漏洞攻击面未明：路径遍历（path-traversal-hotplug-param1）和脚本执行（unsafe-script-exec-hotplug）漏洞的触发依赖$1参数外部可控性，但当前分析未确定$1来源。已知关联点：1) 内核热插拔事件可能通过设备属性传递$1 2) 用户空间服务（如udev）可能触发hotplug调用。安全影响：若$1可通过网络/USB等接口控制，则形成高危远程攻击链。
- **关键词:** hotplug, $1, 内核热插拔, udev
- **备注:** 后续关键任务：1) 分析内核文档（Documentation/hotplug/）确定$1传递机制 2) 审计/etc/udev/rules.d/规则文件 3) 检查是否存在网络接口调用hotplug

---
### ipc-sxipc_create-path_traversal

- **文件路径:** `usr/sbin/sxstoragemanager`
- **位置:** `sxstoragemanager:0x4053cc`
- **类型:** ipc
- **综合优先级分数:** **7.35**
- **风险等级:** 7.5
- **置信度:** 8.0
- **触发可能性:** 6.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** sxipc_create函数存在路径遍历漏洞。具体表现：外部路径参数(param_1)未经净化直接用于stat/open操作。触发条件：攻击者通过IPC调用链（如sxstrg_get_storage_list）注入含'../'的路径。利用方式：结合路径模板'/tmp/sxipc/ipc-%s.sock'访问任意文件。约束条件：需控制IPC通信参数。
- **代码片段:**
  ```
  iVar2 = stat(param_1, &stack_buffer);
  ```
- **关键词:** sxipc_create, param_1, stat, open, sxipc_create_clientipc, sxstrg_get_storage_list
- **备注:** 需验证sxstrg_get_usb_storage_info等关联函数的参数可控性。

---
### buffer_overflow-dns_reply_query-0x40df70

- **文件路径:** `sbin/dnsmasq`
- **位置:** `sbin/dnsmasq:0x40df70 sym.reply_query`
- **类型:** network_input
- **综合优先级分数:** **7.35**
- **风险等级:** 7.0
- **置信度:** 7.5
- **触发可能性:** 8.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** DNS请求处理函数reply_query()中，通过recvfrom接收网络数据后仅验证最小长度(>11字节)，未检查最大长度限制。缓冲区指针和大小来自全局配置结构体偏移0x88和0x84。潜在影响：缓冲区溢出。因无法追踪配置结构体初始化，不能确认缓冲区大小是否固定或受外部配置影响。
- **代码片段:**
  ```
  if ((0xb < iVar2) && ((*puVar10 >> 0x17 & 1) != 0)) {...}
  ```
- **关键词:** sym.reply_query, sym.imp.recvfrom, *(*piVar13 + 0x88), *(*piVar13 + 0x84)
- **备注:** 需通过动态分析确认：1) 全局配置结构体初始化来源 2) 实际缓冲区分配大小 3) 是否受/etc/dnsmasq.conf配置影响

---
### command_execution-system_ops-csrf

- **文件路径:** `www/tools_time.asp`
- **位置:** `www/tools_system.asp:87-118`
- **类型:** command_execution
- **综合优先级分数:** **7.3**
- **风险等级:** 6.0
- **置信度:** 9.0
- **触发可能性:** 8.0
- **查询相关性:** 7.5
- **阶段:** N/A
- **描述:** 系统高危操作无认证（风险等级6.0）：www/tools_system.asp的restoreConfirm/confirm_reboot等函数仅通过前端JS弹窗确认，未验证会话有效性。攻击者构造CSRF可触发：1) 恢复出厂设置 2) 设备重启。触发条件：用户访问恶意页面时自动提交请求。
- **关键词:** restoreConfirm, confirm_reboot, form3, form6, dev_info.login_info
- **备注:** 需结合身份认证机制评估实际可利用性。注意关联已有关键词：form3/form6

---
### attack-chain-dos

- **文件路径:** `www/storage.asp`
- **位置:** `www/storage.asp: send_request()函数`
- **类型:** network_input
- **综合优先级分数:** **7.25**
- **风险等级:** 7.0
- **置信度:** 7.5
- **触发可能性:** 7.5
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 服务拒绝攻击链：利用wa_http_port参数注入非数字值（如'80a'）→parseInt转换产生NaN→绕过check_integer范围验证→冲突检测逻辑异常。触发条件：远程管理功能开启时提交畸形端口值。实际影响：导致Web服务异常停止。
- **关键词:** send_request, wa_http_port, parseInt, check_integer, ac_alert_invalid_port, adminCfg_RemoteAdminHttpPort_
- **备注:** 关联远程管理端口配置，实际影响需结合服务重启机制

---
### iv-tools_ddns-300

- **文件路径:** `www/tools_ddns.asp`
- **位置:** `tools_ddns.asp:300-308,407-440`
- **类型:** network_input
- **综合优先级分数:** **7.2**
- **风险等级:** 6.0
- **置信度:** 9.0
- **触发可能性:** 7.5
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 输入验证缺陷：1) IPv6验证（check_ipv6_symbol/check_ipv6_address）仅检查格式合法性，未过滤特殊字符 2) 主机名校验（check_client_name）排除数字开头但允许<>'\"等危险符号 3) 空值检查（check_form）未覆盖XSS关键字段。边界检查不充分导致前述漏洞可利用。
- **代码片段:**
  ```
  if (!check_client_name(reserved_name) || _isNumeric(reserved_name)){
    alert(get_words('DDNS_HOST_ERROR'));
    return false;
  }
  ```
- **关键词:** check_ipv6_symbol, check_client_name, check_form, save_reserved, check_varible

---
### command_execution-smbd_service_chain

- **文件路径:** `usr/sbin/hotplug_misc.sh`
- **位置:** `hotplug_misc.sh:22-27`
- **类型:** command_execution
- **综合优先级分数:** **7.2**
- **风险等级:** 7.0
- **置信度:** 8.0
- **触发可能性:** 6.5
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** 服务管理命令注入风险：1) killall smbd使用固定进程名，攻击者可提前部署同名恶意进程造成拒绝服务 2) smbd启动依赖/tmp/smb.dir.conf内容，该文件完全由攻击者通过DEVPATH控制。未对配置文件内容过滤，可通过注入恶意smb.conf参数（如log file = |恶意命令）实现权限提升。触发条件：攻击者成功写入恶意配置后触发smbd服务重启
- **代码片段:**
  ```
  killall smbd
  $SMBD -s "/etc/samba/smb.conf" -D
  ```
- **关键词:** killall, smbd, smb.dir.conf, SMBD, grep path, DEVPATH

---
### attack_chain_gap-dhcp6c_duid_file_write

- **文件路径:** `bin/dhcp6c`
- **位置:** `全局分析结论`
- **类型:** analysis_gap
- **综合优先级分数:** **7.2**
- **风险等级:** 7.0
- **置信度:** 9.0
- **触发可能性:** 5.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 关键攻击链缺口：DUID文件处理漏洞（heap_overflow-dhcp6c-duid_file_processing）的利用依赖攻击者能写入/var/dhcp6c_duid文件，但当前知识库中未发现任何文件上传或写入漏洞可达成此目标。完整攻击路径需满足：1) 存在Web接口或网络服务允许写入目标文件；2) 写入内容可控；3) 文件权限允许dhcp6c进程读取。安全影响：无初始写入漏洞将导致该堆溢出无法被远程触发。
- **关键词:** /var/dhcp6c_duid, file_write, web_upload, attack_chain
- **备注:** 关联heap_overflow-dhcp6c-duid_file_processing；后续分析应优先寻找文件写入漏洞

---
### fixed_memcpy-dhcp6s-lease_address-0x4180d0

- **文件路径:** `bin/dhcp6s`
- **位置:** `dhcp6s:0x4180d0 (lease_address)`
- **类型:** network_input
- **综合优先级分数:** **7.15**
- **风险等级:** 6.5
- **置信度:** 9.0
- **触发可能性:** 6.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** lease_address 函数存在固定长度拷贝风险：使用 16 字节固定长度 memcpy 未验证源缓冲区（param_1）实际大小。触发条件：调用者传递 <16 字节的缓冲区。安全影响：越界读取可能导致敏感信息泄露或程序崩溃。
- **代码片段:**
  ```
  0x4180d4: move a1, s1
  0x4180d8: addiu a2, zero, 0x10
  ```
- **关键词:** lease_address, memcpy, param_1, 0x10, a2
- **备注:** 需验证 param_1 来源是否受外部输入影响

---
### configuration_load-accel-pptp-arithmetic_injection

- **文件路径:** `sbin/accel-pptp.sh`
- **位置:** `accel-pptp.sh:35`
- **类型:** configuration_load
- **综合优先级分数:** **7.15**
- **风险等级:** 6.5
- **置信度:** 9.0
- **触发可能性:** 6.0
- **查询相关性:** 7.5
- **阶段:** N/A
- **描述:** 算术操作未验证输入类型，直接对$5(PPTP_OPTIME)执行expr运算。攻击者传入非数字值可导致命令执行错误，破坏服务可用性。触发条件：控制PPTP_OPTIME参数的组件未进行输入过滤。无任何类型检查或异常处理机制。
- **代码片段:**
  ```
  PPTP_OPTIME=\`expr $PPTP_OPTIME \* 60\`
  ```
- **关键词:** PPTP_OPTIME, expr, $5

---
### vulnerability-path_traversal-save_append

- **文件路径:** `www/storage_WFA_1_00.asp`
- **位置:** `www/storage_WFA_1_00.asp:0 (save_append)`
- **类型:** network_input
- **综合优先级分数:** **7.1**
- **风险等级:** 7.0
- **置信度:** 8.0
- **触发可能性:** 6.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 路径遍历漏洞：攻击者通过HTTP表单提交恶意路径（如含`../`序列），利用`save_append`函数仅过滤反斜杠(`\`)但未检查正斜杠路径遍历的缺陷。触发条件：用户提交存储路径配置请求时。约束条件：客户端仅通过`indexOf('\\')`检查反斜杠，未对`/`或`../`进行过滤。实际影响：结合固件环境，可能绕过目录限制访问系统文件（如`/etc/passwd`），利用概率取决于服务器端`web_access.ccp`是否二次验证。
- **代码片段:**
  ```
  if(path_content == '\\' || (path_content.indexOf('\\') != -1)) {
    alert(addstr(get_words(MSG056), '\\');
    return;
  }
  ```
- **关键词:** save_append, folder_path, path_content, get_set.ccp, web_access.ccp, DataArray, encodeURIComponent
- **备注:** 需验证服务器端文件'www/web_access.ccp'对路径的规范化处理。建议后续分析该文件确认是否实施完整路径过滤。

---
### env-set-injection-uenv-main

- **文件路径:** `bin/uenv`
- **位置:** `bin/uenv:? (main) 0x00401024`
- **类型:** env_set
- **综合优先级分数:** **7.1**
- **风险等级:** 6.0
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 环境变量设置操作存在注入漏洞。当执行`uenv set [name] [value]`时，程序直接使用命令行参数调用setenv()，未对name/value进行字符过滤（仅检查'='在name中的存在）。攻击者可注入包含特殊字符的环境变量（如`uenv set PATH '恶意路径'`）。触发条件：攻击者能执行uenv命令（通常需shell访问）。安全影响：破坏环境变量解析，但影响限于当前进程会话（因未触发MTD持久化写入），无法直接导致固件级持久化攻击。
- **代码片段:**
  ```
  (**(iVar2 + -0x7fac))(puStackX_4[2],puStackX_4[3]); // 直接传递argv参数
  ```
- **关键词:** setenv, argv[2], argv[3], puStackX_4
- **备注:** 需结合环境变量使用场景（如busybox）评估实际影响；建议检查调用uenv的启动脚本。关联点：寻找环境变量读取(env_get)或持久化写入操作。

---
### network_input-udhcpd-option_parsing-risk

- **文件路径:** `sbin/udhcpd`
- **位置:** `.rodata:0 [unknown] 0x004080f4`
- **类型:** network_input
- **综合优先级分数:** **7.1**
- **风险等级:** 6.0
- **置信度:** 9.0
- **触发可能性:** 7.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** DHCP选项处理风险。发现硬编码'option'字符串，表明程序直接处理DHCP选项数据。边界检查：无证据显示存在输入验证。安全影响：选项数据可能作为前述漏洞（如sendACK命令注入）的输入载体。
- **关键词:** option, udhcpd.conf, static_lease, max_leases
- **备注:** 需反编译分析get_option等函数的输入处理逻辑

---
### network_input-remote_admin-filter_xss

- **文件路径:** `www/tools_admin.asp`
- **位置:** `www/tools_admin.asp:280-288`
- **类型:** network_input
- **综合优先级分数:** **7.1**
- **风险等级:** 8.0
- **置信度:** 7.0
- **触发可能性:** 5.0
- **查询相关性:** 7.5
- **阶段:** N/A
- **描述:** 访问控制过滤规则存在XSS风险：add_option()函数动态生成选项时直接输出array_filter_name（第280-288行），未对用户输入的过滤规则名称做HTML编码。攻击者通过设置恶意规则名称可存储XSS载荷。触发条件：管理员查看远程管理页面时触发恶意脚本。
- **代码片段:**
  ```
  for (var i = 0; i < obj; i++){
  	document.write("<option value=" + inst.charAt(2) + ">" + nam[i] + "</option>");
  }
  ```
- **关键词:** add_option, array_filter_name, remote_inbound_filter, document.write
- **备注:** 需确认过滤规则名称是否通过其他接口设置；关联关键词'document.write'已在历史发现中出现

---
### network_input-tools_system_asp-csrf_missing

- **文件路径:** `www/tools_system.asp`
- **位置:** `tools_system.asp: JavaScript functions restoreConfirm & confirm_reboot`
- **类型:** network_input
- **综合优先级分数:** **7.05**
- **风险等级:** 6.5
- **置信度:** 8.0
- **触发可能性:** 7.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 高危操作缺少CSRF防护：恢复出厂设置(restoreConfirm)和重启(confirm_reboot)仅检查管理员权限，未验证请求来源。攻击者可构造CSRF攻击诱导管理员触发设备重置。触发条件：管理员登录状态下访问恶意页面。约束条件：需诱使管理员点击恶意链接。影响：导致设备配置清零或服务中断，成功概率取决于浏览器安全策略。
- **关键词:** restoreConfirm, confirm_reboot, dev_info.login_info, form3, form6, ccp_act=restore, ccp_act=reboot
- **备注:** 需全局检查CSRF防护机制：1) 是否存在anti-CSRF token；2) 关键操作是否检查Referer。建议扫描所有ASP文件的表单提交逻辑。

---
### command_injection-dhcp_option_43-0x40a240

- **文件路径:** `sbin/dnsmasq`
- **位置:** `dnsmasq:0x40a240 (recv_dhcp_packet)`
- **类型:** network_input
- **综合优先级分数:** **7.05**
- **风险等级:** 8.5
- **置信度:** 6.0
- **触发可能性:** 5.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** DHCP报文处理函数recv_dhcp_packet()中，option 43字段内容未经充分验证即拼接至shell命令（通过my_system执行），存在命令注入风险。触发条件：需启用lease_update_script功能且客户端发送恶意option字段。潜在影响：RCE（远程代码执行）。因符号表缺失，无法确认lease_update_script默认状态及调用路径验证机制。
- **关键词:** recv_dhcp_packet, option_43, lease_update_script, my_system
- **备注:** 关键局限：无法验证lease_update_script是否默认启用。攻击链构建依赖：1) 动态分析确认/etc/dnsmasq.conf配置 2) 验证DHCP客户端是否可控option字段

---
### network_input-remote_admin-port_conflict

- **文件路径:** `www/tools_admin.asp`
- **位置:** `www/tools_admin.asp:223-243`
- **类型:** network_input
- **综合优先级分数:** **7.0**
- **风险等级:** 6.5
- **置信度:** 8.5
- **触发可能性:** 6.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 远程管理端口冲突检测逻辑缺陷：端口检查函数chg_rm_port()仅对比固定值8080/8090（第223-243行），未验证端口是否被其他高危服务（如SSH）占用。攻击者可诱骗用户设置冲突端口，导致服务拒绝。触发条件：用户启用远程管理并修改端口，攻击者通过HTTP参数注入恶意端口值。
- **代码片段:**
  ```
  if ((chk_port == '8080') || ((chk_port == rmgr_port) && (rmgr_port!='0'))) {
  	$('#remote_http_management_port').val("8090");
  }
  ```
- **关键词:** chg_rm_port, remote_http_management_port, rmgr_port, rmgr_ports, adminCfg_RemoteAdminHttpPort_
- **备注:** 需验证get_set.ccp如何处理端口参数；关联关键词'adminCfg_RemoteAdminHttpPort_'已在历史发现中出现

---

## 低优先级发现

### network_input-smbd_reply_sesssetup_and_X-SPNEGO

- **文件路径:** `sbin/smbd`
- **位置:** `smbd:0x4ba470 (sym.reply_sesssetup_and_X)`
- **类型:** network_input
- **综合优先级分数:** **6.9**
- **风险等级:** 7.0
- **置信度:** 7.0
- **触发可能性:** 6.5
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** SPNEGO认证流程存在验证机制缺陷风险：1) parse_negTokenTarg直接处理recvfrom接收的网络数据（攻击面暴露）2) 关键验证函数(**(iVar6 + -0x64dc))未完全反编译，无法确认其边界检查完整性 3) 多层过滤机制（协议标识验证、令牌结构验证）的实现存在不确定性。触发条件：攻击者发送畸形SPNEGO认证包可能绕过验证机制，但具体漏洞利用链未证实。
- **关键词:** parse_negTokenTarg, reply_sesssetup_and_X, SPNEGO, NTLMSSP, recvfrom, (**(iVar6 + -0x64dc)), aiStack_510
- **备注:** 后续建议：1) 逆向0x64dc偏移对应的验证函数 2) 测试畸形SPNEGO令牌的解析行为；关联发现：知识库中存在多个通过recvfrom接收未验证网络输入导致的漏洞（如jcpd栈溢出、dnsmasq堆溢出等）

---
### dos-dnsmasq-dhcp_parser_0x0041b220

- **文件路径:** `sbin/dnsmasq`
- **位置:** `dnsmasq:0 (dhcp_parser) 0x0041b220`
- **类型:** network_input
- **综合优先级分数:** **6.85**
- **风险等级:** 6.5
- **置信度:** 8.0
- **触发可能性:** 6.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** DHCP报文选项解析缺陷：虽检查udp_len基础长度，但未验证option_type与option_len逻辑一致性。触发条件：构造畸形option字段使option_len超出实际数据长度，导致服务崩溃（拒绝服务）。
- **关键词:** dhcp_packet, option_len, udp_len, DHCP_OPTIONS_MAX

---
### network_input-syslog_server-address

- **文件路径:** `www/tools_syslog.asp`
- **位置:** `www/tools_syslog.asp`
- **类型:** network_input
- **综合优先级分数:** **6.65**
- **风险等级:** 6.0
- **置信度:** 7.5
- **触发可能性:** 7.0
- **查询相关性:** 8.5
- **阶段:** N/A
- **描述:** 在系统日志配置页面(tools_syslog.asp)中，用户输入的sys_server参数（系统日志服务器地址）通过客户端JavaScript获取，最大长度限制15字符。触发条件：用户启用系统日志(sel_sys_enable.checked=true)并提交表单。参数值被拼接到CCP请求参数(sysLog_SysLogServerAddress_1.1.0.0.0)发送至get_set.ccp。约束条件：客户端IP格式验证(check_address)和LAN IP冲突检查(check_LAN_ip)，但无服务端验证证据。潜在安全影响：若get_set.ccp未正确处理该参数，可能引发命令注入或缓冲区溢出（如超过15字符限制时）。攻击者可绕过客户端验证直接构造恶意CCP请求。
- **关键词:** sys_server, sysLog_SysLogServerAddress_1.1.0.0.0, do_submit, get_config_obj, check_address, check_LAN_ip, sel_sys_enable
- **备注:** 需分析get_set.ccp文件以验证sysLog_SysLogServerAddress参数处理逻辑。客户端验证可绕过，建议检查服务端对CCP请求的过滤机制。

---
### path_hijack-kill_command

- **文件路径:** `usr/hotplug`
- **位置:** `hotplug:15`
- **类型:** command_execution
- **综合优先级分数:** **6.65**
- **风险等级:** 6.5
- **置信度:** 8.0
- **触发可能性:** 5.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 环境变量依赖风险：kill命令未使用绝对路径，依赖运行时PATH变量。若PATH被其他漏洞篡改（如通过恶意rc脚本），攻击者可替换恶意kill程序实现权限持久化。触发条件：1) PATH变量可控 2) 需配合漏洞触发机制。
- **关键词:** kill, PATH
- **备注:** 与知识库notes字段关联：'需结合环境变量使用场景...寻找env_get操作'。建议修复：使用/bin/kill绝对路径

---
### file_read-storage-path_traversal

- **文件路径:** `www/storage.asp`
- **位置:** `www/storage.asp:0 [browser_folder]`
- **类型:** file_read
- **综合优先级分数:** **6.55**
- **风险等级:** 6.5
- **置信度:** 7.0
- **触发可能性:** 6.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** folder_path参数处理存在路径遍历风险：仅过滤反斜杠但允许正斜杠且未防御'..'序列。当通过browser_folder()设置路径时，值直接拼入AJAX请求(req_subfolder)。攻击者可构造如'/etc/passwd'的路径尝试访问系统文件。触发条件：用户操作文件浏览功能时注入恶意路径。
- **代码片段:**
  ```
  path_content = $('#folder_path').val();
  if(path_content.indexOf('\\') != -1) { alert(...) }
  ```
- **关键词:** folder_path, req_subfolder, browser_folder, get_path
- **备注:** 实际漏洞取决于后端web_access.ccp对get_path的解析，需进一步验证

---
### dos-script-service-control

- **文件路径:** `sbin/opt.local`
- **位置:** `sbin/opt.local`
- **类型:** command_execution
- **综合优先级分数:** **6.5**
- **风险等级:** 6.0
- **置信度:** 9.0
- **触发可能性:** 4.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 脚本通过位置参数$1(action)接收外部输入，但使用case语句严格限制为start/stop/restart白名单。当输入非法指令时仅显示帮助信息，无法绕过验证。在stop/restart分支中，使用kill -9强制终止'mydlink-watch-dog.sh'和'signalc'进程。攻击者若能调用该脚本并传入stop/restart参数（需通过权限验证），可造成服务拒绝，但无法执行任意命令或文件操作。
- **关键词:** action=$1, case $action in, kill -9, killall -9, mydlink-watch-dog.sh, signalc
- **备注:** 实际利用需配合权限获取漏洞，建议检查调用此脚本的上级组件权限控制

---
### ci-tools_ddns-523

- **文件路径:** `www/tools_ddns.asp`
- **位置:** `tools_ddns.asp:523`
- **类型:** network_input
- **综合优先级分数:** **6.45**
- **风险等级:** 7.0
- **置信度:** 6.5
- **触发可能性:** 5.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 潜在服务器端命令注入链：用户控制的DataArray.Name/IP通过get_config_obj发送至get_set.ccp（参数名ddnsListCfg_HostName_/Yiaddr_）。若服务器端未安全处理参数（如直接拼接系统命令），可造成命令注入。触发条件：提交含特殊字符（;|$）的主机名。当前证据显示参数传递完整但需验证get_set.ccp处理逻辑。
- **代码片段:**
  ```
  paramForm.arg += "&ddnsListCfg_HostName_"+instStr+"="+DataArray[i].Name;
  ```
- **关键词:** get_config_obj, paramForm.arg, ddnsListCfg_HostName_, ddnsListCfg_Yiaddr_, get_set.ccp
- **备注:** 关键待验证点：get_set.ccp对参数的过滤和调用方式。建议后续分析get_set.ccp的command_exec调用点

---
### hardware_input-ACTION_validation_bypass

- **文件路径:** `usr/sbin/hotplug_misc.sh`
- **位置:** `hotplug_misc.sh:6-34`
- **类型:** hardware_input
- **综合优先级分数:** **6.45**
- **风险等级:** 6.0
- **置信度:** 7.5
- **触发可能性:** 6.0
- **查询相关性:** N/A
- **阶段:** N/A
- **描述:** ACTION变量未验证：环境变量ACTION直接用于case分支选择，未过滤非法值。攻击者可设置非常规ACTION值尝试激活未使用代码路径（如符号链接创建）。触发条件：控制热插拔事件的ACTION变量。
- **关键词:** ACTION
- **备注:** 潜在攻击面扩展点。建议审查所有热插拔脚本的ACTION验证逻辑

---
### hardware_input-hotplug_service_kill-001

- **文件路径:** `usr/sbin/hotplug_kill.sh`
- **位置:** `hotplug_kill.sh:11-14`
- **类型:** hardware_input
- **综合优先级分数:** **6.45**
- **风险等级:** 6.5
- **置信度:** 8.0
- **触发可能性:** 4.0
- **查询相关性:** 9.5
- **阶段:** N/A
- **描述:** 当$1='stop'时无条件执行killall smbd终止Samba服务。触发条件：1) hotplugd守护进程处理存储设备卸载事件 2) 系统存在脏页（DIRTY=1）或无视脏页（DIRTY=0）。攻击路径：攻击者通过物理操作强制制造存储设备脏页并移除设备→触发hotplugd调用脚本→传递'stop'参数→终止关键服务。实际影响：拒绝服务攻击(CWE-400)，但利用需物理接触设备且依赖脏页状态。
- **代码片段:**
  ```
  "stop" )
  #	if [ $DIRTY = 1 ]; then
  		killall smbd
  ```
- **关键词:** $1, killall, smbd, hotplugd, com_umount, /proc/meminfo, dirty page, DIRTY
- **备注:** 后续建议：1) 分析hotplugd的脏页检查逻辑是否可被污染 2) 检查网络接口是否可模拟设备卸载事件。关联发现：参数验证缺陷（见hardware_input-hotplug_param_validation-002）可能降低攻击门槛。局限性：物理访问要求降低可利用性。

---
### nvram_operation-config_val-nvram_exposure

- **文件路径:** `www/tools_admin.asp`
- **位置:** `待确认 (函数: config_val/config_str_multi)`
- **类型:** nvram_set
- **综合优先级分数:** **6.4**
- **风险等级:** 8.0
- **置信度:** 8.0
- **触发可能性:** N/A
- **查询相关性:** N/A
- **阶段:** N/A
- **描述:** NVRAM操作路径暴露：通过config_val()和get_config_obj()函数读写adminCfg_RemoteAdminHttpPort_等敏感配置项。触发条件：页面加载或配置保存时自动执行。约束条件：需管理员权限触发操作。安全影响：攻击者利用CSRF或会话劫持可篡改远程管理设置，开启未授权访问路径
- **关键词:** config_val, config_str_multi, get_config_obj, adminCfg_RemoteAdminHttpPort_, adminCfg_RemoteManagementEnable_, param.arg
- **备注:** 关键链点：adminCfg_*参数与发现1的HTTP注入点直接关联，需追踪param.arg数据流

---
### network_input-tools_admin.asp-http_parameter_injection

- **文件路径:** `www/tools_admin.asp`
- **位置:** `www/tools_admin.asp (待确认具体行号)`
- **类型:** network_input
- **综合优先级分数:** **6.35**
- **风险等级:** 8.5
- **置信度:** 7.0
- **触发可能性:** N/A
- **查询相关性:** N/A
- **阶段:** N/A
- **描述:** HTTP参数注入风险：攻击者可伪造POST请求操控admin_password1/hostname等参数（绕过客户端JS验证）。触发条件：向tools_admin.asp发送恶意表单数据。约束条件：依赖服务端get_set.ccp的输入过滤。安全影响：若get_set.ccp未充分过滤，可导致NVRAM污染或命令注入（通过adminCfg_*参数链）
- **关键词:** admin_password1, admPass2, hostname, remote_enable, send_request, get_set.ccp, adminCfg_SystemName_, adminCfg_RemoteManagementEnable_
- **备注:** 需验证get_set.ccp对adminCfg_*参数的过滤机制，关联NVRAM操作路径（参见发现2）

---
### Unverified-FirmwareUpload

- **文件路径:** `www/tools_firmw.asp`
- **位置:** `tools_firmw.asp: HTML form`
- **类型:** network_input
- **综合优先级分数:** **6.3**
- **风险等级:** 6.0
- **置信度:** 7.0
- **触发可能性:** 6.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** 未经验证的文件上传入口：前端表单直接提交文件名至fwupgrade.ccp，仅进行空值检查（$('#file').val()）。攻击者可上传恶意固件文件，结合后端漏洞实现固件篡改。触发条件：用户选择文件并点击上传按钮。实际风险依赖fwupgrade.ccp的验证机制（当前文件缺失无法验证）。
- **代码片段:**
  ```
  <input type=file id=file name=file size="30">
  $('#form1').submit();
  ```
- **关键词:** file, form1, fwupgrade.ccp, send_request, CCP_SUB_UPLOADFW
- **备注:** 关键风险点：需后续分析fwupgrade.ccp的签名验证和文件处理逻辑；关联提示：知识库中已存在'file'、'form1'、'send_request'等关键词

---
### configuration_load-hotplugd-dynamic_path-0x004024c0

- **文件路径:** `usr/sbin/hotplugd`
- **位置:** `hotplugd:0x004024c0 (main)`
- **类型:** configuration_load
- **综合优先级分数:** **6.2**
- **风险等级:** 6.0
- **置信度:** 8.0
- **触发可能性:** 4.0
- **查询相关性:** 7.5
- **阶段:** N/A
- **描述:** 动态配置文件路径构造风险：程序使用snprintf类函数动态构建'/etc/silex_nas.conf'等路径，未实施路径消毒。攻击者若能篡改NVRAM或通过目录遍历注入可能影响程序行为。触发条件：程序初始化时加载配置。安全影响：中危（6.0），实际风险取决于文件写入权限和内容验证机制。
- **关键词:** /etc/silex_nas.conf, /etc/sysconfig, system.conf, snprintf, **(iVar4 + -0x7ce8)
- **备注:** 建议检查目标文件的ACL权限和内容验证逻辑

---
### hardware_input-action_validation

- **文件路径:** `usr/sbin/hotplug_misc.sh`
- **位置:** `hotplug_misc.sh:6-34`
- **类型:** hardware_input
- **综合优先级分数:** **6.1**
- **风险等级:** 5.5
- **置信度:** 8.5
- **触发可能性:** 4.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 输入验证缺失：1) ACTION环境变量直接用于case分支选择，未过滤非法值，可能绕过事件处理逻辑 2) 注释代码显示STORAGEPATH从/tmp/smb.dir.conf解析，通过ln -s创建符号链接时未验证路径合法性。若启用该功能，攻击者可创建指向敏感文件（如/etc/shadow）的符号链接。触发条件：攻击者控制smb.dir.conf文件内容且相关代码取消注释
- **代码片段:**
  ```
  case "$ACTION" in
  ...
  #ln -s $STORAGEPATH /tmp/storage
  ```
- **关键词:** ACTION, STORAGEPATH, ln -s, grep path, case, smb.dir.conf
- **备注:** 当前风险较低因代码被注释，但固件更新可能激活该功能；与发现1共享smb.dir.conf控制点

---
### configuration_load-base64_encoding_flaw

- **文件路径:** `www/login.asp`
- **位置:** `login.asp: encode_base64()函数`
- **类型:** configuration_load
- **综合优先级分数:** **6.0**
- **风险等级:** 2.0
- **置信度:** 10.0
- **触发可能性:** 10.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 自定义Base64编码函数(encode_base64)使用非标准字符集(map1)，但因同时传输原始密码(log_pass)而完全失效。该机制无法提供实际安全防护，仅增加代码复杂度。触发条件：与密码传输漏洞同步触发。
- **代码片段:**
  ```
  function encode_base64(psstr) {
    return encode(psstr,psstr.length);
  }
  var map1="ABCDEFGHIJKLMNOPQRSTUVWXYZ...";
  ```
- **关键词:** encode_base64(), map1, password, log_pass
- **备注:** 安全机制设计缺陷，建议移除冗余编码逻辑以减少攻击面

---
### configuration_load-nas_conf-env_exposure

- **文件路径:** `usr/sbin/hotplugd`
- **位置:** `/etc/silex/nas.conf:0 [config_loader] 0x0`
- **类型:** configuration_load
- **综合优先级分数:** **5.95**
- **风险等级:** 5.0
- **置信度:** 7.5
- **触发可能性:** 6.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 发现潜在攻击面：配置文件/etc/silex/nas.conf内容未经过滤直接设置到SHAREPATH环境变量（通过setenv调用）。虽未在本次分析中直接用于命令执行，但该变量在全局环境暴露，可能被其他组件利用。
- **关键词:** SHAREPATH, setenv, /etc/silex/nas.conf
- **备注:** 建议后续追踪SHAREPATH在其他组件（如挂载脚本）中的使用情况

---
### input_validation-client_filter-weakness

- **文件路径:** `www/tools_admin.asp`
- **位置:** `待确认 (函数: check_varible/is_ascii)`
- **类型:** network_input
- **综合优先级分数:** **5.45**
- **风险等级:** 7.0
- **置信度:** 6.5
- **触发可能性:** N/A
- **查询相关性:** N/A
- **阶段:** N/A
- **描述:** 输入验证缺陷：客户端使用is_ascii/is_quotes进行基础过滤，但未检测换行符、命令分隔符等特殊字符。触发条件：直接发送畸形HTTP请求。约束条件：服务端可能有额外验证。安全影响：结合get_set.ccp的实现缺陷，可能构造多阶段攻击链（如通过hostname参数注入命令）
- **关键词:** check_varible, is_ascii, is_quotes, remote_http_management_port, hostname
- **备注:** 与发现1形成组合风险：绕过客户端过滤的输入可能被get_set.ccp处理

---
### vulnerability-clear_text_transmission-add_user

- **文件路径:** `www/storage_WFA_1_00.asp`
- **位置:** `www/storage_WFA_1_00.asp:0 (add_user)`
- **类型:** network_input
- **综合优先级分数:** **5.3**
- **风险等级:** 4.0
- **置信度:** 9.0
- **触发可能性:** 3.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 敏感信息明文传输：用户密码通过AJAX明文传输至`get_set.ccp`，存储为NVRAM参数`igdStorageUser_Password_`。触发条件：用户添加/修改账户时。约束条件：存在基础验证（用户名保留词检查、端口范围验证、密码一致性）。安全影响：无直接代码执行风险，但传输过程可能被中间人攻击截获。
- **代码片段:**
  ```
  submitData += "&igdStorageUser_Password_1.1."+(user_idx)+".0.0="+usrPasswd[j].split("/")[1];
  ```
- **关键词:** add_user, usrPasswd, igdStorageUser_Password_, send_request, check_port_use
- **备注:** 风险程度依赖HTTPS配置。未发现边界检查缺失或缓冲区溢出。

---
### hardware_input-gpio_set_led-atoi_boundary

- **文件路径:** `bin/gpio`
- **位置:** `bin/gpio:0x401320 (gpio_set_led)`
- **类型:** hardware_input
- **综合优先级分数:** **5.29**
- **风险等级:** 1.5
- **置信度:** 9.8
- **触发可能性:** 8.0
- **查询相关性:** 9.0
- **阶段:** N/A
- **描述:** GPIO控制程序存在参数边界检查缺陷：1) 命令行参数通过atoi转换存储为无符号整型；2) 边界检查仅验证上限(gpio_number≤31)；3) 负输入(如'-1')被atoi转换为4294967295触发检查失败。触发条件：攻击者传递负参数。实际影响：被错误处理分支拦截，无法执行危险ioctl操作。
- **代码片段:**
  ```
  uStack_28 = atoi(*(param_2 + 8));
  if (0x1f < uStack_28) { /* 错误处理 */ }
  ```
- **关键词:** gpio_set_led, atoi, ioctl, /dev/gpio
- **备注:** 缺陷被防御机制有效控制。建议：1) 验证GPIO驱动对异常ioctl参数的容错性；2) 检查其他参数边界处理

---
### logic_risk-watchdog_priority

- **文件路径:** `sbin/watchdog`
- **位置:** `/etc/watchdog.conf:0`
- **类型:** configuration_load
- **综合优先级分数:** **5.25**
- **风险等级:** 5.0
- **置信度:** 6.5
- **触发可能性:** 4.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 发现潜在逻辑风险：1) 通过'priority'配置项控制sched_setscheduler调用，错误设置可能导致DoS 2) 'watchdog-device'路径未验证即用于open操作，可能造成任意文件访问。但受限于：设备路径需符合内核要求；优先级设置需root权限。
- **关键词:** priority, sched_setscheduler, open, watchdog-device

---
### Firmware-Upload-Chain-Gap

- **文件路径:** `www/tools_firmw.asp`
- **位置:** `未分析文件: fwupgrade.ccp`
- **类型:** evidence_gap
- **综合优先级分数:** **5.2**
- **风险等级:** 5.0
- **置信度:** 9.0
- **触发可能性:** 0.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 固件上传攻击链关键证据缺口：前端文件上传入口（tools_firmw.asp）提交至fwupgrade.ccp处理，但该文件尚未分析。需验证：1) 是否存在固件签名验证 2) 文件解压/写入过程是否含命令注入 3) CCP_SUB_UPLOADFW操作码的安全约束。完整攻击链依赖此文件分析结果：若验证缺失，攻击者可上传恶意固件实现持久化控制。
- **关键词:** fwupgrade.ccp, CCP_SUB_UPLOADFW, file, send_request
- **备注:** 最高优先级缺口：与发现'Unverified-FirmwareUpload'直接关联，补齐后可能提升原风险至8.0+

---
### Firmware-Upload-Chain-Gap

- **文件路径:** `www/tools_time.asp`
- **位置:** `未分析文件: fwupgrade.ccp`
- **类型:** evidence_gap
- **综合优先级分数:** **5.2**
- **风险等级:** 5.0
- **置信度:** 9.0
- **触发可能性:** 0.0
- **查询相关性:** 10.0
- **阶段:** N/A
- **描述:** 固件上传攻击链关键证据缺口：前端文件上传入口（tools_firmw.asp）提交至fwupgrade.ccp处理，但该文件尚未分析。需验证：1) 是否存在固件签名验证 2) 文件解压/写入过程是否含命令注入 3) CCP_SUB_UPLOADFW操作码的安全约束。完整攻击链依赖此文件分析结果：若验证缺失，攻击者可上传恶意固件实现持久化控制。
- **关键词:** fwupgrade.ccp, CCP_SUB_UPLOADFW, file, send_request
- **备注:** 最高优先级缺口：与发现'network_input-firmw_upload-vulchain'直接关联，补齐后可能将风险提升至9.5+

---
### log_injection-network_input-jcpd_run

- **文件路径:** `usr/sbin/jcpd`
- **位置:** `usr/sbin/jcpd:0x00407f3c (jcpd_run)`
- **类型:** network_input
- **综合优先级分数:** **5.1**
- **风险等级:** 5.0
- **置信度:** 6.0
- **触发可能性:** 4.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 潜在日志注入风险：未注册命令触发日志记录(**(iVar20 + -0x7e78))，参数(puStack_34)外部可控。触发条件：发送未注册命令。安全影响：若日志函数存在格式化字符串漏洞，可能引发信息泄露或内存破坏。
- **关键词:** jcpd_run, puStack_34, *(iVar20 + -0x7e78), str.command_is__s__request_command_s_n
- **备注:** 需验证日志函数实现（偏移-0x7e78）是否存在格式化字符串漏洞

---
### input-truncation-eth.sh-SetMac

- **文件路径:** `sbin/eth.sh`
- **位置:** `eth.sh: (SetMac函数)`
- **类型:** command_execution
- **综合优先级分数:** **5.0**
- **风险等级:** 4.0
- **置信度:** 8.0
- **触发可能性:** 3.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 输入截断缺陷：当$2长度小于substr截取位置时，awk返回空字符串导致flash写入空值。可能破坏MAC地址存储结构，但需特定条件触发（如配置超短MAC地址）。相比命令注入风险较低。
- **关键词:** substr, awk, $2, flash -w
- **备注:** 需验证flash程序对空输入的容错性。与发现ID:command-injection-eth.sh-SetMac存在关联数据流

---
### design_flaw-parameter_validation

- **文件路径:** `usr/sbin/hotplug_kill.sh`
- **位置:** `hotplug_kill.sh:6-10`
- **类型:** configuration_load
- **综合优先级分数:** **4.7**
- **风险等级:** 3.0
- **置信度:** 10.0
- **触发可能性:** 1.0
- **查询相关性:** 6.0
- **阶段:** N/A
- **描述:** 参数校验机制存在设计缺陷：1) DIRTY参数($2)在ACTION='start'分支进行校验([ $DIRTY = 1 ])但未执行实际操作 2) ACTION='stop'分支的历史校验代码被注释(#Tin Remark)。表明输入处理逻辑不完整，若未来启用注释代码可能引入未验证的'killall ftpd'操作。当前风险有限，但显示代码维护问题。
- **代码片段:**
  ```
  if [ $DIRTY = 1 ]; then
  
  fi
  #		killall ftpd #Tin Remark 20120615
  ```
- **关键词:** DIRTY, $2, if [ $DIRTY = 1 ], #Tin Remark
- **备注:** 历史变更记录(20120615)显示曾被修改，需在固件版本比对中验证变更原因。与ACTION漏洞无直接关联，但反映hotplug机制的整体脆弱性

---
### hardware_input-hotplug_param_validation-002

- **文件路径:** `usr/sbin/hotplug_kill.sh`
- **位置:** `hotplug_kill.sh:5,8,13`
- **类型:** hardware_input
- **综合优先级分数:** **4.6**
- **风险等级:** 3.0
- **置信度:** 9.0
- **触发可能性:** 2.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 参数验证机制存在设计缺陷：DIRTY参数($2)在'start'分支进行检测但无实际操作，'stop'分支的DIRTY检测被注释。边界检查缺失导致参数验证逻辑形同虚设，虽当前未造成直接漏洞，但暴露hotplug机制整体脆弱性，可能被用于扩大攻击面。
- **代码片段:**
  ```
  DIRTY=$2
  ...
  if [ $DIRTY = 1 ]; then
  ```
- **关键词:** DIRTY, $2, hotplugd, boundary_check
- **备注:** 需结合固件变更历史分析被注释代码的潜在风险。该缺陷与服务终止漏洞（hardware_input-hotplug_service_kill-001）共同构成攻击链基础。

---
### param_injection-mdb_set-value_validation

- **文件路径:** `sbin/mdb`
- **位置:** `sbin/mdb`
- **类型:** command_execution
- **综合优先级分数:** **4.4**
- **风险等级:** 3.0
- **置信度:** 9.0
- **触发可能性:** 1.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 中危参数注入路径降级：mdb set命令的value参数虽未经充分验证即传递给下游函数，但关键处理函数ChkString(0x400984)仅进行空值检查，未实施缓冲区操作。未发现strcpy等危险函数调用。当前证据表明此路径无法直接导致内存破坏，风险限于逻辑漏洞层面。
- **关键词:** mdb set, value, ChkString, obj.StrMapMdbAct

---
### command_execution-dnsmasq-receive_query_0x40dd64

- **文件路径:** `sbin/dnsmasq`
- **位置:** `dnsmasq:0 (sym.receive_query) 0x40dd64`
- **类型:** command_execution
- **综合优先级分数:** **4.35**
- **风险等级:** 3.0
- **置信度:** 9.5
- **触发可能性:** N/A
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 硬编码system命令执行：receive_query调用system("killall mini_httpd")参数固定，无输入污染路径。触发条件：特定DNS查询逻辑，仅造成mini_httpd进程终止（拒绝服务）。
- **关键词:** sym.receive_query, system, killall, mini_httpd

---
### command_execution-dnsmasq-reply_query_0x40e058

- **文件路径:** `sbin/dnsmasq`
- **位置:** `dnsmasq:0 (sym.reply_query) 0x40e058`
- **类型:** command_execution
- **综合优先级分数:** **4.35**
- **风险等级:** 3.0
- **置信度:** 9.5
- **触发可能性:** N/A
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 硬编码system命令执行：reply_query调用system("killall mini_httpd")参数固定，无输入污染路径。触发条件：特定DNS查询逻辑，仅造成mini_httpd进程终止（拒绝服务）。
- **关键词:** sym.reply_query, system, killall, mini_httpd

---
### library-uClibc-vulnerability_vectors

- **文件路径:** `bin/miniupnpd`
- **位置:** `/lib/libc.so.0`
- **类型:** command_execution
- **综合优先级分数:** **4.3**
- **风险等级:** 5.0
- **置信度:** 4.0
- **触发可能性:** 3.0
- **查询相关性:** 6.0
- **阶段:** N/A
- **描述:** uClibc库(libc.so.0)存在未验证的安全风险。触发条件：若编译时禁用栈保护(-fno-stack-protector)或危险函数(strcpy/sprintf)未加固，可能被miniupnpd的缓冲区操作触发。实际影响取决于：1) libc具体版本 2) 内存操作函数的边界检查实现 3) GOT表可覆盖性。
- **关键词:** libc.so.0, ld-uClibc.so.0, strcpy, sprintf
- **备注:** 需提取/lib/libc.so.0进行：1) 栈保护机制验证 2) strcpy/sprintf函数反汇编 3) GOT表覆盖可行性分析

---
### input_validation-factory_reset-no_parameter_handling

- **文件路径:** `sbin/factory_reset`
- **位置:** `sbin/factory_reset`
- **类型:** command_execution
- **综合优先级分数:** **4.2**
- **风险等级:** 2.0
- **置信度:** 10.0
- **触发可能性:** 1.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 脚本未实现任何参数处理机制：未使用$1/$2等位置参数，未读取环境变量，无条件分支逻辑。作为独立组件无直接外部输入点，但作为高危操作端点，其调用上下文可能引入攻击面。
- **代码片段:**
  ```
  echo 1 > /proc/load_default
  sleep 10
  exit 0
  ```
- **关键词:** exit 0
- **备注:** 建议后续分析：1) 查找调用此脚本的进程；2) 检查/proc/load_default的内核处理逻辑

---
### mtd-path-overflow-uenv-main

- **文件路径:** `bin/uenv`
- **位置:** `bin/uenv:? (main) 0x00400f24`
- **类型:** file_read
- **综合优先级分数:** **3.95**
- **风险等级:** 3.0
- **置信度:** 7.5
- **触发可能性:** 1.0
- **查询相关性:** 6.5
- **阶段:** N/A
- **描述:** MTD设备路径构造存在缓冲区管理缺陷。程序使用sprintf格式化设备路径（/dev/mtdblockX），其中X来自8字节栈缓冲区(auStack_20)。目标缓冲区大小未验证，若全局路径缓冲区小于17字节（'/dev/mtdblock' + 8字节 + null），可能导致溢出。触发条件：/proc/mtd返回超长设备号（需篡改/proc伪文件系统，通常需root权限）。安全影响：理论上的栈溢出风险，但实际触发需特权条件且未发现直接控制溢出数据的路径。
- **代码片段:**
  ```
  (**(iVar2 + -0x7fa8))(*(iVar2 + -0x7f68), "_dev_mtdblock_s", auStack_20);
  ```
- **关键词:** sprintf, auStack_20, /dev/mtdblock, *(iVar2 + -0x7f68)
- **备注:** 目标缓冲区*(iVar2-0x7f68)大小未验证；实际风险受限于/proc/mtd篡改难度。关联点：检查MTD设备操作函数（如擦除/写入）。

---
### file_permission-mdb_test-priv_escalation

- **文件路径:** `sbin/mdb`
- **位置:** `sbin/mdb_test.sh`
- **类型:** configuration_load
- **综合优先级分数:** **3.9**
- **风险等级:** 4.0
- **置信度:** 5.0
- **触发可能性:** 2.0
- **查询相关性:** 6.0
- **阶段:** N/A
- **描述:** 权限配置风险待验证：sbin/mdb的rwxrwxrwx权限理论上允许权限提升，但缺乏两项关键证据：1) /etc/passwd未确认低权限账户存在 2) 系统启动脚本未发现自动调用mdb/mdb_test.sh的记录。实际风险取决于运行时环境配置。
- **关键词:** file_permission, mdb_test.sh, /etc/passwd, /etc/init.d
- **备注:** 后续需提供：1) 完整/etc/passwd 2) 系统启动脚本 3) crontab配置

---
### file_read-gpio-permission

- **文件路径:** `bin/gpio`
- **位置:** `bin/gpio`
- **类型:** file_read
- **综合优先级分数:** **3.25**
- **风险等级:** 0.5
- **置信度:** 10.0
- **触发可能性:** N/A
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 文件权限为777但未设置setuid位，运行时保持当前用户权限，无法直接提权。
- **代码片段:**
  ```
  文件权限设置
  ```
- **关键词:** gpio

---
### static-file-support_men.asp

- **文件路径:** `www/support_men.asp`
- **位置:** `www/support_men.asp:0`
- **类型:** static_content
- **综合优先级分数:** **3.0**
- **风险等级:** 0.0
- **置信度:** 10.0
- **触发可能性:** 0.0
- **查询相关性:** 0.0
- **阶段:** N/A
- **描述:** 文件'support_men.asp'为纯静态HTML页面，经全面分析确认：1) 无ASP服务器端代码，不存在HTTP参数获取点（如Request.QueryString）2) 无危险操作调用（exec/ShellExecute等）3) JavaScript函数仅处理文本本地化，未接收外部输入。因此该文件无法作为攻击路径的初始输入点，也不包含可被利用的安全缺陷。
- **关键词:** support_men.asp, show_words, document.write
- **备注:** 需转向分析其他动态文件（如*.asp/*.cgi）寻找初始输入点。建议后续分析关注：1) 含表单处理的ASP文件 2) CGI二进制程序 3) 涉及NVRAM操作的脚本

---
### static-www-support_tools.asp

- **文件路径:** `www/support_tools.asp`
- **位置:** `www/support_tools.asp:0 (static)`
- **类型:** configuration_load
- **综合优先级分数:** **3.0**
- **风险等级:** 0.0
- **置信度:** 10.0
- **触发可能性:** 0.0
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 文件 'www/support_tools.asp' 是纯静态HTML帮助文档，无服务器端处理逻辑。具体表现：1) 不接收任何HTTP参数（QueryString/Form/Cookies） 2) 未实例化危险对象（如WScript.Shell） 3) 无命令执行函数调用 4) 所有敏感字符串（如_password）仅用于界面文本展示。文件无外部输入处理能力，因此不存在可被触发的安全漏洞或攻击路径。
- **关键词:** support_tools.asp, show_words, document.write, public.js
- **备注:** 建议后续分析：1) 检查引用的JS文件（public.js/pandoraBox.js）是否存在客户端漏洞 2) 转向其他ASP文件（如tools_admin.asp）分析服务器端逻辑

---
### command_execution-gpio-vuln_absence

- **文件路径:** `bin/gpio`
- **位置:** `bin/gpio`
- **类型:** command_execution
- **综合优先级分数:** **2.95**
- **风险等级:** 0.2
- **置信度:** 9.5
- **触发可能性:** N/A
- **查询相关性:** 6.0
- **阶段:** N/A
- **描述:** 未发现高危漏洞特征：1) 无命令执行函数(system/execv)；2) printf使用固定格式；3) 所有ioctl调用均受参数检查保护。
- **代码片段:**
  ```
  整体函数分析
  ```
- **关键词:** ioctl, printf, system

---
### file_write-watchdog_conf-wdg_sh

- **文件路径:** `sbin/wdg.sh`
- **位置:** `wdg.sh:1-33`
- **类型:** file_write
- **综合优先级分数:** **2.94**
- **风险等级:** 0.0
- **置信度:** 9.8
- **触发可能性:** 0.0
- **查询相关性:** 7.5
- **阶段:** N/A
- **描述:** wdg.sh是静态看门狗配置脚本，仅通过硬编码常量向/etc/watchdog.conf追加配置。无参数处理逻辑（无$*/$1变量）、未调用nvram/setenv等环境操作命令、未接收任何外部输入（网络/环境变量/参数等）。所有配置值（如'max-load-1=24'）均为常量，无输入验证需求。脚本在启动时一次性执行，无持续监听或交互接口，无法构成攻击链环节。
- **代码片段:**
  ```
  #!/bin/sh
  CONF_FILE=/etc/watchdog.conf
  echo "file = /var/log/messages" >> $CONF_FILE
  echo "max-load-1 = 24" >> $CONF_FILE
  echo "watchdog-device = /dev/watchdog" >> $CONF_FILE
  ```
- **关键词:** CONF_FILE, /etc/watchdog.conf, echo, max-load-1, min-memory, watchdog-device, pidfile, /var/log/messages, /var/run/syslogd.pid
- **备注:** 该文件无攻击面。建议检查调用此脚本的启动组件（如/etc/init.d）是否存在配置注入风险，或分析其他可能操作watchdog.conf的动态组件。

---
### excluded-hotplugd_stack_overflow

- **文件路径:** `usr/sbin/jcpd`
- **位置:** `unknown: (sym.sxstrg_get_storage_list)`
- **类型:** network_input
- **综合优先级分数:** **2.7**
- **风险等级:** 0.0
- **置信度:** 9.0
- **触发可能性:** N/A
- **查询相关性:** 8.0
- **阶段:** N/A
- **描述:** 原始报告的hotplugd服务栈溢出（sym.sxstrg_get_storage_list）被排除：缓冲区大小208字节与接收长度限制匹配，循环边界检查完善（26次*8字节）
- **关键词:** sym.sxstrg_get_storage_list, acStack_f8, iVar6, 0xd0
- **备注:** 经验证缓冲区与接收限制匹配，无实际溢出风险

---
### risk-stack_overflow-sym.iptc_init

- **文件路径:** `bin/miniupnpd`
- **位置:** `bin/miniupnpd:0x42c67c (sym.iptc_init)`
- **类型:** network_input
- **综合优先级分数:** **2.7**
- **风险等级:** 2.0
- **置信度:** 5.0
- **触发可能性:** 1.0
- **查询相关性:** 7.0
- **阶段:** N/A
- **描述:** 潜在栈溢出风险：sym.iptc_init函数中strcpy操作将外部参数arg_b8h复制到152字节栈缓冲区。触发条件：攻击者控制arg_b8h且提供>152字节数据。但分析受阻：1) 调用链追溯失败 2) 无法确认arg_b8h是否受网络输入控制。当前证据不足，暂不列为有效漏洞。
- **关键词:** sym.iptc_init, arg_b8h, strcpy, sp+0x20
- **备注:** 后续建议：1) 人工逆向调用链 2) 检查配套脚本/config文件。注意：关键词'sp+0x20'与mii_mgr漏洞(command_execution-mii_mgr-ioctl_control)存在关联但上下文不同。

---
